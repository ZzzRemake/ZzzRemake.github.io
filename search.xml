<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MIT 6.S081 Lab7-9 Thread &amp; Network Driver</title>
      <link href="/2024/01/27/mit-6.s081-lab7-9-thread/"/>
      <url>/2024/01/27/mit-6.s081-lab7-9-thread/</url>
      
        <content type="html"><![CDATA[<h2 id="Lab-Thread">Lab Thread</h2><p>å“ˆå“ˆï¼Œè´¼ç®€å•ï¼Œä½†åˆè„‘æ®‹äº†ï¼Œæ€ä¹ˆæœ‰äººè®°é”™äº†æ ˆçš„å¢é•¿æ–¹å‘çš„ï¼Œæ¶ˆæ¯äº†ã€‚</p><h3 id="è¯¾ç¨‹">è¯¾ç¨‹</h3><p>æœ‰ä¸€è¯´ä¸€ï¼Œè¯¾ç¨‹å†…å®¹å…¶å®å°±å¸®ä½ æŠŠLabåšä¸€éäº†ã€‚</p><p>åé¢æœ‰æœºä¼šäº†è¡¥ç½¢ã€‚</p><h3 id="Uthread-switching-between-threads-moderate">Uthread: switching between threads (moderate)</h3><p>æœ€éš¾çš„ï¼ˆè¿«çœŸï¼‰</p><p>é¦–å…ˆå»ºä¸ªä¸Šä¸‹æ–‡contextç»“æ„ä½“ï¼Œç”¨ç»“æ„ä½“å­˜å¿…è¦çš„calleeå¯„å­˜å™¨ä»¥åŠraï¼Œspï¼Œ ç”¨æ±‡ç¼–è¿›è¡Œswitchå³å¯ã€‚</p><p>uthread.c:</p><pre class="language-c" data-language="c"><code class="language-c">struct ucontext{  uint64 ra;  uint64 sp;  // callee-saved  uint64 s0;  uint64 s1;  uint64 s2;  uint64 s3;  uint64 s4;  uint64 s5;  uint64 s6;  uint64 s7;  uint64 s8;  uint64 s9;  uint64 s10;  uint64 s11;};struct thread {  char       stack[STACK_SIZE]; /* the thread's stack */  int        state;             /* FREE, RUNNING, RUNNABLE */  struct ucontext context;};struct thread all_thread[MAX_THREAD];struct thread *current_thread;void thread_schedule(void){       //....  if (current_thread != next_thread) {         /* switch threads?  */    next_thread-&gt;state = RUNNING;    t = current_thread;    current_thread = next_thread;    /* YOUR CODE HERE     * Invoke thread_switch to switch from t to next_thread:     * thread_switch(??, ??);     */    thread_switch((uint64)(&amp;t-&gt;context), (uint64)(&amp;next_thread-&gt;context));  } else    next_thread = 0;}void thread_create(void (*func)()){  struct thread *t;  for (t = all_thread; t &lt; all_thread + MAX_THREAD; t++) {    if (t-&gt;state == FREE) break;  }  t-&gt;state = RUNNABLE;  // YOUR CODE HERE  memset(&amp;t-&gt;context, 0, sizeof(t-&gt;context));  t-&gt;context.ra = (uint64)func;  t-&gt;context.sp = (uint64)(t-&gt;stack+STACK_SIZE-1);  // å‘ï¼š spæ˜¯åå‘å¢é•¿ã€‚ã€‚ã€‚ã€‚ä»¤äººæ„Ÿå¹ã€‚}</code></pre><p>è€Œæ±‡ç¼–çš„å†…å®¹ã€‚ã€‚ã€‚å…¶å®ç›´æ¥å¯ä»¥æŠŠ<code>kernel/swtch.S</code>æŠ„è¿‡æ¥ã€‚</p><h3 id="Using-threads-moderate">Using threads (moderate)</h3><p>pthreadçš„ç®€å•åº”ç”¨ã€‚ä½†è¿™é‡Œæœ‰ä¸€ä¸ªä¼˜åŒ–æ˜¯å¯ä»¥å•ç‹¬è¯´çš„ã€‚</p><p>åŸé¢˜è¦æ±‚å°†ä¸€ä¸ªå•çº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨æ”¹æˆå¤šçº¿ç¨‹å®‰å…¨ï¼Œè‹¥æ¯ä¸ªæ¡¶éƒ½ç”¨ç›¸åŒçš„é”ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹å°†é€€åŒ–ä¸ºä¸²è¡Œæ‰§è¡Œï¼Œä¸èƒ½èµ·åˆ°å¹¶è¡ŒåŠ é€Ÿçš„æ•ˆæœï¼›ä½†è‹¥å¯¹æ¯ä¸ªæ¡¶å•ç‹¬åŠ ä¸ªé”ï¼Œä¾¿å¯ä»¥åšåˆ°å¹¶è¡ŒåŠ é€Ÿã€‚</p><p>å› æ­¤ï¼Œè¿™éƒ¨åˆ†æœ‰<code>ph_safe</code>å’Œ<code>ph_fast</code>ä¸¤ä¸ªæµ‹è¯•ï¼Œåˆ†åˆ«æµ‹è¯•æ­£ç¡®æ€§å’Œä¼˜åŒ–åçš„å¹¶è¡ŒåŠ é€Ÿã€‚</p><p>ph.c:</p><pre class="language-c" data-language="c"><code class="language-c">pthread_mutex_t entry_mutex[NBUCKET];static void put(int key, int value){  int i = key % NBUCKET;  // is the key already present?  struct entry *e = 0;  pthread_mutex_lock(&amp;entry_mutex[i]);  for (e = table[i]; e != 0; e = e-&gt;next) {    if (e-&gt;key == key)      break;  }  if(e){    // update the existing key.    e-&gt;value = value;  } else {    // the new is new.    insert(key, value, &amp;table[i], table[i]);  }  pthread_mutex_unlock(&amp;entry_mutex[i]);}</code></pre><p>å†åŠ ä¸ªé”çš„åˆå§‹åŒ–å³å¯ã€‚</p><h3 id="Barrier-moderate">Barrier(moderate)</h3><p>pthreadä¸­çš„ä¿¡å·é‡ç®€å•ä½¿ç”¨ã€‚</p><p>Barrierçš„ä½œç”¨æ˜¯æŒ‡å®šæ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œåæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œç›¸å½“äºä¸€ä¸ªæ•´åˆçš„ä½œç”¨ã€‚</p><p>barrier.c:</p><pre class="language-c" data-language="c"><code class="language-c">static void barrier(){  // YOUR CODE HERE  //  // Block until all threads have called barrier() and  // then increment bstate.round.  //  pthread_mutex_lock(&amp;bstate.barrier_mutex);  bstate.nthread++;  if(bstate.nthread == nthread){    pthread_mutex_unlock(&amp;bstate.barrier_mutex);    bstate.nthread = 0;    bstate.round++;    pthread_cond_broadcast(&amp;bstate.barrier_cond);  } else {    pthread_cond_wait(&amp;bstate.barrier_cond, &amp;bstate.barrier_mutex);  } }</code></pre><h2 id="Lab-Network-Driver">Lab Network Driver</h2><h3 id="è¯¾ç¨‹-2">è¯¾ç¨‹</h3><p>è¯¾ç¨‹ä¸»è¦è®²äº†UARTè®¾å¤‡å’Œconsoleå¦‚ä½•è”ç³»ã€å¦‚ä½•è¯»å†™ã€‚è¯¥éƒ¨åˆ†è°ƒç”¨å…³ç³»çš„å¤æ‚å¯¼è‡´ç†è§£ä¸Šä¼šå‡ºç°å›°éš¾æ€§ï¼Œä¸‹é¢æ˜¯ç®€ç•¥éƒ¨åˆ†ï¼š</p><p>å¯èƒ½çš„å¯„å­˜å™¨ï¼š</p><ol><li>SIEï¼ˆå„ç±»ä¸­æ–­ï¼‰</li><li>SSTATUSï¼ˆæ§åˆ¶ä¸­æ–­ï¼‰</li><li>SIP æŸ¥çœ‹ä¸­æ–­ç±»å‹</li><li>SCAUSE è¯´æ˜å½“å‰çŠ¶æ€åŸå› ä½ä¸­æ–­ã€‚</li><li>STVEC usertrapç­‰è¿”å›ä½ç½®</li></ol><p>å…¶ä¸­ï¼ŒSTVECå’ŒSCAUSEå·²ç»åœ¨trapé‡ŒçŸ¥é“ç”¨å¤„äº†ï¼Œè€Œå…¶ä»–å¯„å­˜å™¨åœ¨è®¾å¤‡é©±åŠ¨ä¸­èµ·ä½œç”¨ã€‚</p><p>å¦‚ä½•è®©UARTè®¾å¤‡ä¸xv6æ­£å¸¸ååŒå·¥ä½œï¼š</p><p>startï¼ˆm modeï¼‰è®¾ç½®supervisor mode ä¸­æ–­ï¼Œä»¥åŠå®šæ—¶å™¨åˆå§‹åŒ–<br>-&gt; consoleåˆå§‹åŒ–ï¼Œé…ç½®UARTèŠ¯ç‰‡<br>-&gt; PLIC åˆå§‹åŒ–<br>-&gt; SCHEDULER CPUæ¥æ”¶ä¸­æ–­ã€‚</p><p>è¯»å†™çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºtopï¼ˆç³»ç»Ÿè°ƒç”¨åˆ°bufferï¼‰å’Œbottomï¼ˆbufferåˆ°ä¸‹å±‚å¯„å­˜å™¨è¯»å†™ä»£ç ï¼‰ï¼Œè¿™ä¸¤éƒ¨åˆ†ä»£ç ç»„åˆä¾¿æ˜¯é©±åŠ¨çš„ä»£ç ã€‚</p><h4 id="writeï¼ˆconsoleï¼‰">writeï¼ˆconsoleï¼‰</h4><p>Topï¼šshell-&gt; putc-&gt; write-&gt;filewrite-&gt;è¯†åˆ«FD_DEVICEï¼Œconsolewrite-&gt;è·å¾—charï¼Œuartputc-&gt;è‹¥æ»¡åˆ™sleepï¼Œå¦åˆ™å†™å…¥bufferï¼Œè°ƒuartstartå‡½æ•°-&gt;å†™å…¥THR</p><p>Bottomï¼šé€åˆ°åï¼Œæ”¶åˆ°ä¸­æ–­-&gt; PLIC-&gt; devintr-&gt;plic_claiå£°æ˜æŸä¸ªCPUè·å¾—ä¸­æ–­ï¼ˆä¸­æ–­å·ï¼‰-&gt;uartintr-&gt; consoleintr(ç”±äºæ¥å—å¯„å­˜å™¨ä¸º0ï¼Œè¿™é‡Œè·³è¿‡)-&gt;uartstart,</p><h4 id="read-console">read(console)</h4><p>Topï¼šshell-&gt; read-&gt;fileread-&gt;consoleread(buffer),è‹¥ç©ºåˆ™sleepï¼Œå¦åˆ™è¯»å–é”®ç›˜å†™å…¥çš„bufferã€‚</p><p>Bottomï¼šé”®ç›˜è¯»å…¥ï¼šä¸­æ–­-&gt; plic, cpu, devintr(åŒä¸Š)-&gt;uartgetc-&gt;consoleintr-&gt;consputc.</p><h3 id="Code-Hard">Code(Hard)</h3><p>labçš„æç¤ºç–‘ä¼¼æœ‰äº›å¤ªè¯¦å°½äº†ï¼Œ<s>è¿™ä¸æ˜¯ç›´æ¥å¯¹ç€å†™å®Œå°±è¡Œå—</s></p><p>labåªéœ€è¦æŸ¥éƒ¨åˆ†æ–‡æ¡£å³å¯å†™å®Œï¼Œä¸”ç”¨åˆ°çš„ä¹Ÿå°±3ä¸ªå¯„å­˜å™¨å’Œ4ä¸ªæ ‡å¿—ä½è€Œå·²ã€‚<br>ä¹‹åå»æŸ¥äº†ä¸€ä¸‹6.828ï¼ˆ6.S081çš„å‰èº«ï¼‰ï¼Œå‘ç°é‡æ˜¯çœŸçš„å¤šï¼Œç›¸å½“äºä»å¤´å¼€å§‹è¿™ä¸ªlabï¼ˆè™½ç„¶ç½‘ç»œåè®®æ ˆç»™äº†ï¼Œä½†æç¤ºå‡ ä¹æ²¡ç»™ï¼Œåªèƒ½æŒ‰ç…§é€»è¾‘é¡ºåºé‡æ–°å®ç°e1000é©±åŠ¨ã€‚</p><pre class="language-c" data-language="c"><code class="language-c">inte1000_transmit(struct mbuf *m){  //  // Your code here.  //  // the mbuf contains an ethernet frame; program it into  // the TX descriptor ring so that the e1000 sends it. Stash  // a pointer so that it can be freed after sending.  //  // transmitæ˜¯å•ä¸ªframeçš„ä¼ é€ï¼Œå› æ­¤å¤šè¿›ç¨‹çš„æ—¶å€™éœ€è¦acquireã€‚  // å®é™…ä¸Štransmitçš„åŠ é”ä¸å¦ä¸ä¼šå½±å“å¤ªå¤šï¼Œå¯èƒ½è¿™å°±æ˜¯é”ç½¢ã€‚ä½†recvçš„é”ä¼¼ä¹æ— æ³•åŠ ï¼Œå…·ä½“å¾—çœ‹ä¸€ä¸‹net.cé‡Œæ€ä¹ˆå®ç°çš„ã€‚  acquire(&amp;e1000_lock);  int index = regs[E1000_TDT];  struct tx_desc* current_tx = tx_ring + index;  // check if the ring is overflowing  if((current_tx-&gt;status &amp; E1000_TXD_STAT_DD) == 0){    return -1;  }  // free the last mbuf that was transmitted from the descriptor  if(tx_mbufs[index]){    mbuffree(tx_mbufs[index]);    tx_mbufs[index] = 0;  }  // fill in the descriptor  current_tx-&gt;addr = (uint64)m-&gt;head;  current_tx-&gt;length = m-&gt;len;  current_tx-&gt;cmd = E1000_TXD_CMD_RS | E1000_TXD_CMD_EOP;  // update E1000_TDT to wake up DMA.  regs[E1000_TDT] = (regs[E1000_TDT] + 1) % TX_RING_SIZE;  tx_mbufs[index] = m;  release(&amp;e1000_lock);  return 0;}static voide1000_recv(void){  //  // Your code here.  //  // Check for packets that have arrived from the e1000  // Create and deliver an mbuf for each packet (using net_rx()).  //    while(1){    // åŒæ—¶åˆ»å¤šä¸ªè¿›ç¨‹è¿›è¡Œreadï¼Œå› æ­¤éœ€è¦whileã€‚    // ask the ring index    int index = (regs[E1000_RDT] + 1) % RX_RING_SIZE;    struct rx_desc *current_rx = rx_ring + index;    // check if available    if((current_rx-&gt;status &amp; E1000_RXD_STAT_DD) == 0){      return;    }    // update mbuf len    struct mbuf* current_mbuf = rx_mbufs[index];    current_mbuf-&gt;len = current_rx-&gt;length;    net_rx(current_mbuf);    // new mbuf    struct mbuf* next_mbuf = mbufalloc(MBUF_DEFAULT_HEADROOM);    rx_mbufs[index] = next_mbuf;    current_rx-&gt;addr = (uint64)next_mbuf-&gt;head;    current_rx-&gt;status = 0;        // update E1000_RDT    regs[E1000_RDT] = (regs[E1000_RDT] + 1) % RX_RING_SIZE;  }}</code></pre><hr><p>å»çœ‹äº†ä¸‹optional challengeï¼Œå¾ˆæœ‰è¶£ï¼Œä½†æˆ‘æ²¡æ—¶é—´å†™äº†å‘œå‘œå‘œã€‚</p><h2 id="Lab-File-System">Lab File System</h2><h3 id="è¯¾ç¨‹-3">è¯¾ç¨‹</h3><p>è¿™éƒ¨åˆ†è¿˜æ˜¯æœ‰äº›å°æ™•ï¼Œä¸»è¦æ˜¯é”çš„éƒ¨åˆ†ï¼Œæœ‰çš„åœ°æ–¹ä¸ç”¨åŠ æœ‰çš„åœ°æ–¹è¦åŠ ã€‚åé¢åº”è¯¥è¦æ•´ç†ä¸€ä»½æ¢³ç†ä¸€ä¸‹ã€‚</p><h3 id="Large-files-moderate">Large files (moderate)</h3><p>å®ç°åŒé‡é—´æ¥å—ã€‚</p><p>æ”¹ä¸‹å®šä¹‰ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">//fs.h#define NDIRECT 11#define NINDIRECT_DOUBLE (NINDIRECT * NINDIRECT)#define MAXFILE (NDIRECT + NINDIRECT + NINDIRECT_DOUBLE)struct dinode {  short type;           // File type  short major;          // Major device number (T_DEVICE only)  short minor;          // Minor device number (T_DEVICE only)  short nlink;          // Number of links to inode in file system  uint size;            // Size of file (bytes)  uint addrs[NDIRECT+1+1];   // Data block addresses};//file.hstruct inode {  uint dev;           // Device number  uint inum;          // Inode number  int ref;            // Reference count  struct sleeplock lock; // protects everything below here  int valid;          // inode has been read from disk?  short type;         // copy of disk inode  short major;  short minor;  short nlink;  uint size;  uint addrs[NDIRECT+1+1];};</code></pre><p>bmap.c:</p><pre class="language-c" data-language="c"><code class="language-c">static uintbmap(struct inode *ip, uint bn){  uint addr, *a;  struct buf *bp;  if(bn &lt; NDIRECT){    if((addr = ip-&gt;addrs[bn]) == 0)      ip-&gt;addrs[bn] = addr = balloc(ip-&gt;dev);    return addr;  }  bn -= NDIRECT;  if(bn &lt; NINDIRECT){    // Load indirect block, allocating if necessary.    if((addr = ip-&gt;addrs[NDIRECT]) == 0)      ip-&gt;addrs[NDIRECT] = addr = balloc(ip-&gt;dev);    bp = bread(ip-&gt;dev, addr);    a = (uint*)bp-&gt;data;    if((addr = a[bn]) == 0){      a[bn] = addr = balloc(ip-&gt;dev);      log_write(bp);    }    brelse(bp);    return addr;  }  // begin  bn -= NINDIRECT;  int first_index = bn/NINDIRECT, second_index = bn%NINDIRECT;  if(bn &lt; NINDIRECT_DOUBLE){    if((addr = ip-&gt;addrs[NDIRECT+1]) == 0)      ip-&gt;addrs[NDIRECT+1] = addr = balloc(ip-&gt;dev);    bp = bread(ip-&gt;dev, addr);    a = (uint*)bp-&gt;data;    if((addr = a[first_index]) == 0){      a[first_index] = addr = balloc(ip-&gt;dev);      log_write(bp);    }    brelse(bp);    // second : to data    bp = bread(ip-&gt;dev, addr);    a = (uint*)bp-&gt;data;    if((addr = a[second_index]) == 0){      a[second_index] = addr = balloc(ip-&gt;dev);      log_write(bp);    }    brelse(bp);    return addr;  }  // end  panic("bmap: out of range");}voiditrunc(struct inode *ip){  int i, j;  struct buf *bp;  uint *a;  for(i = 0; i &lt; NDIRECT; i++){    if(ip-&gt;addrs[i]){      bfree(ip-&gt;dev, ip-&gt;addrs[i]);      ip-&gt;addrs[i] = 0;    }  }  if(ip-&gt;addrs[NDIRECT]){    bp = bread(ip-&gt;dev, ip-&gt;addrs[NDIRECT]);    a = (uint*)bp-&gt;data;    for(j = 0; j &lt; NINDIRECT; j++){      if(a[j])        bfree(ip-&gt;dev, a[j]);    }    brelse(bp);    bfree(ip-&gt;dev, ip-&gt;addrs[NDIRECT]);    ip-&gt;addrs[NDIRECT] = 0;  }  // begin  struct buf *bp_index;  uint *a_index;  if(ip-&gt;addrs[NDIRECT+1]){    bp = bread(ip-&gt;dev, ip-&gt;addrs[NDIRECT+1]);    a = (uint*)bp-&gt;data;    for(i = 0; i&lt;NINDIRECT;i++){      if(a[i]){        bp_index = bread(ip-&gt;dev, a[i]);        a_index = (uint*)bp_index-&gt;data;        for(j = 0; j&lt;NINDIRECT;j++){          if(a_index[j])            bfree(ip-&gt;dev, a_index[j]);        }        brelse(bp_index);        bfree(ip-&gt;dev, a[i]);        a[i] = 0;      }    }    brelse(bp);    bfree(ip-&gt;dev, ip-&gt;addrs[NINDIRECT+1]);    ip-&gt;addrs[NDIRECT+1] = 0;  }  // end  ip-&gt;size = 0;  iupdate(ip);}</code></pre><h3 id="Symbolic-links-moderate">Symbolic links (moderate)</h3><p>å¢åŠ ç³»ç»Ÿè°ƒç”¨çš„éƒ¨åˆ†ç•¥ã€‚</p><p>å®šä¹‰ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">//stat.h#define T_SYMLINK 4   // Symlink//fcntl.h#define O_NOFOLLOW 0x100</code></pre><p>sysfile.c:</p><pre class="language-c" data-language="c"><code class="language-c">uint64sys_open(void){  char path[MAXPATH];  int fd, omode;  struct file *f;  struct inode *ip;  int n;  if((n = argstr(0, path, MAXPATH)) &lt; 0 || argint(1, &amp;omode) &lt; 0)    return -1;  begin_op();  if(omode &amp; O_CREATE){    ip = create(path, T_FILE, 0, 0);    if(ip == 0){      end_op();      return -1;    }  } else {    int cnt = 0;    for(cnt = 0;cnt&lt;10;++cnt){      //printf("cnt: %d\n", cnt);      if((ip = namei(path)) == 0){        end_op();        return -1;      }      ilock(ip);      if(ip-&gt;type == T_SYMLINK &amp;&amp; ((omode &amp; O_NOFOLLOW) == 0)){        if(readi(ip, 0, (uint64)path, 0, MAXPATH) != MAXPATH){          iunlockput(ip);          end_op();          return -1;        }        iunlockput(ip);      } else {        break;      }    }    if(cnt==10){      iunlockput(ip);      end_op();      return -1;    }    if(ip-&gt;type == T_DIR &amp;&amp; omode != O_RDONLY){      iunlockput(ip);      end_op();      return -1;    }  }  //...}uint64sys_symlink(void){  char target[MAXPATH], path[MAXPATH];  if(argstr(0, target, MAXPATH) &lt; 0 || argstr(1, path, MAXPATH) &lt; 0){    return -1;  }  int len = strlen(target);  struct inode* ip;  begin_op();  if((ip = create(path, T_SYMLINK, 0, 0)) == 0){    end_op();    return -1;  }  //create å°±æ˜¯åŠ é”çš„ipï¼Œè¿™é‡Œé“¸å¸äº†  //ilock(ip);  if(writei(ip, 0, (uint64)target, 0, len) != len){    end_op();    return -1;  }  iunlockput(ip);  end_op();  return 0;}</code></pre><p>å‡ ä¸ªé”™è¯¯ç‚¹ï¼š</p><ol><li>æ–‡æ¡£é‡Œçš„apiä¸è®°å¾—äº†ï¼Œç”šè‡³è¿˜æƒ³è‡ªå·±å®ç°ä¸€éwritei/readiï¼Œå¹¸å¥½æ‚¬å´–å‹’é©¬äº†ã€‚</li><li>å¦å¤–å¯¹opençš„ä½¿ç”¨ä¹Ÿä¸å¤ªç†Ÿæ‚‰ï¼Œå¯¼è‡´æˆ‘è¿˜ä»¥ä¸ºè¦åœ¨symlinkçš„ç³»ç»Ÿè°ƒç”¨é‡Œå¤´ç”¨O_TAGï¼Œæˆ‘å¯»æ€ä¹Ÿæ²¡æœ‰fileå±‚çš„è°ƒç”¨å•Šã€‚</li><li>æœ€åå°±æ˜¯ilockâ€¦è¿™éƒ¨åˆ†åˆ°ç°åœ¨è¿˜æ˜¯ä¸å¤ªäº†è§£ï¼Œç­‰ä¹‹åç»†ç»†æ¢³ç†äº†ã€‚ä¸è¿‡åœ¨è¿™é‡Œå’Œlockçš„åŸç†æ— å…³ï¼Œå•çº¯å°±æ˜¯è‡ªå·±ä¼šå¿˜è®°åŠ iunlockputè€Œå·²ã€‚</li></ol><h2 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h2><p>ä¸€æ‹–å†æ‹–åˆ°æœ€åå‰©ä¸€ä¸ªmmap labæ²¡å®Œæˆï¼Œåªèƒ½æœŸå¾…åé¢æœ‰æ—¶é—´å†™äº†ã€‚æ¥ä¸‹æ¥æ²¡æœ‰labäº†ï¼Œè¯¾ç¨‹è¿˜ä¼šç»§ç»­çœ‹ï¼Œä½†åšå®¢ä¸å†æ›´æ–°äº†ï¼Œä»¤äººæ„Ÿå¹ã€‚</p><p>å†™labç¡®å®æ˜¯æœ‰ç”¨çš„ï¼Œæ»¡è¶³äº†æˆ‘å†™ä»£ç çš„éœ€æ±‚ï¼Œå¹¶ä¸”æˆ‘ä¹Ÿç¡®å®ç†Ÿæ‚‰äº†å…³äºæ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ã€‚ä½†åˆ°åé¢å°±ä¼šå‘ç°ï¼Œæˆ‘è¿™ç§ä¸‰å¤©æ‰“é±¼ä¸¤å¤©æ™’ç½‘å¼å­¦ä¹ ä¸¥é‡å½±å“äº†å­¦6.S081 çš„è¿‡ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ²¡æ—¶é—´å†™mmap labçš„åŸå› ã€‚</p><p>å¸Œæœ›è‡ªå·±ä»¥åå­¦è¿™äº›ç¡®å®èƒ½å­¦åˆ°çŸ¥è¯†çš„æ—¶å€™ï¼Œä¸ä¼šå†å»ç”¨è¿™ç§æ€åº¦å»ç³Ÿè¹‹çŸ¥è¯†å§ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MIT 6.S081 Lab4-6 trap &amp; Lazy &amp; COW</title>
      <link href="/2024/01/27/mit-6.s081-lab4-6-trap-lazy-cow/"/>
      <url>/2024/01/27/mit-6.s081-lab4-6-trap-lazy-cow/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸‹å¤§é¸½å­äº†ï¼Œéš”äº†ä¸€ä¸ªæœˆæ‰å†™äº†è¿™ç‚¹ã€‚ä½†ä¸ä¼šå®Œå…¨é¸½çš„ã€‚å°½é‡åœ¨å¯’å‡å‰å®Œæˆç»å¤§éƒ¨åˆ†labã€‚</p><p>æˆ–è®¸æˆ‘ä¹Ÿæƒ³ç¨å¾®æ‘†ç‚¹çƒ‚ï¼Œå› æ­¤æŠŠ2021åˆ æ‰çš„lab lazyä¹Ÿæ‹¿æ¥åšåš<s>æ‹–æ—¶é—´</s></p><h2 id="Lab-Trap-2021">Lab Trap(2021)</h2><h3 id="è¯¾ç¨‹">è¯¾ç¨‹</h3><h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h4><ol><li>ç”¨æˆ·æ€ä¸­ï¼ŒRISC-Væœ‰32ä¸ªç”¨æˆ·å¯„å­˜å™¨ä»¥åŠSATPå¯„å­˜å™¨ï¼ˆUser page tableï¼‰ï¼Œtrapéœ€è¦å°†è¿™äº›å¯„å­˜å™¨ä¿å­˜ï¼Œå¹¶åˆ‡æ¢SATPåˆ°kernel page tableã€‚</li><li>å†…æ ¸æ€çš„åˆ‡æ¢ä¸­å°†ä¼šä½¿ç”¨ä»¥ä¸‹å¯„å­˜å™¨</li></ol><ul><li>stvecï¼štrap handlerçš„ä½ç½®</li><li>sepcï¼šä¿å­˜ç”¨æˆ·çš„pcå¯„å­˜å™¨ï¼Œsretç­‰éœ€è¦ç”¨åˆ°ã€‚</li><li>scauseï¼šreason for the trap</li><li>sstatusï¼šå…¶ä¸­ï¼ŒSIE bitè¡¨ç¤ºdevice interruptsçš„enableï¼›è€ŒSPPè¡¨ç¤ºç›®å‰å¤„äºé‚£ä¸ªæ¨¡å¼ã€‚</li></ul><ol start="3"><li>åŸºæœ¬çš„trapè¿‡ç¨‹ï¼š<br><img src="/images/OS/xv6-trap.png" alt="trap"><br>+ start executing at the new pc.</li><li>supervisor modeï¼šå®é™…ä¸Šï¼Œsupervisor modeå¯åšçš„äº‹å¾ˆå°‘ã€‚å…¶ç›¸æ¯”äºUser modeï¼Œå¯ä»¥è¯»å†™æ§åˆ¶å¯„å­˜å™¨ï¼ˆä¹Ÿå°±æ˜¯satpï¼Œstvecè¿™äº›ï¼‰ï¼Œä»¥åŠä½¿ç”¨PTE_Uæ ‡å¿—ä½ä¸º0çš„PTEï¼Œé™¤æ­¤ä¹‹å¤–ä¾¿æ— æ³•è¿›è¡Œï¼Œè¯»å–åœ°å€ä¹Ÿåªèƒ½ä¾é kernel page tableã€‚</li></ol><h4 id="uservecä»¥åŠä¹‹å‰">uservecä»¥åŠä¹‹å‰</h4><p>è¯¥trapä¸ºç”¨æˆ·æ€ç³»ç»Ÿè°ƒç”¨ç­‰ã€‚<br>ä¾‹å¦‚ï¼Œç”¨æˆ·æ€ä¸­é€šè¿‡shellè°ƒç”¨writeçš„æ—¶å€™ä¼šæœ‰ï¼š</p><p><img src="https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-ML5OrMSu1sZV8JrCG4C%2F-ML5RUaTjsUrdw2GrcYT%2Fimage.png?alt=media&amp;token=54b07586-6e4d-4304-b399-3696cc0152f6" alt="write riscv"></p><p>å…¶ä¾¿ä¼šåœ¨a7å¯„å­˜å™¨å¯„å­˜å€¼ï¼Œè°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼›ä¸”åœ¨å…¶ä»–å¯„å­˜å™¨é…ç½®writeçš„åŸºæœ¬å‚æ•°ï¼Œecallè¿›å…¥uservecï¼ˆtrampolineï¼‰ä¸­ã€‚æ­¤æ—¶ï¼Œecallåšäº†ä¸‰ä»¶äº‹ï¼š</p><ol><li>user mode-&gt; supervisor mode</li><li>pc-&gt; sepc</li><li>jump to stvecï¼ˆæ­¤å¤„ä¸ºtrampolineçš„èµ·å§‹åœ°å€ï¼Œä¹Ÿå°±æ˜¯uservecï¼‰.</li></ol><p>æ­¤æ—¶ï¼Œéœ€è¦uservecåšä»¥ä¸‹äº‹ï¼š</p><ol><li>ä¿å­˜32ä¸ªç”¨æˆ·å¯„å­˜å™¨</li><li>åˆ‡æ¢kernel page table</li><li>åˆ›å»ºæˆ–æ‰¾åˆ°kernel stackï¼Œæ”¹å˜spã€‚</li><li>jump to kernel C codeï¼ˆusertrapï¼‰</li></ol><p>ä»¥ä¸Šæ­¥éª¤å‡é€šè¿‡uservecçš„æ±‡ç¼–ä»£ç æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtrampolineå’Œtrapframeï¼ˆç”¨æˆ·å¯„å­˜å™¨ä»¥åŠkernelå¯„å­˜å™¨ä¿å­˜å¤„ï¼‰åœ¨user å’Œkernel page tableä¸­éƒ½æ˜¯å›ºå®šçš„ï¼Œè¿™é˜²æ­¢äº†å› ecallå¯¼è‡´çš„å¯èƒ½çš„é¡µè¡¨é”™è¯¯ã€‚</p><p>æ±‡ç¼–ä»£ç ä¸­çš„sscratchç”¨äºç§»é™¤a0ï¼Œè®©æ¥ä¸‹æ¥çš„ä¿å­˜å¯„å­˜å™¨ç­‰æ“ä½œå¯ä»¥é€šè¿‡a0å®ç°ã€‚</p><h4 id="usertrap">usertrap</h4><p>è¯¥å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-c" data-language="c"><code class="language-c">voidusertrap(void){  int which_dev = 0;  if((r_sstatus() &amp; SSTATUS_SPP) != 0)    panic("usertrap: not from user mode");  // send interrupts and exceptions to kerneltrap(),  // since we're now in the kernel.  w_stvec((uint64)kernelvec);  struct proc *p = myproc();    // save user program counter.  p-&gt;trapframe-&gt;epc = r_sepc();    if(r_scause() == 8){    // system call    if(p-&gt;killed)      exit(-1);    // sepc points to the ecall instruction,    // but we want to return to the next instruction.    p-&gt;trapframe-&gt;epc += 4;    // an interrupt will change sstatus &amp;c registers,    // so don't enable until done with those registers.    intr_on();    syscall();  } else if((which_dev = devintr()) != 0){    // ok  } else {    printf("usertrap(): unexpected scause %p pid=%d\n", r_scause(), p-&gt;pid);    printf("            sepc=%p stval=%p\n", r_sepc(), r_stval());    p-&gt;killed = 1;  }  if(p-&gt;killed)    exit(-1);  // give up the CPU if this is a timer interrupt.  if(which_dev == 2)    yield();  usertrapret();}</code></pre><p>æ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚å…¶åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š</p><ol><li>æ£€æŸ¥SPPç­‰ã€‚</li><li>åœ¨å†…æ ¸è¿›è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œå†™å…¥kernelvecï¼Œä½¿å¾—è‹¥å‘ç”Ÿkernel trapï¼ˆä¸€èˆ¬è€Œè¨€å°±æ˜¯exceptionï¼‰è·³è½¬åˆ°kernelvecã€‚</li><li>ä¿å­˜ç”¨æˆ·ç¨‹åºè®¡æ•°å™¨ï¼ˆé˜²æ­¢åˆ‡æ¢æ”¹å˜SEPCï¼‰</li><li>æ ¹æ®ä¸åŒæƒ…å†µï¼Œè¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</li></ol><h4 id="usertrapret">usertrapret</h4><pre class="language-c" data-language="c"><code class="language-c">voidusertrapret(void){  struct proc *p = myproc();  // we're about to switch the destination of traps from  // kerneltrap() to usertrap(), so turn off interrupts until  // we're back in user space, where usertrap() is correct.  intr_off();  // send syscalls, interrupts, and exceptions to trampoline.S  w_stvec(TRAMPOLINE + (uservec - trampoline));  // set up trapframe values that uservec will need when  // the process next re-enters the kernel.  p-&gt;trapframe-&gt;kernel_satp = r_satp();         // kernel page table  p-&gt;trapframe-&gt;kernel_sp = p-&gt;kstack + PGSIZE; // process's kernel stack  p-&gt;trapframe-&gt;kernel_trap = (uint64)usertrap;  p-&gt;trapframe-&gt;kernel_hartid = r_tp();         // hartid for cpuid()  // set up the registers that trampoline.S's sret will use  // to get to user space.    // set S Previous Privilege mode to User.  unsigned long x = r_sstatus();  x &amp;= ~SSTATUS_SPP; // clear SPP to 0 for user mode  x |= SSTATUS_SPIE; // enable interrupts in user mode  w_sstatus(x);  // set S Exception Program Counter to the saved user pc.  w_sepc(p-&gt;trapframe-&gt;epc);  // tell trampoline.S the user page table to switch to.  uint64 satp = MAKE_SATP(p-&gt;pagetable);  // jump to trampoline.S at the top of memory, which   // switches to the user page table, restores user registers,  // and switches to user mode with sret.  uint64 fn = TRAMPOLINE + (userret - trampoline);  ((void (*)(uint64,uint64))fn)(TRAPFRAME, satp);}</code></pre><p>å—¯å“¼ï¼Œæ„Ÿè§‰é¥¥åˆå§‹å†™çš„ä¹Ÿå¾ˆæ˜ç™½ï¼ˆ<br>è¿™é‡Œå¯ä»¥è¯´çš„å°±æ˜¯ï¼Œtrampolineä¸­çš„SEPCå®é™…ä¸Šå¯ä»¥ä¸ç”¨åœ¨usertrapé‡Œä¿å­˜ï¼Œè¿™é‡Œçš„ä¿å­˜é¡ºåºæ˜¯æ²¡æœ‰å¿…ç„¶è”ç³»çš„ã€‚</p><h4 id="userret">userret</h4><p>æ±‡ç¼–ä»£ç ï¼Œå…¶åšäº†ä»¥ä¸‹äº‹ï¼š</p><ol><li>åˆ‡æ¢ page tableã€‚</li><li>restore user registerã€‚</li><li>a0æ”¹ä¸ºreturnçš„è¿”å›å€¼ï¼ˆsscratchï¼‰</li><li>sret</li></ol><p>sretæ‰§è¡Œä»¥ä¸‹éƒ¨åˆ†ï¼š</p><ol><li>åˆ‡æ¢å›user mode</li><li>SPECä¿å­˜è‡³PCå¯„å­˜å™¨</li><li>é‡æ–°æ‰“å¼€ä¸­æ–­</li></ol><hr><p>ä»¥ä¸Šè¿‡ç¨‹ä¸­ï¼Œxv6å°½å¯èƒ½åœ°ä½¿ç³»ç»Ÿè°ƒç”¨çœ‹ä¸Šå»åƒæ˜¯å‡½æ•°ï¼Œä½†å®é™…ä¸Šæ˜¯éœ€è¦ä¸€ä¸ªå±‚çº§çš„è°ƒç”¨è¿‡ç¨‹ã€‚</p><h4 id="kernel-trap">kernel trap</h4><p>è¯¥éƒ¨åˆ†ã€‚ã€‚å…¶å®å’Œuser trapå·®ä¸å¤šï¼Œä½†ç®€å•ä¸€ç‚¹ã€‚</p><p>kernelvecåªåœ¨æ ˆé‡Œä¿å­˜å’Œæ¢å¤å¯„å­˜å™¨ï¼Œè€Œkerneltrapå¤„ç†interruptsï¼ˆtimeï¼‰å’Œexceptionã€‚</p><h3 id="RISC-V-assembly-easy">RISC-V assembly (easy)</h3><p>è¿™éƒ¨åˆ†æ˜¯ç®€å•çš„å¯¹ç€ä»£ç è¿›è¡Œåˆ†æï¼Œè®©å­¦ç”Ÿç†Ÿæ‚‰RISC-Vçš„ã€‚ä½†xv6çš„RISC-Vå¹¶ä¸ç”¨å®Œæ•´å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰€ä»¥æˆ‘è¿™ç§å®Œå…¨ä¸ä¼šRISC-Vçš„ä¹Ÿå¯ä»¥ä¸Šæ‰‹ã€‚</p><p>æ‘†ä¸€å¼ å›¾ï¼š</p><p><img src="https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-MM-XjiGboAFe-3YvZfT%2F-MM0rYc4eVnR9nOesAAv%2Fimage.png?alt=media&amp;token=f30ebac8-8dc0-4b5d-8aa7-b241a10b43b3" alt="RISC-V registers"></p><p><s>ç”¨åˆ«äººå›¾åºŠä¸ä¹ŸæŒºå¥½å—</s></p><p>åˆ†æçš„ä»£ç éƒ¨åˆ†ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">user/_call:     file format elf64-littleriscvDisassembly of section .text:0000000000000000 &lt;g&gt;:#include "kernel/param.h"#include "kernel/types.h"#include "kernel/stat.h"#include "user/user.h"int g(int x) {   0:1141                addisp,sp,-16   2:e422                sds0,8(sp)   4:0800                addis0,sp,16  return x+3;}   6:250d                addiwa0,a0,3   8:6422                lds0,8(sp)   a:0141                addisp,sp,16   c:8082                ret000000000000000e &lt;f&gt;:int f(int x) {   e:1141                addisp,sp,-16  10:e422                sds0,8(sp)  12:0800                addis0,sp,16  return g(x);}  14:250d                addiwa0,a0,3  16:6422                lds0,8(sp)  18:0141                addisp,sp,16  1a:8082                ret000000000000001c &lt;main&gt;:void main(void) {  1c:1141                addisp,sp,-16  1e:e406                sdra,8(sp)  20:e022                sds0,0(sp)  22:0800                addis0,sp,16  printf("%d %d\n", f(8)+1, 13);  24:4635                lia2,13  26:45b1                lia1,12  28:00000517          auipca0,0x0  2c:7c050513          addia0,a0,1984 # 7e8 &lt;malloc+0xea&gt;  30:00000097          auipcra,0x0  34:610080e7          jalr1552(ra) # 640 &lt;printf&gt;  exit(0);  38:4501                lia0,0  3a:00000097          auipcra,0x0  3e:27e080e7          jalr638(ra) # 2b8 &lt;exit&gt;</code></pre><p>è¿™é‡Œæ˜¯è§£ç­”éƒ¨åˆ†ï¼š</p><div class="admonition info"><p class="admonition-title">Question 1</p><p>Which registers contain arguments to functions? For example, which register holds 13 in main's call to printf?</p></div><p>a0------a7. 13 å­˜å‚¨åœ¨a2.</p><div class="admonition info"><p class="admonition-title">Question 2</p><p>Where is the call to function f in the assembly code for main? Where is the call to g? (Hint: the compiler may inline functions.)</p></div><p>ç¼–è¯‘å™¨ä¼˜åŒ–ç›´æ¥å†…è”å±•å¼€äº†ã€‚</p><div class="admonition info"><p class="admonition-title">Question 3</p><p>At what address is the function printf located?</p></div><p><code>0000000000000630 &lt;printf&gt;</code>ã€‚</p><div class="admonition info"><p class="admonition-title">Question 4</p><p>What value is in the register ra just after the jalr to printf in main?</p></div><p>è¿”å›çš„åœ°å€raæ˜¯mainé‡Œå¤´çš„å¯¹åº”è¡Œæ•°çš„åœ°å€ã€‚</p><div class="admonition info"><p class="admonition-title">Question 5</p><p>Run the following code. What is the output?The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you set i to in order to yield the same output? Would you need to change 57616 to a different value?</p></div><pre class="language-c" data-language="c"><code class="language-c">unsigned int i = 0x00646c72;printf("H%x Wo%s", 57616, &amp;i);</code></pre><p>å¤§ç«¯å°ç«¯çš„é—®é¢˜ã€‚ã€‚ã€‚è®¡ç»„éƒ½æè¿‡äº†ï¼Œä¸å›ç­”ğŸ˜¤ğŸ˜¤ğŸ˜¤</p><div class="admonition info"><p class="admonition-title">Question 6</p><p>In the following code, what is going to be printed after 'y='? (note: the answer is not a specific value.) Why does this happen?</p></div><pre class="language-c" data-language="c"><code class="language-c">printf("x=%d y=%d", 3);</code></pre><p>æœªå®šä¹‰è¡Œä¸ºï¼Œå½“å‰çš„a2å¯„å­˜å™¨ä¸çŸ¥é“æ˜¯ä»€ä¹ˆå€¼ï¼Œå› æ­¤è¾“å‡ºä¹Ÿæ˜¯æœªçŸ¥çš„ã€‚</p><h3 id="Backtrace-moderate">Backtrace (moderate)</h3><p>å®ç°ä¸€ä¸ªå›æº¯çš„Backtraceã€‚</p><p>è¿˜æ˜¯å¾ˆç®€å•çš„ä¸€é“é¢˜ï¼Œç”¨æŒ‡é’ˆå°±è¡Œäº†ï¼Œæˆ‘è¿˜åœ¨æƒ³ç”¨ä»€ä¹ˆriscvæŒ‡ä»¤æ¥è®¿é—®ç‰©ç†å†…å­˜ã€‚è‡ªå·±åšè¿™äº›é¢˜è¿˜æ˜¯å®¹æ˜“èˆè¿‘æ±‚è¿œã€‚</p><p>æœ¬é¢˜ç›®éœ€è¦ç†è§£ä¸‹å›¾ï¼š</p><p><img src="/images/OS/xv6-stack.png" alt="xv6 Stack"></p><p>åœ¨æ¯ä¸€å±‚çš„å †æ ˆä¸­ï¼Œreturn addressä½äºframe pointerçš„offset(-8)ä½ç½®ï¼ŒäºŒä¸Šä¸€ä¸ªframe pointerçš„åœ¨å½“å‰frame pointer offset(-16)ä½ç½®ï¼Œå› æ­¤è‹¥è¦å­˜å–ä¸Šä¸€ä¸ªå †æ ˆä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥ç”¨æŒ‡é’ˆçš„åŠ å‡æ¥è·å¾—ã€‚</p><p>é¦–å…ˆåœ¨<code>kernel/defs.h</code>ç­‰åœ°æ–¹åŠ ä¸Šå¿…è¦çš„é…ç½®ï¼Œä¾‹å¦‚å‡½æ•°å£°æ˜ç­‰ã€‚</p><p>å…¶æ¬¡åœ¨<code>kernel/riscv.h</code>é‡Œå¢åŠ ä»¥ä¸‹å‡½æ•°å£°æ˜ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">static inline uint64r_fp(){  uint64 x;  asm volatile("mv %0, s0" : "=r" (x) );  return x;}</code></pre><p>è¯¥å‡½æ•°å¯ä»¥è·å–å½“å‰å¸§æŒ‡é’ˆ<code>s0</code>çš„å€¼ã€‚</p><p>åœ¨<code>kernel/printf.c</code>é‡Œå¢åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">void backtrace(){  printf("backtrace:\n");  uint64 fp = r_fp();  uint64 start = PGROUNDUP(fp), end = PGROUNDDOWN(fp);  while(end&lt;=fp&amp;&amp;fp&lt;=start){    printf("%p\n", *(uint64*)(fp-8));    fp = *(uint64*)(fp-16);  }}</code></pre><p>å…¶ä¸­çš„startå’Œendå˜é‡æ˜¯ä¸ºäº†é˜²æ­¢fpçš„æ— é™å›æº¯è¶…å‡ºç•Œé™ã€‚xv6ä¼šå°†æ¯ä¸€ä¸ªstackéƒ½åˆ†é…ä¸€ä¸ªpageï¼Œå› æ­¤ç”¨PGROUNDUPç­‰å®å³å¯è·å–ä¸Šä¸‹é™ã€‚</p><h3 id="Alarm-hard">Alarm (hard)</h3><p>æŒ‰ç…§ä»–çš„æ­¥éª¤æ¥å°±ç®—ç®€å•ã€‚</p><p>æœ¬é¢˜è¦æ±‚å¢åŠ ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼šsigalarmå’Œsigreturnã€‚</p><p>é™¤äº†å¢åŠ ç³»ç»Ÿè°ƒç”¨æ‰€å¿…è¦çš„ä¿®æ”¹å¤–ï¼Œå…¶ä»–ä¿®æ”¹å¦‚ä¸‹ï¼š</p><p>ç”±äºè·³è½¬å‡½æ•°ä¼šç ´åå¯„å­˜å™¨çš„å€¼ï¼Œå› æ­¤éœ€è¦åœ¨procç»“æ„é‡Œä¿å­˜å¯„å­˜å™¨çš„å€¼ã€‚è¿™é‡Œçš„å®ç°æ˜¯æœ‰äº›å·æ‡’çš„ï¼Œåªæ ¹æ®alarmtest.asmé‡Œçš„æ‰€éœ€å€¼å¢åŠ äº†æ‰€éœ€è¦çš„å¯„å­˜å™¨ï¼šspï¼Œpcï¼Œs0-s1, raä»¥åŠa0-a7ï¼Œä½†å®é™…ä¸Šæ— ä»çŸ¥é“ç¼–è¯‘å™¨ä¼šç”¨å“ªäº›ç”¨æˆ·å¯„å­˜å™¨ï¼Œå› æ­¤åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™åº”è¯¥å°†32ä¸ªå¯„å­˜å™¨å…¨éƒ¨å­˜å‚¨ã€‚</p><pre class="language-c" data-language="c"><code class="language-c">struct proc {  //...  uint64 ticks; //æ—¶é—´é—´éš”  uint64 func; //æ‰§è¡Œçš„å‡½æ•°æŒ‡é’ˆ  uint64 count; //ç»è¿‡å¤šé•¿æ—¶é—´  uint64 alarm_epc; //ä¿å­˜çš„pcå¯„å­˜å™¨  uint64 in_handler; //æ˜¯å¦æœ‰return  // ä¿å­˜çš„å¯„å­˜å™¨  uint64 sp;  uint64 s0;  uint64 s1;  uint64 ra;  uint64 a0;  uint64 a1;  uint64 a2;  uint64 a3;  uint64 a4;  uint64 a5;  uint64 a6;  uint64 a7;};</code></pre><p><code>kernel/proc.c</code> çš„<code>allocproc</code>å‡½æ•°é‡Œä¹Ÿå¢åŠ åˆå§‹åŒ–å†…å®¹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">static struct proc*allocproc(void){found:    //.....  p-&gt;count = 0;  p-&gt;ticks = 0;  p-&gt;func = 0;  p-&gt;alarm_epc = 0;  p-&gt;in_handler = 0;  p-&gt;a0 = p-&gt;a1 = p-&gt;a2 = p-&gt;a3 = p-&gt;a4 = p-&gt;a5 = p-&gt;a6 = p-&gt;a7 =0;  p-&gt;sp = p-&gt;ra = p-&gt;s0 = p-&gt;s1 = 0;  return p;}</code></pre><p>ä¸¤ç³»ç»Ÿè°ƒç”¨ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">uint64sys_sigalarm(void){  int ticks;  uint64 func;  if(argint(0, &amp;ticks) &lt; 0 &amp;&amp; argaddr(1, &amp;func)&lt;0){    return -1;  }  struct proc *p = myproc();  func = p-&gt;trapframe-&gt;a1;  printf("%p\n", func);  if(ticks == 0 &amp;&amp; func == 0){    p-&gt;ticks = p-&gt;func = p-&gt;count = 0;    return 0;  }  p-&gt;ticks = ticks;  p-&gt;func = func;  p-&gt;count = 0;  return 0;}uint64sys_sigreturn(void){  struct proc *p = myproc();  if (p-&gt;in_handler){    p-&gt;trapframe-&gt;epc  = p-&gt;alarm_epc;    p-&gt;count = 0;    p-&gt;in_handler = 0;    p-&gt;trapframe-&gt;a0 = p-&gt;a0;    p-&gt;trapframe-&gt;a1 = p-&gt;a1;    p-&gt;trapframe-&gt;a2 = p-&gt;a2;    p-&gt;trapframe-&gt;a3 = p-&gt;a3;    p-&gt;trapframe-&gt;a4 = p-&gt;a4;    p-&gt;trapframe-&gt;a5 = p-&gt;a5;    p-&gt;trapframe-&gt;a6 = p-&gt;a6;    p-&gt;trapframe-&gt;a7 = p-&gt;a7;    p-&gt;trapframe-&gt;sp = p-&gt;sp;    p-&gt;trapframe-&gt;s0 = p-&gt;s0;    p-&gt;trapframe-&gt;s1 = p-&gt;s1;    p-&gt;trapframe-&gt;ra = p-&gt;ra;  }  return 0;}</code></pre><p><code>kernel/trap.c</code>:</p><pre class="language-c" data-language="c"><code class="language-c">voidusertrap(void){     // ...  // give up the CPU if this is a timer interrupt.  if(which_dev == 2){    if (p-&gt;func||p-&gt;ticks){      p-&gt;count++;      if (p-&gt;count==p-&gt;ticks){        p-&gt;in_handler = 1;        p-&gt;alarm_epc = p-&gt;trapframe-&gt;epc;        p-&gt;trapframe-&gt;epc = p-&gt;func;        p-&gt;a0 = p-&gt;trapframe-&gt;a0;        p-&gt;a1 = p-&gt;trapframe-&gt;a1;        p-&gt;a2 = p-&gt;trapframe-&gt;a2;        p-&gt;a3 = p-&gt;trapframe-&gt;a3;        p-&gt;a4 = p-&gt;trapframe-&gt;a4;        p-&gt;a5 = p-&gt;trapframe-&gt;a5;        p-&gt;a6 = p-&gt;trapframe-&gt;a6;        p-&gt;a7 = p-&gt;trapframe-&gt;a7;        p-&gt;sp = p-&gt;trapframe-&gt;sp;        p-&gt;s0 = p-&gt;trapframe-&gt;s0;        p-&gt;s1 = p-&gt;trapframe-&gt;s1;        p-&gt;ra = p-&gt;trapframe-&gt;ra;      }    }    yield();  }  usertrapret();}</code></pre><h3 id="Option">Option</h3><p>Optional Challengeæ˜¯è¦åœ¨backtraceé‡Œæ‰“å°å‡ºnameè€Œä¸æ˜¯åœ°å€ï¼Œè¿™éƒ¨åˆ†ã€‚ã€‚ã€‚ç½‘ä¸Šæ‰¾ä¸åˆ°ï¼Œæˆ‘ä¹Ÿä¸ä¼šã€‚å¤§æ¦‚çš„æ€è·¯å°±æ˜¯åƒgdbä¸€æ ·ä»å¯æ‰§è¡Œæ–‡ä»¶é‡Œè¯»symbolç„¶åè¾“å‡ºï¼Œå¯é—®é¢˜æ˜¯æ€ä¹ˆè·å¾—å‘¢ï¼Ÿä¸ä¼šæã€‚</p><h2 id="Lab-Lazy-2020">Lab Lazy(2020)</h2><p>2021è¯¾ç¨‹æŠŠè¿™ä¸ªlabåˆ äº†ã€‚å¯èƒ½æ˜¯å› ä¸ºè¯¾å ‚ä¸Šå·²ç»æŠŠlabçš„è‡³å°‘ä¸€åŠçš„å†…å®¹ç»™æ³„å®Œäº†ã€‚</p><p>ä½†å…¶å®å‰©ä¸‹çš„ä¹Ÿæ˜¯é‡é‡çº§ï¼Œè°èƒ½æƒ³å¾—åˆ°æŠŠpanicåˆ äº†çš„ã€‚</p><h3 id="è¯¾ç¨‹-2">è¯¾ç¨‹</h3><p>è¯¾ç¨‹å…³äºä»£ç çš„è§£é‡Šéƒ½åœ¨labé‡Œé¢ï¼Œæ‰€ä»¥è¿™é‡Œåªç¨å¾®æä¸€ä¸‹åŸç†ã€‚</p><p>lazy labæœ¬èº«éœ€è¦åˆ©ç”¨è™šæ‹Ÿå†…å­˜çš„Page faultsæ¥åŠ è½½pageï¼ŒRVé‡Œï¼ŒPage faultçš„åŸå› å­˜å‚¨åœ¨SCAUSEï¼Œè™šæ‹Ÿå†…å­˜ä¸­çš„åœ°å€å­˜å‚¨åœ¨STVALå¯„å­˜å™¨ä¸­ï¼š</p><p><img src="https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-MMD_TK8Ar4GqWE6xfWV%2F-MMNmVfRDZSAOKze10lZ%2Fimage.png?alt=media&amp;token=4bbfdfa6-1491-4ab8-8248-03bd0e36a8e9" alt="RISC-V SCAUSE value"></p><p>ä»¥åŠåœ¨TRAPFRAMEä¸­å­˜å‚¨çš„ç”¨æˆ·ç¨‹åºå¯„å­˜å™¨å€¼ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä»¥ä¸Šä¿¡æ¯æ¥è¿›è¡Œlazy page allocationï¼Œæ›¿ä»£eager allocationä»¥æé«˜æ€§èƒ½ã€‚</p><h3 id="Eliminate-allocation-from-sbrk-easy">Eliminate allocation from sbrk() (easy)</h3><p>åªè¦æ”¹ä¸€ä¸‹sys_sbrkå°±è¡Œã€‚</p><p><code>sysproc.c</code>:</p><pre class="language-c" data-language="c"><code class="language-c">uint64sys_sbrk(void){  int addr;  int n;  struct proc* p;  if(argint(0, &amp;n) &lt; 0)    return -1;  p =  myproc();  p-&gt;sz = p-&gt;sz+n;  //if(growproc(n) &lt; 0)  //  return -1;  return addr;}</code></pre><p>è¿è¡Œç»“æœå¤§è‡´å¦‚ä¸‹ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">init: starting sh$ echo hiusertrap(): unexpected scause 0x000000000000000f pid=3            sepc=0x0000000000001258 stval=0x0000000000004008va=0x0000000000004000 pte=0x0000000000000000panic: uvmunmap: not mapped</code></pre><p>å¯ä»¥çœ‹åˆ°uvmunmapå‡ºç°äº†panicï¼Œå› ä¸ºè¿™é‡Œåªæ”¹äº†heapçš„ä½ç½®ï¼Œæ²¡æœ‰åˆ†é…çœŸæ­£çš„å†…å­˜ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰çœŸæ­£çš„é¡µè¡¨ï¼Œæ— æ³•è¿›è¡Œunmapæ“ä½œã€‚</p><h3 id="Lazy-allocation-moderate">Lazy allocation (moderate)</h3><p>lazy allocationçš„æ€è·¯æ˜¯å¼•å‘page faultï¼ˆè¿™é‡Œåªå¤„ç†loadå’Œsaveç±»å‹çš„page faultï¼‰æ—¶è¿›è¡Œåˆ†é…ã€‚ç”±äºç‰©ç†å†…å­˜å’Œé€»è¾‘å†…å­˜æ˜¯å…¨ç›¸è”çš„ï¼Œæ‰€ä»¥ç®€å•çš„åˆ†é…ç»™ä¸€é¡µå°±è¡Œã€‚</p><p>å…·ä½“ä»£ç è§ä¸‹é¢æ•´ä½“ä»»åŠ¡ã€‚</p><h3 id="Lazytests-and-Usertests-moderate">Lazytests and Usertests (moderate)</h3><p><code>trap.c</code>:å¤„ç†Page Faultçš„åˆ†é…é¡µè¡¨ã€‚</p><pre class="language-c" data-language="c"><code class="language-c">voidusertrap(void){  //......  if(r_scause() == 8){    // system call    if(p-&gt;killed)      exit(-1);    // sepc points to the ecall instruction,    // but we want to return to the next instruction.    p-&gt;trapframe-&gt;epc += 4;    // an interrupt will change sstatus &amp;c registers,    // so don't enable until done with those registers.    intr_on();    syscall();  } else if (r_scause() == 13 || r_scause() == 15){    uint64 va = r_stval();    //printf("page fault: %p\n", va);    //printf("%p, %p\n", r_stval(), va);    if(va &gt;= p-&gt;sz||va&lt;=p-&gt;trapframe-&gt;sp){      p-&gt;killed = 1;      //printf("usertrap(): error va %p pid=%d\n", va, p-&gt;pid);    } else {      uint64 ka = (uint64)kalloc();      if (ka==0){        p-&gt;killed = 1;      } else {        memset((void*)ka, 0, PGSIZE);        va = PGROUNDDOWN(va);        if(mappages(p-&gt;pagetable, va, PGSIZE, ka, PTE_W|PTE_U|PTE_R)!=0){          kfree((void*)ka);          p-&gt;killed = 1;        }      }          }  } else if((which_dev = devintr()) != 0){    // ok  }  //....}</code></pre><p>ä¸Šè¿°ä»£ç åœ¨loadæˆ–save page faultè¿›å…¥ï¼Œé¦–å…ˆè¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œä¹‹åå¼€å§‹åˆ†é…å†…å­˜ã€‚è‹¥æ— å†…å­˜ï¼Œå°±killå†…å­˜ï¼Œå¦åˆ™å°†å†…å­˜ç½®0ï¼Œmappageså°†å…¶æ˜ å°„åˆ°ç›®æ ‡ç”¨æˆ·çš„é¡µè¡¨ä¸­ã€‚</p><p><code>sysproc.c</code>: ä¿®æ”¹sbrkã€‚</p><pre class="language-c" data-language="c"><code class="language-c">uint64sys_sbrk(void){  int addr;  int n;  struct proc* p;  if(argint(0, &amp;n) &lt; 0)    return -1;  p =  myproc();  addr = p-&gt;sz;  p-&gt;sz = p-&gt;sz+n;  if (n&lt;0) {    uvmdealloc(p-&gt;pagetable, p-&gt;sz-n, p-&gt;sz);  }  //if(growproc(n) &lt; 0)  //  return -1;  return addr;}</code></pre><p>å¢åŠ äº†è´Ÿæ•°çš„å¤„ç†ã€‚</p><p><code>vm.c</code> å¤„ç†forkï¼Œcopyinï¼ˆwriteï¼‰å’Œcopyoutï¼ˆreadï¼‰</p><pre class="language-c" data-language="c"><code class="language-c">// è¦ç”¨åˆ°procç»“æ„ï¼Œå¼•å…¥å¤´æ–‡ä»¶ã€‚#include "spinlock.h"#include "proc.h"//è¯¥éƒ¨åˆ†çš„æ”¹åŠ¨å®é™…ä¸Šå°±æ˜¯æ³¨é‡Šæ‰ä¸¤ä¸ªpanicï¼Œè¿™è°æƒ³å¾—åˆ°ï¼Œæˆ–è€…æ•¢è¿™æ ·åšï¼Ÿ//å“ï¼Œä»¥åå¾—å¤šè¯•äº†ï¼Œè¿™é‡Œå¡äº†å¥½ä¹…ã€‚// Remove npages of mappings starting from va. va must be// page-aligned. The mappings must exist.// Optionally free the physical memory.voiduvmunmap(pagetable_t pagetable, uint64 va, uint64 npages, int do_free){  uint64 a;  pte_t *pte;  if((va % PGSIZE) != 0)    panic("uvmunmap: not aligned");  for(a = va; a &lt; va + npages*PGSIZE; a += PGSIZE){    if((pte = walk(pagetable, a, 0)) == 0){      //panic("uvmunmap: walk");      continue;    }    if((*pte &amp; PTE_V) == 0)      continue;      //panic("uvmunmap: not mapped");    if(PTE_FLAGS(*pte) == PTE_V)      panic("uvmunmap: not a leaf");    if(do_free){      uint64 pa = PTE2PA(*pte);      kfree((void*)pa);    }    *pte = 0;  }}// åŒä¸Šã€‚forkç”¨çš„ã€‚// Given a parent process's page table, copy// its memory into a child's page table.// Copies both the page table and the// physical memory.// returns 0 on success, -1 on failure.// frees any allocated pages on failure.intuvmcopy(pagetable_t old, pagetable_t new, uint64 sz){  pte_t *pte;  uint64 pa, i;  uint flags;  char *mem;  for(i = 0; i &lt; sz; i += PGSIZE){    if((pte = walk(old, i, 0)) == 0)      //panic("uvmcopy: pte should exist");      continue;    if((*pte &amp; PTE_V) == 0)      //panic("uvmcopy: page not present");      continue;    pa = PTE2PA(*pte);    flags = PTE_FLAGS(*pte);    if((mem = kalloc()) == 0)      goto err;    memmove(mem, (char*)pa, PGSIZE);    if(mappages(new, i, PGSIZE, (uint64)mem, flags) != 0){      kfree(mem);      goto err;    }  }  return 0; err:  uvmunmap(new, 0, i / PGSIZE, 1);  return -1;}// Copy from kernel to user.// Copy len bytes from src to virtual address dstva in a given page table.// Return 0 on success, -1 on error.intcopyout(pagetable_t pagetable, uint64 dstva, char *src, uint64 len){  uint64 n, va0, pa0;  struct proc* p = myproc();  while(len &gt; 0){    va0 = PGROUNDDOWN(dstva);    pa0 = walkaddr(pagetable, va0);    if(pa0 == 0) {      if(va0 &gt;= p-&gt;sz||va0&lt;=p-&gt;trapframe-&gt;sp){        return -1;        //printf("usertrap(): error va %p pid=%d\n", va, p-&gt;pid);      } else {        pa0 = (uint64)kalloc();        if (pa0==0){          p-&gt;killed = 1;          return -1;        } else {          memset((void*)pa0, 0, PGSIZE);          va0 = PGROUNDDOWN(va0);          if(mappages(p-&gt;pagetable, va0, PGSIZE, pa0, PTE_W|PTE_U|PTE_R)!=0){            kfree((void*)pa0);            p-&gt;killed = 1;            return -1;          }        }            }    }    n = PGSIZE - (dstva - va0);    if(n &gt; len)      n = len;    memmove((void *)(pa0 + (dstva - va0)), src, n);    len -= n;    src += n;    dstva = va0 + PGSIZE;  }  return 0;}// Copy from user to kernel.// Copy len bytes to dst from virtual address srcva in a given page table.// Return 0 on success, -1 on error.intcopyin(pagetable_t pagetable, char *dst, uint64 srcva, uint64 len){  uint64 n, va0, pa0;  struct proc* p = myproc();  while(len &gt; 0){    va0 = PGROUNDDOWN(srcva);    pa0 = walkaddr(pagetable, va0);    if(pa0 == 0) {      if(va0 &gt;= p-&gt;sz||va0&lt;=p-&gt;trapframe-&gt;sp){        return -1;        //printf("usertrap(): error va %p pid=%d\n", va, p-&gt;pid);      } else {        pa0 = (uint64)kalloc();        if (pa0==0){          p-&gt;killed = 1;          return -1;        } else {          memset((void*)pa0, 0, PGSIZE);          va0 = PGROUNDDOWN(va0);          if(mappages(p-&gt;pagetable, va0, PGSIZE, pa0, PTE_W|PTE_U|PTE_R)!=0){            kfree((void*)pa0);            p-&gt;killed = 1;            return -1;          }        }            }    }    n = PGSIZE - (srcva - va0);    if(n &gt; len)      n = len;    memmove(dst, (void *)(pa0 + (srcva - va0)), n);    len -= n;    dst += n;    srcva = va0 + PGSIZE;  }  return 0;}</code></pre><hr><p>å“ï¼Œè‡ªå·±å¥½èœã€‚</p><h2 id="Lab-Copy-On-Write-2021">Lab Copy-On-Write(2021)</h2><h3 id="è¯¾ç¨‹-3">è¯¾ç¨‹</h3><p>å…¶å®è¯¾ç¨‹å†…å®¹å¾ˆå°‘ã€‚</p><p>Xv6ä»¥åŠå…¶ä»–ç±»POSIX ç³»ç»Ÿï¼Œè‹¥è¦ä½¿ç”¨fork-execæ–¹å¼æ¥ç”Ÿæˆæ–°çš„è¿›ç¨‹ï¼Œforkä¾¿ä¼šå¸¦æ¥ä¸å¿…è¦çš„å¤åˆ¶ï¼šforkçš„æ„ä¹‰æ˜¯ä¸ºexecå¸¦æ¥æ–°çš„pidä»¥åŠè¿›ç¨‹èµ„æºï¼ŒåŸè¿›ç¨‹çš„å¤åˆ¶åªä¼šå¸¦æ¥ä¸å¿…è¦çš„IOã€‚</p><p>äºæ˜¯ï¼Œå¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿéƒ½å®ç°äº†Copy-On-Writeï¼ˆCOWï¼‰forkï¼ŒæŒ‰éœ€è¿›è¡Œå¤åˆ¶ã€‚</p><h4 id="å…·ä½“è¿‡ç¨‹">å…·ä½“è¿‡ç¨‹</h4><p>å¯ä»¥å°†forkåçš„çˆ¶å­è¿›ç¨‹å…±äº«åŒä¸€ä»½ç‰©ç†å†…å­˜ï¼ˆpageï¼‰ï¼Œè¿™æ ·ï¼Œè‹¥ä¸å‘ç”Ÿå†™å…¥ï¼Œåˆ™åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹å­è¿›ç¨‹çš„pagetableå³å¯ã€‚è€Œä¸ºäº†æ»¡è¶³è¿™ä¸€ç‚¹ï¼Œéœ€è¦å°†PTEæ ‡å¿—ä½è®¾ä¸ºåªè¯»ï¼Œä¸”æ˜ç¡®æ ‡æ˜è¿™æ˜¯COWçš„ç»“æœï¼ˆå¯åœ¨RSWä½ä¸­è®¾ç½®ï¼‰ï¼Œæ–¹ä¾¿å’Œå‡ºé”™æƒ…å†µåŒºåˆ†ã€‚è€Œå½“éœ€è¦å†™å…¥çš„æ—¶å€™ï¼ŒæŒ‰éœ€å¯¹å†™å…¥é¡µè¿›è¡Œå¤åˆ¶ã€‚</p><p>å†™æ—¶å¤åˆ¶å¸¦æ¥äº†æ€§èƒ½çš„æå‡ï¼Œä½†ç›¸å¯¹ä¹Ÿå¸¦æ¥äº†ç»´æŠ¤çš„å¤æ‚æ€§ï¼šä»€ä¹ˆæ—¶å€™é‡Šæ”¾é¡µå‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦å¼•å…¥å¼•ç”¨è®¡æ•°ï¼Œè€Œå¼•ç”¨è®¡æ•°çš„ç›¸å…³çŸ¥è¯†ã€‚ã€‚ç•¥ã€‚æ„Ÿè§‰éƒ½ä¼šç½¢ã€‚</p><h3 id="Implement-copy-on-write-hard">Implement copy-on write (hard)</h3><p>è¯¥éƒ¨åˆ†ç¡®å®å’ŒLazyé‡åˆåº¦å¤§ï¼Œé‡ç‚¹åœ¨PTEæ ‡å¿—ä½çš„è®¾å®šï¼Œä»¥åŠkalloc.cä¸­å¼•ç”¨æ•°æ®ç»“æ„çš„ç»´æŠ¤ã€‚</p><p>ä¸ç”¨æœ€å¼€å§‹å°±è€ƒè™‘å¤æ‚æƒ…å†µã€‚ç”±äºxv6æœ¬èº«è¾ƒä¸ºç®€å•ï¼Œå› æ­¤æ ‡å¿—ä½ä¸ä¼šè®¾å®šçš„å¤ªå¤æ‚ï¼Œä¸éœ€è¦è€ƒè™‘Rå’ŒWä½çš„ç»„åˆé—®é¢˜ï¼Œè¿™é‡Œé’»äº†ç‰›è§’å°–äº†ã€‚</p><p>riscv.h:</p><pre class="language-c" data-language="c"><code class="language-c">#define PTE_COW (1L &lt;&lt; 8) // 1 -&gt; Copy-On-Write PAGE</code></pre><p>kalloc.c:</p><pre class="language-c" data-language="c"><code class="language-c">#include "types.h"#include "param.h"#include "memlayout.h"#include "spinlock.h"#include "riscv.h"#include "defs.h"#define PA2CNT_INDEX(pa) (((uint64)pa)&gt;&gt;12)void freerange(void *pa_start, void *pa_end);struct cnt {  struct spinlock lock;  uint cnt[PHYSTOP&gt;&gt;PGSHIFT];} kcnt;extern char end[]; // first address after kernel.                   // defined by kernel.ld.struct run {  struct run *next;};struct {  struct spinlock lock;  struct run *freelist;} kmem;voidkinit(){  initlock(&amp;kmem.lock, "kmem");  initlock(&amp;kcnt.lock, "kcnt");  freerange(end, (void*)PHYSTOP);}voidfreerange(void *pa_start, void *pa_end){  char *p;  p = (char*)PGROUNDUP((uint64)pa_start);  for(; p + PGSIZE &lt;= (char*)pa_end; p += PGSIZE){    kcnt.cnt[PA2CNT_INDEX(p)] = 0;    kfree(p);  }}// Free the page of physical memory pointed at by v,// which normally should have been returned by a// call to kalloc().  (The exception is when// initializing the allocator; see kinit above.)voidkfree(void *pa){  struct run *r;  if(((uint64)pa % PGSIZE) != 0 || (char*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)    panic("kfree");  acquire(&amp;kcnt.lock);  if(kcnt.cnt[PA2CNT_INDEX(pa)] != 0){    --kcnt.cnt[PA2CNT_INDEX(pa)];  }  release(&amp;kcnt.lock);  if (kcnt.cnt[PA2CNT_INDEX(pa)] != 0){    return;  }  // Fill with junk to catch dangling refs.  memset(pa, 1, PGSIZE);  r = (struct run*)pa;  acquire(&amp;kmem.lock);  r-&gt;next = kmem.freelist;  kmem.freelist = r;  release(&amp;kmem.lock);}// Allocate one 4096-byte page of physical memory.// Returns a pointer that the kernel can use.// Returns 0 if the memory cannot be allocated.void *kalloc(void){  struct run *r;  acquire(&amp;kmem.lock);  r = kmem.freelist;  if(r){    kmem.freelist = r-&gt;next;    acquire(&amp;kcnt.lock);    kcnt.cnt[PA2CNT_INDEX(r)] = 1;    release(&amp;kcnt.lock);  }  release(&amp;kmem.lock);  if(r){    memset((char*)r, 5, PGSIZE); // fill with junk  }  return (void*)r;}void kincrease(uint64 pa){  acquire(&amp;kcnt.lock);  kcnt.cnt[PA2CNT_INDEX(pa)] += 1;  release(&amp;kcnt.lock);}</code></pre><p>vm.c:</p><pre class="language-c" data-language="c"><code class="language-c">intuvmcopy(pagetable_t old, pagetable_t new, uint64 sz){  pte_t *pte;  uint64 pa, i;  uint flags;  //char *mem;  for(i = 0; i &lt; sz; i += PGSIZE){    if((pte = walk(old, i, 0)) == 0)      panic("uvmcopy: pte should exist");    if((*pte &amp; PTE_V) == 0)      panic("uvmcopy: page not present");    pa = PTE2PA(*pte);        kincrease(pa);        *pte |= PTE_COW;    *pte &amp;= ~PTE_W;    flags = PTE_FLAGS(*pte);    //if((mem = kalloc()) == 0)    //  goto err;    //memmove(mem, (char*)pa, PGSIZE);    if(mappages(new, i, PGSIZE, (uint64)pa, flags) != 0){      // è‹¥æ— æ³•åˆ†é…ä¸€ä¸ªpageã€‚ã€‚ã€‚æ„Ÿè§‰è¦æ”¹mappageï¼Œè¿™é‡Œå¤´æœ‰ä¸ªremapã€‚      //kfree((void*)pa);      goto err;    }  }  return 0;  //...}intcopyout(pagetable_t pagetable, uint64 dstva, char *src, uint64 len){  uint64 n, va0, pa0;  pte_t* pte0;  while(len &gt; 0){    va0 = PGROUNDDOWN(dstva);    pa0 = walkaddr(pagetable, va0);    if(pa0 == 0)      return -1;    pte0 = walk(pagetable, va0, 0);    if((*pte0 &amp; PTE_W) == 0){      if(cow(pagetable, va0)&lt;0){        return -1;      }    }    pa0 = PTE2PA(*pte0);    //.....  }}int cow(pagetable_t pagetable, uint64 va){  if(va&gt;=MAXVA){    return -1;  }  pte_t* pte;  if((pte = walk(pagetable, va, 0)) == 0){    panic("cow(): cow walk error.");    return -1;  }  if((*pte &amp; PTE_V) == 0){    return -1;  }  if((*pte &amp; PTE_COW) == 0){    return -1;  }  if((*pte &amp; PTE_U) == 0){    return -1;  }  uint64 ka = (uint64)kalloc(), pa = PTE2PA(*pte);  uint flags = PTE_FLAGS(*pte);  if (ka==0){    return -1;  }  memmove((void*)ka, (char*)pa, PGSIZE);  flags &amp;= ~PTE_COW;  flags |= PTE_W;  *pte = PA2PTE(ka) | flags;  kfree((void*)pa);  return 0;}</code></pre><p>trap.c:</p><pre class="language-c" data-language="c"><code class="language-c">voidusertrap(void){  //...  if(r_scause() == 8){    // system call    // ...    syscall();  } else if (r_scause() == 15){    uint64 va = r_stval();    if(cow(p-&gt;pagetable, va)&lt;0){      p-&gt;killed = 1;    }  } //...}</code></pre><p>å†ä¿®æ”¹ä¸€ä¸‹defs.hå³å¯ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CNSS Recruit 2023 SA writeup</title>
      <link href="/2023/12/06/cnss-recruit-2023-sa-writeup/"/>
      <url>/2023/12/06/cnss-recruit-2023-sa-writeup/</url>
      
        <content type="html"><![CDATA[<p>å­©å­ä¸ä¼šSAï¼Œéšä¾¿æ‰“ç€ç©çš„ã€‚<br>å”‰ï¼Œæ€»æ˜¯åœ¨é”™è¯¯çš„æ—¶é—´é‡åˆ°æ­£ç¡®çš„äº‹æƒ…ã€‚</p><h2 id="Little-Docker">Little Docker</h2><h3 id="åŸºæœ¬è¦æ±‚">åŸºæœ¬è¦æ±‚</h3><ul><li>å®‰è£…docker</li><li>åˆ©ç”¨dockeréƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡ï¼Œå®ç°å½“å®¿ä¸»æœºè¯·æ±‚è‡ªèº«çš„5000ç«¯å£æ—¶èƒ½è·å–åˆ°nginxçš„æ¬¢è¿ç•Œé¢</li><li>è¯·ä½ å®ç°å½“ä¸è¿›å…¥å®¹å™¨çš„æƒ…å†µä¸‹ï¼Œå°†nginxçš„æ¬¢è¿ç•Œé¢æ›´æ”¹æˆä¸‹è½½é“¾æ¥ä¸­çš„é¡µé¢(ç¦ç”¨æ–‡ä»¶å¤åˆ¶)</li><li>ç°ä½¿ç”¨ centos:latest é•œåƒåˆ›å»ºå¦ä¸€ä¸ªå®¹å™¨ï¼Œç¡®ä¿centoså®¹å™¨èƒ½ä»¥ container:port çš„å½¢å¼è®¿é—®åˆ°ç‚¹2ä¸­çš„é¡µé¢</li><li>è¿™ä¸¤ä¸ªå®¹å™¨èƒ½ç›¸äº’pingé€š</li></ul><h3 id="è¿‡ç¨‹">è¿‡ç¨‹</h3><p>æœ¬é¢˜åœ¨centosç¯å¢ƒä¸­å®Œæˆã€‚</p><p>å®‰è£…dockeréƒ¨åˆ†ï¼šæŒ‰ç…§<a href="https://docs.docker.com/engine/install/centos/">å®˜æ–¹æ–‡æ¡£</a>æ“ä½œå³å¯ã€‚</p><p>dockeréƒ¨ç½²nginxï¼šé‡‡ç”¨docker composeå®Œæˆã€‚</p><p>é…ç½®æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">.â”œâ”€â”€ conf.dâ”‚   â”œâ”€â”€ fastcgi.confâ”‚   â”œâ”€â”€ fastcgi.conf.defaultâ”‚   â”œâ”€â”€ fastcgi_paramsâ”‚   â”œâ”€â”€ fastcgi_params.defaultâ”‚   â”œâ”€â”€ koi-utfâ”‚   â”œâ”€â”€ koi-winâ”‚   â”œâ”€â”€ mime.typesâ”‚   â”œâ”€â”€ mime.types.defaultâ”‚   â”œâ”€â”€ nginx.conf.defaultâ”‚   â”œâ”€â”€ scgi_paramsâ”‚   â”œâ”€â”€ scgi_params.defaultâ”‚   â”œâ”€â”€ uwsgi_paramsâ”‚   â”œâ”€â”€ uwsgi_params.defaultâ”‚   â””â”€â”€ win-utfâ”œâ”€â”€ docker-compose.ymlâ”œâ”€â”€ htmlâ”‚   â””â”€â”€ index.htmlâ”œâ”€â”€ logsâ”‚   â””â”€â”€ access.logâ””â”€â”€ nginx.conf</code></pre><p>nginx.confå¦‚ä¸‹ï¼š</p><pre class="language-nginx" data-language="nginx"><code class="language-nginx">worker_processes  auto;events {    worker_connections  1024;}http {    include       mime.types;    default_type  application/octet-stream;    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '                      '$status $body_bytes_sent "$http_referer" '                      '"$http_user_agent" "$http_x_forwarded_for"';    sendfile        on;    #tcp_nopush     on;    server_tokens off;    #keepalive_timeout  0;    keepalive_timeout  65;    gzip on;    gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/javascript image/jpeg image/gif image/png;    gzip_vary on;          server {        listen       80;        location / {            root   /usr/share/nginx/html;            try_files /index.html /index.htm;        }    }}</code></pre><p>docker-compose.yamlå¦‚ä¸‹ï¼š</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml">version: '3.9'services:    nginx:        image: nginx        restart: always        ports:            - '5000:80'        volumes:            - ./html:/usr/share/nginx/html            - ./nginx.conf:/etc/nginx/nginx.conf            - ./conf.d:/etc/nginx/conf.d            - ./logs:/var/log/nginx        networks:            - testnetworks:    test:        driver: bridge</code></pre><p><code>curl 127.0.0.1:5000</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/images/CNSS/curl%201.png" alt="curl"></p><p>åˆ›å»ºcentoså®¹å™¨ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">sudo docker run --network nginx_test --network-alias centos --name centos -itd centos:latest# è¿›å…¥centoså®¹å™¨sudo docker exec -it &lt;centos id&gt; bash</code></pre><p><code>curl</code> ä¸€ä¸‹ï¼Œå‘ç°dockerç½‘ç»œé‡Œæš´éœ²çš„ä¸æ˜¯ç»‘å®šçš„ç«¯å£ï¼Œè€Œæ˜¯è‡ªèº«çš„ç«¯å£ï¼ˆ</p><p><img src="/images/CNSS/curl%202.png" alt="centos curl"></p><p><img src="/images/CNSS/curl%203.png" alt="centos ping"></p><p>nginxå®¹å™¨æµ‹è¯•æ—¶ï¼Œç”±äºå®¹å™¨è¿‡åˆ†ç²¾ç®€å¯¼è‡´æ²¡æœ‰<code>ping</code>ï¼Œæ‰€ä»¥åœ¨å®¹å™¨ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ˆé»˜è®¤rootç”¨æˆ·ï¼‰ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">apt updateapt install inetutils-ping</code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/images/CNSS/curl%204.png" alt="nginx ping"></p><h2 id="RSS-Service">RSS Service</h2><h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3><ul><li>ä½¿ç”¨ Docker éƒ¨ç½² RSSHubï¼Œå¹¶å¼€æ”¾åˆ°å…¬ç½‘ä»¥ä¾›æŸ¥æˆ¿ã€‚</li><li>ä½¿ç”¨ Docker éƒ¨ç½²æ¢¯å­ï¼Œå¹¶ä½œä¸º RSSHub çš„ä»£ç†ï¼Œä»¥è®¿é—®æºç«™ä½äºå¢™å¤–çš„è·¯ç”±ï¼ˆä¾‹å¦‚ Twitterï¼‰</li><li>åœ¨åŒä¸€ä¸ª docker-compose ä¸­éƒ¨ç½²ä¸Šè¿°ä¸¤æœåŠ¡</li></ul><h3 id="è¿‡ç¨‹-2">è¿‡ç¨‹</h3><p>å…¶å®åº”è¯¥æ›´æ—©åšå‡ºæ¥è¿™é“é¢˜çš„ï¼Œä½†æˆ‘debugæ‰¾äº†åŠå¤©ï¼Œé—®äº†ganqiuæ‰çŸ¥é“æ˜¯æˆ‘clashé…ç½®æ–‡ä»¶çš„é—®é¢˜ï¼Œæ”¹ä¸€ä¸‹<code>allow-lan</code>,å°†clashä»åªå…è®¸æœ¬åœ°ç¯å›åœ°å€æ”¹æˆå…è®¸å±€åŸŸç½‘è®¿é—®å°±è¡Œã€‚ä»¤äººæ„Ÿå¹ã€‚</p><p>æœ¬é¢˜é‡‡ç”¨clashä½œä¸ºä»£ç†ï¼Œå›½å†…è®¿é—®ä»¥bilibiliï¼ˆæ— éœ€appkeyï¼‰ä¸ºä¾‹ï¼Œå›½å¤–è®¿é—®ä»¥youtubeï¼ˆéœ€è¦google keyï¼‰ä¸ºä¾‹ï¼Œè®¿é—®åœ°å€ï¼š<code>http://82.157.22.75:9981/</code>,ç»nginxåå‘ä»£ç†è‡³rsshubçš„ç«¯å£ï¼ˆåé¢æ‰å‘ç°å…¶å®æ ¹æœ¬æ²¡å¿…è¦è¿™æ ·ï¼Œæ‡’äº†ï¼‰</p><p><code>docker-compose.yaml</code>ï¼š</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml">version: '3.9'services:    rsshub:        # two ways to enable puppeteer:        # * comment out marked lines, then use this image instead: diygod/rsshub:chromium-bundled        # * (consumes more disk space and memory) leave everything unchanged        image: diygod/rsshub        restart: always        ports:            - '1200:1200'        environment:            NODE_ENV: production            CACHE_TYPE: redis            REDIS_URL: 'redis://redis:6379/'            PUPPETEER_WS_ENDPOINT: 'ws://browserless:3000'  # marked            PROXY_URI: 'http://clash:7890'            YOUTUBE_KEY: 'xxxxxxxxxxxxxxxxxxxxxxxx' # ç•¥        depends_on:            - clash            - redis            - browserless  # marked    browserless:  # marked        image: browserless/chrome  # marked        restart: always  # marked        ulimits:  # marked          core:  # marked            hard: 0  # marked            soft: 0  # marked        environment:          DEFAULT_LAUNCH_ARGS: '["--window-size=375,820","--proxy-server=http://clash:7890"]' # ä»£ç†æœåŠ¡         depends_on:          - clash    redis:        image: redis:alpine        restart: always        volumes:            - redis-data:/data     clash:        image: dreamacro/clash        restart: always        ports:          - "7890:7890"          - "7891:7891"          - "9090:9090"        volumes:          - /etc/clash:/root/.config/clashvolumes:    redis-data:</code></pre><p>å‘½ä»¤éƒ¨åˆ†ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"># åˆ›å»ºrediséœ€è¦çš„data volumesudo docker create volume redis-data# RSSHub å¯åŠ¨ï¼sudo docker compose up -d</code></pre><p>è®¿é—®ç¤ºä¾‹ï¼š</p><p>[bilibili]:</p><p><img src="/images/CNSS/rss_bilibili.png" alt="Bilibili Cherry"></p><p>[youtube]:</p><p><img src="/images/CNSS/rss_youtube.png" alt="Youtube"></p><h2 id="åŸºç¡€ç¯å¢ƒå»ºè®¾">åŸºç¡€ç¯å¢ƒå»ºè®¾</h2><h3 id="é¢˜ç›®è¦æ±‚">é¢˜ç›®è¦æ±‚</h3><ol><li><p>æ­å»ºåŸºç¡€ç¯å¢ƒï¼ŒåŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><ul><li>git</li><li>docker</li><li>python 3</li><li>pip3</li><li>curl</li><li>ssh ç¦ç”¨å¯†ç ç™»å½•</li></ul></li><li><p>åŠ åˆ†é¡¹</p><ul><li>ä¸€é”®è„šæœ¬ï¼ˆè§ä¸‹ï¼‰</li><li>ä¸€äº›å¥‡æ€ªçš„åŠŸèƒ½</li></ul></li></ol><h3 id="è¿‡ç¨‹-3">è¿‡ç¨‹</h3><p>æœ¬é¢˜åŸºäºå¤ä»¤è¥çš„è„šæœ¬åŸºç¡€ä¸Šè¿›è¡Œé‡æ„ï¼Œé™¤äº†åŸºæœ¬è¦æ±‚ï¼Œæ–°å¢ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><ol><li>å¤šä¸ªå‘è¡Œç‰ˆæ”¯æŒï¼Œæœ‰ï¼š<ul><li>Ubuntu (åªè¦æºé‡Œæœ‰å°±ç®—æ”¯æŒ)</li><li>CentOS 7 8ï¼ˆåŒä¸Šï¼‰</li><li>Arch Linux~~ï¼ˆè¿™å°±æ˜¯æ»šåŠ¨æ›´æ–°ç»™æˆ‘çš„è‡ªä¿¡ï¼‰~~</li></ul></li><li>æ”¯æŒåˆ‡æ¢å®‰è£…æº<br>ç›®å‰æ”¯æŒé˜¿é‡Œäº‘ã€æ¸…åã€ä¸­ç§‘å¤§ã€ç½‘æ˜“æºï¼Œå¹¶æœ‰äº¤äº’å¯ä»¥ä¿®æ”¹ã€‚</li><li>ä¸€äº›ä¸ªäººé…ç½®<br>å¤ä»¤è¥çš„å­˜è´§ï¼Œä¾‹å¦‚vimå®‰è£…é…ç½®ï¼Œå®‰è£…zshåˆ‡æ¢ä¸ºé»˜è®¤shellï¼Œä»¥åŠnodejsç­‰ç­‰ã€‚</li></ol><p>è„šæœ¬åœ¨WSL Ubuntu20.04å’ŒCentOS 7æµ‹è¯•äº†ä¸€ä¸‹ï¼Œ<s>ä¸ä¿è¯æ­£ç¡®æ€§</s></p><h3 id="Code">Code</h3><pre class="language-bash" data-language="bash"><code class="language-bash">#!/bin/bash# é‡æ„äº†ä¸‹åŸæœ‰çš„ä»£ç ï¼Œçœ‹äº†ä¸‹åˆ«äººä»£ç é£æ ¼è¯•ç€æ¨¡ä»¿äº†ï¼ˆ# åªç”¨è¿‡Ubuntu CentOSå’ŒArchï¼Œå°±æŒ‘è¿™ä¸‰ä¸ªå‘è¡Œç‰ˆäº†function identify_the_linux_distribution(){    if [[ "$(uname)" == "Linux" ]]; then        if [[ "$(type -P apt)" ]]; then            PACKAGE_MANAGEMENT_INSTALL='sudo apt-get -y --no-install-recommends install'            PACKAGE_MANAGEMENT_UPDATE='sudo apt-get update &amp;&amp; sudo apt-get upgrade -y'            PACKAGE_MANAGEMENT_REMOVE='sudo apt-get purge'            LINUX_DISTRIBUTION='ubuntu'        elif [[ "$(type -P yum)" ]]; then            PACKAGE_MANAGEMENT_INSTALL='sudo yum -y install'            PACKAGE_MANAGEMENT_UPDATE='sudo yum makecache &amp;&amp; sudo yum -y upgrade'            PACKAGE_MANAGEMENT_REMOVE='sudo yum remove'            LINUX_DISTRIBUTION='centos'        elif [[ "$(type -P pacman)" ]]; then            PACKAGE_MANAGEMENT_INSTALL='sudo pacman -Syu --noconfirm'            PACKAGE_MANAGEMENT_UPDATE='sudo pacman -Syyu --noconfirm'            PACKAGE_MANAGEMENT_REMOVE='sudo pacman -Rsn'            LINUX_DISTRIBUTION='arch'        else              echo "error: The script does not support the package manager in this operating system."             exit 1        fi    else        echo "error: This OS is not supported."        exit 1    fi}function is_ip_cn(){    COUNTRY=$(curl ipinfo.io | grep "country" | awk '{print $2}')    if [ $COUNTRY == '"CN",' ]; then        LOCAL_COUNTRY="OTHER"    else        LOCAL_COUNTRY="CN"    fi}function update_software(){    $PACKAGE_MANAGEMENT_UPDATE    if [[ $PACKAGE_MANAGEMENT_UPDATE ]]; then        echo "info: update success."    else        echo "error: update failed!"        exit 1    fi}function install_software(){    package_name="$1"    file_to_detect="$2"    type -p "$file_to_detect" &gt; /dev/null 2&gt;&amp;1 &amp;&amp; return    if ${PACKAGE_MANAGEMENT_INSTALL} "$package_name"; then        echo "info: $package_name is installed."    else        echo "error: Installation of $package_name failed!"        exit 1    fi}function change_source() {    if [[ $LOCAL_COUNTRY == "CN" ]]; then        echo "WARNING: your linux is in CN so that change your source is recommended."    fi    echo "please choose a mirror:    1. aliyun    2. tsinghua    3. 163    4. ustc    "        read MIRROR_CHOOSE        if [ $MIRROR_CHOOSE -ne 1 ] &amp;&amp; [ $MIRROR_CHOOSE -ne 2 ] &amp;&amp; [ $MIRROR_CHOOSE -ne 3 ] &amp;&amp; [ $MIRROR_CHOOSE -ne 4 ]; then        echo 'error: input error.'        exit 1    fi    if [[ $LINUX_DISTRIBUTION == "ubuntu" ]]; then        echo "=========================================="        UBUNTU_VERSION=$(cat /etc/os-release | grep VERSION_CODENAME | awk -F "=" '{print $2}')        case $MIRROR_CHOOSE in            1)                UBUNTU_MIRROR_URL='http://mirrors.aliyun.com/ubuntu/'            ;;            2)                UBUNTU_MIRROR_URL='https://mirrors.tuna.tsinghua.edu.cn/ubuntu/'            ;;            3)                UBUNTU_MIRROR_URL='http://mirrors.163.com/ubuntu/'            ;;            4)                UBUNTU_MIRROR_URL='https://mirrors.ustc.edu.cn/ubuntu/'            ;;        esac        echo "==== Ubuntu version: $UBUNTU_VERSION ===="        echo "begin change your source($UBUNTU_MIRROR_URL)..."        sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak        echo "origin source.list is stored in /etc/apt/sources.list.bak"                echo "# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb $UBUNTU_MIRROR_URL $UBUNTU_VERSION main restricted universe multiverse# deb-src $UBUNTU_MIRROR_URL $UBUNTU_VERSION main restricted universe multiversedeb $UBUNTU_MIRROR_URL $UBUNTU_VERSION-updates main restricted universe multiverse# deb-src $UBUNTU_MIRROR_URL $UBUNTU_VERSION-updates main restricted universe multiversedeb $UBUNTU_MIRROR_URL $UBUNTU_VERSION-backports main restricted universe multiverse# deb-src $UBUNTU_MIRROR_URL $UBUNTU_VERSION-backports main restricted universe multiverse# deb $UBUNTU_MIRROR_URL $UBUNTU_VERSION-security main restricted universe multiverse# \# deb-src $UBUNTU_MIRROR_URL $UBUNTU_VERSION-security main restricted universe multiversedeb http://security.ubuntu.com/ubuntu/ $UBUNTU_VERSION-security main restricted universe multiverse# deb-src http://security.ubuntu.com/ubuntu/ $UBUNTU_VERSION-security main restricted universe multiverse" | sudo tee /etc/apt/sources.list    elif [[ $LINUX_DISTRIBUTION == "centos" ]]; then        REDHAT_RELEASE=$(grep "CentOS" /etc/redhat-release)        if  echo "$REDHAT_RELEASE" | grep "release 7"         thenCENTOS_VERSION=7elif echo "$REDHAT_RELEASE" | grep "release 8"        thenCENTOS_VERSION=8elseecho "error: only support CentOS 7 and 8"            exit 1fi        sudo cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak        echo "origin CentOS-Base.repo is stored in /etc/yum.repos.d/CentOS-Base.repo.bak"        if [ $CENTOS_VERSION -eq 7 ]        then            case $MIRROR_CHOOSE in                1)                wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo                ;;                2)                sudo sed -e 's|^mirrorlist=|#mirrorlist=|g' \         -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos|g' \         -i.bak \         /etc/yum.repos.d/CentOS-*.repo                ;;                3)                sudo wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.163.com/.help/CentOS7-Base-163.repo                ;;                4)                sudo sed -e 's|^mirrorlist=|#mirrorlist=|g' \         -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.ustc.edu.cn/centos|g' \         -i.bak \         /etc/yum.repos.d/CentOS-Base.repo                ;;            esac        else            case $MIRROR_CHOOSE in                1)                sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo                 ;;                2)                sudo sed -e 's|^mirrorlist=|#mirrorlist=|g' \         -e 's|^#baseurl=http://mirror.centos.org/$contentdir|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos|g' \         -i.bak \         /etc/yum.repos.d/CentOS-*.repo                ;;                3)                sudo wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.163.com/.help/CentOS8-Base-163.repo                ;;                4)                sudo sed -e 's|^mirrorlist=|#mirrorlist=|g' \         -e 's|^#baseurl=http://mirror.centos.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/centos|g' \         -i.bak \         /etc/yum.repos.d/CentOS-Stream-AppStream.repo \         /etc/yum.repos.d/CentOS-Stream-BaseOS.repo \         /etc/yum.repos.d/CentOS-Stream-Extras.repo \         /etc/yum.repos.d/CentOS-Stream-PowerTools.repo                ;;            esac        fi    elif [[ $LINUX_DISTRIBUTION == "arch" ]]; then        #reflect åœ¨ä¹‹å‰å®‰è£…archçš„æ—¶å€™å¾ˆä¸å¥½ç”¨ï¼Œç›´æ¥ç•¥äº†ï¼Œè¿™é‡Œåªå®‰è£…å¯¹åº”çš„æºï¼Œä»¥åŠç¤¾åŒºæºã€yayã€‚        sudo cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.bak        echo "origin mirrorlist is stored in /etc/pacman.d/mirrorlist.bak"        case $MIRROR_CHOOSE in            1)                echo 'Server = http://mirrors.aliyun.com/archlinux/$repo/os/$arch'&gt;/etc/pacman.d/mirrorlist            ;;            2)                echo 'Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxarm/$arch/$repo'&gt;/etc/pacman.d/mirrorlist            ;;            3)                echo 'Server = http://mirrors.163.com/archlinux/$repo/os/$arch'&gt;/etc/pacman.d/mirrorlist            ;;            4)                echo 'Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch'&gt;/etc/pacman.d/mirrorlist            ;;        esac        echo 'choose a COMMUNITY SOURCE'        echo "        1. official        2. 163        3. tsinghua        "        read COMMUNITY_SOURCE        if [ $comm -ne 1 ]&amp;&amp;[ $comm -ne 2 ]; then            echo "error: input error."            exit 1        fi        echo "[archlinuxcn]"&gt;&gt;/etc/pacman.conf        case $COMMUNITY_SOURCE in            1)            echo 'Server = http://repo.archlinuxcn.org/$arch'&gt;&gt;/etc/pacman.conf            ;;            2)            echo 'Server = http://mirrors.163.com/archlinux-cn/$arch'&gt;&gt;/etc/pacman.conf            ;;            3)            echo 'Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch'&gt;&gt;/etc/pacman.conf            ;;        esac        install_software 'archlinuxcn-keyring' 'archlinuxcn-keyring'        install_software 'yay' 'yay'    fi    echo "=========================================="    echo "SUCCESS change $LINUX_DISTRIBUTION source!"}function install_zsh(){    echo "=========================================="    echo "begin install zsh..."    install_software 'zsh' 'zsh'    install_software 'git' 'git'    if [ $LOCAL_COUNTRY == "OTHER" ]; then        sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"    else        sh -c "$(curl -fsSL https://gitee.com/shmhlsy/oh-my-zsh-install.sh/raw/master/install.sh)" #å›½å†…é•œåƒæº    fi    chsh -s /bin/zsh    echo "=========================================="    echo "SUCCESS install zsh &amp; oh-my-zsh!"}function change_ssh_config(){    echo "=========================================="    echo "begin config ssh..."    sed -i 's/\(^[\s#]*\)ClientAliveInterval\(.*\)/ClientAliveInterval 60/'     sed -i 's/\(^[\s#]*\)ClientAliveCountMax\(.*\)/ClientAliveCountMax 10/'     sed -i 's/\(^[\s#]*\)PasswordAuthentication\(.*\)/PasswordAuthentication no/'    echo "=========================================="    echo "SUCCESS config ssh: 10 minutes Alive and no password auth"}function install_git(){    echo "=========================================="    echo "begin install git..."    install_software 'git' 'git'    echo -n "Your git name:"    read GIT_USERNAME    git config --global user.name $GIT_USERNAME    echo -n "Your git email:"    read GIT_EMAIL    git config --global user.email $GIT_EMAIL    git config --list    echo "=========================================="    echo "SUCCESS install git!"}function install_docker(){    echo "=========================================="    echo "begin install docker..."    if [[ "$LINUX_DISTRIBUTION" == "ubuntu" ]]; then        for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do            $PACKAGE_MANAGEMENT_REMOVE $pkg        done        install_software ca-certificates ca-certificates        install_software curl curl        install_software gnupg gnupg        sudo install -m 0755 -d /etc/apt/keyrings        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg        sudo chmod a+r /etc/apt/keyrings/docker.gpg        echo \        "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \        "$(. /etc/os-release &amp;&amp; echo "$VERSION_CODENAME")" stable" | \        sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null                update_software        for pkg in docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin; do            install_software $pkg $pkg        done        sudo systemctl enable docker        sudo systemctl start docker    elif [[ "$LINUX_DISTRIBUTION" == "centos" ]];then        for pkg in docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine; do            $PACKAGE_MANAGEMENT_REMOVE $pkg        done        install 'yum-utils'        sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo        for pkg in docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin; do            install_software $pkg $pkg        done        sudo systemctl enable docker        sudo systemctl start docker    elif [[ "$LINUX_DISTRIBUTION" == "arch" ]]; then        install_software 'docker' 'docker'    fi    if [ $1 = "CN" ]; then     echo "{  \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"]}" | sudo tee -a /etc/docker/daemon.json    fi    sudo service docker restart    echo "=========================================="    echo "SUCCESS install docker!"}function install_nodejs_new(){    echo "=========================================="    echo "begin install nodejs..."    NOW_PWD=$(pwd)    cd /usr/local/src/    sudo wget https://nodejs.org/dist/v18.17.0/node-v18.17.0.tar.gz    sudo tar -zxvf node-v18.17.0.tar.gz    cd node-v18.17.0    sudo ./configure    sudo make    sudo make install    cd $NOW_PWD    if [ $1 = "CN" ]; then    npm config set registry https://registry.npm.taobao.org    npm config get registry    npm install -g cnpm --registry=https://registry.npm.taobao.org    fi    echo "=========================================="    echo "SUCCESS install newest nodejs!"}function install_vim(){    install_software 'vim' 'vim'    echo "set laststatus=2set numberset noebset ts=4set softtabstop=4set shiftwidth=4set expandtabset autoindent" | tee ~/.vimrc}function install_python3_pip(){    if [[ $LINUX_DISTRIBUTION == "ubuntu" ]]; then        install 'python3' 'python3'    elif [[ $LINUX_DISTRIBUTION == "centos" ]]; then        install 'python3' 'python3'    elif [[ $LINUX_DISTRIBUTION == "arch" ]]; then        install_software 'python' 'python'        echo "WARNING: arch linux doesn't use pip3 to install python package, use 'sudo pacman -S python-xxx' instead."    fi}function config_system_proxy(){    if [ $LOCAL_COUNTRY == "OTHER" ]; then        return 0    fi    echo "=========================================="    echo "begin config your proxy..."    echo "Your HTTP PROXY:"    read HTTP_PROXY    echo "Your HTTPS PROXY?:"    read HTTPS_PROXY    echo "export HTTP_PROXY=\"$HTTP_PROXY\"" | sudo tee -a /etc/profile.d/proxy.sh    echo "export HTTPS_PROXY=\"$HTTPS_PROXY\"" | sudo tee -a /etc/profile.d/proxy.sh    sudo chmod u+x /etc/profile.d/proxy.sh    source /etc/profile.d/proxy.sh    echo "=========================================="}function main(){    identify_the_linux_distribution    install_software 'curl' 'curl'    is_ip_cn    change_source    # update_software     install_git    install_docker    install_python3_pip    install_vim    install_zsh    # æºç ç¼–è¯‘nodejsè¿‡æ…¢ï¼Œç•¥äº†    # install_nodejs_new }main#config_system_proxy</code></pre><h2 id="èŒæ–°ä¹Ÿæƒ³æ­è½½ä¸Šâ€¦â€¦A-å¼•æ“ï¼">èŒæ–°ä¹Ÿæƒ³æ­è½½ä¸Šâ€¦â€¦A-å¼•æ“ï¼</h2><h3 id="é¢˜ç›®è¦æ±‚-2">é¢˜ç›®è¦æ±‚</h3><p>ä½¿ç”¨ Apache å®ç°ä»¥ä¸‹è¦æ±‚ï¼š</p><blockquote><ol><li>ä½¿ç”¨ä¸€ä¸ª Apache å®ä¾‹ä»£ç† 3 ä¸ªé¡µé¢ï¼Œä¸åŒçš„ç«¯å£å·è®¿é—®åˆ°ä¸åŒçš„é¡µé¢</li><li>å®ç° URL è½¬å‘ï¼š å½“ URI è¯·æ±‚ä¸º /google æ—¶ï¼Œè·³è½¬åˆ°è°·æ­Œï¼›å½“ URI è¯·æ±‚ä¸º /github æ—¶ï¼Œè·³è½¬åˆ° GitHub ï¼›å½“ URI è¯·æ±‚ä¸º/cnssæˆ–/cnss/xxx æ—¶ï¼Œxxx æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œè·³è½¬åˆ° CNSS æ‹›æ–°å®˜ç½‘ï¼›å…¶ä½™ä»»æ„è¯·æ±‚è·³è½¬åˆ°é™æ€é¡µé¢</li><li>æ­å»ºä¸€ä¸ªç®€æ˜“æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ï¼Œè®¿é—® /downloads èƒ½å¤Ÿæ˜¾ç¤ºæ–‡ä»¶ç›®å½•ã€‚</li><li>å®ç°ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå½“è®¿é—®åŒä¸€ä¸ª URL æ—¶ï¼ŒæŒ‰ç…§æµé‡æ¯” 1 : 2 : 3 åˆ†åˆ«è®¿é—®åˆ° 3 ä¸ªä¸åŒçš„é¡µé¢.</li><li>syrinka çš„æœ‹å‹åœˆæœ‰å¾ˆå¤šå¤§ä½¬ï¼Œä¸ºäº†è†œæ‹œè¿™äº›å¤§ä½¬æ•™ä»–æŠ€æœ¯ï¼Œä»–æ¯å¤©éƒ½ä¼šâ€œè½®è¯¢â€æ‹œè®¿è¿™äº›å¤§ä½¬çš„åšå®¢ï¼Œå¹¶åˆ¶ä½œäº†ä¸€ä¸ª â€œURL è½®è¯¢å™¨â€æ¥è¾¾åˆ°ç›®çš„ï¼Œè®¿é—®è¯¥ URL æ—¶ï¼Œè½®è¯¢è·³è½¬åˆ°å¤§ä½¬ä»¬çš„åšå®¢ï¼Œè¯·èªæ˜çš„ä½ ä¹Ÿå®ç°ä¸€ä¸ªå§ï¼</li></ol></blockquote><p>å®ŒæˆåŸºæœ¬éƒ¨åˆ†ï¼Œæ— åŠ åˆ†é¡¹ã€‚</p><h3 id="è¿‡ç¨‹-4">è¿‡ç¨‹</h3><h4 id="ç¯å¢ƒ">ç¯å¢ƒ</h4><blockquote><p>CentOS httpd(ApacheæœåŠ¡å™¨çš„CentOSç‰ˆæœ¬)<br>python+flask</p></blockquote><h4 id="å…¶ä»–é…ç½®å‡†å¤‡">å…¶ä»–é…ç½®å‡†å¤‡</h4><p>é™æ€æ–‡ä»¶éƒ¨åˆ†ï¼Œä¿å­˜åœ¨/var/wwwä¸‹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">/var/wwwâ”œâ”€â”€ cgi-binâ”œâ”€â”€ downloadsâ”‚   â”œâ”€â”€ kkndâ”‚   â””â”€â”€ logo.pngâ””â”€â”€ html    â”œâ”€â”€ h1    â”‚   â””â”€â”€ index.html    â”œâ”€â”€ h2    â”‚   â””â”€â”€ index.html    â”œâ”€â”€ h3    â”‚   â””â”€â”€ index.html    â””â”€â”€ todo        â”œâ”€â”€ index.html        â”œâ”€â”€ script.js        â””â”€â”€ style.css</code></pre><p>pythonéƒ¨åˆ†æ˜¯ä¸ºäº†å®ŒæˆURLè½®è¯¢å™¨ã€‚apacheä¸åƒnginxï¼Œè´Ÿè½½å‡è¡¡çš„é»˜è®¤è½®è¯¢ç®—æ³•ä¸åŸºäºç¡®å®šé¡ºåº(emmmï¼ŒæŸ¥ä¸åˆ°åŸå› æ)ï¼Œå› æ­¤æ— æ³•åƒnginxé‚£æ ·é€šè¿‡upstreamç›´æ¥å®ç°ï¼Œç”¨python+flaskå®ç°å¦‚ä¸‹ï¼š</p><p><code>app.py</code></p><pre class="language-python" data-language="python"><code class="language-python">from flask import Flask, redirectapp=Flask(__name__)i=0url = [        'https://www.sh1no.icu/',        'https://yaossg.com',        'https://www.cnblogs.com/timlzh/',        'https://www.skyecho.fun/']@app.route('/')def index():        global i        true_url=url[i]        i+=1        i%=len(url)        return redirect(true_url)if __name__ == '__main__':        app.run(port=8084)</code></pre><p>å¦å¤–ï¼Œæœ¬æœºåœ¨<code>/etc/host</code> æ·»åŠ  <code>127.0.0.1 zzzremake.eu.org</code></p><hr><p>httpdæ˜¯æœ‰åˆ†ä¸»é…ç½®æ–‡ä»¶<code>/etc/httpd/conf/httpd.conf</code>å’Œå…¶ä»–é…ç½®æ–‡ä»¶<code>/etc/httpd/conf.d/*.conf</code>ï¼Œä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œé™¤äº†Listençš„ç«¯å£ä¿®æ”¹å¤–ï¼Œå…¶ä»–ä¿æŒé»˜è®¤ã€‚</p><p>ä¸»é…ç½®æ–‡ä»¶<code>/etc/httpd/conf/httpd.conf</code>(éƒ¨åˆ†)</p><pre class="language-apache" data-language="apache"><code class="language-apache">ServerRoot "/etc/httpd"Listen 8080Listen 8081Listen 8082Listen 8083</code></pre><p>å…¶ä»–é…ç½®æ–‡ä»¶:<br><code>...../conf.d/h1_3.conf</code></p><p>å®Œæˆ ä¸åŒçš„ç«¯å£å·è®¿é—®åˆ°ä¸åŒçš„é¡µé¢ éƒ¨åˆ†ã€‚</p><pre class="language-apache" data-language="apache"><code class="language-apache">Define htmlroot "/var/www/html"&lt;VirtualHost zzzremake.eu.org:8081&gt;    DocumentRoot "${htmlroot}/h1"    DirectoryIndex index.html    ServerName zzzremake.eu.org:8081    &lt;Directory "${htmlroot}/h1"&gt;        Options Indexes FollowSymLinks        AllowOverride None        Require all granted    &lt;/Directory&gt;&lt;/VirtualHost&gt;&lt;VirtualHost zzzremake.eu.org:8082&gt;    DocumentRoot "${htmlroot}/h2"    DirectoryIndex index.html    ServerName zzzremake.eu.org:8082    &lt;Directory "${htmlroot}/h2"&gt;        Options Indexes FollowSymLinks        AllowOverride None        Require all granted    &lt;/Directory&gt;&lt;/VirtualHost&gt;&lt;VirtualHost zzzremake.eu.org:8083&gt;    DocumentRoot "${htmlroot}/h3"    DirectoryIndex index.html    ServerName zzzremake.eu.org:8083    &lt;Directory "${htmlroot}/h3"&gt;        Options Indexes FollowSymLinks        AllowOverride None        Require all granted    &lt;/Directory&gt;&lt;/VirtualHost&gt;</code></pre><p><code>...../conf.d/url_redirect.conf</code></p><pre class="language-apache" data-language="apache"><code class="language-apache">RewriteEngine on&lt;VirtualHost zzzremake.eu.org:8080&gt;    ServerName zzzremake.eu.org:8080    DocumentRoot /var/www/html/todo        RewriteRule "^/google$" "https://www.google.com" [R=301,L]    RewriteRule "^/github$" "https://github.com" [R=301,L]    RewriteRule "^/cnss$" "https://recruit.cnss.io" [R=301,L]    RewriteRule "^/cnss/.*" "https://recruit.cnss.io" [R=301,L]    # RewriteRule "^(/downloads)$" "$1/" [L]    RewriteRule "^(/visit)$" "http://127.0.0.1:8084" [P,L]        RewriteCond %{REQUEST_URI} !^/downloads     RewriteRule "^/.+$" "http://127.0.0.1:8080/" [R,L]     ProxyRequests off       &lt;Proxy balancer://balance&gt;        BalancerMember http://zzzremake.eu.org:8081 loadfactor=1        BalancerMember http://zzzremake.eu.org:8082 loadfactor=2        BalancerMember http://zzzremake.eu.org:8083 loadfactor=3        ProxySet lbmethod=bytraffic    &lt;/Proxy&gt;    ProxyPass /balance balancer://balance    ProxyPassReverse /balance balancer://balance    Alias /downloads/ /var/www/downloads/    &lt;Directory "/var/www/html/todo"&gt;        Options Indexes FollowSymlinks        AllowOverride None        Require all granted    &lt;/Directory&gt;    &lt;Directory "/var/www/downloads"&gt;        Options Indexes FollowSymLinks        AllowOverride None        Require all granted    &lt;/Directory&gt;&lt;/VirtualHost&gt;</code></pre><h2 id="æˆ‘è¦æˆä¸ºç»„ç½‘é«˜æ‰‹ï¼">æˆ‘è¦æˆä¸ºç»„ç½‘é«˜æ‰‹ï¼</h2><h3 id="é¢˜ç›®è¦æ±‚-3">é¢˜ç›®è¦æ±‚</h3><p>ä½¿ç”¨ä»»æ„ç½‘ç»œæ¨¡æ‹Ÿå™¨ï¼ˆæœ¬é¢˜é€‰ç”¨PacketTracerï¼‰å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºçš„</p><p><img src="/images/CNSS/network.png" alt="network"></p><p>å¹¶å®Œæˆä»¥ä¸‹è¦æ±‚ï¼š</p><ol><li><p>åŸºæœ¬è¦æ±‚</p><ul><li>å®Œæˆ 10.0.10.0/24 ä¸ 10.0.20.0/24 ç½‘æ®µçš„æ­å»ºï¼Œä½¿ PC0 è‡³ PC3 å¯ä»¥äº’é€š</li><li>å®Œæˆ 10.0.30.0/24 ç½‘æ®µçš„æ­å»ºï¼Œå¹¶ä¸º Edge_Route ä¸ Side_Route é…ç½®åŠ¨æ€è·¯ç”±åè®®ï¼Œåœ¨ä¸ä½¿ç”¨é™æ€è·¯ç”±çš„å‰æä¸‹ï¼Œä½¿ PC0 è‡³ PC4 å¯ä»¥äº’é€š</li><li>é…ç½® ICPï¼Œå¹¶ä¸ºå…¶é…ç½®é™æ€è·¯ç”±ï¼Œä½¿ PC0 è‡³ PC4 å¯ä»¥è¿é€š ICP</li><li>å‡è®¾ ICP æ‰€åœ¨çš„ç½‘æ®µä¸ºå¤–ç½‘ï¼ŒPC0 è‡³ PC3 æ‰€åœ¨çš„ç½‘æ®µä¸ºå†…ç½‘ï¼Œä¸º Edge_Route é…ç½® NAT</li></ul></li><li><p>åŠ åˆ†é¡¹</p><ul><li>15% é…ç½® VLANï¼Œä»¤ PC0 ä¸ PC2 åŠ å…¥ vlan10ï¼ŒPC1 ä¸ PC3 åŠ å…¥ vlan20</li><li>[ ] 25% å°† Edge_Route æ›¿æ¢ä¸ºé˜²ç«å¢™ï¼Œå¹¶é…ç½®è§„åˆ™ï¼Œä½¿ï¼š<br>PC0-3 èƒ½è¿é€š PC4ã€Edge_Routeã€ICP<br>PC4 èƒ½è¿é€š Edge_Routeã€ICPã€ä¸èƒ½è¿é€š PC0-3<br>ICP ä¸èƒ½è¿é€š PC0-4ã€Edge_Route</li><li>[ ] 10% ä½¿ç”¨ HCL å®Œæˆæœ¬é¢˜ï¼ˆå› ä¸ºå®ƒçœŸçš„è¦å…¨ç¨‹ç”¨å‘½ä»¤è¡Œï¼Œè¿™æ˜¯æˆäºˆæ˜çŸ¥å±±æœ‰è™åå‘è™å±±è¡Œçš„å‹‡å£«çš„å¥–åŠ±ï¼‰</li></ul></li></ol><h3 id="è¿‡ç¨‹-5">è¿‡ç¨‹</h3><h4 id="åŸºæœ¬éƒ¨åˆ†">åŸºæœ¬éƒ¨åˆ†</h4><p>ç½‘æ®µæ­å»ºéƒ¨åˆ†å°±ä¸æäº†ï¼Œè¿™éƒ¨åˆ†åªè¦ç½‘å…³å’Œipåœ°å€å¯¹äº†å°±è¡Œã€‚</p><p>åŠ¨æ€è·¯ç”±éƒ¨åˆ†ï¼Œè®¾ç½®ospf 1å’Œarea 0. éœ€è¦æ³¨æ„çš„æ˜¯pingç”¨çš„ICMPæ˜¯ä¸€ä¸ªæ¥å›çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥è¦é…åŒå‘è·¯ç”±ã€‚</p><p>é…ç½®é™æ€è·¯ç”±éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ä¸€æ ·è¦æ³¨æ„åŒå‘è·¯ç”±éƒ½è¦é…ç½®ã€‚</p><p>NATéƒ¨åˆ†ï¼Œé™æ€NATæ— æ³•æ»¡è¶³éœ€æ±‚ï¼ŒåŠ¨æ€NATä¹Ÿè¦å¤šIPçš„poolï¼Œé‡‡ç”¨ç«¯å£æ˜ å°„PATã€‚</p><h4 id="åŠ åˆ†é¡¹éƒ¨åˆ†">åŠ åˆ†é¡¹éƒ¨åˆ†</h4><p>VLANé…ä¼¼äº†ï¼Œç»“æœå‡ºé”™äº†ï¼ˆ</p><p><img src="/images/CNSS/nishi_.png" alt="æŸå‡ºé¢˜äººçš„å›ç­”"></p><p>è·¯ç”±å™¨çš„å­ç«¯å£æ— æ³•å•ç‹¬é…ç½®VLAN IDï¼Œå› æ­¤å½“å‡ºç°é¢˜ç›®æ‰€ç¤ºçš„é…ç½®æ—¶ï¼Œä¼šå› ä¸ºå­ç½‘å†²çªè€Œæ— æ³•é…ç½®å•è‡‚è·¯ç”±çš„ç½‘å…³ï¼Œåˆ°æœ€ååªèƒ½åœ¨ä¸€ä¸ªå­æ¥å£æœ‰å¯¹åº”çš„ipåœ°å€ã€‚<br>å› æ­¤ï¼ŒVLANé—´æ— æ³•äº’é€šã€‚</p><p><s>ä½†åŸæ„ä¼¼ä¹å°±æ˜¯é…trunkå’Œaccesså£å°±è¡Œäº†</s></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> CNSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CNSS </tag>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MIT 6.S081 Lab1-3 begin xv6</title>
      <link href="/2023/11/09/mit-6.s081-lab1-3-begin-xv6/"/>
      <url>/2023/11/09/mit-6.s081-lab1-3-begin-xv6/</url>
      
        <content type="html"><![CDATA[<p>å»å¹´è¿™ä¸ªæ—¶å€™æˆ‘åˆšå¼€å§‹å†™ç°ä»£å¯†ç å­¦çš„åšå®¢ï¼Œè¿‡äº†ä¸€å¹´å¼€äº†ä¸ªè¿™ä¸ªï¼Œä»¤äººæ„Ÿå¹ã€‚</p><h2 id="é…ç¯å¢ƒ">é…ç¯å¢ƒ</h2><p>ç¬¬ä¸€æ¬¡é…ç¯å¢ƒçš„æ—¶å€™wslç»™æˆ‘æå´©äº†ï¼Œå¯èƒ½æ˜¯wslçš„Ubuntuç‰ˆæœ¬ä¸åŒï¼Œå¯¼è‡´æºå’Œå®˜æ–¹æ–‡æ¡£ä¸å¤ªä¸€æ ·ã€‚åæ­£æ²¡ä»€ä¹ˆé‡è¦ä¸œè¥¿ï¼Œå¸è½½é‡è£…ï¼</p><p>å…·ä½“æ–¹æ³•è¯¦è§<a href="https://pdos.csail.mit.edu/6.828/2021/tools.html">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæˆ‘è‡ªå·±çš„ç¯å¢ƒé…ç½®ä¸ºï¼š</p><blockquote><p>wsl2+Ubuntu20.04<br>å…·ä½“ç¯å¢ƒåŠé…ç½®å‘½ä»¤åŒå®˜æ–¹æ–‡æ¡£ã€‚</p></blockquote><h3 id="ä¸€äº›å‘½ä»¤">ä¸€äº›å‘½ä»¤</h3><ol><li><p><code>make qemu</code> å¯åŠ¨qemuä»¥åŠxv6ã€‚<br>è¯¾ç¨‹è¯„æµ‹æ–‡ä»¶<code>grade-lab-util</code>æ˜¯pyæ–‡ä»¶ï¼Œæ‰€ä»¥æ—¢å¯ä»¥ç”¨<code>./grade-lab-util xxxx</code>è¯„æµ‹ï¼Œä¹Ÿå¯ä»¥åŠ ä¸ªpythonå¯åŠ¨ã€‚</p></li><li><p><code>echo "add-auto-load-safe-path /home/remake/remake_dev/xv6-labs-2021/.gdbinit" &gt;&gt; ~/.gdbinit</code> è®©<code>gdb-multiarch</code>å¯ä»¥è°ƒè¯•xv6ç¨‹åºã€‚è°ƒè¯•æ—¶éœ€è¦æ³¨æ„make qemuçš„flagæ·»åŠ ï¼ˆ</p></li></ol><h2 id="Lab-1-Util">Lab 1 Util</h2><p>ä¸»è¦é€šè¿‡ç±»POSIXæ¥å£å®ç°ç”¨æˆ·çš„ä¸€äº›åŠŸèƒ½ã€‚</p><h3 id="è¯¾ç¨‹">è¯¾ç¨‹</h3><p>å¤§ä½“å…¶å®å’Œæ™®é€šçš„OSå·®ä¸å¤šï¼Œä½†6.S081çš„ä¸€å¤§ç‰¹ç‚¹æ˜¯ä¸Šæ¥å°±è®²ä»£ç ï¼Œå› æ­¤å¾ˆå¤šæ“ä½œç³»ç»Ÿè¯¾ä¸ä¼šè®²çš„ä»£ç å…·ä½“å®ç°åœ¨è¯¾ç¨‹é‡Œä¼šè¯¦ç»†ä»‹ç»ã€‚</p><p>é™¤äº†xv6ä»£ç çš„ç»†èŠ‚ï¼Œä¾‹å¦‚ç¨‹åºå¿…é¡»exit(0)é€€å‡ºï¼Œexecè½½å…¥elfæ ¼å¼æ–‡ä»¶ç­‰ï¼Œå€¼å¾—è®²çš„å°±æ˜¯forkå’Œexecçš„I/Oå’ŒFileçš„descriptorsï¼Œä¸€åˆ‡ä¼¼ä¹éƒ½æ˜¯æ°´åˆ°æ¸ æˆã€‚</p><hr><p>file descriptorä½œä¸ºä¸€ç§æµçš„æŠ½è±¡ï¼Œè¢«å¹¿æ³›åº”ç”¨äºUNIXçš„å„ä¸ªéƒ¨åˆ†ï¼ˆé™¤äº†networkï¼Œè™½ç„¶æœ‰ç±»ä¼¼å®ç°ä½†åˆå­˜åœ¨ä¸åŒï¼‰ï¼Œè¯¸å¦‚ç®¡é“ç­‰ã€‚</p><p>forkåœ¨æ™®é€šOSè¯¾ç¨‹ä¸­åªä¼šç”¨å˜é‡ç­‰ä¾‹å­æ¥å±•ç¤º"å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„å¤åˆ¶"ï¼Œä½†ä¸ä»…äºæ­¤ã€‚forkåœ¨å¤åˆ¶ç¨‹åºæœ¬èº«çš„æƒ…å†µä¸‹è¿˜å¤åˆ¶äº†çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œè€Œexecè™½ç„¶æ”¹å˜äº†ç¨‹åºï¼ˆé€šè¿‡loadçš„imageï¼‰ï¼Œä½†ä¸ä¼šå¯¹æ–‡ä»¶æè¿°ç¬¦è¡¨è¿›è¡Œæ”¹å˜ã€‚</p><p>å› æ­¤ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥é€šè¿‡ä¸´æ—¶æ”¹å˜æ–‡ä»¶æè¿°ç¬¦æ¥æ“ä½œå­è¿›ç¨‹çš„æè¿°ç¬¦ï¼Œå­è¿›ç¨‹åªçŸ¥é“æè¿°ç¬¦æœ¬èº«ï¼Œè€Œä¸çŸ¥é“æè¿°ç¬¦åé¢ä»£è¡¨çš„æ˜¯æ–‡ä»¶ï¼Œè®¾å¤‡ã€æˆ–è€…ç®¡é“ã€‚</p><p>å¦å¤–ï¼Œforkè™½ç„¶å¤åˆ¶äº†æè¿°ç¬¦è¡¨ï¼Œä½†æ¯ä¸ªæè¿°ç¬¦ä¸‹çš„åç§»é‡æ˜¯ç‹¬ç«‹çš„ã€‚å› æ­¤ï¼Œä¸¤ä¸ªè¿›ç¨‹çš„æè¿°ç¬¦ä¸‹å¯èƒ½æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œå…±äº«åŒä¸€ä¸ªåç§»é‡ã€‚</p><hr><p>æ—¢ç„¶ä»‹ç»äº†è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆpipeä¹Ÿå°±æ°´åˆ°æ¸ æˆäº†ã€‚çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«ä¸€ä¸ªdescriptorã€‚åœ¨å®é™…çš„æ“ä½œä¸­ï¼Œä¸€ç«¯æ“ä½œéœ€è¦å¯¹å¦ä¸€ç«¯è¿›è¡Œå…³é—­ï¼Œå¦åˆ™ä¾¿ä¼šä¸€ç›´é˜»å¡ã€‚pipeçš„è¯­ä¹‰ä¸­ï¼Œreadè¿”å›éœ€è¦ï¼š</p><ol><li>writeå­—èŠ‚</li><li>å†™å…¥ç«¯å…³é—­</li></ol><p>å› æ­¤ï¼Œéœ€è¦æŒ‰éœ€å…³é—­pipeã€‚</p><hr><p>æœ€åä¸€ä¸ªå¯ä»¥å…³æ³¨çš„ç‚¹ä¾¿æ˜¯shellå†…ç½®å‘½ä»¤ã€‚Unixæ—¶ä»£ç»å¸¸æŠŠmkdirç­‰å‘½ä»¤å†…ç½®ï¼Œä½†Unixå°†å…¶ä½œä¸ºå¯æ‰§è¡Œç¨‹åºï¼Œä»PATHä¸­å¯»æ‰¾ã€‚ä½†cdå‘½ä»¤ä¸åŒï¼Œå¦‚æœç”¨ä¼ ç»Ÿçš„fork-execæ¥è¿›è¡Œï¼Œæ”¹å˜çš„åªæœ‰å­è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œshellå¹¶ä¸ä¼šå…³æ³¨å­è¿›ç¨‹çš„è¿™ä¸€ä¿¡æ¯ã€‚</p><h3 id="Sleep-easy">Sleep (easy)</h3><p>ç®€å•çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p><pre class="language-c" data-language="c"><code class="language-c">#include "kernel/types.h"#include &lt;user/user.h&gt;void my_sleep(const char* argument){    int sleep_second = atoi(argument);    sleep(sleep_second);}int main(int argc, char const *argv[]){    if(argc &lt;= 1){        fprintf(2, "usage: sleep need number(second).\n");        exit(1);    }    if(argc &gt;=3){        fprintf(2, "error: too many argument.(sleep)\n");    }    my_sleep(argv[1]);    exit(0);}</code></pre><h3 id="pingpong-easy">pingpong (easy)</h3><p>ç®€å•çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œç†è§£äº†pipeå’Œforkçš„å…³ç³»å°±è¡Œã€‚</p><pre class="language-c" data-language="c"><code class="language-c">//Simple pingpong: pipe.#include &lt;kernel/types.h&gt;#include &lt;user/user.h&gt;int main(int argc, char const *argv[]) {    int p[2];    char buf[2];        if(pipe(p)&lt;0){        fprintf(2, "error: pipe exit(pingpong)\n");        exit(1);    }    int pid = fork();    if(pid == 0){        //child        int read_bytes = read(p[0], buf, 1);        close(p[0]);        if(read_bytes&gt;0){            int now_pid = getpid();            printf("%d: received ping\n", now_pid);            write(p[1], buf, 1);            close(p[1]);        } else {            exit(1);        }    } else if(pid&gt;0){        //parent        char *buf="y";        char* buf_test="y";        write(p[1], buf, 1);        close(p[1]);        int read_bytes = read(p[0], buf, 1);        close(p[0]);        if(read_bytes&gt;0){            int now_pid = getpid();            if(strcmp(buf, buf_test)){                printf("%d: received pong\n", now_pid);                           }        }    } else {        fprintf(2, "error: fork(pingpong)\n");    }    return 0;}</code></pre><h3 id="primes-moderate-hard">primes (moderate)/(hard)</h3><p>æŠ½è±¡èµ·æ¥äº†ã€‚</p><p>é—®é¢˜åœ¨äºç†è§£ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p><img src="https://swtch.com/~rsc/thread/sieve.gif" alt="primes"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¿›ç¨‹forkå®Œåï¼Œä¾¿ä¸€ç›´å‘å­è¿›ç¨‹å‘é€é€’å¢æ•°æ®ï¼Œè€Œå­ç¨‹åºæ¥å—æ•°æ®åï¼Œéœ€è¦è§†æƒ…å†µforkï¼Œç„¶åä¼ é€’æ•°æ®ã€‚</p><p>å…¶ä¸»è¦ä¼ªä»£ç ä¸ºï¼š</p><pre class="language-python" data-language="python"><code class="language-python">p = get a number from left neighborprint ploop:    n = get a number from left neighbor    if (p does not divide n)        send n to right neighbor</code></pre><pre class="language-c" data-language="c"><code class="language-c">#include &lt;kernel/types.h&gt;#include &lt;user/user.h&gt;void prime(int*fd){    int p, d;    close(fd[1]);    if(read(fd[0], &amp;p, 4)==0){        exit(0);    }    printf("prime %d\n", p);    if (read(fd[0], (void *)&amp;d, sizeof(d))){        int fd1[2];        pipe(fd1);        if (fork() == 0){            prime(fd1);        }else{            // å…³é—­è¯»            close(fd1[0]);            do{                if (d % p != 0){                    write(fd1[1], (void *)&amp;d, sizeof(d));                }            }while(read(fd[0], (void *)&amp;d, sizeof(d)));            // å…³é—­è¯»            close(fd[0]);            // å…³é—­å†™            close(fd1[1]);            wait(0);        }    }    exit(0);}int main(int argc, char const *argv[]) {    int p[2];    pipe(p);    int pid=fork();    if(pid==0){        prime(p);    } else if(pid&gt;0){        close(p[0]);        for(int i = 2;i&lt;=35;++i){            write(p[1], &amp;i, 4);        }        close(p[1]);        wait((int*)0);    } else {        fprintf(2, "error: fork(prime).\n");    }    exit(0);}</code></pre><p>å½“æ—¶çŠ¯äº†ä¸¤é”™è¯¯ã€‚</p><ol><li>é¢˜ç›®ä¸€çœ¼ç”¨å‡½æ•°é€’å½’å®ç°ï¼Œä½†å½“æ—¶é’»äº†ç‰›è§’å°–éå¾—åœ¨mainå‡½æ•°å®ç°ï¼Œç”šè‡³æ‰“ç®—ç”¨gotoäº†ã€‚</li><li>å‡½æ•°é¡ºåºåº”è¯¥æ˜¯<code>read -- read -- fork</code> ï¼Œè¿™æ ·ç¬¬äºŒä¸ªreadä¾¿å¯ä»¥æˆä¸ºåœæ­¢æ¡ä»¶ï¼›è€Œæˆ‘å½“æ—¶ç†è§£æˆäº† <code>read -- fork -- read</code> è¿™ä¼šå¯¼è‡´ä¸€ä¸ªè¿›ç¨‹ä¸€ç›´åœ¨ç­‰å¾…ä¿¡æ¯ï¼Œä»è€Œæ— æ³•é€€å‡ºç¨‹åºã€‚</li></ol><h3 id="xargs-moderate">xargs (moderate)</h3><p>æ³¨æ„è¯»é¢˜ï¼ˆ</p><p>æœ¬é¢˜å¹¶æ²¡æœ‰ä»€ä¹ˆéš¾åº¦ï¼Œä½†åšçš„æ—¶å€™è¯»é”™é¢˜æ„å¯¼è‡´åé¢ä»£ç å¯è¯»æ€§å¾ˆå·®ï¼Œæœ€åè¿˜æ˜¯å‚è€ƒäº†åˆ«äººï¼Œä»¤äººæ„Ÿå¹ã€‚</p><p>æ³¨æ„è¦ç”¨execå®ç°ï¼Œç¬¬ä¸€æ¬¡å®ç°çš„æ—¶å€™è™½ç„¶è¿‡äº†ä½†å¹¶ä¸æ˜¯execå®ç°ã€‚</p><pre class="language-c" data-language="c"><code class="language-c">#include &lt;kernel/types.h&gt;#include &lt;kernel/param.h&gt;#include &lt;user/user.h&gt;void copy(char **p1, char *p2){    *p1 = malloc(strlen(p2) + 1);    strcpy(*p1, p2);}int readline(char** parm, int begin){    char buf[512];        int i = 0;    while(read(0, buf+i, 1)){        if(buf[i]=='\n'){            buf[i]=0;            break;        }        ++i;    }    if(i==0){        return 0;    }    int j = 0;    while(j&lt;i){        if(begin&gt;MAXARG){            fprintf(2, "too many parameters!(xargs)\n");            exit(1);        }        int temp = j;        while((j&lt;i)&amp;&amp;(buf[j]!=' ')){            ++j;        }        buf[j++] = 0;        copy(&amp;parm[i], buf+temp);    }    return begin;}int main(int argc, char *argv[]){    if(argc&lt;2){        fprintf(2, "Please enter more parameters.(xargs)\n");        exit(1);    }    char*pars[MAXARG];    for(int i = 1;i&lt;argc;++i){        copy(&amp;pars[i-1], argv[i]);    }    int end;    end=readline(pars, argc-1);    while(end){        pars[end]=0;        if(fork()==0){            for(int i =0;i&lt;end;++i){                printf("%s\n", pars[i]);            }            //exec(pars[0], pars);            exit(1);        } else {            wait(0);        }        end=readline(pars, argc-1);    }    exit(0);}</code></pre><h2 id="Lab-2-system-calls">Lab 2 system calls</h2><h3 id="è¯¾ç¨‹-2">è¯¾ç¨‹</h3><p>ä¼¼ä¹ä»lab2å¼€å§‹ï¼Œä¾¿æ·±å…¥xv6ç»†èŠ‚ï¼Œè€Œä¸å…³æ³¨UNIXç­‰å…¶ä»–ç³»ç»Ÿçš„æ¥å£äº†ï¼ˆä½†xv6è¿˜æ˜¯ç±»UNIXå˜›ï¼‰</p><hr><div class="admonition info"><p class="admonition-title">misc</p><p>qemuæ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿäº†ROM, RAM, Diskå’Œ serial connection to ç”¨æˆ·çš„å±å¹•/é”®ç›˜ã€‚</p><p>RISC-Vå…·æœ‰ä¸‰ä¸ªæ¨¡å¼ï¼šmachine supervisorå’Œuser modeï¼Œä¸€èˆ¬çš„ç‰¹æƒæŒ‡ä»¤æ˜¯æŒ‡supervisor modeï¼Œuser spaceè¦è°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å¯„å­˜å™¨å…ˆè®¾ç½®å¥½å‚æ•°ï¼Œå†é€šè¿‡ecallæŒ‡ä»¤åˆ°ç‰¹æƒæ¨¡å¼ï¼Œé€šè¿‡sreté€€å‡ºã€‚</p></div><p>xv6çš„åœ°å€ç©ºé—´ä¸º39bitï¼Œè€Œxv6åªç”¨å…¶ä¸­çš„38bitã€‚é€»è¾‘ç©ºé—´æœ€å¤§å€¼MAXVA=$2^{38}-1$ã€‚<br>è¿›ç¨‹æŠ½è±¡ä¸ºprocç»“æ„ï¼Œå…¶ä¸­å­˜å‚¨ç€è¯¸å¦‚pagetableç­‰æˆå‘˜ã€‚åŒæ—¶ï¼Œè¿›ç¨‹ç»´æŠ¤ç€ä¸¤ä¸ªå †æ ˆï¼Œç”¨æˆ·å †æ ˆå’Œå†…æ ¸å †æ ˆkstackï¼Œå†…æ ¸å †æ ˆåœ¨è¿›å…¥ç‰¹æƒæ¨¡å¼ä¸‹ä½¿ç”¨ä¸”ç‹¬ç«‹ï¼Œå› æ­¤è¿›ç¨‹ç ´åçš„æ—¶å€™ï¼Œkernelä»ç„¶èƒ½åœ¨kstackä¸­æ‰§è¡Œã€‚</p><hr><p>xv6çš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼š</p><ol><li>é¦–å…ˆåœ¨bootloaderï¼ˆROMï¼‰è¯»å–å¼•å¯¼ç¨‹åºï¼Œå¼•å¯¼ç¨‹åºå°†xv6 kernelè½½å…¥å†…å­˜åœ¨_entryä¸­ï¼ˆentry.Sï¼‰ï¼š</li></ol><pre class="language-risc-v" data-language="risc-v"><code class="language-risc-v">.section .text.global _entry_entry:        # set up a stack for C.        # stack0 is declared in start.c,        # with a 4096-byte stack per CPU.        # sp = stack0 + (hartid * 4096)        la sp, stack0        li a0, 1024*4        csrr a1, mhartid        addi a1, a1, 1        mul a0, a0, a1        add sp, sp, a0        # jump to start() in start.c        call startspin:        j spin</code></pre><p>RISC-Vï¼ˆæ­¤æ—¶ä¸ºmachine modeï¼‰å¯åŠ¨çš„æ—¶å€™ç¦ç”¨äº†åˆ†é¡µç¡¬ä»¶ï¼Œå› æ­¤ç¨‹åºçš„è™šæ‹Ÿåœ°å€ç›´æ¥æ˜ å°„å…¥ç‰©ç†åœ°å€ã€‚</p><p>loaderç›´æ¥å°†kernelæ˜ å°„å…¥ç‰©ç†åœ°å€0x80000000ï¼Œè¿™ä¹Ÿæ˜¯qemuçš„å…¥å£åœ°å€ã€‚0åˆ°80000000çš„è¿™ä¸€éƒ¨åˆ†åˆ™æ˜¯IOè®¾å¤‡ã€‚</p><ol start="2"><li>entry.Såˆ›å»ºäº†Cä»£ç æ‰€éœ€çš„æ ˆstack0ï¼Œå¹¶å¯åŠ¨äº†start function(start.c)</li><li>start.cå°†modeè½¬ä¸ºsupervisorï¼ˆé€šè¿‡mretï¼‰å¹¶è½½å…¥mainå‡½æ•°åœ°å€ï¼ˆmepcï¼‰ä»¥åŠå…¶ä»–å¿…è¦è®¾ç½®ï¼Œå¦‚å§”æ‰˜ä¸­æ–­å’Œå¼‚å¸¸ç»™supervisor modeï¼Œå¯åŠ¨clockç­‰ï¼Œæœ€åå°†pcè½¬ä¸ºmainå‡½æ•°ã€‚</li><li>mainå‡½æ•°å¯åŠ¨å¿…è¦çš„é…ç½®ï¼Œåœ¨userinité‡Œåˆ›å»ºç¬¬ä¸€ä¸ªè¿›ç¨‹ã€‚</li><li>è¿›ç¨‹æ‰§è¡Œinitcode.Sæ±‡ç¼–ç¨‹åºï¼Œinvoke exec ç³»ç»Ÿè°ƒç”¨ï¼Œè½¬å˜ä¸º/initã€‚å½“kernelæ‰§è¡Œexecå®Œæ¯•ï¼Œå°†ä¼šè¿”å›/init è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹ä¼šæ‰§è¡Œè¯¸å¦‚æ‰“å¼€æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦å’Œå¯åŠ¨shellç­‰ä»»åŠ¡ã€‚</li></ol><div class="admonition note"><p class="admonition-title">mainå‡½æ•°å¹²äº†ä»€ä¹ˆï¼Ÿ</p><p>kinitï¼šè®¾ç½®page allocatorkvminitï¼šè®¾ç½®è™šæ‹Ÿå†…å­˜kvminitstartï¼šæ‰“å¼€é¡µè¡¨processinitï¼šè®¾ç½®åˆå§‹è¿›ç¨‹trapinitï¼šè®¾ç½®user/kernel modeè½¬æ¢ä»£ç plicinitï¼šä¸­æ–­æ§åˆ¶å™¨binitï¼šbuffer cachefileinitï¼šæ–‡ä»¶ç³»ç»Ÿvirtio_disk_initï¼šåˆå§‹åŒ–ç£ç›˜userinitï¼šå¯åŠ¨ç¬¬ä¸€ä¸ªè¿›ç¨‹</p></div><h3 id="System-call-tracing-moderate">System call tracing (moderate)</h3><p>è¿˜æ˜¯è¯»é¢˜é—®é¢˜ã€‚è‹±è¯­å¤ªå·®æ˜¯è¿™æ ·çš„ã€‚</p><p>è¿™é¢˜è®²æ˜äº†éœ€è¦åœ¨procç»“æ„é‡Œå¢åŠ å˜é‡æ¥å®ç°tracingã€‚å› æ­¤ï¼Œç³»ç»Ÿè°ƒç”¨traceåªéœ€è¦æ”¹å˜è°ƒç”¨è¿›ç¨‹çš„maskï¼Œforkçš„å­è¿›ç¨‹ä¾¿ä¼šç»§æ‰¿mask(ä¿®æ”¹forkå®ç°)ã€‚</p><p>å½“è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œsyscallå‡½æ•°ä¾¿ä¼šæ£€æŸ¥maskï¼Œé»˜è®¤0ï¼Œå…¶ä»–æƒ…å†µä¾¿å¯ä»¥æ£€æŸ¥æ¥æ‰“å°å…·ä½“å‡½æ•°ã€‚</p><hr><ol><li>procç»“æ„é‡Œå¢åŠ maskå­—æ®µæ¥è®°å½•è¦traceçš„ç³»ç»Ÿè°ƒç”¨ã€‚</li><li><code>kernel/syscall.c</code>æ”¹ä¸ºï¼š</li></ol><pre class="language-c" data-language="c"><code class="language-c">void syscall(void){  int num;  struct proc *p = myproc();  num = p-&gt;trapframe-&gt;a7; // è®°å½•ç³»ç»Ÿè°ƒç”¨  if(num &gt; 0 &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) {    p-&gt;trapframe-&gt;a0 = syscalls[num](); //è¿”å›å€¼è®°å½•a0    if((1 &lt;&lt; num) &amp; p-&gt;mask){      printf("%d: syscall %s -&gt; %d\n",        p-&gt;pid, sysnames[num], p-&gt;trapframe-&gt;a0);    }  } else {    printf("%d %s: unknown sys call %d\n",            p-&gt;pid, p-&gt;name, num);    p-&gt;trapframe-&gt;a0 = -1;  }}</code></pre><ol start="3"><li><code>kernel/sysproc.c</code> æ·»åŠ ï¼š</li></ol><pre class="language-c" data-language="c"><code class="language-c">uint64 sys_trace(void){   uint64 mask;  if(argaddr(0, &amp;mask)&lt;0)    return -1;  myproc()-&gt;mask = mask;  return 0;}</code></pre><p>å‰©ä½™çš„è¯¸å¦‚ä¿®æ”¹forkå’Œå¤´æ–‡ä»¶ç­‰ç•¥ã€‚</p><h3 id="Sysinfo-moderate">Sysinfo (moderate)</h3><p>å…·ä½“å‡½æ•°ç”¨æ³•éœ€è¦çœ‹å…·ä½“çš„ç”¨ä¾‹ã€‚labå·²ç»ç»™å‡ºç”¨æ³•ï¼šåœ¨<code>kernel/file.c</code>é‡Œå¤´ã€‚</p><p>é‡è¦çš„å°±æ˜¯<code>arg</code>å‡½æ•°ä»¥åŠ<code>copyout</code>å‡½æ•°ä½¿ç”¨ã€‚</p><hr><ol><li><code>kernel/kalloc.c</code>é‡Œå¢åŠ ï¼š</li></ol><pre class="language-c" data-language="c"><code class="language-c">uint64 get_memory_count(void){  uint64 count=0;  struct run*r = kmem.freelist;  while(r){    count+=PGSIZE;    r = r-&gt;next;  }  return count;}</code></pre><ol start="2"><li><code>kernel/proc.c</code>å¢åŠ ï¼š</li></ol><pre class="language-c" data-language="c"><code class="language-c">int get_process_count(void){  int count = 0;  struct proc* p;  for(p = proc; p &lt; &amp;proc[NPROC]; p++) {      if(p-&gt;state != UNUSED){        count++;      }  }  return count;}</code></pre><ol start="3"><li><code>kernel/sysproc.c</code> å¢åŠ ç³»ç»Ÿè°ƒç”¨ï¼š</li></ol><pre class="language-c" data-language="c"><code class="language-c">uint64 sys_sysinfo(void){  uint64 info;  struct sysinfo nowinfo;  if(argaddr(0, &amp;info) &lt; 0)    return -1;  nowinfo.freemem = get_memory_count();  nowinfo.nproc = get_process_count();    struct proc *p = myproc();  if(copyout(p-&gt;pagetable, info, (char*)&amp;nowinfo, sizeof(nowinfo))&lt;0)    return -1;  return 0;}</code></pre><p>å…¶ä»–ä¿®æ”¹åŒtraceã€‚</p><h2 id="Lab-3">Lab 3</h2><h3 id="è¯¾ç¨‹-3">è¯¾ç¨‹</h3><p>è¿™é‡Œè¯•å›¾å¯¹xv6çš„å†…æ ¸é¡µè¡¨æŒ‚è½½æµç¨‹è¿›è¡Œæ¢³ç†ã€‚</p><h4 id="pre">pre</h4><p>xv6åœ¨cä»£ç ä¸­å†™æ˜äº†å…·ä½“çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹ç”¨åˆ°çš„ç»“æ„ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">//é“¾è¡¨ç»“æ„struct run {  struct run *next;};//lockå¹¶å‘+freelistç»“æ„struct {  struct spinlock lock;  struct run *freelist;} kmem;//åŒ¿åç»“æ„ï¼škmemç®¡ç†å†…æ ¸é¡µè¡¨</code></pre><p>mainå‡½æ•°ä¸­å…³äºå†…æ ¸é¡µè¡¨çš„å†…å®¹æœ‰ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">kinit();         // physical page allocatorkvminit();       // create kernel page tablekvminithart();   // turn on paging</code></pre><p>ä¸‹é¢å†…å®¹ä¸»è¦ä¸ºkalloc.cã€‚</p><h4 id="kinit">kinit</h4><p>é¦–å…ˆçœ‹çœ‹kinitï¼šåˆå§‹åŒ–lockå’Œå†…æ ¸é¡µè¡¨ï¼Œå°†å†…æ ¸é¡µè¡¨æŒ‚è½½åˆ°ç‰©ç†å†…å­˜ä¸­</p><pre class="language-c" data-language="c"><code class="language-c">void kinit(){  initlock(&amp;kmem.lock, "kmem");  freerange(end, (void*)PHYSTOP);}//endåœ¨kalloc.cå£°æ˜ä¸º`extern char []`ï¼Œå®é™…ä¸Šçš„endåœ¨kernel.ldå‡ºç°ï¼Œå…¶ä»£è¡¨å†…æ ¸åçš„ç¬¬ä¸€ä¸ªåœ°å€.//PHYSTOP ä¸ºå®å®šä¹‰ï¼š#define KERNBASE 0x80000000#define PHYSTOP (KERNBASE + 128*1024*1024)//å…¶ä»£è¡¨ å†…å­˜ç©ºé—´ä¸º128M.</code></pre><p>kernelçš„é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/images/OS/xv6_kernel.png" alt="xv6 logical address to physical address"></p><p>å†…æ ¸æŒ‚è½½åœ¨é€»è¾‘åœ°å€0x8000000ï¼ˆKERNBASEï¼‰,å†…æ ¸ç©ºé—´åˆ°PHYSTOPã€‚ç”±äºkinitçš„æ—¶å€™è¿˜æœªæœ‰é¡µè¡¨ç»“æ„ï¼Œæ­¤æ—¶çš„é€»è¾‘åœ°å€æ˜¯ç›´æ¥æ˜ å°„åˆ°ç‰©ç†ç©ºé—´çš„ã€‚</p><p>freerangeå¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">#define PGSIZE 4096#define PGROUNDUP(sz) (((sz)+PGSIZE-1) &amp; ~(PGSIZE-1))//è¿™é‡Œçš„è¾“å…¥ä¸ºç‰©ç†åœ°å€voidfreerange(void *pa_start, void *pa_end){  char *p;  p = (char*)PGROUNDUP((uint64)pa_start);  for(; p + PGSIZE &lt;= (char*)pa_end; p += PGSIZE)    kfree(p);}</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä»¥ä¸Šè¿‡ç¨‹ä¸­å¯¹pa_startåˆ°pa_endçš„æ‰€æœ‰ç©ºé—´è¿›è¡Œkfree(å³åˆå§‹åŒ–)ã€‚<br>xv6ä¸­æ¯é¡µé•¿åº¦å›ºå®šä¸º4096ï¼ŒPGROUNDUPæ“ä½œçš„å«ä¹‰æ˜¯é¡µè¡¨é¦–åœ°å€å¾€ä¸Šå–æ•´ï¼Œä¾‹å¦‚è¾“å…¥ï¼ˆé¡µè¡¨0ï¼‰0000åˆ™è¿”å›ï¼ˆé¡µè¡¨0ï¼‰0000ï¼Œè‹¥è¾“å…¥ï¼ˆé¡µè¡¨0ï¼‰0001åˆ™è¿”å›ï¼ˆé¡µè¡¨1ï¼‰0000ã€‚</p><p>endæ˜¯kernelåçš„ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå› æ­¤å¯èƒ½æ²¡æœ‰è¿›è¡Œå†…å­˜å¯¹é½ã€‚PGROUNDUPåˆ™å°†å†…æ ¸é¡µè¡¨çš„æ¯ä¸ªé¡µè¿›è¡Œå†…å­˜å¯¹é½ï¼Œå†…æ ¸å’Œå†…æ ¸é¡µè¡¨é—´å­˜åœ¨ç©ºé—²ç©ºé—´ã€‚å¯¹é½çš„æ„ä¹‰ä¸ç”¨å¤šè¯´ï¼Œå…¶å¯ä»¥ç®€åŒ–è®¸å¤šæ“ä½œï¼Œä¸Šè¿‡è®¡ç»„çš„éƒ½çŸ¥é“ç½¢ã€‚</p><p>kfreeæ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-c" data-language="c"><code class="language-c">void kfree(void *pa){  struct run *r;  if(((uint64)pa % PGSIZE) != 0 || (char*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)    panic("kfree");  // Fill with junk to catch dangling refs.  memset(pa, 1, PGSIZE);  r = (struct run*)pa;  acquire(&amp;kmem.lock);  r-&gt;next = kmem.freelist;  kmem.freelist = r;  release(&amp;kmem.lock);}</code></pre><p>kfree å¯¹æ•°æ®è¿›è¡Œå¿…è¦æ£€æŸ¥åï¼Œmemsetä¸º1ï¼ˆè‹¥é”™è¯¯è®¿é—®ï¼Œmemsetä¸º1æœŸæœ›èƒ½å¤Ÿæ›´å¿«åœ°å¼•å‘å¼‚å¸¸ï¼Œç»ˆæ­¢è¿‡ç¨‹ï¼‰ï¼Œç„¶åå¡«å……é“¾è¡¨ã€‚</p><p>è¿å¸¦ç€ï¼Œè§£é‡Šä»¥ä¸‹kallocï¼š</p><pre class="language-c" data-language="c"><code class="language-c">void * kalloc(void){  struct run *r;  acquire(&amp;kmem.lock);  r = kmem.freelist;  if(r)    kmem.freelist = r-&gt;next;  release(&amp;kmem.lock);  if(r)    memset((char*)r, 5, PGSIZE); // fill with junk  return (void*)r;}</code></pre><p>kalloc å°†freeé“¾è¡¨çš„è¡¨å¤´å»æ‰freeåï¼Œåˆå§‹åŒ–å†…å­˜å¹¶è¿”å›ç‰©ç†åœ°å€ï¼ˆkernelï¼‰</p><h4 id="kvminit">kvminit</h4><p>kvminitç´§æ¥ç€kinitçš„åˆå§‹åŒ–ï¼Œå¼€å§‹åˆ†é…å†…æ ¸é¡µè¡¨ã€‚</p><p>å…¶å†…éƒ¨ä¸ºï¼š</p><pre class="language-c" data-language="c"><code class="language-c">// the kernel's page table.pagetable_t kernel_pagetable;void kvminit(void){  kernel_pagetable = kvmmake();}pagetable_t kvmmake(void){  pagetable_t kpgtbl;  kpgtbl = (pagetable_t) kalloc();  memset(kpgtbl, 0, PGSIZE);  // uart registers  kvmmap(kpgtbl, UART0, UART0, PGSIZE, PTE_R | PTE_W);  // virtio mmio disk interface  kvmmap(kpgtbl, VIRTIO0, VIRTIO0, PGSIZE, PTE_R | PTE_W);  // PLIC  kvmmap(kpgtbl, PLIC, PLIC, 0x400000, PTE_R | PTE_W);  // map kernel text executable and read-only.  kvmmap(kpgtbl, KERNBASE, KERNBASE, (uint64)etext-KERNBASE, PTE_R | PTE_X);  // map kernel data and the physical RAM we'll make use of.  kvmmap(kpgtbl, (uint64)etext, (uint64)etext, PHYSTOP-(uint64)etext, PTE_R | PTE_W);  // map the trampoline for trap entry/exit to  // the highest virtual address in the kernel.  kvmmap(kpgtbl, TRAMPOLINE, (uint64)trampoline, PGSIZE, PTE_R | PTE_X);  // map kernel stacks  proc_mapstacks(kpgtbl);    return kpgtbl;}</code></pre><p>kvminitè°ƒç”¨kvmmakeï¼Œè€Œkvmmakeå¯¹æ¯ä¸€æ®µè¿›è¡Œå…·ä½“çš„åˆ†é…ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåˆ†é…ï¼Ÿè§ä¸Šå›¾ã€‚</p><p>kvmmake:</p><pre class="language-c" data-language="c"><code class="language-c">void kvmmap(pagetable_t kpgtbl, uint64 va, uint64 pa, uint64 sz, int perm){  if(mappages(kpgtbl, va, sz, pa, perm) != 0)    panic("kvmmap");}</code></pre><p>kvmmap è°ƒç”¨mappagesæ¥åˆ†é…vaåˆ°paçš„æ»¡è¶³size=szçš„PTEé¡µè¡¨é¡¹ã€‚</p><h4 id="mappages">mappages</h4><p>mappageså¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-c" data-language="c"><code class="language-c">#define PGROUNDDOWN(a) (((a)) &amp; ~(PGSIZE-1))// Create PTEs for virtual addresses starting at va that refer to// physical addresses starting at pa. va and size might not// be page-aligned. Returns 0 on success, -1 if walk() couldn't// allocate a needed page-table page.int mappages(pagetable_t pagetable, uint64 va, uint64 size, uint64 pa, int perm){  uint64 a, last;  pte_t *pte;  if(size == 0)    panic("mappages: size");    a = PGROUNDDOWN(va);  last = PGROUNDDOWN(va + size - 1);  for(;;){    if((pte = walk(pagetable, a, 1)) == 0)      return -1;    if(*pte &amp; PTE_V)      panic("mappages: remap");    *pte = PA2PTE(pa) | perm | PTE_V;    if(a == last)      break;    a += PGSIZE;    pa += PGSIZE;  }  return 0;}</code></pre><p>mappages é€šè¿‡walkè·å¾—åˆ†é…åçš„é¡µè¡¨é¡¹åœ°å€ï¼Œè¿›è¡Œä¸€ç³»åˆ—æ£€æŸ¥åæŒç»­è¿›è¡Œï¼Œç›´åˆ°æ»¡è¶³sizeè¦æ±‚ã€‚sizeå’Œvaä¸å¿…è¿›è¡Œå¯¹é½ï¼Œå‡½æ•°å†…éƒ¨é€šè¿‡PGROUNDDOWN è¿›è¡Œé¡µè¡¨é¡¹åœ°å€å‘ä¸‹å¯¹é½ã€‚</p><h4 id="walk">walk</h4><p>walkç”¨åˆ°çš„å®æ¯”è¾ƒå¤šï¼Œè¿™é‡Œåˆ—å‡ºï¼š</p><pre class="language-c" data-language="c"><code class="language-c">#define MAXVA (1L &lt;&lt; (9 + 9 + 9 + 12 - 1))#define PXMASK          0x1FF // 9 bits#define PXSHIFT(level)  (PGSHIFT+(9*(level)))#define PX(level, va) ((((uint64) (va)) &gt;&gt; PXSHIFT(level)) &amp; PXMASK)#define PTE2PA(pte) (((pte) &gt;&gt; 10) &lt;&lt; 12)#define PA2PTE(pa) ((((uint64)pa) &gt;&gt; 12) &lt;&lt; 10)</code></pre><ol><li>MAXVAå°±æ˜¯xv6çš„æœ€é«˜åœ°å€ï¼Œè¿™é‡Œåˆ†æ‹†æ¥å†™ï¼Œmaybeè®©äººæ˜ç™½é¡µè¡¨å’Œé¡µå†…åç§»çš„ä½æ•°å§ã€‚</li><li>PXéƒ¨åˆ†é€šè¿‡levelå’Œè™šæ‹Ÿåœ°å€æ¥è·å¾—ç¬¬levelçº§é¡µè¡¨é¡¹çš„indexã€‚</li><li>PTE2PAçš„ä¸¤ä¸ªç»„æ˜¯è¿›è¡Œé¡µè¡¨é¡¹å’Œç‰©ç†åœ°å€çš„äº’è½¬ã€‚</li></ol><p>walk ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">// Return the address of the PTE in page table pagetable// that corresponds to virtual address va.  If alloc!=0,// create any required page-table pages.//// The risc-v Sv39 scheme has three levels of page-table// pages. A page-table page contains 512 64-bit PTEs.// A 64-bit virtual address is split into five fields://   39..63 -- must be zero.//   30..38 -- 9 bits of level-2 index.//   21..29 -- 9 bits of level-1 index.//   12..20 -- 9 bits of level-0 index.//    0..11 -- 12 bits of byte offset within the page.pte_t *walk(pagetable_t pagetable, uint64 va, int alloc){  if(va &gt;= MAXVA)    panic("walk");  for(int level = 2; level &gt; 0; level--) {    pte_t *pte = &amp;pagetable[PX(level, va)];    if(*pte &amp; PTE_V) {      pagetable = (pagetable_t)PTE2PA(*pte);    } else {      if(!alloc || (pagetable = (pde_t*)kalloc()) == 0)        return 0;      memset(pagetable, 0, PGSIZE);      *pte = PA2PTE(pagetable) | PTE_V;    }  }  return &amp;pagetable[PX(0, va)];}</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä»¥ä¸Šè¿‡ç¨‹ä¸­ç›¸å½“äºæ¨¡æ‹Ÿäº†é¡µè¡¨çš„å¯»å€è¿‡ç¨‹ã€‚é€šè¿‡ä¸‰çº§çš„é¡µè¡¨æ–¹å¼æ¥åˆ†é…é¡µè¡¨ï¼Œå¹¶è¿”å›PTEçš„addressã€‚</p><h4 id="proc-mapstacks">proc_mapstacks</h4><pre class="language-c" data-language="c"><code class="language-c">// Allocate a page for each process's kernel stack.// Map it high in memory, followed by an invalid// guard page.voidproc_mapstacks(pagetable_t kpgtbl) {  struct proc *p;    for(p = proc; p &lt; &amp;proc[NPROC]; p++) {    char *pa = kalloc();    if(pa == 0)      panic("kalloc");    uint64 va = KSTACK((int) (p - proc));    kvmmap(kpgtbl, va, (uint64)pa, PGSIZE, PTE_R | PTE_W);  }}</code></pre><p>ä¸ºæ¯ä¸€ä¸ªprocï¼ˆprocçš„å†…å®¹éƒ½æ˜¯äº‹å…ˆåˆ†é…çš„ï¼‰åˆ†é…ä¸€ä¸ªKSTACKã€‚<br>KSTACKå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-c" data-language="c"><code class="language-c">#define KSTACK(p) (TRAMPOLINE - (p)*2*PGSIZE - 3*PGSIZE)</code></pre><p>åˆ†é…KSTACKçš„æ—¶å€™éœ€è¦åœ¨trampolineä¸‹ï¼ˆé¡¶å±‚ï¼‰ï¼Œæ¯ä¸ªSTACKéƒ½è¦æœ‰ä¸¤ä¸ªguard pagesæ¥ä¿æŠ¤ï¼Œè‹¥è®¿é—®äº†è¶…å‡ºKSTACKçš„éƒ¨åˆ†ï¼Œæœ‰æ•ˆä½ä¼šå¼•å‘å¼‚å¸¸ã€‚</p><h4 id="kvminitstart">kvminitstart</h4><pre class="language-c" data-language="c"><code class="language-c">voidkvminithart(){  w_satp(MAKE_SATP(kernel_pagetable));  sfence_vma();}</code></pre><p>æ‰§è¡Œå†…å­˜å±éšœï¼Œåˆ·æ–°TLBã€‚</p><h3 id="code">code</h3><p>2021åŠä¹‹åçš„6.S081æŠŠä¸€äº›labæ”¹äº†ï¼Œæ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><h4 id="Speed-up-system-calls-easy">Speed up system calls (easy)</h4><p>æœ¬é¢˜éœ€è¦å°†ç”¨æˆ·ç©ºé—´ï¼ˆVAï¼‰çš„USYSCALLå¤„æ˜ å°„åˆ°å†…æ ¸ä¸­çš„æŸä¸€å¤„ï¼Œè¿™æ ·ç”¨æˆ·ä¾¿å¯ä»¥ä»USYCALLå¤„è·å¾—å¿…è¦ä¿¡æ¯ï¼ˆæœ¬é¢˜ä¸ºpidï¼‰ã€‚</p><p>å…·ä½“å®ç°ä¸­ï¼šä¿®æ”¹procç»“æ„ï¼š</p><p><code>kernel/proc.h</code></p><pre class="language-c" data-language="c"><code class="language-c">struct proc {  struct spinlock lock;  // p-&gt;lock must be held when using these:  enum procstate state;        // Process state  void *chan;                  // If non-zero, sleeping on chan  int killed;                  // If non-zero, have been killed  int xstate;                  // Exit status to be returned to parent's wait  int pid;                     // Process ID  // wait_lock must be held when using this:  struct proc *parent;         // Parent process  // these are private to the process, so p-&gt;lock need not be held.  uint64 kstack;               // Virtual address of kernel stack  uint64 sz;                   // Size of process memory (bytes)  pagetable_t pagetable;       // User page table  struct trapframe *trapframe; // data page for trampoline.S  struct context context;      // swtch() here to run process  struct file *ofile[NOFILE];  // Open files  struct inode *cwd;           // Current directory  char name[16];               // Process name (debugging)  #ifdef LAB_PGTBL  struct usyscall * usyscall;  #endif};</code></pre><p><code>kernel/proc.c</code>:</p><pre class="language-c" data-language="c"><code class="language-c">static struct proc*allocproc(void){  // ......found:  p-&gt;pid = allocpid();  p-&gt;state = USED;  // Allocate a trapframe page.  if((p-&gt;trapframe = (struct trapframe *)kalloc()) == 0){    freeproc(p);    release(&amp;p-&gt;lock);    return 0;  }  #ifdef LAB_PGTBL  if((p-&gt;usyscall = (struct usyscall*)kalloc()) == 0){    freeproc(p);    release(&amp;p-&gt;lock);    return 0;  }  p-&gt;usyscall-&gt;pid = p-&gt;pid;  #endif  // An empty user page table.  p-&gt;pagetable = proc_pagetable(p);  if(p-&gt;pagetable == 0){    freeproc(p);    release(&amp;p-&gt;lock);    return 0;  }  //.......}static voidfreeproc(struct proc *p){  if(p-&gt;trapframe)    kfree((void*)p-&gt;trapframe);  #ifdef LAB_PGTBL  if(p-&gt;usyscall)    kfree((void*)p-&gt;usyscall);  p-&gt;usyscall = 0;  #endif  //.....}pagetable_tproc_pagetable(struct proc *p){  //....  // map the trapframe just below TRAMPOLINE, for trampoline.S.  if(mappages(pagetable, TRAPFRAME, PGSIZE,              (uint64)(p-&gt;trapframe), PTE_R | PTE_W) &lt; 0){    uvmunmap(pagetable, TRAMPOLINE, 1, 0);    uvmfree(pagetable, 0);    return 0;  }#ifdef LAB_PGTBL  if(mappages(pagetable, USYSCALL, PGSIZE,              (uint64)(p-&gt;usyscall), PTE_R | PTE_U)&lt;0){    uvmunmap(pagetable, TRAMPOLINE, 1, 0);    uvmunmap(pagetable, TRAPFRAME, 1, 0);    uvmfree(pagetable, 0);    return 0;              }#endif  return pagetable;}// Free a process's page table, and free the// physical memory it refers to.voidproc_freepagetable(pagetable_t pagetable, uint64 sz){  uvmunmap(pagetable, TRAMPOLINE, 1, 0);  uvmunmap(pagetable, TRAPFRAME, 1, 0);  #ifdef LAB_PGTBL  uvmunmap(pagetable, USYSCALL, 1, 0);  #endif  uvmfree(pagetable, sz);}</code></pre><p>æœ¬é¢˜çš„å‘åœ¨äºproc_freepagetableè¿™é‡Œã€‚</p><p>å…¶ä½™éƒ¨åˆ†çš„ä¿®æ”¹å‡æœ‰æç¤ºï¼Œä½†proc_freepagetableæ²¡æœ‰ã€‚è‹¥æœªä¿®æ”¹proc_freepagetableï¼Œåˆ™freewalkå‡½æ•°ä¼šè§¦å‘panicï¼š</p><p>ä»¥ä¸‹ä¸ºfreewalkï¼ˆ<code>kernel/vm.c</code>ï¼‰ä»£ç ï¼š</p><pre class="language-c" data-language="c"><code class="language-c">// Recursively free page-table pages.// All leaf mappings must already have been removed.voidfreewalk(pagetable_t pagetable){  // there are 2^9 = 512 PTEs in a page table.  for(int i = 0; i &lt; 512; i++){    pte_t pte = pagetable[i];    if((pte &amp; PTE_V) &amp;&amp; (pte &amp; (PTE_R|PTE_W|PTE_X)) == 0){      // this PTE points to a lower-level page table.      uint64 child = PTE2PA(pte);      freewalk((pagetable_t)child);      pagetable[i] = 0;    } else if(pte &amp; PTE_V){      panic("freewalk: leaf");    }  }  kfree((void*)pagetable);}</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè‹¥panicï¼Œåˆ™å¯¹åº”çš„pteçš„PTE_R,W,Xå‡æœ‰æ•ˆï¼Œå³è¯¥pteæ²¡æœ‰é‡Šæ”¾ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨proc_freepagetableå¤„unmapäº†ã€‚</p><p>å‘ç°æ–¹æ³•ï¼šï¼ˆå‘ƒå‘ƒï¼Œæˆ‘æœäº†ï¼Œç¡®å®ä¸ä¼šgdbï¼‰<br>gdbè®¾ç½®freewalkæ–­ç‚¹ï¼Œcontinueåé€šè¿‡backtraceæ‰¾å‡½æ•°è°ƒç”¨æ ˆå¯ä»¥å‘ç°ã€‚</p><h4 id="Print-a-page-table-easy">Print a page table (easy)</h4><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå¯¹ç€æç¤ºå†™é€’å½’å°±è¡Œã€‚</p><pre class="language-c" data-language="c"><code class="language-c">void _vmprint_level(pagetable_t pagetable, int level){  if(level&gt;2){    return;  }  // there are 2^9 = 512 PTEs in a page table.  for(int i = 0; i &lt; 512; i++){        pte_t pte = pagetable[i];    if(pte &amp; PTE_V){      // this PTE points to a lower-level page table.      for(int i = 0;i &lt;= level;++i){          printf(" ..");      }      uint64 child = PTE2PA(pte);            printf("%d: pte %p pa %p\n", i, pte, child);      _vmprint_level((pagetable_t)child, level+1);    }  }}void vmprint(pagetable_t pagetable){  printf("page table %p\n", pagetable);  _vmprint_level(pagetable, 0);}</code></pre><p>å‘ç‚¹åœ¨äºä¸èƒ½å…ˆå†™è¿™ä¸ªå†å†™speed upâ€¦</p><p>speed upä¼šåˆ›å»ºå¿…è¦çš„å†…æ ¸é¡µè¡¨æ˜ å°„ï¼Œè‹¥æ²¡æœ‰å†™speed upéƒ¨åˆ†ï¼Œprintä¼šç¼ºå°‘ä¸€é¡µï¼Œä¹Ÿå°±æ˜¯speed upåˆ›å»ºçš„USYSCALLæ˜ å°„é¡µã€‚</p><h4 id="Detecting-which-pages-have-been-accessed-hard">Detecting which pages have been accessed (hard)</h4><p>è¿™é¢˜éœ€è¦è·¨æ–‡ä»¶æ¥ä½¿ç”¨walkå‡½æ•°ï¼Œä½†walkå‡½æ•°å·²ç»è¢«å°è£…è€Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå› æ­¤å°è£…äº†ä¸€ä¸‹å†™äº†mywalkå‡½æ•°ï¼š</p><p><code>kernel/vm.c</code></p><pre class="language-c" data-language="c"><code class="language-c">pte_t *my_walk(pagetable_t pagetable, uint64 va, int alloc){  return walk(pagetable, va, alloc);}</code></pre><p><code>kernel/sysproc.c</code></p><pre class="language-c" data-language="c"><code class="language-c">#ifdef LAB_PGTBLvoid my_pgacess_walk(uint64 va, int num, int* buf){  struct proc* p = myproc();  vmprint(p-&gt;pagetable);  for(int i =0;i&lt;num;++i){    pte_t* pte = my_walk(p-&gt;pagetable, va, 0);    if(*pte &amp; PTE_A){      (*buf) |=(1&lt;&lt;i);      (*pte) &amp;= ~(PTE_A);      printf("pte: %p\n", *pte);    }    va+=PGSIZE;  }}intsys_pgaccess(void){  uint64 va, buf;  int num;  int tempbuf = 0;  if(argaddr(0, &amp;va) &lt; 0 || argint(1, &amp;num) &lt;0 || argaddr(2, &amp;buf) &lt;0)    return -1;  struct proc* p = myproc();  my_pgacess_walk(va, num, &amp;tempbuf);  printf("buf: %p\n", (uint64)tempbuf);  if(copyout(p-&gt;pagetable, buf, (char*)&amp;tempbuf, sizeof(tempbuf))&lt;0){    return -1;  }    return 0;}#endif</code></pre><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CNSS Summer 2023 Dev writeup</title>
      <link href="/2023/09/08/cnss-summer-2023-dev-writeup/"/>
      <url>/2023/09/08/cnss-summer-2023-dev-writeup/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h2><p>å‘œå‘œï¼Œå­©å­ä¸ä¼šdevï¼Œéšä¾¿æ‰“ç€ç©çš„ã€‚</p><h2 id="ğŸ§Dev-is-so-funâ€¦-functional">ğŸ§Dev is so funâ€¦ functional!</h2><h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3><p>å†™å‡ºå’Œä»¥ä¸‹<code>scheme</code>ä»£ç ç­‰ä»·çš„ä»£ç ï¼ˆä¸‰ç§è¯­è¨€ï¼‰</p><pre class="language-scheme" data-language="scheme"><code class="language-scheme">#lang scheme(define (make-withdraw balance)  (lambda (amount)    (if (&gt;= balance amount)        (begin (set! balance (- balance amount))               balance)        "Insufficient funds")))(define W1 (make-withdraw 100))(define W2 (make-withdraw 100))(W1 50); 50(W1 30); 20(W2 70); 30(W2 50); Insufficient funds</code></pre><h3 id="è¦ç‚¹">è¦ç‚¹</h3><p>å“ˆå“ˆï¼Œä¸ä¼šå‡½æ•°å¼ç¼–ç¨‹æã€‚<br>é¢˜ç›®è¦æ±‚çš„æ˜¯é—­åŒ…å®ç°ï¼Œå› æ­¤ç”¨classå®ç°ç±»ä¼¼åŠŸèƒ½æ˜¯ä¸è¡Œçš„ã€‚</p><h3 id="è¿‡ç¨‹">è¿‡ç¨‹</h3><p><s>Javascriptæ ¹æœ¬ä¸ä¼šï¼Œä½†ç”¨æ³•éƒ½èƒ½ä»ç½‘ä¸Šæ‰¾åˆ°</s></p><h4 id="C">C++</h4><pre class="language-cpp" data-language="cpp"><code class="language-cpp">#include &lt;functional&gt;#include &lt;iostream&gt;std::function&lt;void(int)&gt; make_withdraw(int balance){    return [=] (int amount) mutable {        if (balance &gt;= amount){            balance -=amount;            std::cout&lt;&lt;balance&lt;&lt;'\n';        } else {            std::cout&lt;&lt;"Insufficient funds\n";        }    };}int main(){    auto W1=make_withdraw(100);    auto W2=make_withdraw(100);    W1(50);    W1(30);    W2(70);    W2(50);}</code></pre><h4 id="Python">Python</h4><pre class="language-python" data-language="python"><code class="language-python">def make_withdraw(balance):    def kkndlam(amount):        nonlocal balance        if balance &gt;= amount:            balance -= amount            print(balance)        else:            print("Insufficient funds")    return kkndlamW1 = make_withdraw(100)W2 = make_withdraw(100)W1(50)W1(30)W2(70)W2(50)</code></pre><h4 id="Javascript">Javascript</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript">function make_withdraw(balance) {    function kkndlam(amount) {        if(balance&gt;=amount){            balance -= amount;            console.log(balance)        } else{            console.log("Insufficient funds");        }    };    return kkndlam;}var W1 = make_withdraw(100);var W2 = make_withdraw(100);W1(50);W1(30);W2(70);W2(50);</code></pre><h2 id="â™ŠåŒäººæˆè¡Œ">â™ŠåŒäººæˆè¡Œ</h2><h3 id="é¢˜ç›®æè¿°-2">é¢˜ç›®æè¿°</h3><p>ä½¿ç”¨æ•°æ®å¹¶è¡ŒåŒ–å®ç°å¤šæœº/å¤šå¡å¯¹<code>CIFAR-10</code>è¿›è¡Œåˆ†ç±»çš„ç¥ç»ç½‘ç»œï¼Œæ¨¡å‹è‡ªé€‰ï¼Œå¹¶å›ç­”æ•°æ®å¹¶è¡ŒåŒ–çš„æ–¹å¼</p><h3 id="è¦ç‚¹-2">è¦ç‚¹</h3><p>CPU+GPUä¹Ÿæ˜¯åŒå¡ğŸ˜¤ï¼Œpytorchå†™ä¸€ä¸‹multiprocessingå°±è¡Œã€‚</p><h3 id="è¿‡ç¨‹-2">è¿‡ç¨‹</h3><div class="admonition note"><p class="admonition-title">é…ç½®</p><ul><li>CPU ç•¥</li><li>GPU NVIDIA GeForce MX450</li><li>æœºå™¨å­¦ä¹ ç¯å¢ƒ pytorch 2.0.1+cu117 CUDA 11.7</li></ul></div><p>å®ç°ï¼šç”¨<s>ä¸œæ‹¼è¥¿å‡‘çš„</s>ResNetæ®‹å·®ç½‘ç»œå®ç°çš„ã€ä»¥<code>CIFAR-10</code>ä¸ºæ•°æ®é›†çš„å›¾åƒåˆ†ç±»</p><h4 id="Code">Code</h4><pre class="language-python" data-language="python"><code class="language-python">import osimport argparseimport torchimport torchvisionimport torchvision.transforms as transformsimport torch.nn as nnimport torch.optim as optimfrom torch.nn import functional as Fimport torch.multiprocessing as mpimport torch.distributed as distfrom torch.nn.parallel import DistributedDataParallel# some parameterkernel_size=3num_epochs = 3lr = 0.01# device: cpu, gpudevice = [torch.device('cpu'), torch.device('cuda')]# transform origin dataï¼š æ•°æ®å¢å¼ºç­‰ã€‚transform = transforms.Compose([    transforms.Pad(4), # å¡«å……åƒç´     transforms.RandomHorizontalFlip(), # å€’è½¬    transforms.RandomCrop(32), # åˆ‡ç‰‡    transforms.ToTensor()])# Res blockclass Residual(nn.Module):    def __init__(self, input_channels, num_channels,                 kernel_size, strides=1, use1x1=False):        super().__init__()        self.conv1 = nn.Conv2d(input_channels, num_channels,                               kernel_size=kernel_size, padding=(kernel_size-1)//2, stride=strides)        self.conv2 = nn.Conv2d(num_channels, num_channels,                               kernel_size=kernel_size, padding=(kernel_size-1)//2)        if use1x1:            self.conv3 = nn.Conv2d(input_channels, num_channels, kernel_size=1, stride=strides)        else:            self.conv3 = None        self.bn1 = nn.BatchNorm2d(num_channels)        self.bn2 = nn.BatchNorm2d(num_channels)    def forward(self, X):        Y = self.conv1(X)        Y = self.bn1(Y)        Y = F.relu(Y)        Y = self.bn2(self.conv2(Y))        if self.conv3:            X = self.conv3(X)        Y += X        return F.relu(Y)# æ€»æ¨¡å‹class ResNet(nn.Module):    def _resnet_block(self, input_channels, num_channels, num_residuals, first_block=False):        blist=[]        for i in range(num_residuals):            if i == 0 and not first_block:                blist.append(Residual(input_channels, num_channels,kernel_size=kernel_size, use1x1=True))            else:                blist.append(Residual(num_channels, num_channels, kernel_size=kernel_size))        return nn.Sequential(*blist)    def __init__(self, layers:list, num_classes=10):        super().__init__()        self.conv1 = nn.Conv2d(3, 16, kernel_size=kernel_size, bias=False)        self.bn1 = nn.BatchNorm2d(16)        self.relu = nn.ReLU(inplace=True)        self.resblk1 = self._resnet_block(16, 16, layers[0], first_block=True)        self.resblk2 = self._resnet_block(16,32, layers[1])        self.resblk3 = self._resnet_block(32, 64, layers[2])        self.avgPool = nn.AdaptiveAvgPool2d((1,1))        self.flatten = nn.Flatten()        self.fullconn = nn.Linear(64, num_classes)    def forward(self, x):        Y = self.conv1(x)        Y = self.bn1(Y)        Y = self.relu(Y)        Y = self.resblk1(Y)        Y = self.resblk2(Y)        Y = self.resblk3(Y)        Y = self.avgPool(Y)        Y = self.flatten(Y)        Y = self.fullconn(Y)        return Ydef train(rank, args):    # åˆå§‹åŒ– ä½¿ç”¨å†…ç½®çš„gloo    dist.init_process_group("gloo", rank=rank, world_size=args.nodes*args.gpus)    # å½“å‰è¿›ç¨‹æ‰€ç”¨device    local_device = device[rank]    # print(rank, local_device)    # åˆå§‹åŒ–è¿›ç¨‹    model = ResNet([2,2,2]).to(local_device)    # åˆ†å¸ƒï¼    model = DistributedDataParallel(model)    #    if rank == 0: # ä¸»è¿›ç¨‹download        train_dataset = torchvision.datasets.CIFAR10(root='data/', train=True, transform=transform, download=True)    else:        dist.barrier()        train_dataset = torchvision.datasets.CIFAR10(root='data/', train=True, transform=transform)    train_loader = torch.utils.data.DataLoader(dataset=train_dataset, batch_size=300, shuffle=True)    # ç­‰å¾…çŠ¶æ€ä»¥ä½¿è¿›ç¨‹è¾¾åˆ°åŒæ­¥ã€‚    dist.barrier()    # äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œ Adamä¼˜åŒ–å™¨    criterion = nn.CrossEntropyLoss()    optimizer = optim.Adam(model.parameters(), lr=lr)    for epoch in range(num_epochs):        # print(epoch)        for images, labels in train_loader:            images = images.to(local_device)            labels = labels.to(local_device)            optimizer.zero_grad()            out = model(images)            loss = criterion(out, labels)            loss.backward()            optimizer.step()    dist.barrier()    # å­˜ä¸‹å‚æ•°    if rank == 0:        torch.save(model.state_dict(), "./resnet.pth")    # å…³é—­æ‰€æœ‰è¿›ç¨‹    dist.destroy_process_group()if __name__ == "__main__":    os.environ["MASTER_ADDR"] = "127.0.0.1"    os.environ["MASTER_PORT"] = "11451"    parser = argparse.ArgumentParser()    parser.add_argument('-n', '--nodes', default=1, type=int)    parser.add_argument('-g', '--gpus', default=len(device), type=int)    args = parser.parse_args()    mp.spawn(train, nprocs=args.gpus, args=(args,))</code></pre><h4 id="æ•°æ®å¹¶è¡ŒåŒ–">æ•°æ®å¹¶è¡ŒåŒ–</h4><p>codeä¸­ä¸ºå¤šè¿›ç¨‹Ring ALLReduceæ–¹å¼ï¼Œé€šè¿‡ç¯å¼çš„é€šä¿¡æå‡äº†é€šä¿¡æ•ˆç‡ã€‚</p><p>å¦å¤–ï¼Œè¯¸å¦‚torchçš„dataparallelå°±ç±»ä¼¼äºgoogle çš„ MapReduceï¼Œå°†ä»»åŠ¡åˆ†æ´¾ç»™å„ä¸ªå­ä»»åŠ¡è¿›è¡Œreduceï¼Œæœ€ååœ¨ä¸»èŠ‚ç‚¹è¿›è¡Œæ•´åˆã€‚</p><h2 id="ğŸ†•malloc-æ€ä¹ˆæ˜¯ä¸ªå‡½æ•°å•Š">ğŸ†•malloc æ€ä¹ˆæ˜¯ä¸ªå‡½æ•°å•Š</h2><h3 id="é¢˜ç›®æè¿°-3">é¢˜ç›®æè¿°</h3><blockquote><p>æ¨èlinuxç¯å¢ƒå®Œæˆ</p></blockquote><p>ä½¿ç”¨Cè¯­è¨€é€ å‡ºmallocå’Œfreeçš„è½®å­ï¼Œå¹¶å›ç­”ç›¸åº”é—®é¢˜ã€‚</p><h3 id="è¦ç‚¹-3">è¦ç‚¹</h3><p><s>windowså¾ˆå¥½å®ç°ï¼Œä½†ä¼šè¢«æ¯™</s><br><s>æ²¡è¯•è¿‡è¿™æ ·å¹²ï¼Œå¯ä»¥çœ‹çœ‹yaoçš„åšå®¢</s></p><p>mallocä¼šåœ¨åˆ†é…çš„å†…å­˜å—å‰å­˜æ”¾ä¿¡æ¯ï¼Œä»è€Œæ–¹ä¾¿freeç­‰æ“ä½œã€‚</p><h3 id="è¿‡ç¨‹-3">è¿‡ç¨‹</h3><h4 id="Code-2">Code</h4><pre class="language-c" data-language="c"><code class="language-c">#include &lt;sys/types.h&gt;#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;#define align8(x) (((((x)+7)&gt;&gt;3)&lt;&lt;3))typedef struct block block;typedef struct block* p_block;// å…¨å±€p_block begin_heap = NULL, end_heap = NULL;struct block{    p_block next; //ä¸‹ä¸€å—åœ°å€ã€‚    p_block prev;// å‰ä¸€å—åœ°å€ï¼Œç”¨äºmergeã€‚    size_t size;// è¯¥å—åˆ†é…äº†å¤šå°‘å­—èŠ‚    int free; //è¯¥å—æ˜¯å¦free.    char *ptr;// ç›¸å½“äºéªŒè¯ä½œç”¨ï¼Ÿ    char data[]; //ç”¨äºå®é™…æ“ä½œä¸­æŒ‰å­—èŠ‚å¯»å€ã€‚};p_block find_block(size_t size){    p_block now = begin_heap;    while(now &amp;&amp; !(now-&gt;free &amp;&amp; now-&gt;size &gt;= size)){        now = now-&gt;next;    }    return now;}p_block extend(size_t size){    p_block now = sbrk(0);    if(sbrk(sizeof(block)+size)==(void*)-1){        return NULL;    }    now-&gt;size = size;    now-&gt;next = NULL;    now-&gt;free = 0;    if(end_heap){        end_heap-&gt;next = now;    } else {        begin_heap = now;    }    now -&gt; prev = end_heap;    now -&gt; ptr = now-&gt;data;    end_heap = now;    return now;}void *mymalloc(size_t size){    p_block now;    size_t align_size = align8(size);    if (begin_heap) {        //å·²æœ‰mallocå†…å­˜åçš„æ“ä½œ        if (now = find_block(align_size)){            now -&gt; free = 0;        } else {            now = extend(align_size);            if(now == NULL){                return NULL;            }        }    } else {        // åˆæ¬¡mallocï¼Œè¿›è¡Œextendæ“ä½œ        now = extend(align_size);        if (now == NULL){            return NULL;        }    }    return now-&gt;data;}p_block get_block(void *nowptr){    //malloc å°†ä¿¡æ¯ä¿å­˜åœ¨ä½¿ç”¨çš„å†…å­˜å—å‰ï¼Œè¿™é‡Œè·å–è¯¥metadataåœ°å€ã€‚    return (p_block)((char*)nowptr - sizeof(block));}int is_valid(void *nowptr){    if (begin_heap){        if ((void*)begin_heap &lt; nowptr &amp;&amp; nowptr &lt; sbrk(0)){            return nowptr == get_block(nowptr)-&gt;ptr;        }    }    return 0;}p_block merge_block(p_block now){    // avoid fragments(maybe?)    if(now-&gt;next &amp;&amp; now-&gt;next-&gt;free){        now-&gt;size += sizeof(block) + now-&gt;next-&gt;size;        now-&gt;next = now-&gt;next-&gt;next;        if(now-&gt;next){            now-&gt;next-&gt;prev = now;        }    }    return now;}void myfree(void * nowptr){    //mergeä¸€ä¸‹ç¢ç‰‡    if(is_valid(nowptr)){        //free block        p_block now = get_block(nowptr);        now-&gt;free = 1;        //merge prev.        if(now-&gt;prev&amp;&amp;now-&gt;prev-&gt;free){            now = merge_block(now-&gt;prev);        }        if(now-&gt;next == NULL){// update begin and end heap.            end_heap = now-&gt;prev;            if(end_heap){                end_heap-&gt;next = NULL;            } else {                begin_heap = NULL;            }            brk(now);        } else { //else do merge.           merge_block(now);         }    } //else : do nothing.}int main(){    //æµ‹æµ‹ä½ çš„    printf("sizeof block: %d\n",sizeof(block));    printf("ptr   begin_heap: %p, end_heap: %p\n", begin_heap, end_heap);    int *a = (int*)mymalloc(sizeof(int)*10);    printf("ptr   begin_heap: %p, end_heap: %p\n", begin_heap, end_heap);    char *b = (char*)mymalloc(sizeof(char)*100);    p_block ta = get_block(a), tb = get_block(b);    printf("a: size %d, next %p, prev %p\n",ta-&gt;size, ta-&gt;next, ta-&gt;prev);    printf("b: size %d, next %p, prev %p\n",tb-&gt;size, tb-&gt;next, tb-&gt;prev);    printf("ptr   begin_heap: %p, end_heap: %p\n", begin_heap, end_heap);    myfree(a);    printf("free a: ptr   begin_heap: %p, end_heap: %p\n", begin_heap, end_heap);    myfree(b);    printf("free b: ptr   begin_heap: %p, end_heap: %p\n", begin_heap, end_heap);}</code></pre><p>æµ‹è¯•æˆªå›¾:<br><img src="/images/CNSS/mymalloc.png" alt="kknd"></p><h4 id="ä¸ºä»€ä¹ˆ-malloc-size-t-size-éœ€è¦ç”³è¯·çš„å†…å­˜é•¿åº¦ï¼Œä½†æ˜¯-free-void-ptr-ä¸éœ€è¦å·²ç”³è¯·çš„å†…å­˜é•¿åº¦ï¼Ÿ">ä¸ºä»€ä¹ˆ malloc(size_t size) éœ€è¦ç”³è¯·çš„å†…å­˜é•¿åº¦ï¼Œä½†æ˜¯ free(void* ptr) ä¸éœ€è¦å·²ç”³è¯·çš„å†…å­˜é•¿åº¦ï¼Ÿ</h4><p>mallocçš„å®ç°ä¸­ï¼Œä¼šåœ¨åˆ†é…çš„å†…å­˜å—å‰å‚¨å­˜ä¸€å°å—æ•°æ®ï¼Œç”¨äºå­˜å‚¨å…³äºè¯¥æ¬¡mallocçš„ä¿¡æ¯ï¼Œä¾‹å¦‚åˆ†é…çš„å†…å­˜å­—èŠ‚å¤§å°ï¼Œä»¥åŠå…¶ä»–ä¿¡æ¯ã€‚freeçš„æ—¶å€™åªéœ€è¦ä¼ å…¥æŒ‡é’ˆï¼Œç¨‹åºä¼šåœ¨çº¦å®šå¥½çš„ä½ç½®è¯»å–ä¿¡æ¯ï¼Œä¾¿å¯ä»¥è¿›è¡Œfreeæ“ä½œè€Œä¸ç”¨ä¼ å…¥éœ€è¦é‡Šæ”¾çš„å†…å­˜å¤§å°ï¼Œæ–¹ä¾¿æ“ä½œã€‚</p><h4 id="OSå¦‚ä½•ç®¡ç†å†…å­˜ï¼Ÿ">OSå¦‚ä½•ç®¡ç†å†…å­˜ï¼Ÿ</h4><p>æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†å†…å­˜æï¼Ÿ</p><ol><li>æ“ä½œç³»ç»Ÿå‘è¿›ç¨‹éšè—äº†å…·ä½“çš„ç‰©ç†å†…å­˜åœ°å€ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯è™šæ‹Ÿçš„åœ°å€ç©ºé—´å‡è±¡ï¼ˆä½¿ç”¨MMUç­‰ç¡¬ä»¶è¿›è¡Œè™šæ‹Ÿåœ°å€è½¬æ¢ï¼‰ã€‚</li><li>æ“ä½œç³»ç»Ÿç»™æ¯ä¸€ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªé¡µè¡¨ï¼Œç”¨ç›¸å¯¹è¾ƒå¤§çš„é¡µè¿™ä¸€å•å…ƒæ¥å‚¨å­˜å…·ä½“çš„ä»£ç å’Œæ•°æ®ï¼Œå¹¶ä½¿ç”¨TLBã€å¤šçº§é¡µè¡¨ç­‰æœºåˆ¶è¿›è¡Œé€Ÿåº¦ä¼˜åŒ–ã€‚</li><li>æ“ä½œç³»ç»Ÿä¼šå°†ä¸å¸¸ç”¨çš„é¡µä»å†…å­˜å‚¨å­˜è¿›ç£ç›˜ï¼Œå½“éœ€è¦è®¿é—®è¯¥é¡µæ—¶ï¼Œç¡¬ä»¶æŠ›å‡ºç¼ºé¡µå¼‚å¸¸ï¼Œç”±è½¯ä»¶ï¼ˆæ“ä½œç³»ç»Ÿï¼‰æ¥è°ƒåº¦é¡µã€‚</li></ol><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä»¥ä¸Šçš„æ“ä½œç³»ç»Ÿè¿‡ç¨‹éƒ½æ˜¯é€æ˜çš„ï¼Œè¿›ç¨‹æ— ä»æ„ŸçŸ¥è¿™ä¸€åˆ‡ï¼Œæ“ä½œç³»ç»Ÿç”¨å¤æ‚çš„æœºåˆ¶å‘è¿›ç¨‹éšè—äº†è¿™ä¸€åˆ‡ã€‚</p><h2 id="ğŸ”€Trace-it">ğŸ”€Trace it!</h2><p>å†é€ æ¬¡è½®å­ï¼</p><h3 id="é¢˜ç›®æè¿°-4">é¢˜ç›®æè¿°</h3><p>è‡ªé€‰è¯­è¨€ï¼Œå®ç°linuxä¸‹çš„tracerouteã€‚æ‰“å°å‡ºæœ¬æœºåˆ°ç›®çš„ä¸»æœºä¹‹é—´è®¾å¤‡çš„ IP åœ°å€å’Œ TTL æ—¶é—´ã€‚ç”±äºæœ‰äº›ä¸­é—´è®¾å¤‡å…³é—­äº†æŸäº›ç½‘ç»œæœåŠ¡ï¼Œæ‰€ä»¥ä¸èƒ½è¢« trace åˆ°ï¼Œä½ åªéœ€è¦ç»™å‡ºç›¸åº”æç¤ºå³å¯ã€‚</p><h3 id="è¦ç‚¹-4">è¦ç‚¹</h3><p>è™½è¯´tracerouteä½¿ç”¨çš„ICMPåŒ…å·²ç»ç¡®å®šå¥½äº†ç±»å‹å’Œä»£ç ï¼Œä½†é”™è¯¯çš„ç±»å‹å’Œä»£ç ä»èƒ½å¾—åˆ°å›åº”<br><s>å’Œå‡ºé¢˜äººbattleåå‘ç°å‡ºé¢˜äººå†™é”™äº†ç±»å‹å’Œä»£ç ç…§æ ·èƒ½å¾—åˆ°å›åº”</s></p><p>äºæ˜¯åªè¦æ„é€ ICMPåŒ…å°±è¡Œäº†ã€‚</p><h3 id="è¿‡ç¨‹-4">è¿‡ç¨‹</h3><p>ç¯å¢ƒ</p><blockquote><p>Linux<br>Python 3.11.3 + Scapy</p></blockquote><h4 id="åŸç†">åŸç†</h4><p>traceroute ä¸»è¦é€šè¿‡IPåè®®å’ŒICMPåè®®ä¸¤è€…å…±åŒå®Œæˆï¼ˆè´Ÿè½½ä¸Šä¹Ÿæœ‰TCPå’ŒUDPä¸¤ç§å®ç°ï¼Œè¿™é‡Œåªè®²UDPå®ç°ï¼‰</p><p>IPåè®®ä¸­çš„TTLå­—æ®µæ¯ç»ä¸€ä¸ªè·¯ç”±å™¨éƒ½ä¼š-1ï¼Œ è‹¥-1åä¸º0ï¼Œè·¯ç”±å™¨å°†å…¶ä¸¢å¼ƒï¼Œå¹¶å°†å‘æºipåœ°å€ï¼ˆå‘èµ·æ–¹ï¼‰å›å¤ä¸€ä¸ªICMPçš„è¶…æ—¶æŠ¥æ–‡ï¼Œä»è¶…æ—¶æ•°æ®æŠ¥çš„æºIPåœ°å€ä¸­ï¼Œ å‘èµ·æ–¹ä¾¿å¯è·å–è¯¥è·¯ç”±å™¨çš„IPåœ°å€ã€</p><p>åˆ©ç”¨ä»¥ä¸ŠåŸç†ï¼Œtracerouteå¯ä»¥åœ¨ç¬¬ä¸€æ¬¡å‘é€<code>TTL=1</code>çš„UDPï¼ˆor TCP?ï¼‰æŠ¥æ–‡ï¼Œæ”¶åˆ°è¶…æ—¶çš„å›å¤æ—¶å†å‘é€<code>TTL=2</code>çš„æŠ¥æ–‡ï¼Œå¦‚æ­¤åå¤ï¼Œç›´åˆ°å‘é€åˆ°ç›®çš„IPåœ°å€ï¼Œæˆ–è¾¾åˆ°è®¾å®šçš„æœ€é«˜hopæ•°ï¼ˆLinux ä¸­çš„ <code>traceroute</code> é»˜è®¤ä¸º30 hopsï¼‰ï¼Œä¾¿å¯å¾—å‡ºæ•°æ®åŒ…é€”ç»çš„IPåœ°å€ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç°åœ¨çš„è®¸å¤šè·¯ç”±å™¨å¼€å¯äº†é˜²ç«å¢™ç­‰åŠŸèƒ½ï¼Œè¢«é…ç½®ä¸ºäº†ä¸è¿”å›ICMPæŠ¥æ–‡ï¼Œå› æ­¤tracerouteå‘½ä»¤æ— æ³•è·å¾—è¯¥è·¯ç”±å™¨çš„IPåœ°å€ï¼Œåœ¨åŸå‘½ä»¤ä¸­æ˜¾ç¤ºä¸º<code>*</code>ã€‚tracerouteä¸ä¼šå› ä¸ºé‡åˆ°è¯¥ç§æƒ…å†µåœæ­¢ï¼Œè€Œæ˜¯ç»§ç»­å¢åŠ TTLï¼Œå‘å‡ºæ•°æ®åŒ…ï¼Œç›´åˆ°é‡åˆ°ä»¥ä¸Šæ‰€è¿°çš„æƒ…å†µè€Œåœæ­¢ã€‚</p><hr><p>é‚£ä¹ˆï¼Œå¦‚ä½•æ ¹æ®ICMPæ¥å¾—å‡ºè·¯ç”±å™¨è¿”å›çš„ä¸åŒæƒ…å†µå‘¢ï¼Ÿ</p><p>ICMP æä¾›äº†typeå­—æ®µä»¥åŠç»†åˆ†çš„codeå­—æ®µä»¥åŒºåˆ†ä¸åŒçš„ç±»å‹ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªåœ¨tracerouteä¸­å°¤å…¶é‡è¦ï¼š</p><table><thead><tr><th>Type</th><th>Code</th><th>description</th></tr></thead><tbody><tr><td>11</td><td>0</td><td>TTL expired in transit</td></tr><tr><td>3</td><td>3</td><td>Destination port unreachable</td></tr></tbody></table><p>Destination port unreachable(ç›®çš„ç«¯å£ä¸å¯è¾¾)ï¼š traceroute çš„ç›®çš„ç«¯å£è®¾ä¸º&gt;30000(Linux é»˜è®¤å€¼ä¸º33434), å¤§å¤šæ•°çš„æœåŠ¡å™¨å¤„ç†è¯¥æ•°æ®æŠ¥æ—¶ä¼šå°†å…¶è§†ä¸ºç«¯å£ä¸å¯è¾¾ï¼Œå› æ­¤è¿”å›ç‰¹å®šæŠ¥æ–‡ã€‚</p><div class="admonition note"><p class="admonition-title">ä¸ºä»€ä¹ˆç›®çš„ç«¯å£è®¾å®šä¸ºå¤§äº30000</p><p>UDPçš„å®ç°ä¸­ä¿è¯äº†0~65535çš„ç«¯å£å·å¯ç”¨ï¼Œåœ¨RFCæ–‡æ¡£ä¸­å¹¶æ²¡æœ‰é™åˆ¶ç«¯å£ä½¿ç”¨ã€‚</p><p>manæ–‡æ¡£ä¸­çš„è§£é‡Šä¸ºï¼šæ¢æµ‹åŒ…éœ€è¦ä½¿ç”¨ <code>udp datagrams with so-called "unlikely" destination ports</code>ï¼Œäºæ˜¯å°±é€‰æ‹©äº†é»˜è®¤å€¼33434ï¼Œä¹Ÿè®¸è®¾è®¡è€…è®¤ä¸º33434å¤§ä¼™å„¿éƒ½ä¸ä¼šç”¨å§ï¼Œæ–‡æ¡£ä¸­ä¹Ÿè¯´æ˜ä¸ä¿è¯33434å¦‚æœæœ‰åº”ç”¨ç”¨äº†ï¼Œtracerouteçš„è¡Œä¸ºå¦‚ä½•ã€‚</p><p>è‡³äºç«¯å£è®¾ç½®ä¸ºå¤§äº30000çš„è¯´æ³•ï¼Œä¹Ÿè®¸åªæ˜¯ç½‘ä¸Šçš„äººäº‘äº¦äº‘ï¼Ÿ</p></div><p>TTL expired in transit(TTL è¶…æ—¶)ï¼šTTLä¸º0æ—¶è·¯ç”±å™¨è¿”å›çš„ICMPæŠ¥æ–‡ï¼Œç”¨äºè·å–è¯¥è·¯ç”±å™¨çš„æºIPåœ°å€ã€‚</p><hr><p>ç»¼åˆæ¥çœ‹ï¼Œ tracerouteçš„è®¾è®¡è¶³å¤Ÿå·§å¦™ï¼Œåˆ©ç”¨äº†ä¸¤ä¸ªåè®®çš„ç»„åˆä½¿ç”¨æ¥è¾¾æˆåŠŸèƒ½ã€‚<br><s>ä¹Ÿè¶³å¤Ÿä¸¥è°¨ï¼Œè¯´æ˜äº†è‡ªå·±é€‰æ‹©ç›®çš„ç«¯å£33434ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º</s></p><h4 id="Code-3">Code</h4><pre class="language-python" data-language="python"><code class="language-python">import sysimport socketimport timefrom scapy.all import *def my_trace_one(dest_ip:str, dest_port:str, ttl:int):    begin_time = time.time()    # verbose ä¼šè¾“å‡ºå¤šä½™ä¿¡æ¯ï¼Œtimeoutä¸ºè®¾å®šå•æ¬¡è¯·æ±‚è¶…æ—¶æ—¶é—´1sã€‚    # IPæ®µè®¾ç½®ç›®çš„IPï¼Œ ttlç”Ÿå­˜å‘¨æœŸï¼Œ UDPè®¾ç½®æºport(è¿™æ„Ÿè§‰æ— æ‰€è°“çš„)ï¼Œ ç›®çš„ç«¯å£è®¾ä¸ºä¸å¯è¾¾(&gt;30000)    reply = sr1(IP(dst=dest_ip, ttl=ttl)/UDP(sport=6600, dport=dest_port), timeout=1, verbose=False)    end_time = time.time()    period=end_time-begin_time    try:        if reply.getlayer(ICMP).type==11 and reply.getlayer(ICMP).code==0:            now_ip = reply.getlayer(IP).src            return "TTL expired in transit", now_ip, period        elif reply.getlayer(ICMP).type == 3 and reply.getlayer(ICMP).code == 3:            now_ip = reply.getlayer(IP).src            return "Destination port unreachable", now_ip, period    except Exception as e:        return None    def my_traceroute(domain:str,ip:str, hops:int=30):    print("Destiny : "+f"({domain}) "+ip)    hop = 0    flag = True    # traceroute default port: 33434    dest_port=33434    while flag and hop&lt;hops:        hop += 1        dest_port +=1        message = str(hop)+" "        result = my_trace_one(dest_ip=ip, dest_port=dest_port, ttl=hop)        if result is None:            message +="\t*"        elif result[0]=="TTL expired in transit":            message += f"\t{result[1]}\t{result[2]*1000}ms"        elif result[0]=="Destination port unreachable":            message += f"\t{result[1]}\t{result[2]*1000}ms\nOver!"            flag=False        print(message)if __name__ == "__main__":    domain = sys.argv[1]    if len(sys.argv)&gt;2:        hops = int(sys.argv[2])    else:        hops=30    ip = socket.gethostbyname(domain)    my_traceroute(domain, ip, hops)</code></pre><h4 id="Picture">Picture</h4><p>æ¼”ç¤ºï¼š<br><img src="/images/CNSS/mytraceroute.png" alt="kknd"></p><p>çœ‹çœ‹Linuxçš„<br><img src="/images/CNSS/linux_traceroute.png" alt="linux"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> CNSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CNSS </tag>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CNSS Summer 2023 SA writeup</title>
      <link href="/2023/09/08/cnss-summer-2023-sa-writeup/"/>
      <url>/2023/09/08/cnss-summer-2023-sa-writeup/</url>
      
        <content type="html"><![CDATA[<p>æ—©çŸ¥é“ï¼Œè¿˜å¾—æ˜¯SAã€‚</p><p>ä»¥ä¸‹åšé¢˜è¿‡ç¨‹ä¸­ï¼Œç¯å¢ƒåŒ…æ‹¬ï¼š</p><ol><li>Windows</li><li>Ubuntu 20.04</li><li>CentOS 7</li><li>Archâ€¦ å½“æ—¶æœ€æ–°ç‰ˆæœ¬ã€‚</li></ol><p>å”‰ï¼Œlinuxå¤ªå¤šäº†ã€‚</p><h2 id="ğŸŒ³Learn-Git-Branching-Git">ğŸŒ³Learn Git Branching(Git)</h2><h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3><p><a href="https://learngitbranching.js.org/">Learn Git</a></p><p>å®Œæˆä»¥ä¸Šé“¾æ¥ä¸­[ä¸»è¦]é‡Œçš„<strong>åŸºç¡€ç¯‡</strong>ã€<strong>é«˜çº§ç¯‡</strong>ã€<strong>ç§»åŠ¨æäº¤è®°å½•</strong> å’Œ<strong>æ‚é¡¹</strong>ï¼Œè¿˜æœ‰[è¿œç¨‹]é‡Œçš„<strong>Push &amp; Pull â€”â€” Git è¿œç¨‹ä»“åº“ï¼</strong>ã€‚</p><p><s>ç•™ç»™åé¢æŸ¥gitå‘½ä»¤æ¥ç”¨</s></p><h3 id="ä¸»è¦-åŸºç¡€ç¯‡">ä¸»è¦-åŸºç¡€ç¯‡</h3><h4 id="commit">commit</h4><p>åªéœ€è¦è¿›è¡Œä¸¤æ¬¡æäº¤å³å¯ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git commitgit commit</code></pre><h4 id="branch">branch</h4><p>åˆ›å»º<code>bugFix</code>åˆ†æ”¯å¹¶åˆ‡æ¢åˆ°æ­¤åˆ†æ”¯ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git branch bugFixgit checkout bugFix</code></pre><h4 id="merge">merge</h4><p>åˆ›å»ºåˆ†æ”¯ååˆ†åˆ«<code>commit</code>ï¼Œæœ€åä½¿ç”¨<code>merge</code>å¯ä»¥åˆå¹¶<code>bugFix</code>åˆ†æ”¯è‡³<code>main</code>åˆ†æ”¯ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git checkout -b bugFixgit commitgit checkout maingit commitgit merge bugFix</code></pre><h4 id="Rebase">Rebase</h4><p>å°†æ–°å»ºçš„<code>bugFix</code>åˆ†æ”¯é€šè¿‡<code>rebase</code>è½¬ç§»è‡³<code>main</code>ä¸‹ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git checkout -b bugFixgit commitgit checkout maingit commitgit checkout bugFixgit rebase main</code></pre><h3 id="ä¸»è¦-é«˜çº§ç¯‡">ä¸»è¦-é«˜çº§ç¯‡</h3><h4 id="åœ¨æäº¤æ ‘ä¸Šç§»åŠ¨">åœ¨æäº¤æ ‘ä¸Šç§»åŠ¨</h4><p>æŒ‡å®šå“ˆå¸Œå€¼ä¾¿å¯ä»¥åˆ†ç¦»<code>HEAD</code>.</p><pre class="language-bash" data-language="bash"><code class="language-bash">git checkout C4</code></pre><h4 id="ç›¸å¯¹å¼•ç”¨1">ç›¸å¯¹å¼•ç”¨1</h4><p>é™¤å¼€å“ˆå¸Œå€¼ï¼Œå¯ä»¥ä½¿ç”¨<code>^</code>æˆ–<code>~num</code>æ¥å‘ä¸Šç§»åŠ¨ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git checkout bugFix^</code></pre><h4 id="ç›¸å¯¹å¼•ç”¨2">ç›¸å¯¹å¼•ç”¨2</h4><p>åŒä¸Š</p><pre class="language-bash" data-language="bash"><code class="language-bash">git branch -f main C6git checkout HEAD~1git branch -f bugFix HEAD~1</code></pre><h4 id="æ’¤é”€å˜æ›´">æ’¤é”€å˜æ›´</h4><p><code>git reset</code>é€šè¿‡å›é€€æ¥æ’¤é”€æ”¹åŠ¨ï¼ˆæœ¬åœ°ï¼‰ï¼Œ<code>git revert</code>æ’¤é”€æ›´æ”¹å¹¶åˆ†äº«åˆ«äººã€‚è¿™é‡Œåªéœ€è¦å¯¹ä¸åŒçš„åˆ†æ”¯è¿›è¡Œä¸åŒæ“ä½œå³å¯ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git reset HEAD^git checkout pushedgit revert pushed</code></pre><h3 id="ç§»åŠ¨æäº¤è®°å½•">ç§»åŠ¨æäº¤è®°å½•</h3><h4 id="Git-Cherry-pick">Git Cherry-pick</h4><p>è¯¥å‘½ä»¤å¯ä»¥å°†ä¸€äº›æäº¤ç›´æ¥å¤åˆ¶åˆ°HEADä¸‹ï¼Œå¹¶å¯æŒ‡å®šå¤šä¸ªæäº¤æŒ‰çº¿æ€§é¡ºåºå¤åˆ¶.</p><pre class="language-bash" data-language="bash"><code class="language-bash">git cherry-pick C3 C4 C7</code></pre><h4 id="äº¤äº’å¼-rebase">äº¤äº’å¼ rebase</h4><p><code>rebase -i(--interactive)</code>å¯ä»¥æ‰“å¼€UIç•Œé¢è¿›è¡ŒèŠ‚ç‚¹åˆ é™¤ã€ä¿®æ”¹é¡ºåºç­‰æ“ä½œã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git rebase -i overHere</code></pre><p>ç„¶åæ‹–æ‹½åˆ é™¤èŠ‚ç‚¹ä¸ºæŒ‡å®šé¡ºåºå³å¯ã€‚</p><h3 id="æ‚é¡¹">æ‚é¡¹</h3><h4 id="åªå–ä¸€ä¸ªæäº¤è®°å½•">åªå–ä¸€ä¸ªæäº¤è®°å½•</h4><p>ä»ç„¶åœ¨äº¤äº’çš„rebaseä¸‹è¿›è¡Œæ‹–æ‹½åˆ é™¤ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git rebase -i maingit rebase bugFix main</code></pre><h4 id="æäº¤çš„æŠ€å·§-1">æäº¤çš„æŠ€å·§ #1</h4><p>å¯ä»¥é€šè¿‡<code>rebase -i </code>+<code>commit--amend</code>å®Œæˆ</p><pre class="language-bash" data-language="bash"><code class="language-bash">git rebase -i HEAD~2git commit --amendgit rebase -i HEAD~2git rebase caption main</code></pre><h4 id="æäº¤çš„æŠ€å·§-2">æäº¤çš„æŠ€å·§ #2</h4><p><code>rebase</code>å¯èƒ½ä¼šå¯¼è‡´å†²çªï¼Œ<code>cherry-pick</code>åˆ™å¯ä»¥å°†æäº¤æ ‘ä¸Šä»»ä½•åœ°æ–¹æ‹¿æ¥è¿½åŠ è‡³<code>HEAD</code>ï¼ˆé<code>HEAD</code>ä¸Šæ¸¸ï¼‰</p><pre class="language-bash" data-language="bash"><code class="language-bash">git checkout maingit cherry-pick C2git commit --amendgit cherry-pick C3</code></pre><h4 id="Git-tags">Git tags</h4><p>ä½¿ç”¨tagå¯ä»¥å®šä¹‰æ°¸è¿œæŒ‡å‘æŸä¸ªæäº¤è®°å½•çš„æ ‡è¯†ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git tag v1 C2git tag v0 C1git checkout v1</code></pre><h4 id="Git-Describe">Git Describe</h4><p>è¿™é‡Œåªæ˜¯ä½œä¸ºæµ‹è¯•<code>describe</code>å‘½ä»¤ä½¿ç”¨ï¼Œæœ€åè¾“å‡º<code>&lt;tag&gt;_&lt;numCommmits&gt;_g&lt;hash&gt;</code>;<br><code>git commit</code> å‘½ä»¤åªæ˜¯ä¸ºäº†é€šè¿‡æ­¤å…³ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git discribe maingit commit</code></pre><h3 id="Push-Pull-â€”â€”-Git-è¿œç¨‹ä»“åº“">Push &amp; Pull â€”â€” Git è¿œç¨‹ä»“åº“</h3><h4 id="git-clone">git clone</h4><p>åˆ›å»ºè¿œç¨‹ä»“åº“æ‹·è´ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git clone</code></pre><h4 id="è¿œç¨‹åˆ†æ”¯">è¿œç¨‹åˆ†æ”¯</h4><p>o(origin)/mainä¸ºè¿œç¨‹åˆ†æ”¯ï¼Œååº”äº†è¿œç¨‹ä»“åº“åœ¨ä¸Šæ¬¡è¿›è¡Œé€šä¿¡çš„çŠ¶æ€ï¼Œç›´æ¥cåœ¨o/mainä¸Šæäº¤ä¸ä¼šæ”¹å˜è¿œç¨‹ä»“åº“çš„çŠ¶æ€ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git commitgit checkout o/maingit commit</code></pre><h4 id="Git-Fetch">Git Fetch</h4><p>è¯¥å‘½ä»¤å¯ä»¥è·å–è¿œç¨‹ä»“åº“çš„æœ€æ–°ä¿¡æ¯ï¼ˆæ›´æ–°è¿œç¨‹åˆ†æ”¯ï¼‰</p><pre class="language-bash" data-language="bash"><code class="language-bash">git fetch</code></pre><h4 id="Git-Pull">Git Pull</h4><p><code>fetch</code> å’Œ <code>merge</code>çš„åˆå¹¶æ“ä½œã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git pull</code></pre><h4 id="æ¨¡æ‹Ÿå›¢é˜Ÿåä½œ">æ¨¡æ‹Ÿå›¢é˜Ÿåä½œ</h4><p><code>fakeTeamwork</code>åœ¨æ•™ç¨‹ä¸­ä¸ºè¿œç¨‹ä»“åº“çš„æäº¤ï¼Œåªåšæ¼”ç¤ºä½œç”¨ã€‚</p><p>è¿™é‡Œæ¨¡æ‹Ÿäº†éƒ¨åˆ†å›¢é˜Ÿåä½œï¼Œåªåœ¨æœ¬åœ°è¿›è¡Œäº†æ›´æ–°<code>pull</code>æ“ä½œã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git clonegit fakeTeamwork main 2git commitgit pull</code></pre><h4 id="Git-push">Git push</h4><p>å°†å˜æ›´ä¸Šä¼ è‡³è¿œç¨‹ä»“åº“ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git commitgit commitgit push</code></pre><h4 id="åç¦»çš„å·¥ä½œ">åç¦»çš„å·¥ä½œ</h4><p>å†å²åç§»çš„ä¸ç¡®å®šæ€§ï¼Œå¯¼è‡´gitä¸å…è®¸ç›´æ¥è¿›è¡Œpushå˜æ›´ï¼ˆå¤±è´¥ï¼‰ã€‚éœ€è¦å…ˆå¼ºåˆ¶åˆå¹¶è¿œç¨‹ä»£ç ï¼Œå†è¿›è¡Œpushæ“ä½œã€‚</p><p><code>pull --rebase</code> (fetch rebase)å’Œ<code>pull</code>(fetch merge)çš„è¡Œä¸ºä¸åŒã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git clonegit fakeTeamwork 1git commitgit pull --rebasegit push</code></pre><h4 id="é”å®šçš„main">é”å®šçš„main</h4><p>è¿œç¨‹ä»“åº“çš„mainé”å®šæ—¶ï¼Œéœ€è¦é€šè¿‡æ–°å»ºåˆ†æ”¯ã€æ¨é€åˆ†æ”¯æ¥è¿›è¡Œæ“ä½œã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">git branch -f main C1git checkout -b featuregit branch -f feature C2git push origin feature </code></pre><h2 id="ğŸ‹ä¸Šä¸ªé¢˜-Docker-Xinetd">ğŸ‹ä¸Šä¸ªé¢˜(Docker, Xinetd)</h2><h3 id="é¢˜ç›®æè¿°-2">é¢˜ç›®æè¿°</h3><p>éƒ¨ç½²ä¸€é“<code>Pwn</code>é¢˜ã€‚è¦æ±‚å…¨è‡ªåŠ¨éƒ¨ç½²ã€‚</p><h3 id="è¿‡ç¨‹">è¿‡ç¨‹</h3><p>è¿™é¢˜å¯ä»¥ç›´æ¥ä»githubä¸Šæ‰¾<a href="https://github.com/Eadom/ctf_xinetd/tree/master">è½®å­</a><br>ä½†åšé¢˜è¿‡ç¨‹ä¸­ç¨å¾®ç»•äº†ä¸€ä¸‹ï¼ŒåŸæœ¬æƒ³è‡ªå·±å†™ç€è¯•è¯•çš„ï¼Œä½†æœ€åè¿˜æ˜¯æŒ‰ä»¥ä¸Š<a href="https://github.com/Eadom/ctf_xinetd/tree/master">è½®å­</a>çš„æ€è·¯å†™äº†ã€‚</p><h3 id="Code">Code</h3><p><strong>docker-compose.yml</strong></p><pre class="language-yaml" data-language="yaml"><code class="language-yaml">services:  pwn:    image: ubuntu:16.04    build: .    container_name: hello_pwn_deploy    ports:      - 0.0.0.0:10000:10000</code></pre><p>å‰©ä¸‹çš„éƒ¨åˆ†åŒä»¥ä¸Šçš„è½®å­éƒ¨åˆ†ã€‚</p><p>pwn å¯åŠ¨ï¼š<code>sudo docker compose up --build -d</code></p><p>åšé¢˜æ—¶pwné¢˜é‡‡ç”¨2023 CNSSå¤ä»¤è¥é‡Œå¤´çš„<code>ğŸ‘€[easy]ä½ çš„åå­—</code>ã€‚</p><h2 id="ğŸ®Play-Game-With-Friends-é…ç¯å¢ƒ">ğŸ®Play Game With Friends(é…ç¯å¢ƒ)</h2><h3 id="é¢˜ç›®æè¿°-3">é¢˜ç›®æè¿°</h3><ol><li>å®Œæˆ ã€æˆ‘çš„ä¸–ç•Œ Minecraft ã€‘ã€ã€æ³°æ‹‰ç‘äºš Terraria ã€‘ã€ã€é¥¥è’ Donâ€™t Starveã€‘ã€ã€åŸç¥ Genshin Impactã€‘ ä¸­ä»»æ„ä¸¤æ¬¾æ¸¸æˆçš„æœåŠ¡å™¨æ­å»ºã€‚</li><li>æ­å»ºåœ¨å…¬ç½‘ä¸é—´æ–­è¿è¡Œçš„æœåŠ¡å™¨ä¸Šã€‚</li></ol><h3 id="è¦ç‚¹">è¦ç‚¹</h3><p>å®˜æ–¹wikiéƒ½æœ‰æ­å»ºæœåŠ¡å™¨æ•™ç¨‹ï¼Œå¯¹ç€è‡ªå·±linuxç‰ˆæœ¬è°ƒä¸€ä¸‹å°±è¡Œäº†ã€‚</p><h3 id="è¿‡ç¨‹-2">è¿‡ç¨‹</h3><p>ç”±äºCentOSå†…å­˜è¿‡å°é…ç½®å¤ªä½ï¼Œä»…èƒ½åŒæ—¶åœ¨çº¿ä¸€ä¸ªæ¸¸æˆçš„æœåŠ¡å™¨ã€‚</p><p>å¼€å¯å¯¹åº”æ¸¸æˆå…·ä½“ç«¯å£xxxxï¼ˆMCï¼‰ï¼Œxxxx+114514ï¼ˆTerrariaï¼‰ã€‚</p><h4 id="æˆ‘çš„ä¸–ç•Œéƒ¨åˆ†">æˆ‘çš„ä¸–ç•Œéƒ¨åˆ†</h4><p>æˆ‘çš„ä¸–ç•Œæœ€æ–°çš„æœåŠ¡å™¨éœ€è¦jdk17ï¼ŒCentOSè‡ªå¸¦javaä¸º1.8ï¼ˆJava 8ï¼‰å¸è½½è‡ªå¸¦çš„jdk1.8ï¼Œå»Oracleå®˜ç½‘å®‰è£…äº†<a href="https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gz">jdk-17</a></p><p>å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gztar zxf jdk-17_linux-x64_bin.tar.gz# jdk 17.0.8 ç‰ˆæœ¬mv jdk-17.0.8.* jdk-17mv jdk-17 /usr/local/# å¢åŠ ç¯å¢ƒå˜é‡vim /etc/profile# å¢åŠ ä»¥ä¸‹è¯­å¥export JAVA_HOME=/usr/local/jdk-17export PATH=/usr/local/jdk-17/bin:$PATH# ä¿å­˜ååŠ è½½é…ç½®æ–‡ä»¶source /etc/profile# çœ‹çœ‹javaç‰ˆæœ¬java -version</code></pre><p>ä¹‹åå°±æ˜¯æˆ‘çš„ä¸–ç•ŒæœåŠ¡å™¨æ­å»ºï¼š</p><p>å»å®˜ç½‘æ‰¾åˆ°<a href="https://piston-data.mojang.com/v1/objects/84194a2f286ef7c14ed7ce0090dba59902951553/server.jar">æœåŠ¡å™¨ä¸‹è½½ç½‘å€</a>ï¼Œåœ¨minecraftæ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨å‘½ä»¤ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">wget https://piston-data.mojang.com/v1/objects/84194a2f286ef7c14ed7ce0090dba59902951553/server.jar</code></pre><p>ä¹‹åå…ˆè¿è¡Œä¸€æ¬¡æœåŠ¡å™¨ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">java -Xmx1024M -Xms1024M -jar server.jar --nogui </code></pre><p>ä¿®æ”¹ç”Ÿæˆçš„eula.txt,ä¿®æ”¹ä¸ºï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">eula=true</code></pre><p>æœ€åå°±æ˜¯ä¿®æ”¹é…ç½®éƒ¨åˆ†ï¼Œé…ç½®æ–‡ä»¶ä¸º<code>server.properties</code>,é…ç½®å¦‚ä¸‹ï¼ˆåšäº†ç‚¹éšç§å¤„ç†ï¼‰</p><pre class="language-bash" data-language="bash"><code class="language-bash">#Minecraft server propertiesenable-jmx-monitoring=falsercon.port=?level-seed=gamemode=survivalenable-command-block=falseenable-query=falsegenerator-settings={}enforce-secure-profile=truelevel-name=worldmotd=A Minecraft Serverquery.port=?pvp=truegenerate-structures=truemax-chained-neighbor-updates=1000000difficulty=easynetwork-compression-threshold=256max-tick-time=-1require-resource-pack=falseuse-native-transport=truemax-players=4online-mode=falseenable-status=trueallow-flight=falseinitial-disabled-packs=broadcast-rcon-to-ops=trueview-distance=10server-ip=resource-pack-prompt=allow-nether=trueserver-port=??????????????enable-rcon=falsesync-chunk-writes=trueop-permission-level=4prevent-proxy-connections=falsehide-online-players=falseresource-pack=entity-broadcast-range-percentage=100simulation-distance=10rcon.password=player-idle-timeout=0force-gamemode=falserate-limit=0hardcore=falsewhite-list=falsebroadcast-console-to-ops=truespawn-npcs=truespawn-animals=truefunction-permission-level=2initial-enabled-packs=vanillalevel-type=minecraft\:normaltext-filtering-config=spawn-monsters=trueenforce-whitelist=falsespawn-protection=16resource-pack-sha1=max-world-size=29999984</code></pre><p>ç”±äºæˆ‘è‡ªå·±æ˜¯ç”¨PCLå¯åŠ¨å™¨è€Œéå®˜æ–¹çš„ï¼Œæ‰€ä»¥online-mode æ”¹æˆfalseäº†ã€‚</p><p>å¥½å˜ï¼Œ<strong>MC å¯åŠ¨</strong>ï¼</p><p><img src="/images/CNSS/local_mc.png" alt="æœ¬åœ°æ¸¸æˆç•Œé¢"></p><p><img src="/images/CNSS/shell_mc.png" alt="shellæŸ¥çœ‹MC"></p><p>æœ€åè®©æœåŠ¡å™¨24å°æ—¶è¿è¡Œï¼Œä½¿ç”¨å‘½ä»¤ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">sudo yum install screenscreen -S minecraft</code></pre><p>è¿›è¡Œä»¥ä¸Šå¯åŠ¨éƒ¨åˆ†çš„å‘½ä»¤ï¼Œç„¶åCtrl+A+Dé€€å‡ºscreenï¼Œå¯ä»¥å‘ç°ä»ç„¶èƒ½å¤Ÿè¿œç¨‹è®¿é—®MCã€‚</p><h4 id="æ³°æ‹‰ç‘äºšéƒ¨åˆ†">æ³°æ‹‰ç‘äºšéƒ¨åˆ†</h4><p>æ²¡ç©è¿‡æ³°æ‹‰ç‘äºšï¼Œçå†™äº†ã€‚</p><p>é¦–å…ˆsteamè´­ä¹°æ³°æ‹‰ç‘äºšï¼ˆ36ï¿¥ğŸ˜­ï¼‰ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬1.4.4.9</p><p>ç„¶åæ–°å»ºTerrariaæ–‡ä»¶å¤¹ï¼Œä»å®˜ç½‘ä¸Šä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">wget https://www.terraria.org/api/download/pc-dedicated-server/terraria-server-1449.zip</code></pre><p>ä¸‹è½½æ¥çš„æ–‡ä»¶æœ‰Windowsï¼Œ linuxå’ŒMacOSä¸‰ä¸ªç‰ˆæœ¬ï¼ŒæŠŠlinuxä¸­æ–‡ä»¶å…¨éƒ¨å¤åˆ¶åˆ°Terrariaæ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>ç»™æ–‡ä»¶åŠ æƒé™ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">chmod a+x ./TerrariaServer.bin.x86_64</code></pre><p>ç‚¹å‡»è¿è¡Œå¹¶ç”Ÿæˆä¸–ç•Œã€‚ä½†æœ‰äº›éº»çƒ¦äº†ï¼Œç›´æ¥å†™ä¸ªconfig.txt:</p><pre class="language-bash" data-language="bash"><code class="language-bash">#Load a world and automatically start the server. Createworld=....../Terraria/worlds/helloTerraria.wldworldpath=....../Terraria/worldsworldname=helloTerrariaport=?????password=??????????????????????????upnp=1motd=Test your terraria!autocreate=1difficulty=0secure=1language=zh/Hans</code></pre><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œ<strong>æ³°æ‹‰ç‘äºš å¯åŠ¨ï¼</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">./TerrariaServer.bin.x86_64 -config config.txt</code></pre><p><img src="/images/CNSS/shell_terraria.png" alt="Terraria shell"></p><p>24å°æ—¶è¿è¡Œæ–¹å¼åŒMCçš„æ–¹å¼ã€‚</p><h2 id="ğŸ˜‹æ‡’äººç¦éŸ³-shellè„šæœ¬">ğŸ˜‹æ‡’äººç¦éŸ³(shellè„šæœ¬)</h2><h3 id="é¢˜ç›®æè¿°-4">é¢˜ç›®æè¿°</h3><p>å†™ä¸ªä¸€é”® bash è„šæœ¬å®Œæˆ:</p><ol><li>åˆ‡æ¢è½¯ä»¶æºä¸ºå›½å†…æºï¼ˆapt/yumï¼‰</li><li>å®‰è£… zsh/fish å’Œ oh-my-zsh</li><li>è®¾ç½® ssh è¶…æ—¶æ—¶é—´ä¸ºè‡³å°‘ 10 åˆ†é’Ÿ</li><li>å®‰è£… Git å¹¶é…ç½®å¥½ email å’Œç”¨æˆ·å</li><li>è®¾ç½®ç³»ç»Ÿä»£ç†</li><li>åˆ‡æ¢ç³»ç»Ÿ locale ä¸ºä¸­æ–‡</li><li>æ›´æ–°æ‰€æœ‰è½¯ä»¶ä¸ºæœ€æ–°</li><li>ç®€è¦çš„äº¤äº’æç¤º</li></ol><p>å¹¶å®Œæˆé™„åŠ è¦æ±‚ï¼š</p><ol><li>å®‰è£… docker å¹¶é…å¥½å›½å†…é•œåƒ</li><li>å®‰è£… nodejs æœ€æ–°ç‰ˆå¹¶é…å¥½å›½å†…é•œåƒ</li><li>å®‰è£…å¹¶é…ç½®å¥½ä½ åœ¨ Linux ä¸‹æœ€å¸¸ç”¨çš„ç¼–è¾‘å™¨ï¼ˆæ¨è Vim åªéœ€è¦é…ä¸ª vimrc å°±å¥½äº†ï¼‰</li><li>å¯¹äºä»¥ä¸Šæ‰€æœ‰æœ‰å…³é•œåƒ/ä»£ç†çš„å†…å®¹ï¼Œæ£€æµ‹å½“å‰è„šæœ¬è¿è¡Œçš„ ip æ˜¯å¦åœ¨å›½å†…ï¼Œåœ¨çš„è¯æ‰é…ç½®é•œåƒ/ä»£ç†å¦åˆ™ä¸æ›´æ”¹é»˜è®¤é…ç½®</li></ol><h3 id="è¦ç‚¹-2">è¦ç‚¹</h3><p>éƒ½èƒ½æœå¾—åˆ°ï¼Œå”¯ä¸€æ³¨æ„çš„æ˜¯æ£€æµ‹ipåœ¨å›½å†…ï¼Œéœ€è¦curlä¸€ä¸‹å¤–éƒ¨ç½‘å€ã€‚</p><h3 id="è¿‡ç¨‹-3">è¿‡ç¨‹</h3><pre class="language-bash" data-language="bash"><code class="language-bash">#!/bin/shfunction change_apt_source(){    echo "=========================================="    UB_VERSION=$(cat /etc/os-release | grep VERSION_CODENAME | awk -F "=" '{print $2}')    echo "==== Ubuntu version: $UB_VERSION ===="    echo "begin change your source(tsinghua)..."    if [ $1 = "OTHER" ]; then        echo "You are not in CN so that don't need change your apt source."        return 0    fi     echo "origin source.list is stored in /etc/apt/sources.list.bak"    sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak        echo "# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-updates main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-backports main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-backports main restricted universe multiverse# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-security main restricted universe multiverse# \# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-security main restricted universe multiversedeb http://security.ubuntu.com/ubuntu/ $UB_VERSION-security main restricted universe multiverse# deb-src http://security.ubuntu.com/ubuntu/ $UB_VERSION-security main restricted universe multiverse# é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-proposed main restricted universe multiverse# # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ $UB_VERSION-proposed main restricted universe multiverse" | sudo tee /etc/apt/sources.list    echo "=========================================="    echo "SUCCESS change apt source!"}function install_zsh(){    echo "=========================================="    echo "begin install zsh..."    sudo apt-get install zsh    if [ $1 = "OTHER" ]; then        sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"    else        sh -c "$(curl -fsSL https://gitee.com/shmhlsy/oh-my-zsh-install.sh/raw/master/install.sh)" #å›½å†…é•œåƒæº    fi    echo "=========================================="    echo "SUCCESS install zsh&amp;oh-my-zsh!"}function change_ssh_config(){    echo "=========================================="    echo "begin config ssh..."    sed -i 's/\(^[\s#]*\)ClientAliveInterval\(.*\)/ClientAliveInterval 60/'     sed -i 's/\(^[\s#]*\)ClientAliveCountMax\(.*\)/ClientAliveCountMax 10/' ~/test.txt    echo "=========================================="    echo "SUCCESS config ssh: 10 minutes Alive"}function install_git(){    echo "=========================================="    echo "begin install git..."    sudo apt install git    echo -n "Your git name:"    read GIT_USERNAME    git config --global user.name $GIT_USERNAME    echo -n "Your git email:"    read GIT_EMAIL    git config --global user.email $GIT_EMAIL    git config --list    echo "=========================================="    echo "SUCCESS install git!"}function install_docker(){    echo "=========================================="    echo "begin install docker..."    for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do        sudo apt-get remove $pkg    done    sudo apt-get update    sudo apt-get install ca-certificates curl gnupg    sudo install -m 0755 -d /etc/apt/keyrings    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg    sudo chmod a+r /etc/apt/keyrings/docker.gpg    echo \    "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \    "$(. /etc/os-release &amp;&amp; echo "$VERSION_CODENAME")" stable" | \    sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null    sudo apt-get update    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin    sudo systemctl enable docker    sudo systemctl start docker    if [ $1 = "CN" ]; then     echo "{  \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"]}" | sudo tee -a /etc/docker/daemon.json    fi    sudo service docker restart    echo "=========================================="    echo "SUCCESS install docker!"}function install_nodejs_new(){    echo "=========================================="    echo "begin install nodejs..."    NOW_PWD=$(pwd)    cd /usr/local/src/    sudo wget https://nodejs.org/dist/v18.17.0/node-v18.17.0.tar.gz    sudo tar -zxvf node-v18.17.0.tar.gz    cd node-v18.17.0    sudo ./configure    sudo make    sudo make install    cd $NOW_PWD    if [ $1 = "CN" ]; then    npm config set registry https://registry.npm.taobao.org    npm config get registry    npm install -g cnpm --registry=https://registry.npm.taobao.org    fi    echo "=========================================="    echo "SUCCESS install newest nodejs!"}function install_vim(){    sudo apt update    sudo apt install vim    echo "set laststatus=2set numberset noebset ts=4set softtabstop=4set shiftwidth=4set expandtabset autoindent" | tee ~/.vimrc}function config_Chinese(){    echo "=========================================="    echo "begin config Chinese..."    sudo apt update    sudo apt install language-pack-zh-hans    echo 'LANG="zh_CN.UTF-8"LANGUAGE="zh_CN:zh"LC_NUMERIC="zh_CN"LC_TIME="zh_CN"LC_MONETARY="zh_CN"LC_PAPER="zh_CN"LC_NAME="zh_CN"LC_ADDRESS="zh_CN"LC_TELEPHONE="zh_CN"LC_MEASUREMENT="zh_CN"LC_IDENTIFICATION="zh_CN"LC_ALL="zh_CN.UTF-8"' | sudo tee /etc/default/localeecho "=========================================="echo "SUCCESS é…ç½®ä¸­æ–‡ï¼"}function config_English(){    echo "=========================================="    echo "begin config English..."    echo 'LANG=C.UTF-8LANGUAGE=LC_CTYPE="C.UTF-8"LC_NUMERIC="C.UTF-8"LC_TIME="C.UTF-8"LC_COLLATE="C.UTF-8"LC_MONETARY="C.UTF-8"LC_MESSAGES="C.UTF-8"LC_PAPER="C.UTF-8"LC_NAME="C.UTF-8"LC_ADDRESS="C.UTF-8"LC_TELEPHONE="C.UTF-8"LC_MEASUREMENT="C.UTF-8"LC_IDENTIFICATION="C.UTF-8"LC_ALL=' | sudo tee /etc/default/locale    echo "=========================================="    echo "SUCCESS config English!"}function config_system_proxy(){    if [ $1 = "OTHER" ]; then        return 0    fi    echo "=========================================="    echo "begin config your proxy..."    echo "Your HTTP PROXY:"    read HTTP_PROXY    echo "Your HTTPS PROXY?:"    read HTTPS_PROXY    echo "export HTTP_PROXY=\"$HTTP_PROXY\"" | sudo tee -a /etc/profile.d/proxy.sh    echo "export HTTPS_PROXY=\"$HTTPS_PROXY\"" | sudo tee -a /etc/profile.d/proxy.sh    sudo chmod u+x /etc/profile.d/proxy.sh    source /etc/profile.d/proxy.sh    echo "=========================================="    echo "SUCCEE config system proxy(HTTP, HTTPS) in /etc/profile.d/proxy.sh"}   function update_software(){    sudo apt upgrade    sudo apt update}function is_ip_cn(){    echo $1    COUNTRY=$(curl ipinfo.io | grep "country" | awk '{print $2}')    if [ $COUNTRY = '"CN",' ]; then        return 0    else        return 1    fi}if [ is_ip_cn ]; then    COUNTRY="CN"else    COUNTRY="OTHER"fichange_apt_source $COUNTRY;install_zsh $COUNTRY;change_ssh_config;install_git;config_system_proxy $COUNTRY;config_Chinese;update_software;install_docker $COUNTRY;install_nodejs_new $COUNTRY;install_vim;</code></pre><h2 id="ğŸ–¥ï¸GUI-Undoubtedly-Indispensable-VNC-xrdp-nohup">ğŸ–¥ï¸GUI Undoubtedly Indispensable(VNC,xrdp,nohup)</h2><h3 id="é¢˜ç›®æè¿°-5">é¢˜ç›®æè¿°</h3><ol><li>å®Œæˆä»»æ„ Linux äº‘æœåŠ¡å™¨ ä¸Šçš„å›¾å½¢åŒ–ç¯å¢ƒæ­å»ºï¼ˆå¦‚ gnome, xfce, kde ï¼‰</li><li>è¿æ¥åˆ°æ¡Œé¢ç¯å¢ƒä¸‹æ‰“å¼€ GVIM å’Œå¯¹åº”ç¯å¢ƒçš„ç»ˆç«¯ï¼ˆè¿è¡Œ neofetch/screenfetchï¼‰ å¹¶æˆªå›¾</li></ol><h3 id="è¿‡ç¨‹-4">è¿‡ç¨‹</h3><p>äº‘æœåŠ¡å™¨ä¸ºè…¾è®¯äº‘ CentOS 7.</p><p>ç³»ç»Ÿå¿…è¦çš„é…ç½®ç•¥è¿‡ä¸æï¼Œç›´æ¥åˆ°å›¾å½¢åŒ–ç•Œé¢éƒ¨åˆ†ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">sudo yum grouplist # æ£€æŸ¥å¯å®‰è£…çš„group# å‘ç°å¯å®‰è£…GNOME Desktopsudo yum groupinstall "GNOME Desktop"# å®‰è£…vnc serversudo yum install vnc-server# å®‰è£…xrdpsudo yum install epel*sudo yum install xrdp# å¯åŠ¨xrdpsudo systemctl start xrdp# æŸ¥çœ‹xrdpå¯åŠ¨çŠ¶æ€sudo systemctl status xrdp# è®¾ç½®å¼€æœºè‡ªå¯sudo systemctl enable xrdp</code></pre><p>ä¹‹ååˆ°è…¾è®¯äº‘æ§åˆ¶å°å¼€æ”¾3389ç«¯å£ï¼š</p><p>Windowsé€šè¿‡è¿œç¨‹æ¡Œé¢è¿æ¥ç¨‹åºæŒ‡å®šipè¿›è¡Œè¿æ¥ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç å³å¯è¿›å…¥æ¡Œé¢ï¼›å®‰è£…gvimï¼Œneofetchï¼Œç»“æŸã€‚</p><hr><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åå°æ‰§è¡Œfirefoxï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">nohup firefox &amp;</code></pre><h2 id="ğŸš€èŒæ–°ä¹Ÿæƒ³æ­è½½ä¸ŠX-å¼•æ“-Nginx">ğŸš€èŒæ–°ä¹Ÿæƒ³æ­è½½ä¸ŠX-å¼•æ“(Nginx)</h2><h3 id="é¢˜ç›®æè¿°-6">é¢˜ç›®æè¿°</h3><ol><li>åœ¨ Linux ç³»ç»Ÿä¸Šå®‰è£… Nginx å…è´¹å¼€æºç‰ˆï¼ˆç¼–è¯‘å®‰è£…/åŒ…ç®¡ç†å™¨å®‰è£…ï¼‰ï¼Œå®‰è£…ååœ¨æµè§ˆå™¨è®¿é—® Nginx åˆå§‹æ¬¢è¿é¡µé¢ã€‚</li><li>äº†è§£ Nginx å¸¸è§ä½¿ç”¨å‘½ä»¤ï¼Œå¯»æ‰¾ä½ çš„ Nginx é…ç½®æ–‡ä»¶è·¯å¾„ã€‚</li><li>Nginx çš„æ¬¢è¿é¡µé¢å¤ªä¸‘äº†ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®©æµè§ˆå™¨è®¿é—®æ˜¾ç¤ºè¯¥é™æ€é¡µé¢é¡µé¢</li><li>ä½¿ç”¨ä¸€ä¸ª Nginx ä»£ç†3ä¸ªé¡µé¢ï¼Œä¸åŒçš„ç«¯å£å·è®¿é—®åˆ°ä¸åŒçš„é¡µé¢.</li><li>å®ç° URL è½¬å‘ï¼š å½“ URI è¯·æ±‚ä¸º /google æ—¶ï¼Œè·³è½¬åˆ°è°·æ­Œï¼›å½“ URI è¯·æ±‚ä¸º /github æ—¶ï¼Œè·³è½¬åˆ° GitHub ï¼›å½“ URI è¯·æ±‚ä¸º/cnssæˆ–/cnss/xxx æ—¶ï¼Œxxx æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œè·³è½¬åˆ° CNSS æ‹›æ–°å®˜ç½‘ï¼›å…¶ä½™ä»»æ„è¯·æ±‚è·³è½¬åˆ°è¯¥é™æ€é¡µé¢ã€‚</li><li>æ­å»ºä¸€ä¸ªç®€æ˜“æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ï¼Œè®¿é—® /downloads èƒ½å¤Ÿæ˜¾ç¤ºæ–‡ä»¶ç›®å½•ã€‚</li><li>å®ç°ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå½“è®¿é—®åŒä¸€ä¸ª URL æ—¶ï¼ŒæŒ‰ç…§æµé‡æ¯” 1 : 2 : 3 åˆ†åˆ«è®¿é—®åˆ° 3 ä¸ªä¸åŒçš„é¡µé¢ã€‚<blockquote><p>Tipï¼šNginx upstream å¯ä»¥å°†è¯·æ±‚è½¬å‘ç»™å¤šä¸ªåç«¯ serverï¼Œè¯¥æ€æ ·æ¨¡æ‹Ÿå¤šä¸ª server å‘¢ï¼Ÿ</p></blockquote></li><li>å®ç° â€œURL è½®è¯¢å™¨â€ï¼Œè®¿é—®è¯¥ URL æ—¶ï¼Œè½®è¯¢è·³è½¬åˆ°å¤§ä½¬ä»¬çš„åšå®¢ã€‚</li></ol><h3 id="è¦ç‚¹-3">è¦ç‚¹</h3><p>æœ€èŠ±æ—¶é—´çš„ä¸€é›†<br>å…¶ä»–SAä¸€ä¸‹åˆä¾¿å¯å®Œæˆï¼Œè¿™é¢˜åšäº†ä¸‰å››å¤©ï¼Œä»¤äººæ„Ÿå¹ã€‚</p><p>nginxå®ç°é‡å®šå‘çš„æ—¶å€™ä¸éœ€è¦å¤ªå¤æ‚ï¼Œä¸è¦å¾€proxyæƒ³å°±è¡Œã€‚</p><h3 id="è¿‡ç¨‹-5">è¿‡ç¨‹</h3><p>CentOS 7 é…ç½®nginxï¼š</p><p>yumæºé‡Œå¤´æ²¡æœ‰nginx availbaleï¼Œé€‰æ‹©ç¼–è¯‘å®‰è£…nginxï¼š</p><p>å¿…è¦çš„ç¯å¢ƒå·²é¢„è£…ï¼ˆå®é™…ä¸Šä¹Ÿå°±yumé‡Œå¤´çš„å‡ ä¸ªè½¯ä»¶ï¼‰</p><pre class="language-bash" data-language="bash"><code class="language-bash"># stable nginxwget http://nginx.org/download/nginx-1.24.0.ziptar -zxvf nginx-1.24.0.zipcd nginx-1.24.0mkdir /var/temp/nginx -p# ç¼–è¯‘é…ç½®./configure         --prefix=/usr/local/nginx \    --pid-path=/usr/local/nginx/nginx.pid \    --lock-path=/var/lock/nginx.lock     \    --error-log-path=/var/log/nginx/error.log \         --http-log-path=/var/log/nginx/access.log   \    --with-http_gzip_static_module     \    --http-client-body-temp-path=/var/temp/nginx/client  \    --http-proxy-temp-path=/var/temp/nginx/proxy \    --http-fastcgi-temp-path=/var/temp/nginx/fastcgi \    --http-uwsgi-temp-path=/var/temp/nginx/uwsgi   \    --http-scgi-temp-path=/var/temp/nginx/scgi \    --with-pcre \    --with-http_ssl_module \    --with-http_v2_module \    --with-http_realip_module \    --with-http_addition_module \     --with-http_sub_module \    --with-http_dav_module \    --with-http_flv_module \    --with-http_mp4_module \    --with-http_gunzip_module \    --with-http_gzip_static_module \    --with-http_random_index_module \    --with-http_secure_link_module \    --with-http_stub_status_module \    --with-http_auth_request_module \    --with-http_image_filter_module \    --with-http_slice_module \    --with-mail \    --with-threads \     --with-file-aio \    --with-stream \    --with-mail_ssl_module \    --with-stream_ssl_module \sudo make &amp;&amp; sudo make install# æµ‹è¯•ä¸€ä¸‹cd /usr/local/nginx/sbinsudo ./nginx # nginx å¯åŠ¨ï¼sudo ./nginx -t # çœ‹çœ‹é…ç½®æ–‡ä»¶sudo ./nginx -s reload # é‡å¯sudo ./nginx -s stop  # å…³é—­sudo ./nginx -v        # çœ‹çœ‹ç‰ˆæœ¬# æ·»åŠ æœåŠ¡sudo vim /usr/lib/systemd/system/nginx.service# æ–‡ä»¶å¦‚ä¸‹ï¼š# [Unit]# Description=nginx - high performance web server# Documentation=http://nginx.org/en/docs/# After=network.target remote-fs.target nss-lookup.target# # [Service]# Type=forking# PIDFile=/var/run/nginx/nginx.pid# ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf# ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf# ExecReload= /usr/local/nginx/sbin/nginx -s reload# ExecStop= /usr/local/nginx/sbin/nginx -s stop# PrivateTmp=true# [Install]# WantedBy=multi-user.targetsudo chmod +x /usr/lib/systemd/nginx.servicesudo systemctl daemon-reloadsudo systemctl start nginx.servicesudo systemctl enable nginx.service# å¸¸ç”¨æŒ‡ä»¤## å¹³æ»‘é‡å¯sudo nginx -s reload## åœæ­¢nginxsudo nginx -s stop## æ£€æµ‹ä¸‹è¯­æ³•é”™è¯¯sudo nginx -t## å¯åŠ¨nginxsudo nginx</code></pre><p>nginxä»£ç†çš„é™æ€é¡µé¢æ–‡ä»¶å¸ƒå±€å¦‚ä¸‹ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">nginx/â”œâ”€â”€ bg.jpgâ”œâ”€â”€ downloadsâ”‚   â”œâ”€â”€ kkndâ”‚   â””â”€â”€ nishi?â”œâ”€â”€ index.htmlâ”œâ”€â”€ portâ”‚   â”œâ”€â”€ h1.htmlâ”‚   â”œâ”€â”€ h2.htmlâ”‚   â””â”€â”€ h3.htmlâ””â”€â”€ todo    â”œâ”€â”€ index.html    â”œâ”€â”€ script.js    â””â”€â”€ style.css</code></pre><p>nginxé…ç½®æ–‡ä»¶ï¼š</p><pre class="language-nginx" data-language="nginx"><code class="language-nginx">user  ?æœ¬æœºuser;worker_processes  auto;error_log  logs/error.log;error_log  logs/error.log  notice;error_log  logs/error.log  info;pid  /usr/local/nginx/nginx.pid;events {    # ulimits -næ˜¯100001,è¿™é‡Œå°±ç¨å¾®å°ä¸€ç‚¹    worker_connections  1024;}http {    include       /usr/local/nginx/conf/mime.types;    default_type  application/octet-stream;    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '                      '$status $body_bytes_sent "$http_referer" '                      '"$http_user_agent" "$http_x_forwarded_for"';    #access_log  logs/access.log  main;    sendfile        on;    #tcp_nopush     on;    #keepalive_timeout  0;    keepalive_timeout  65;    gzip on;    gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/javascript image/jpeg image/gif image/png;    gzip_vary on;          upstream balance {        server æœ¬åœ°é…ç½®åŸŸå:8081 weight=1 max_fails=5 fail_timeout=5;        server æœ¬åœ°é…ç½®åŸŸå:8082 weight=2 max_fails=5 fail_timeout=5;        server æœ¬åœ°é…ç½®åŸŸå:8083 weight=3 max_fails=5 fail_timeout=5;    }    upstream visit {        # è½®è¯¢å®ç°urlè½®è¯¢å™¨        server æœ¬åœ°é…ç½®åŸŸå:8084 max_fails=5 fail_timeout=5;        server æœ¬åœ°é…ç½®åŸŸå:8085 max_fails=5 fail_timeout=5;        server æœ¬åœ°é…ç½®åŸŸå:8086 max_fails=5 fail_timeout=5;    }     server {        listen       80;        server_name  æœ¬åœ°é…ç½®åŸŸå;        #charset koi8-r;        access_log  logs/welcome.log main;        rewrite ^/google$ https://www.google.com permanent;        rewrite ^/github$ https://github.com permanent;        rewrite ^/cnss$ https://summer.cnss.io permanent;        rewrite ^/cnss/.*$ https://summer.cnss.io permanent;        location = / {            root   /???/nginx;            try_files /index.html /index.htm;        }        location / {            rewrite ^/.*$ /todo/ redirect;        }        location = /balance {            proxy_pass http://balance/;        }        location = /visit {                    proxy_pass http://visit/;        }        location /todo/ {            access_log logs/todo.log main;            alias /???/nginx/todo;            try_files /index.html /style.css;        }        location ^~ /downloads/ {            autoindex on;# æ˜¾ç¤ºç›®å½•            autoindex_exact_size on;# æ˜¾ç¤ºæ–‡ä»¶å¤§å°            autoindex_localtime on;# æ˜¾ç¤ºæ–‡ä»¶æ—¶é—´            alias /???/nginx/downloads/;        }        error_page   500 502 503 504  /50x.html;    }    server {        listen        8081;            server_name   æœ¬åœ°é…ç½®åŸŸå;        access_log    logs/h1.log      main;        location / {            root    /???/nginx/port;            index   h1.html h1.htm;        }     }        server {        listen        8082;            server_name   æœ¬åœ°é…ç½®åŸŸå;        access_log    logs/h2.log      main;        location / {            root    /???/nginx/port;            index   h2.html h2.htm;        }     }    server {        listen        8083;            server_name   æœ¬åœ°é…ç½®åŸŸå;        access_log    logs/h3.log      main;        location / {            root    /???/nginx/port;            index   h3.html h3.htm;        }     }    server {        listen 8084;        server_name æœ¬åœ°é…ç½®åŸŸå;        access_log   logs/visit1.log main;        location / {           rewrite ^.*$ https://yaossg.com redirect;        }    }    server {        listen 8085;        server_name æœ¬åœ°é…ç½®åŸŸå;        access_log   logs/visit2.log main;        location / {            return 302 https://www.cnblogs.com/timlzh;        }    }    server {        listen 8086;        server_name æœ¬åœ°é…ç½®åŸŸå;        access_log logs/visit2.log main;        location / {            return 302 https://sh1no.icu;        }    }    # å…³æ³¨yaossg timlzh shinoè°¢è°¢å–µ}</code></pre><p>è‹¥è¦ç»§ç»­æ”¹è¿›ï¼Œå¯æœ‰ï¼š</p><ol><li>keep-alivedç­‰å¢åŠ å¯ç”¨æ€§</li><li>dockerä¸€é”®éƒ¨ç½²</li><li>httpsåŸŸå+è¯ä¹¦</li></ol><h2 id="ğŸ‹é€ ä¸ªé›†è£…ç®±">ğŸ‹é€ ä¸ªé›†è£…ç®±</h2><h3 id="é¢˜ç›®æè¿°-7">é¢˜ç›®æè¿°</h3><p>æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸ªDockerå®¹å™¨ç½‘ç»œã€‚</p><h3 id="è¦ç‚¹-4">è¦ç‚¹</h3><p>æ¥å¼ pictureï¼š</p><p><img src="/images/CNSS/docker_network.jpg" alt="docker ç½‘ç»œåŸç†"></p><h3 id="è¿‡ç¨‹-6">è¿‡ç¨‹</h3><p>ä¸ºäº†è¡¨ç¤ºè®¿é—®å¤–ç½‘ï¼Œå†™ä¸ªflaskå…ˆã€‚</p><p>Flask <code>./app.py</code>:</p><pre class="language-python" data-language="python"><code class="language-python">from flask import Flask, render_templateimport requestsapp = Flask(__name__)@app.route('/')def moyu():    """    è·å–æ‘¸é±¼äººæ—¥å†    """    url = "https://moyu.qqsuu.cn/?type=json"    img_url = ""    response = requests.get(url=url).json()    # æ•°æ®æ ¼å¼ç¤ºä¾‹ï¼šï¼ˆå¯ä»¥çœ‹åˆ°æ ¹æœ¬æ²¡å¿…è¦ç”¨urlæ¥è·å–å›ºå®šæ ¼å¼çš„å›¾ç‰‡urlï¼Œä½†è¿™é‡Œåªæ˜¯ä¸ºäº†ç¨å¾®å±•ç¤ºä¸€ä¸‹èƒ½è®¿é—®å¤–ç½‘ï¼‰    # {"code":200,"msg":"success","data":"https://moyu.qqsuu.cn/moyu/20230818.png"}    if response.get("code") == 200:        moyu_url=response["data"]        response = requests.get(moyu_url)        img_url = response.url    return render_template('index.html', img_url=img_url)if __name__ == '__main__':    app.run(host="0.0.0.0",port=80)</code></pre><p>Flask æ¸²æŸ“çš„htmlæ¨¡ç‰ˆæ–‡ä»¶<code>./template/index.html</code>ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup">&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;    &lt;meta charset="UTF-8"&gt;    &lt;title&gt;ğŸ–ï¸ğŸŸ&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;img src="{{ img_url }}"&gt;&lt;/body&gt;</code></pre><p>è„šæœ¬æ–‡ä»¶ï¼ˆé»˜è®¤å·²è£…æœ‰å¿…è¦å·¥å…·ï¼‰ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"># åˆ›å»ºç½‘ç»œnamespacesudo ip netns add flask_test# åˆ›å»ºvethï¼ˆVirtual Ethernet Pairï¼‰ï¼Œä½œä¸ºæ¡¥æ¢é“¾æ¥ä¸åŒè™šæ‹Ÿç½‘ç»œè®¾å¤‡ã€‚sudo ip link add veth_ns type veth peer name veth_br# å°†vethå…¶ä¸­ä¸€ç«¯è¿å…¥namespaceä¸­sudo ip link set veth_ns netns flask_test# é…ç½®namespaceç«¯çš„veth ipsudo ip netns exec flask_test ip addr add 192.168.0.2/24 dev veth_ns# veth_ns å¯åŠ¨ï¼sudo ip netns exec flask_test ip link set veth_ns up# åˆ›å»ºè™šæ‹Ÿç½‘æ¡¥sudo brctl addbr flask_br # é…ç½®ç½‘æ¡¥ipsudo ip addr add 192.168.0.1/24 dev flask_br# é…ç½®vethçš„å¦ä¸€ç«¯åˆ°ç½‘æ¡¥ä¸Š#ç½‘æ¡¥flask_brå’Œç½‘ç»œnamespace flask_testç›¸è¿sudo ip link set dev veth_br master flask_br# ä¸¤ä¸ªéƒ½å¯åŠ¨sudo ip link set veth_br upsudo ip link set flask_br up# æŠŠ veth_nsè®¾ä¸ºé»˜è®¤ç½‘å…³# æ­¤æ—¶å†…ç½‘éƒ¨åˆ†ä¾¿å¯ä»¥pingé€šsudo ip netns exec flask_test route add default gw 192.168.0.1 veth_nssudo sysctl -w net.ipv4.conf.all.forwarding=1# æœ¬æœºè·¯ç”±è½¬å‘é…ç½®ï¼ˆFORWARDè§„åˆ™ï¼‰ï¼Œè®¾ç½®flask_brå¯ä»¥é€šè¿‡eth0ï¼ˆæœ¬åœ°é€šç½‘ç½‘å¡ï¼‰æ¥è¿›è¡Œä¸å¤–ç½‘çš„é€šä¿¡ã€‚sudo iptables -A FORWARD --out-interface eth0 --in-interface flask_br -j ACCEPTsudo iptables -A FORWARD --in-interface eth0 --out-interface flask_br -j ACCEPT# SNAT ä¸MASQUERADEä¸åŒï¼ŒMASQUERADEè‡ªåŠ¨ä»ç½‘å¡è·å–ipåœ°å€è¿›è¡Œè½¬æ¢ï¼ŒSNATéœ€è¦æŒ‡å®šipè¿›è¡Œè½¬æ¢# è¿›å…¥è·¯ç”±åˆ¤æ–­å‰çš„è§„åˆ™æ·»åŠ ï¼Œå°†æºipåœ°å€è½¬æ¢ä¸ºæœ¬æœºipåœ°å€ã€‚sudo iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -j MASQUERADE# DNATï¼ˆç›®æ ‡ç½‘ç»œåœ°å€è½¬æ¢ï¼‰ï¼Œç±»ä¼¼docker ç«¯å£ç»‘å®šï¼Œå°†å¤–ç½‘42062çš„è®¿é—®ç»‘å®šè‡³192.168.0.2ï¼š80ï¼ˆæœ¬åœ°æœåŠ¡ç«¯ï¼‰sudo iptables -t nat -A PREROUTING -p tcp --dport 42062 -j DNAT --to 192.168.0.2:80# ä¸€é”®å®‰è£…flaskç¯å¢ƒï¼ˆcentosï¼‰# ç”±äºæ‰§è¡Œéƒ¨åˆ†éœ€è¦rootæƒé™ï¼Œéœ€è¦å†åœ¨rootä¸‹å®‰è£…ä¾èµ–åŒ…ã€‚# è¿™éƒ¨åˆ†å’Œå…·ä½“çš„è‡ªå®šä¹‰ç½‘ç»œæ²¡ä»€ä¹ˆå…³ç³»ï¼Œä»¥æ³¨é‡Šæ–¹å¼å‘ˆç°# sudo pip3 install flask# sudo pip3 uninstall urllib3# sudo pip3 install urllib3==1.26.6# sudo pip3 install requests# åœ¨ç½‘ç»œ namespaceä¸‹è¿è¡Œnohup sudo ip netns exec flask_test python3 /.....?????/app.py --port 80 &gt; test.log 2&gt;&amp;1 &amp;</code></pre><p>è¿è¡Œæˆªå›¾ï¼š</p><p><img src="/images/CNSS/result.png" alt="docker network"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> CNSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CNSS </tag>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»¼åˆè¯¾ç¨‹è®¾è®¡ï¼šä»¤äººæ„Ÿå¹</title>
      <link href="/2023/04/27/zong-he-ke-cheng-she-ji-ling-ren-gan-tan/"/>
      <url>/2023/04/27/zong-he-ke-cheng-she-ji-ling-ren-gan-tan/</url>
      
        <content type="html"><![CDATA[<p>è¯¾è®¾è¿‡ç¨‹æ²¡æœ‰è®°å½•æ—¶é—´çº¿ï¼Œå› æ­¤è¯¥åšå®¢å°‘äº†ç‚¹æ¡ç†æ€§ã€‚<br>ç¬¬ä¸€æ¬¡å†™è¿™ç§ç¨å¾®å¤§ä¸€ç‚¹çš„é¡¹ç›®ï¼Œè¿‡ç¨‹è¿˜æ˜¯å€¼å¾—è®°å½•ä¸‹çš„ã€‚</p><h2 id="å¼€å§‹">å¼€å§‹</h2><p>ç»¼åˆè¯¾ç¨‹è®¾è®¡åˆšå¼€å§‹é€‰é¢˜çš„æ—¶å€™ï¼Œå®šä½åˆ°è´Ÿè´£æˆ‘ä»¬è¿™ä¸€å—çš„ç”³æ°è€å¸ˆé¡¹ç›®åˆ—è¡¨ï¼Œæ‰€æœ‰é¡¹ç›®å‡ ä¹éƒ½å’ŒCVï¼Œæœºå™¨å­¦ä¹ ç›¸å…³ï¼Œå”¯ç‹¬ä¸€ä¸ªæ–‡ä»¶åŠ å¯†ä¼ è¾“ååˆ†æ˜¾çœ¼ã€‚5éš¾åº¦ï¼Œåˆšå¥½ä¸Šå­¦æœŸä¸Šè¿‡å¯†ç å­¦ã€‚ä¸è§‰å¾—å¾ˆé…·å—ï¼Ÿå¾ˆç¬¦åˆæˆ‘å¯¹åˆ†æ•°çš„æƒ³è±¡ã€‚</p><p>äºæ˜¯æˆ‘è‡ªä¿¡æ»¡æ»¡çš„é€‰äº†ï¼ŒæŒç»­ä¸€ä¸ªæœˆçš„å™©æ¢¦ä¹Ÿå¼€å§‹äº†ã€‚</p><p>ç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯é€‰æ‹©åº“<s>æˆ‘æ€ä¹ˆä¼šå…ˆæƒ³ç€é€ è½®å­</s>ã€‚é¢˜ç›®è¦æ±‚<code>C++</code>ï¼Œé‚£å›¾å½¢åŒ–è½¯ä»¶å¾ˆå®¹æ˜“æƒ³åˆ°Qtï¼›è€Œå¯†ç åº“çš„é€‰æ‹©å€’æ˜¯ä¸€æ³¢ä¸‰æŠ˜ï¼ŒåŸæœ¬æƒ³ç”¨æˆç†Ÿçš„OpenSSLçš„ï¼Œä½†å­¦ä¹ æˆæœ¬æå¤§ï¼Œäºæ˜¯ç¿»çŸ¥ä¹ç¿»åˆ°ç°åœ¨ç”¨çš„<code>CryptoPP</code>åº“ï¼Œæœ‰wikiæœ‰ç¤ºä¾‹ä»£ç ï¼Œæƒ³è¦çš„åŠ å¯†ç®—æ³•ä¸€åº”ä¿±å…¨ï¼Œè¿˜æ˜¯<code>C++</code>åŸç”Ÿçš„ï¼Œå¤ªå¥½äº†ï¼Œå°±å®ƒäº†ï¼</p><p>ç„¶è€Œä¹‹åå¤§éƒ¨åˆ†çš„bugï¼ˆæˆ–è€…è¯´ï¼Œå…¨éƒ¨æ¼äººçš„bugï¼‰éƒ½æ¥æºè¿™ä¸ªåŠ å¯†åº“ã€‚è¿™éƒ¨åˆ†æš‚ä¸”ä¸æã€‚</p><p><code>CryptoPP</code>åº“æ²¡æœ‰ç°æˆçš„libï¼Œæ¢å¥è¯è¯´éœ€è¦è‡ªå·±ç¼–è¯‘ã€‚æ‰“å¼€å®ƒçš„githubä¸‹è½½æºç ï¼Œå‘ç°è¿™ç©æ„ä½¿ç”¨VSç¼–è¯‘çš„ï¼ˆ<s>ä¸ç”¨CMAKE?</s>ï¼‰,æºç é‡Œç”šè‡³æœ‰ä¸“é—¨æä¾›ç»™VS2005çš„ç”¨æˆ·çš„<code>sln</code>æ–‡ä»¶.</p><p>å¥½ï¼Œé‚£æˆ‘å°±ç”¨VS2022ç»™ä½ ç¼–è¯‘äº†ï¼Œç„¶åå–œé—»ä¹è§çš„æŠ¥é”™äº†ã€‚ç¿»ç½‘ä¸Šèµ„æ–™å‘ç°è¦ç”¨VS2017ï¼Œé‚£å°±è£…ï¼(ç”µè„‘è¢«VSç‹‚æš´é¸¿å„’å››äº”æ¬¡æ‰è£…å¥½ï¼Œ<code>C++</code>ä¸‹çš„SDKç¡®å®éš¾ç»·)</p><p>ç¼–è¯‘å¥½äº†ï¼ˆå·²ç»è¿‡å»ä¸‰å››å¤©äº†ï¼‰ï¼Œé…ç¯å¢ƒéƒ¨åˆ†æœ€æ¼ç«çš„æ¥äº†ï¼šæˆ‘è¯¥æ€ä¹ˆè®©<code>Qt</code>å’Œ<code>CryptoPP</code>é€‚é…å‘¢ï¼Ÿ<br>è£…äº†Qtä¸ƒå…«å›ï¼ŒQtè€ç‰ˆæœ¬çš„VSåªæ”¯æŒVS2015å¥—ä»¶ï¼Œè€Œæ–°ç‰ˆæœ¬çš„VS2017å¥—ä»¶ä¸çŸ¥é“æ€ä¹ˆå›äº‹æ£€æµ‹ä¸åˆ°æœ¬åœ°çš„VS2017 SDKã€‚æŠ˜è…¾äº†ä¸‰å››å¤©æ‰æŒ‘å‡ºæ¥ç¬¦åˆçš„Qtç‰ˆæœ¬ï¼Œä¹‹ååˆèŠ±äº†ä¸€å¤©åœ¨Qtçš„é¡¹ç›®é…ç½®æ–‡ä»¶<code>.pro</code>è¾¹æŸ¥è¾¹å†™,ç»ˆäºæå¥½äº†VS2017 ç¼–è¯‘çš„<code>CryptoPP</code>åœ¨windowsä¸‹å¦‚ä½•å’ŒVS2017 SDKå¥—ä»¶çš„Qtä»¥åŠqmakeé€‚é…ã€‚</p><p><s>è¿™å°±æ˜¯è£…ç¯å¢ƒï¼Œå¬devopsè¯´</s></p><h2 id="ç½‘ç»œé€šä¿¡éƒ¨åˆ†ï¼ˆQTï¼‰">ç½‘ç»œé€šä¿¡éƒ¨åˆ†ï¼ˆQTï¼‰</h2><p>è¿™éƒ¨åˆ†å…¶å®æ²¡å•¥å¥½è¯´ï¼Œå„ç§æŠ„ï¼ŒæŠ„ç€æŠ„ç€å°±æŠŠè‡ªå·±è½¯ä»¶çš„æ¡†æ¶æ­å¥½äº†ï¼Œç„¶ååœ¨è¿™åŸºç¡€ä¸Šæ”¹äº†ã€‚<br>åé¢ç¿»äº†ä¸‹ï¼Œæˆ‘åœ¨åŸæ¥çš„ä»£ç ä¸Šæ”¹äº†æŒºå¤šçš„ï¼Œçœ‹ä¸Šå»ç¡®å®å’ŒåŸæ¥ä»£ç å·®åˆ«å¾ˆå¤§ã€‚socketä»ä¸¤ä¸ªåˆ°ä¸‰ä¸ªåˆåˆ°ä¸¤ä¸ªï¼Œè¿˜ç¨å¾®å­¦äº†ä¸‹TCPçš„ç²˜æ»ï¼Œä»¥åŠQtç¥å¥‡çš„ä¿¡å·å’Œæ§½æœºåˆ¶ã€‚</p><p>è‹¥æŠŠTCPä½œä¸ºä¸€ç§æŠ½è±¡æµï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯æ— æ³•åˆ†è¾¨å…¶ä¸­æ•°æ®æ„ä¹‰çš„ã€‚è‹¥è¦åˆ†è¾¨ï¼Œå¿…é¡»äº‹å…ˆçŸ¥é“æ–‡ä»¶/æ¶ˆæ¯çš„é•¿åº¦ï¼Œç„¶åå†æ ¹æ®é•¿åº¦è¿›è¡Œæˆªæ–­ã€‚<br>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæš´éœ²å¯†æ–‡çš„é•¿åº¦å¹¶ä¸ä¼šå½±å“å®‰å…¨æ€§ï¼Œå› æ­¤å¯ä»¥å°†å¯†æ–‡çš„é•¿åº¦ç›´æ¥æš´éœ²åœ¨ä¸å®‰å…¨ä¿¡é“ä¸‹ã€‚</p><p>Qtçš„ä¿¡å·ä¸æ§½æ˜¯å¯ä»¥åå¤ç»‘å®šçš„ã€‚åå¤ç»‘å®šå¯¹äºæŸäº›æƒ…å†µæ˜¯ä¸è¦ç´§çš„ï¼Œä½†å¦‚æœä½ éœ€è¦ä¿¡å·çš„å‚æ•°ï¼Œè¿™å°±æœ‰å¤§é—®é¢˜ã€‚æˆ‘åœ¨ä¸€ä¸ªå‡½æ•°é‡Œå†™äº†connectè¿›è¡Œä¿¡å·å’Œæ§½çš„ç»‘å®šï¼Œè€Œè¯¥å‡½æ•°å¤šæ¬¡è°ƒç”¨å¯¼è‡´ä¸€ä¸ªä¿¡å·å’Œå¤šä¸ªæ§½ï¼ˆä½†å…¶å®æ˜¯ä¸€ä¸ªï¼‰è¿›è¡Œäº†ç»‘å®šã€‚äºæ˜¯æ§½å‡½æ•°ä¾¿æ”¶åˆ°äº†å¤šä¸ªä¿¡å·ï¼Œè€Œè¿™äº›ä¿¡å·éƒ½æ˜¯æ¥æºäºåŒä¸€ä¸ªåŠ¨ä½œå‡½æ•°çš„ã€‚</p><h2 id="å¯†ç å­¦éƒ¨åˆ†ï¼ˆCryptoPPï¼‰">å¯†ç å­¦éƒ¨åˆ†ï¼ˆCryptoPPï¼‰</h2><p>å…·ä½“ç»†èŠ‚æ”¾æŠ¥å‘Šé‡Œäº†ä¸æƒ³å†™ï¼Œè¿™é‡ŒæŒ‘å‡ ä¸ª<code>CryptoPP</code>çš„ç¥å¥‡bugç½¢ã€‚</p><h3 id="ä¸­æ–‡">ä¸­æ–‡</h3><p>è¿™ä¸ªå…¶å®è¿˜å¥½ï¼Œ<code>CryptoPP</code>ä¸æ”¯æŒä¸­æ–‡è·¯å¾„å’Œä¸­æ–‡åçš„æ–‡ä»¶åŠ å¯†ã€‚ä½†è¿˜æ˜¯å¯ä»¥åæ§½ï¼šä¸æ˜¯åªå¯¹æ–‡ä»¶å†…éƒ¨æ•°æ®è¿›è¡ŒåŠ å¯†ç­¾åå—ï¼Ÿåå­—æŒ‰äºŒè¿›åˆ¶å­˜å–ä¸è¡Œå—ï¼Ÿ</p><h3 id="RNG">RNG</h3><p>ä¸æ˜¯ç”µç«é‚£ä¸ª<code>RNG</code>ï¼Œhzæ‰“æ¥æˆ‘å°±æŠ•é™ã€‚</p><p><code>RNG</code>ï¼ˆRandom number generatorï¼‰ï¼Œåœ¨å¯†ç å­¦ä¸­æ˜¯ååˆ†é‡è¦çš„ä¸€ä¸ªåŸè¯­ï¼Œç”¨äºç”Ÿæˆä¼ªéšæœºæ•°ï¼Œç„¶è€Œ<code>CryptoPP</code>çš„<code>RNG</code>è¡Œä¸ºååˆ†ç‰¹å¼‚ï¼š<code>RNG</code>å®šä¹‰åå¿…é¡»ç«‹å³ä½¿ç”¨ï¼Œä¸èƒ½æ”¾åœ¨å…¶ä»–åœ°æ–¹ï¼ˆæ¯”å¦‚æˆ‘åŸå…ˆæ”¾åœ¨ä¸€ä¸ªç»Ÿä¸€ç®¡ç†çš„<code>CryptoManager</code> classé‡Œå¤´ï¼‰å¤‡ç”¨ã€‚å¦åˆ™<code>CryptoPP</code>è‡ªå·±æ¨èçš„â€œå¯¹åŠ è½½çš„å¯†é’¥å¿…é¡»è¿›è¡ŒéªŒè¯ï¼ˆValinateï¼Œè¯¥æ“ä½œæ¥å—ä¸€ä¸ª<code>RNG</code>å’Œä¸€ä¸ªéªŒè¯çº§åˆ«ä½œä¸ºå‚æ•°ï¼‰â€ä¾¿ä¼š<code>Runtime-error</code>.</p><h3 id="DSA">DSA</h3><p>DSAæ˜¯ååˆ†ç»å…¸çš„æ•°å­—ç­¾åæ–¹æ¡ˆï¼Œæœ¬æ¥æƒ³åœ¨è¯¾è®¾é‡Œå®ç°ä¸€ä¸‹çš„ã€‚ä½†<code>CryptoPP</code>åº“çš„DSAå†…éƒ¨å‡ºç°äº†é—®é¢˜ï¼šæˆ‘åœ¨åŒä¸€ä»½ä»£ç é‡Œå¯¹æ–‡ä»¶ç”Ÿæˆç­¾åï¼Œä¹‹åç«‹åˆ»éªŒè¯ï¼Œç›´æ¥REã€‚åé¢~~ç»è¿‡è¾“å‡ºdebugï¼ˆACMä¹ æƒ¯äº†å±äºæ˜¯ï¼‰~~å®šä½åˆ°<code>CryptoPP</code>åº“å†…éƒ¨å‡ºç°é—®é¢˜ï¼Œæ²¡å•¥åŠæ³•ï¼Œåˆ äº†ç½¢ã€‚</p><h3 id="RSA">RSA</h3><p>RSAä½œä¸ºå…¬é’¥åŠ å¯†æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒæ•°å­—ç­¾åã€‚ä½†è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œ<code>CryptoPP</code>åº“åˆå‡ºç°äº†å’ŒDSAä¸€æ ·çš„é”™è¯¯ã€‚åˆ°è¿™é‡Œæˆ‘è¿˜æ˜¯æ²¡å‘ç°ä¸ºä»€ä¹ˆæ•°å­—ç­¾åä¼šäº§ç”Ÿé”™è¯¯ï¼Œåé¢é€‰æ‹©ED25519ä½œä¸ºæ•°å­—ç­¾åæ–¹æ¡ˆçš„æ—¶å€™æ‰å¶ç„¶å‘ç°ï¼Œåˆæ˜¯ä½ ï¼Œ<code>RNG</code>ï¼</p><p><code>CryptoPP</code>åº“çš„<code>RNG</code>æ”¯æŒæå…¶ä¸å®Œå–„ï¼Œè€Œç¤ºä¾‹ä»£ç ä¸­ï¼Œæ•°å­—ç­¾ååŸºæœ¬éƒ½éœ€è¦ä½¿ç”¨<code>RNG</code>ä½œä¸ºå‚æ•°æ¥è¿›è¡ŒéªŒè¯ã€‚è€ŒWIKIä¸­çš„ED25519ç¤ºä¾‹ä»£ç ååˆ†ç‰¹æ®Šçš„æŠŠå¯¹åº”çš„<code>RNG</code>æ¢æˆäº†<code>NullRNG</code>,è¿™ååˆ†å½¢è±¡çš„åå­—ï¼Œä½¿å¾—ED25519èƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œç­¾åã€‚äºæ˜¯ED25519æˆä¸ºäº†è¯¾è®¾é‡Œå”¯ä¸€çš„æ•°å­—ç­¾åæ–¹æ¡ˆã€‚</p><p>çœ‹åˆ°è¿™é‡Œçš„ä½ å…¶å®ä¹Ÿæ˜ç™½äº†ï¼Œç†è®ºä¸ŠDSAï¼ŒRSAè¿™ä¸¤ä¸ªå¼ƒç”¨çš„æ•°å­—ç­¾åæ”¹æ”¹<code>RNG</code>å°±èƒ½æ¢å¤ä½¿ç”¨ï¼Œä½†æˆ‘æ‡’äº†ï¼Œä¸æ”¹äº†ğŸ˜‡</p><h3 id="ED25519">ED25519</h3><p>ED25519æ˜¯æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åæ–¹æ¡ˆï¼Œå…¶å…¬é’¥å¯†é’¥é•¿åº¦ä¸º64/32 bytesï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­å¯ä»¥è‡ªç”±é€‰æ‹©è¿™ä¸¤ä¸ªã€‚</p><p>ä½†<code>CryptoPP</code>ä¸ä¼—ä¸åŒï¼šå¤´æ–‡ä»¶å†™æ˜defaultæƒ…å†µä¸‹ï¼ŒED25519åº”è¯¥ç”Ÿæˆ32bytesçš„å¯†é’¥ï¼Œä½†å®ƒå®é™…ä¸Šç”Ÿæˆäº†56bytesçš„å¯†é’¥ï¼Œå‰é¢å¤šå‡ºæ¥çš„24bytesæ˜¯ä¸å˜å€¼ã€‚</p><p>è‹¥æŒ‰ç…§ç¤ºä¾‹ä»£ç æ‰€å†™è¿›è¡Œç¼–ç¨‹ï¼Œé‚£ä¹ˆå¯†é’¥ä¸­å°†ä¼šåŒ…å«24bytesçš„ç¡®å®šå€¼ï¼Œä»¥åŠ8bytesçš„éšæœºå€¼ï¼Œè€Œè¿™æ˜¾ç„¶ä¼šå½±å“åˆ°ED25519çš„å®‰å…¨æ€§ã€‚<br>è€Œè¢«DSA,RSAï¼Œä»¥åŠæ¥ä¸‹æ¥çš„GCMæ‘§æ®‹è®¸ä¹…çš„æˆ‘æ”¾å¼ƒäº†ä¿®æ”¹ï¼ˆè™½ç„¶ä¿®æ”¹ç¡®å®ä¼šæ¯”è¾ƒå®¹æ˜“ï¼‰ï¼Œå¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹ï¼Œä½•å†µè¿™ED25519èƒ½è·‘ã€‚èƒ½è·‘å°±è¡Œï¼Œä¸å¥¢æœ›å¤ªå¤šäº†ã€‚</p><p><s>åæ­£è€å¸ˆä¹Ÿçœ‹ä¸æ‡‚</s></p><h3 id="GCM">GCM</h3><p>GCMæ˜¯åœ¨å¯¹ç§°å¯†é’¥åŠ å¯†é‡Œå¤´çš„æ“ä½œæ¨¡å¼ï¼Œå®ƒæä¾›äº†AEå®‰å…¨æ€§ï¼Œå› æ­¤æ»¡è¶³äº†CCAå®‰å…¨ã€‚ã€‚ã€‚ã€‚<br>ä»¥ä¸Šéƒ¨åˆ†æ¢æˆäººèƒ½å¬æ‡‚çš„ï¼Œå°±æ˜¯:GCMèƒ½å¤Ÿæä¾›æ¯”é‡‡å–æ™®é€šæ“ä½œæ¨¡å¼æ›´å¼ºçš„å®‰å…¨æ€§ï¼Œè€Œè¿™éƒ¨åˆ†å®‰å…¨æ€§çš„æ¥æºï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ¥æºäºå®ƒç‹¬ç«‹ç”Ÿæˆçš„GMAC è®¤è¯æ ‡ç­¾ï¼Œè¿™æ˜¯å…¶ä»–æ“ä½œæ¨¡å¼æ‰€æ²¡æœ‰çš„ã€‚</p><p>è¿™ä¹ˆå¥½çš„å®‰å…¨æ€§è‡ªç„¶è¦æ‹¿æ¥ç”¨äº†ã€‚ç…§ç€wikiä»£ç æ•²ä¸€éï¼ŒREâ€¦REï¼Ÿ</p><p>ç¿»äº†StackOverflowï¼Œå‘ç°ç¤ºä¾‹ä»£ç æ˜¯é”™çš„ï¼Œä»£ç æŠŠTagé•¿åº¦å’ŒIVé•¿åº¦æåäº†ã€‚å‘ƒå‘ƒğŸ’§ã€‚<br>æœ€ç¦»è°±çš„æ˜¯ï¼š<code>CryptoPP</code> wikiä¸“é—¨å†™äº†ï¼šåˆå§‹çš„IVå‘é‡å¯ä»¥æ˜¯ä»»æ„é•¿åº¦ï¼›ä½†å®é™…è¿‡ç¨‹ä¸­ï¼ŒIVå¿…é¡»ä¸º12å­—èŠ‚ã€‚</p><hr><p>å¦å¤–è¿˜æœ‰è¯¸å¦‚æŒ‡é’ˆæ²¡æœ‰newå˜é‡å¯¼è‡´ç¨‹åºå‡ºç°å¥‡æ€ªbugï¼Œè¢«yaossg(orz)æŒ‡å‡ºåå¿ƒæ€ç‚¸è£‚ç­‰ntè¡Œä¸ºï¼Œæš‚ä¸”ä¸è¡¨ã€‚</p><h2 id="summary">summary</h2><p><code>CryptoPP</code>åº“æå…¶éš¾ç”¨ï¼Œäºæ˜¯åªèƒ½æŒ‘å‡ ä¸ªæ¯›ç—…æœ€å°‘çš„ä½¿ç”¨ã€‚ä½†æœ€æœ¬è´¨çš„é—®é¢˜å¹¶ä¸åœ¨æ­¤ï¼Œè€Œæ˜¯ï¼šä¸ºä»€ä¹ˆè¦ç”¨<code>C++</code>å¼€å‘ï¼Ÿ</p><p><code>C++</code>æ²¡æœ‰å†…ç½®çš„å¯†ç åº“ï¼Œæ‰€ä»¥æˆ‘åªèƒ½æŒ‘ä¸é è°±çš„ç¬¬ä¸‰æ–¹åº“ä½œä¸ºä»£æ›¿ï¼Œè€Œå…¶ä»–è¯­è¨€ï¼Œæ¯”å¦‚JS,C#,JAVA,è¿™äº›éƒ½æœ‰ååˆ†æˆç†Ÿä¸”ç°æˆçš„å¯†ç åº“ï¼Œå¹¶ä¸”å›¾å½¢åŒ–è½¯ä»¶ç¼–å†™æ›´æ¯”<code>C++</code>å®¹æ˜“çš„å¤šã€‚è€Œç”³è¯·æ”¹æ¢è¯­è¨€åªè¦å’Œè€å¸ˆè¯´ä¸€å¥å°±è¡Œäº†ã€‚</p><p>å½“æˆ‘å‘ç°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘å·²ç»æŠŠä»£ç å†™å®Œäº†ã€‚</p><p>ä¹Ÿè®¸ç»¼è®¾æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸ªç¬‘è¯ã€‚å“ˆå“ˆã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> éšæƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> éšæƒ³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…«-Digital-Signature</title>
      <link href="/2023/03/03/modern-cryptoxii-digital-signature/"/>
      <url>/2023/03/03/modern-cryptoxii-digital-signature/</url>
      
        <content type="html"><![CDATA[<p>å…¬é’¥è¯­å¢ƒä¸‹çš„è®¤è¯å¯ä»¥è®¤ä¸ºæ˜¯åŠ å¯†æ–¹æ¡ˆçš„â€œé€†æ“ä½œâ€ã€‚åœ¨å…¬é’¥åŠ å¯†æ–¹æ¡ˆä¸­ï¼Œå‘é€è€…å¯ä»¥å¯¹æ¶ˆæ¯ç”¨å…¬é’¥åŠ å¯†ï¼Œæ¥æ”¶è€…ç”¨å”¯ä¸€ä¸€æŠŠç§é’¥è¿›è¡Œè§£å¯†ï¼Œä»è€Œä¿è¯æ¶ˆæ¯çš„Secrecyã€‚è€Œè®¤è¯æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯æ¥ä¸‹æ¥è¦ä»‹ç»çš„æ•°å­—ç­¾åä¸­ï¼Œå‘é€è€…ç”¨ç§é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶è€…ç”¨å…¬é’¥è§£å¯†ï¼Œè¿™æ ·ä¾¿å¯ä»¥éªŒè¯å‘é€è€…çš„èº«ä»½ã€‚</p><p>å®é™…ä¸Šï¼Œæ•°å­—ç­¾åï¼ˆå…¬é’¥è¯­å¢ƒä¸‹çš„MACï¼‰éœ€è¦ä¿è¯ä»¥ä¸‹æ€§è´¨ï¼š</p><ol><li>Integrity protectionï¼šä»»ä½•å¯¹ä¸€ä¸ªè¢«ç­¾åçš„æ¶ˆæ¯çš„ä¿®æ”¹éƒ½ä¼šè¢«å‘ç°ã€‚</li><li>Source authenticity å‘é€è¯¥æ¶ˆæ¯çš„äººèº«ä»½å¾—ä»¥éªŒè¯ã€‚</li><li>Non-repudiation å‘é€è€…æ— æ³•æŠµèµ–ä»–å‘é€äº†è¿™æ¡ä¿¡æ¯ã€‚</li></ol><h2 id="Definition">Definition</h2><p>ä¸€ä¸ªæ•°å­—ç­¾åæ–¹æ¡ˆå¯çœ‹ä½œPPT ä¸‰å…ƒç»„$(Gen,Sig,Vrfy)$</p><p>$Gen(1^n)\rightarrow (pk,sk)$<br>$Sig_{sk}(m)\rightarrow$ ç­¾å $\sigma$ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„mä¹Ÿå’Œå…¬é’¥åŠ å¯†æ–¹æ¡ˆä¸€æ ·è¢«å¯†é’¥åˆ¶å®šæ¶ˆæ¯ç©ºé—´ã€‚<br>$Vrfy_{pk}(m,\sigma)\rightarrow b$</p><p>ç‰¹åˆ«çš„ï¼Œæ•°å­—ç­¾åå…è®¸ä»¥ä¸‹Vrfyè¿‡ç¨‹çš„å¯å¿½ç•¥æ¦‚ç‡çš„å¤±è´¥ï¼š</p><p>$Vrfy_{pk}(m,Sig_{sk}(m))=1$</p><p>$Vrfy$æ˜¯ç¡®å®šæ€§çš„ï¼Œå…¶å¯ä»¥å…·æœ‰â€œå¯å¿½ç•¥æ¦‚ç‡çš„å¤±è´¥â€æ€§è´¨ï¼Œä¹Ÿå¯ä»¥è§£å¯†å®Œå…¨æˆåŠŸã€‚<br>è€Œ$Sig$å¯ç¡®å®šå¯æ¦‚ç‡æ€§ï¼Œä¹Ÿå¯ä»¥æ— çŠ¶æ€æˆ–è€…æœ‰çŠ¶æ€ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œæ— çŠ¶æ€ä¸ºå®è·µåšæ³•ã€‚</p><p>ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ„é€ äº†ä¸€ä¸ªæœ‰é™é•¿åº¦çš„æ•°å­—ç­¾åæ–¹æ¡ˆï¼Œåç»­ä¼šä»‹ç»ä»»æ„é•¿åº¦çš„æ–¹æ¡ˆã€‚</p><h2 id="Formal-security-notions">Formal security notions</h2><p>æ•°å­—ç­¾åéœ€è¦æ–°çš„å¨èƒæ¨¡å‹å’Œå®‰å…¨ç›®æ ‡ã€‚</p><h3 id="Attack-model">Attack model</h3><ol><li><strong>No-message attack (NMA)</strong>: æ”»å‡»è€…åªèƒ½è·å–å¯†é’¥ä¿¡æ¯ã€‚</li><li><strong>Random message attack (RMA)</strong>: æ”»å‡»è€…åªèƒ½çœ‹åˆ°éšæœºçš„ä¿¡æ¯æµï¼Œå…¶ä¸­åŒ…å«æ•°å­—ç­¾åã€‚å³ç±»ä¼¼äºEAVçš„è¢«åŠ¨æ”»å‡»ã€‚</li><li><strong>Non-adaptive chosen message attack (naCMA)</strong>: æ”»å‡»è€…å¯ä»¥ä¸»åŠ¨æ„é€ ä¸€ç³»åˆ—ä¿¡æ¯ï¼Œå¹¶è·å¾—ç­¾åï¼ˆæ„é€ çš„è¿‡ç¨‹éœ€åœ¨è·å¾—å¯†é’¥ä¹‹å‰ï¼‰ã€‚</li><li>æ”»å‡»è€…å¯ä»¥ä»»æ„é€‰æ‹©ä¿¡æ¯ï¼Œå¹¶è·å¾—ç­¾åï¼ˆæ— éœ€è€ƒè™‘é¡ºåºï¼‰</li></ol><h3 id="Goal-of-an-adversary">Goal of an adversary</h3><p>æ”»å‡»è€…çš„ç›®æ ‡åè¿‡æ¥å°±æ˜¯å®‰å…¨ç›®æ ‡ï¼ˆé€ƒ</p><ol><li><strong>Universal forgery(UF)</strong>: æ”»å‡»è€…éœ€è¦å¯¹ä»»æ„æ¶ˆæ¯è¾“å‡ºä¸€ä¸ªåˆæ³•çš„signatureã€‚</li><li><strong>Existential forgery (EF)</strong>: æ”»å‡»è€…å¯å¯¹è‡ªå·±é€‰å®šçš„æ¶ˆæ¯è¾“å‡ºåˆæ³•signatureã€‚</li></ol><hr><p>å› æ­¤ï¼Œæˆ‘ä»¬å°½é‡é€‰æ‹©æœ€å¼ºçš„æ•Œæ‰‹èƒ½åŠ›ï¼Œåœ¨æ­¤ä¹‹ä¸‹æ¥ä¿è¯å…¶ä¸èƒ½æ»¡è¶³æœ€å¼±çš„ç›®æ ‡ï¼Œä½œä¸ºæˆ‘ä»¬çš„å®‰å…¨ç›®æ ‡ã€‚</p><p>äºæ˜¯æœ‰EUF-CMAï¼š existential unforgeability under chosen message attacks.</p><h3 id="EUF-CMA-Security">EUF-CMA Security</h3><p>ç•¥ã€‚å®šä¹‰æ–¹å¼å’ŒMACçš„å­˜åœ¨ä¸å¯ä¸ºé€ æ€§æå…¶ç›¸ä¼¼ï¼Œä¸æƒ³å†™äº†å±äºæ˜¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsignatureåˆ†ä¸ºone-timeï¼ˆä¸€æ¬¡æ€§ï¼‰å’Œmany-time signaturesï¼Œå¹¶ä¸”è¿˜æœ‰weak signatureå’Œstrongï¼ˆå¯¹äºæŸ¥è¯¢è¿‡çš„$m$ï¼Œç”Ÿæˆä¸ä¸€æ ·ä½†æœ‰æ•ˆçš„$\sigma$ï¼‰signatureçš„åŒºåˆ«ã€‚</p><h2 id="RSA-signatures">RSA signatures</h2><h3 id="â€œTextbookâ€-RSA">â€œTextbookâ€ RSA</h3><p>è¿™é‡Œçš„æ–¹æ¡ˆå’Œè¯¾æœ¬ä¸Šçš„RSAåŠ å¯†è¿‡ç¨‹æå…¶ç›¸ä¼¼ï¼Œä¸è¿‡æ˜¯å…¬é’¥å’Œç§é’¥ä½œç”¨çš„ä½ç½®äº’æ¢ã€‚</p><p>ç„¶è€Œï¼ŒRSAåªèƒ½ä¿è¯ä¸€æ¬¡æ€§çš„å®‰å…¨æ€§ï¼Œäºæ˜¯æœ‰ä¸€ä¸‹æ”»å‡»ï¼š</p><p><strong>NMA</strong>: $(mâ€™,\sigmaâ€™)=(1,1)$ï¼Œåˆ™å¿…æœ‰$1^d=1\pmod N$<br><strong>EUF-CMA</strong>: ä»»æ„$(m_1,\sigma_1),(m_2,\sigma_2)$ï¼Œéƒ½èƒ½æ„é€ æ–°çš„ä¸€å¯¹ï¼š$(mâ€™,\sigmaâ€™)=(m_1\cdot m_2\pmod N,\sigma_1\cdot\sigma_2\pmod N)$,å…¶ä¸ºåˆæ³•æ•°å­—ç­¾åã€‚</p><h3 id="Hash-and-Sign">Hash-and-Sign</h3><p>ç†è®ºä¸Šè€Œè¨€ï¼Œä½¿ç”¨å®šé•¿çš„æ•°å­—ç­¾åæ–¹æ¡ˆï¼Œé‡å¤å¤šæ¬¡ä¹Ÿèƒ½å¤Ÿèµ·åˆ°åŠ å¯†ä»»æ„é•¿ä¿¡æ¯çš„æ•ˆæœã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸èƒ½æ»¡è¶³å¯¹é«˜æ•ˆç‡çš„éœ€æ±‚ã€‚</p><p>å¾ˆè‡ªç„¶çš„ä¾¿æœ‰äº†ä½¿ç”¨Hashå†ç­¾åçš„æ–¹æ¡ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯å“ˆå¸Œå‡½æ•°$H$çš„å€¼åŸŸä¹Ÿéœ€è¦æ»¡è¶³æ•°å­—ç­¾åçš„æ¶ˆæ¯ç©ºé—´è¦æ±‚ã€‚</p><p>äºæ˜¯æœ‰ä»¥ä¸‹æ„é€ ï¼š$\Sigma=(Gen,Sig,Vrfy)$ä½œä¸ºé•¿åº¦$k(n)$çš„å®šé•¿æ•°å­—ç­¾åæ–¹æ¡ˆï¼Œè®¾$\Gamma=(Gen_H,H)$ä½œä¸ºè¾“å‡ºé•¿åº¦$k(n)$çš„å“ˆå¸Œæ–¹æ¡ˆï¼Œåˆ™æ„é€ ä»»æ„é•¿åº¦æ•°å­—ç­¾åæ–¹æ¡ˆ$\Sigmaâ€™=(Genâ€™,Sigâ€™,Vrfyâ€™)$</p><p>$Genâ€™: Gen(1^n)\rightarrow (pk,sk)ï¼ŒGen_H(1^n)\rightarrow s$ï¼Œå…¬é’¥ä¸º$(pk,s)$,ç§é’¥ä¸º$(sk,s)$.<br>$Sigâ€™: Sig_{sk}(H(s,m))\rightarrow$ ç­¾å $\sigma$ã€‚<br>$Vrfyâ€™: Vrfy_{pk}(H(s,m),\sigma)\rightarrow b$</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ·»åŠ äº†å“ˆå¸Œå‡½æ•°çš„å¯†é’¥sã€‚</p><div class="admonition warning"><p class="admonition-title">Arbitrary long signature scheme</p><p>è‹¥$\Sigma$ä¸ºå®‰å…¨å®šé•¿æ•°å­—ç­¾åï¼Œ$\Gamma$ä¸ºæŠ—ç¢°æ’ï¼Œåˆ™$\Sigma'$ä¸ºä»»æ„é•¿åº¦çš„å®‰å…¨æ•°å­—ç­¾åã€‚</p></div><h2 id="Some-construct-scheme">Some construct scheme</h2><h3 id="RSA-FDH">RSA FDH</h3><p>è‹¥å°†æ™®é€šRSAç‰ˆæœ¬æ”¹ä¸ºä¸Šæ–¹çš„Hash-and-Signæ–¹å¼ï¼Œåˆ™æ»¡è¶³EUF-CMAæ€§è´¨ï¼Œå…¶è¯æ˜ç”¨åˆ°äº†éšæœºé¢„è¨€æœºã€‚</p><h3 id="Scheme-based-on-DL-problem">Scheme based on DL problem</h3><p>æ¥ä¸‹æ¥ä»‹ç»çš„ä¸¤æ–¹æ¡ˆæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ— äº¤äº’çš„é›¶çŸ¥è¯†è¯æ˜ä¸‹ä½¿ç”¨DL problemçš„æ–¹æ¡ˆã€‚</p><h3 id="Schnorr">Schnorr</h3><p>$Genï¼š\mathcal{G}(1^n)\rightarrow(G,q,g)$ï¼Œå‡åŒ€é€‰æ‹©$x\leftarrow \mathbb{Z}_q,y=g^x$ï¼Œåˆ™å…¬é’¥ä¸º$(G,q,g,y)$,ç§é’¥ä¸º$x$ã€‚åŒæ—¶ï¼Œé€‰æ‹©$H:\{0,1\}â€˜\rightarrow \mathbb{Z}_q$<br>$Sign:m\in \{0,1\}â€™$ï¼Œå‡åŒ€é€‰æ‹©$k\leftarrow \mathbb{Z}_q,I=g^k$ï¼Œè®¡ç®— $r=H(I,m),s=rx+k\pmod q $,æœ€åè¾“å‡º$\sigma=(r,s)$.<br>$Vrfy:$ è®¡ç®— $I=g^s\cdot y^{-r}$ï¼ŒéªŒè¯$r$æ˜¯å¦ç­‰äº$H(I,m)$</p><p>Correctness:$g^s\cdot y^{-r}=g^{rx+k}\cdot g^{-xr}=g^r=I$</p><div class="admonition warning"><p class="admonition-title">Schnorr</p><p>è‹¥Hä¸ºéšæœºé¢„è¨€æœºï¼Œåˆ™è¯¥é—®é¢˜åŸºäºDL problemä¸‹æ»¡è¶³EUF-CMA secureã€‚</p></div><h3 id="DSA-ECDSA">DSA/ECDSA</h3><p>è¿™é‡Œåªä»‹ç»DSAï¼ˆå› ä¸ºä¸ä¼šæ¤­åœ†æ›²çº¿<s>æœ€é‡è¦çš„åŸå› æ˜¯PPTæ²¡æœ‰</s>ï¼‰</p><p>$Genï¼š\mathcal{G}(1^n)\rightarrow(G,q,g)$ï¼Œå‡åŒ€é€‰æ‹©$x\leftarrow \mathbb{Z}_q,y=g^x$ï¼Œåˆ™å…¬é’¥ä¸º$(G,q,g,y)$,ç§é’¥ä¸º$x$ã€‚åŒæ—¶ï¼Œé€‰æ‹©$H:\{0,1\}â€˜\rightarrow \mathbb{Z}_q$å’Œå‡½æ•°$F:G\rightarrow \mathbb{Z}_q$<br>$Sign:m\in \{0,1\}â€™$ï¼Œå‡åŒ€é€‰æ‹©$k\leftarrow \mathbb{Z}_q,r=F(g^k)$ï¼Œåˆ™è®¡ç®—$s=k^{-1}(H(m)+rx)\pmod q $ã€‚è‹¥ $r,k,s$ä»»æ„ä¸€ä¸ªä¸º0ï¼Œåˆ™é‡æ–°å¼€å§‹ï¼Œé€‰æ‹©å…¨æ–°çš„kã€‚æœ€åè¾“å‡º$\sigma=(r,s)$ã€‚<br>$Vrfy:$ è®¡ç®— $u=s^{-1} \pmod q$ï¼ŒéªŒè¯$r$æ˜¯å¦ç­‰äº$F(g^{H(m)u}y^{ru})$</p><p>Correctnessç±»ä¼¼ä¸Šæ–¹ï¼ŒåŒ–ç®€ä¸‹å°±å‡ºæ¥äº†ã€‚</p><p>DSAå·¥ä½œåœ¨ç´ æ•° $q$ é˜¶ç¾¤ï¼Œå¹¶ä¸”$F(I)=I \pmod q$,ECDSAç±»ä¼¼ã€‚</p><div class="admonition warning"><p class="admonition-title">DSA/ECDSA</p><p>è‹¥$H,F$ä¸ºéšæœºé¢„è¨€æœºï¼Œé‚£ä¹ˆè¯¥æ–¹æ¡ˆçš„EUF-CMA åŸºäºDLé—®é¢˜ã€‚</p></div><hr><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªæ–¹æ¡ˆå¹¶ä¸æ˜¯å®Œå…¨å®‰å…¨çš„ã€‚</p><h3 id="One-time-signatures">One-time signatures</h3><p>$Genï¼š\mathcal{G}(1^n)\rightarrow(G,q,g)$ï¼Œå‡åŒ€é€‰æ‹©$xï¼Œy\leftarrow \mathbb{Z}_q,h=g^x,c=g^y$ï¼Œåˆ™å…¬é’¥ä¸º$(G,q,g,h,c)$,ç§é’¥ä¸º$(x,y)$ã€‚<br>$Sign:m\in \{0,1\}'$,è®¡ç®—$\sigma=(y-m)x^{-1} \pmod q$<br>$Vrfy:$ è®¡ç®— $u=s^{-1} \pmod q$ï¼ŒéªŒè¯$c=g^mh^\sigma$</p><p>Correctness: $g^m,c^\sigma=g^{m+x\sigma}=g^{m+x(y-m)/x}=g^y=c$</p><div class="admonition warning"><p class="admonition-title">One-time signatures</p><p>è¯¥æ–¹æ¡ˆåŸºäºDL problem æ»¡è¶³ EUF-1-naCMAå®‰å…¨æ€§ã€‚</p></div><h2 id="æ‚é¡¹">æ‚é¡¹</h2><h3 id="Generic-compilers-for-strong-security">Generic compilers for strong security</h3><ol><li><strong>CMA from RSA</strong> ä»»æ„çš„RMAæ–¹æ¡ˆï¼ˆæ¶ˆæ¯ç©ºé—´ $k,q(k)$ï¼‰éƒ½èƒ½æ„é€ å‡º$q(k)$æ¶ˆæ¯ç©ºé—´çš„CMA æ–¹æ¡ˆã€‚<br>å…·ä½“è€Œè¨€ï¼Œå¯¹æ¶ˆæ¯$m\in\{0,1\}^*$ï¼Œéšæœºé€‰æ‹©$m_L\rightarrow \{0,1\}^q$ï¼Œè®¡ç®—$m_R=m_L\oplus m$åˆ™æœ‰$m=m_L\oplus m_R$,ä¸¤ä¸ªéƒ½å…·æœ‰éšæœºæ€§ã€‚<br>éšæœºé€‰æ‹©$r\leftarrow\{0,1\}^k$,åˆ™$r||m_L,r||m_R$åˆ†åˆ«å¯ä½œä¸ºç‹¬ç«‹çš„$sk_L,sk_R$ã€‚</li><li><strong>CMA from naCMA</strong>,é€šè¿‡ä½¿ç”¨ä¸€æ¬¡æ€§çš„naCMAæ–¹æ¡ˆç”Ÿæˆæ¶ˆæ¯çš„æ•°å­—ç­¾åï¼Œå¹¶ä½¿ç”¨é•¿æœŸçš„naCMAæ–¹æ¡ˆæ¥å¯¹ä¸€æ¬¡æ€§naCMAæ–¹æ¡ˆç­¾åï¼Œå³å¯æ„é€ CMAã€‚</li></ol><h3 id="CA">CA</h3><p>ç•¥ã€‚</p><h3 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h3><p>å•Šå“ˆå“ˆï¼Œç»ˆäºåœ¨ç´§èµ¶æ…¢èµ¶ï¼Œæ‘¸é±¼æ‘†çƒ‚ä¸­å†™å®Œäº†è¿™ä¸ªå¯†ç å­¦åšå®¢ï¼ŒåŸæœ¬ä½œä¸ºè€ƒè¯•å¤ä¹ çš„åšå®¢åé¢å‘ç°å†™äº†å¤ªå¤šå¤ªèŠ±æ—¶é—´ï¼Œç»“æœå¿½ç•¥äº†æœ€åå…¬é’¥åŠ å¯†çš„ç« èŠ‚ï¼Œåœ¨å¼€å§‹è€ƒè¯•çš„æ—¶å€™æˆ‘è¿˜æ²¡æœ‰å†™11ç« ï¼Œ12ç« åšå®¢ï¼Œç°åœ¨æˆ‘å¯†ç å­¦åˆ†æ•°å·²ç»å‡ºæ¥äº†ï¼Œ93ï¼Œåœ¨å¤§é¢˜ç‚¸äº†çš„æƒ…å†µä¸‹è¿˜ç®—èƒ½å¤Ÿæ¥å—ã€‚</p><p><s>ä½†æˆ‘å…¶ä»–ç§‘ç›®ç‚¸äº†</s></p><p>æœ¬åšå®¢ç³Ÿç³•çš„æ–‡ç¬”ï¼ˆå¾ˆå¤šåœ°æ–¹éƒ½æ˜¯çº¯è®°æµæ°´è´¦ï¼‰ä½¿è¿™ä¸ªåšå®¢å¯è¯»æ€§å¤§å¤§é™ä½ã€‚æˆ‘å°½åŠ›ä½¿è¿™åšå®¢çœ‹èµ·æ¥â€œå¯¹æ–°æ‰‹å‹å¥½â€ï¼Œä½†ä¸€åƒä¸ªè¯»è€…æœ‰ä¸€ä¸‡ä¸ªyyé¡¶é’ˆï¼Œå¦‚æœå› ä¸ºæœ¬åšå®¢çš„ç³Ÿç³•ä½“éªŒï¼ˆè¿«çœŸï¼‰è€Œä½¿ä½ å¤±å»äº†å¯¹ç°ä»£å¯†ç å­¦è¿™é—¨è¯¾çš„å…´è¶£ï¼Œä¸‡åˆ†æŠ±æ­‰ğŸ˜­ã€‚</p><p>åŸè‘—<code>Introduction to MODERN CRYPTOGRAPHY</code>çš„æ¡ç†æ€§ä»¥åŠçŸ¥è¯†ç‚¹è¡¥å……æ˜¯æå¼ºçš„ï¼Œè¿˜æ˜¯æ¥çœ‹çœ‹è¿œå¤„çš„åŸè‘—å§å®¶äººä»¬ã€‚</p><p>å¼€å§‹å†™è¿™ä¸ªåšå®¢çš„æ—¶å€™è¿˜æ˜¯å»å¹´11æœˆ26å·ï¼Œç°åœ¨3æœˆ3å·æˆ‘æ‰å†™å®Œè¿™åšå®¢ï¼Œå³ä½¿èŠ±äº†è¿™ä¹ˆé•¿æ—¶é—´<s>ä»å¯’å‡æ‰å¼€å§‹è®¤çœŸå­¦è¿™å¯†ç å­¦</s>ï¼Œæˆ‘è¿˜æ˜¯æ²¡æ³•å…‹æœè‡ªå·±æ‘†çƒ‚æ‘¸é±¼çš„ä¹ æƒ¯ï¼Œæœ‰è¶£çš„è¯æ˜æˆ‘å‡ ä¹ä¸€ä¸ªæ²¡å†™ï¼Œè€Œè®©æˆ‘å¯¹å¯†ç å­¦æœ‰å…´è¶£çš„ä¸€å¤§åŸå› æ°æ°å°±æ˜¯è¯æ˜éƒ¨åˆ†ï¼Œé™äºç²¾åŠ›å’Œæ—¶é—´ç­‰å› ç´ æ²¡æœ‰åŠæ³•å®Œæˆï¼Œä¸èƒ½ä¸è¯´æ˜¯ä¸€ç§é—æ†¾ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> Public key </tag>
            
            <tag> Digital Signature </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern Cryptoâ…ª Public-key-Encryption</title>
      <link href="/2023/02/24/modern-cryptoxi-public-key-encryption/"/>
      <url>/2023/02/24/modern-cryptoxi-public-key-encryption/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šç« è®²äº†å…¬é’¥å¯†ç çš„ä¼˜ç‚¹ï¼Œè¿™é‡Œæ¥ç‚¹ç¼ºç‚¹ï¼š</p><ol><li>å…¬é’¥å¯†ç ä¸èƒ½æŒ‡å®šå‘é€è€…ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œé‚£ä¹ˆä»»ä½•äººéƒ½å¯ä»¥å‘é€ç»™æŒæœ‰ç§é’¥çš„æ¥æ”¶è€…ä¿¡æ¯ã€‚</li><li>æœ€ä¸»è¦çš„è¿˜æ˜¯æ•ˆç‡ï¼Œå…¬é’¥å¯†ç çš„æ—¶é—´å¤æ‚åº¦æ¯”ç§é’¥å¯†ç é«˜å‡º2-3ä¸ªæ•°é‡çº§ã€‚</li></ol><h2 id="Security-distribution-of-public-keys">Security distribution of public keys</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹å…¬é’¥å¯†ç çš„è®¨è®ºä»…é™äºè¢«åŠ¨ï¼ˆEAVï¼‰æ•Œæ‰‹ã€‚è‹¥æ•Œæ‰‹èƒ½å¤Ÿæˆªè·æ‰€æœ‰ä¿¡æ¯ï¼Œå¹¶ä¸”é€šä¿¡åŒæ–¹æ²¡æœ‰åœ¨æ­¤ä¹‹å‰å…±äº«å¯†é’¥ï¼Œåˆ™æ— æ³•å®ç°secrecyã€‚</p><p>å› æ­¤ï¼Œåœ¨æœ¬ç« æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å‡è®¾ï¼šå‘é€è€…èƒ½å¤Ÿç›´æ¥è·å¾—æ¥æ”¶è€…çš„å…¬é’¥ï¼ˆå®‰å…¨å¯†é’¥åˆ†å‘ï¼‰ã€‚è¯¥å‡è®¾çš„åŸå› æ˜¯å› ä¸ºå­˜åœ¨æœ‰å…¶ä»–æ–¹å¼èƒ½å¤ŸæŠµå¾¡ä¸»åŠ¨æ”»å‡»ï¼Œå› æ­¤å°†å¯†é’¥åˆ†å‘å’Œå…¬é’¥åŠ å¯†çš„å®‰å…¨æ€§åˆ†å¼€è®¨è®ºæ˜¯åˆç†çš„ã€‚</p><h2 id="CPA-attacks">CPA attacks</h2><h3 id="EAV-Security">EAV Security?</h3><hr><p>$PubK_{\mathcal{A},\prod}^{\mathbf{eav}}$ expriment</p><ol><li>æ•Œæ‰‹é¢„è¨€æœºäº‹å…ˆç»™å®šå®‰å…¨å‚æ•°nã€‚</li><li>é¢„è¨€æœº:$(pk,sk)\leftarrow Gen(1^n),b\leftarrow \{0,1\}$ï¼Œå¹¶å°†å…¬é’¥è¿”å›ç»™æ”»å‡»è€…ã€‚</li><li>æ”»å‡»è€…$\mathcal{A}$ å‘é€$(m_0,m_1)$,é¢„è¨€æœºè¿”å›$câ€™\leftarrow Enc_{pk}(m_b)$</li><li>æ”»å‡»è€…è¿”å›$bâ€™$ï¼Œè‹¥$b=bâ€™$ è¿”å›1ï¼Œå¦åˆ™0.</li></ol><hr><div class="admonition warning"><p class="admonition-title">EAV Security</p><p>A public-key encryption scheme $\prod =(Gen, Enc, Dec)$ has indistinguishable encryption in the presence of an eavesdropper if for all probabilistic polynomial-time adversary $\mathcal{A}$ there is a negligible function $negl$ such that$Pr[PubK_{\mathcal{A},\prod}^{\mathbf{eav}}(n)=1]\leq 1/2+negl(n)$</p></div><h3 id="Public-key-definition">Public key definition</h3><p>$Gen(1^n)$ç”Ÿæˆå…¬é’¥$pk$,ç§é’¥$sk$.<br>$Enc_{pk}( m)\rightarrow c$ï¼Œå…¶ä¸­mä»æ¶ˆæ¯ç©ºé—´$\mathcal{M}$ä¸­è·å–ã€‚<br>$Dec_{sk}( c)\rightarrow m\quad or\quad<br>\bot$</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¬é’¥å¯†ç å…è®¸æœ‰å¯å¿½ç•¥çš„æ¦‚ç‡ä½¿å¾—<br>$Dec_{sk}(Enc_{pk}(m))=m$ä¸æˆç«‹ã€‚<br>å› æ­¤ï¼ŒEncå¯ä»¥æ˜¯ç¡®å®šæ€§æˆ–æ¦‚ç‡æ€§çš„ï¼ŒDecå…è®¸Perfectly Correctï¼Œä½†ä¹Ÿå…è®¸ä»¥å¯å¿½ç•¥æ¦‚ç‡å¤±è´¥ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªå…¬é’¥å¯†ç çš„å®ä¾‹ä¸­ï¼Œæ¶ˆæ¯ç©ºé—´éƒ½æ˜¯éšå«ç€ä¸å…¬é’¥$pk$æœ‰å…³ï¼Œå¯èƒ½æ˜¯æŸäº›ä»£æ•°ç»“æ„ä¸­çš„å…ƒç´ ã€‚å› æ­¤ï¼Œæ¶ˆæ¯må¯èƒ½éœ€è¦è½¬æ¢ã€‚</p><h3 id="Some-Theorem">Some Theorem</h3><div class="admonition info"><p class="admonition-title">CPA-Secure</p><p>è‹¥å…¬é’¥åŠ å¯†æ–¹æ¡ˆä¿è¯EAVå®‰å…¨ï¼Œé‚£ä¹ˆå…¶ä¹Ÿæ˜¯IND-CPA-Secureï¼ˆIND= indistinguishableï¼‰</p></div><p>è¿™æ¡å¾ˆå¥½è¯´æ˜ï¼Œå…¬é’¥çš„å…¬å¼€ä½¿ä»»ä½•äººéƒ½å¯ä»¥åŠ å¯†ä¿¡æ¯ï¼Œç›¸å½“äºè·å¾—äº†$Enc$é¢„è¨€æœºã€‚</p><div class="admonition info"><p class="admonition-title">Perfect secret</p><p>æ²¡æœ‰ä»»ä½•å…¬é’¥åŠ å¯†æ–¹æ¡ˆèƒ½ä¿è¯å®Œç¾åŠ å¯†ã€‚</p></div><p>ä¸åšè¯æ˜ï¼ˆä¹‹åçœ‹çœ‹èƒ½ä¸èƒ½è¡¥ä¸Šï¼‰</p><div class="admonition info"><p class="admonition-title">Deterministic encryption scheme</p><p>æ²¡æœ‰ç¡®å®šæ€§çš„å…¬é’¥åŠ å¯†æ–¹æ¡ˆæ»¡è¶³IND-CPA-Secure</p></div><p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬æƒ³è®©åŒä¸€æ¡å…¬é’¥pkå»åŠ å¯†å¤šæ¡æ¶ˆæ¯ï¼Œäºæ˜¯æœ‰ï¼š</p><div class="admonition warning"><p class="admonition-title">Multiple Encryption</p><p>è‹¥å…¬é’¥åŠ å¯†æ–¹æ¡ˆæ»¡è¶³IND-CPA-secureï¼Œé‚£ä¹ˆå…¶ä¹Ÿæ»¡è¶³multiple encryptionçš„ä¸å¯åŒºåˆ†æ€§ã€‚</p></div><h2 id="Arbitrary-long-messages">Arbitrary long messages</h2><p>ç”±ä¸Šæ–‡å¯¹å¤šæ¶ˆæ¯åŠ å¯†çš„å®‰å…¨æ€§ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ªåŠ å¯†æ–¹æ¡ˆï¼Œå…¶åŸºäºæœ€åˆçš„å…¬é’¥åŠ å¯†ï¼šæ¯ä¸€å—éƒ½æ¥ä¸ªåŠ å¯†ç„¶åå‘é€ã€‚è¯¥æ–¹æ¡ˆæ˜¯IND-CPA-secureçš„ã€‚</p><p>ç„¶è€Œï¼Œè¿™ä¸å¤Ÿé«˜æ•ˆï¼Œäºæ˜¯æœ‰æ··åˆåŠ å¯†æ–¹æ¡ˆï¼š</p><p>å…¬é’¥åŠ å¯†åªåŠ å¯†ç§é’¥åŠ å¯†çš„å¯†é’¥ï¼Œç§é’¥åŠ å¯†æ•´æ¡ä¿¡æ¯è¿å¸¦ç€å…¬é’¥åŠ å¯†çš„å¯†é’¥ä¸€åŒå‘é€ã€‚</p><h3 id="CCA-attacks">CCA attacks</h3><hr><p>CCA attack experiment</p><ol><li>äº‹å…ˆç»™å®šnï¼Œ</li><li>é¢„è¨€æœº:$(pk,sk)\leftarrow Gen(1^n),b\leftarrow \{0,1\}$ï¼Œå¹¶å°†å…¬é’¥è¿”å›ç»™æ”»å‡»è€…ã€‚</li><li>æ”»å‡»è€…å‘é€å¯†æ–‡$c_i$,é¢„è¨€æœºè¿”å›$Dec_{sk}(c_i)$</li><li>å¯è¿›è¡Œå¤šæ¬¡ç¬¬ä¸‰æ­¥ï¼Œä¹‹åæ•Œæ‰‹å‘é€$m_0,m_1$,é¢„è¨€æœºè¿”å›$câ€™$<br>ä¹‹åè¿˜å¯ä»¥å¤šæ¬¡è¿›è¡Œç¬¬ä¸‰æ­¥ï¼Œä½†æ— æ³•å¯¹$câ€™$è¿›è¡ŒDecã€‚</li><li>æ•Œæ‰‹å‘é€bâ€™,ä¹‹åå’Œå…¶ä»–å®šä¹‰ä¸€æ ·ã€‚</li></ol><hr><div class="admonition warning"><p class="admonition-title">CCA-secure</p><p>å¯¹ä»»æ„PPTæ•Œæ‰‹$\mathcal{A}$,è‹¥æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼Œåˆ™æ»¡è¶³CCA-secureï¼š$$Pr[PubK_{\mathcal{A},\prod}^{\mathbf{cca}}=1]\leq 1/2+negl(n)$$</p></div><h2 id="Key-encapsulation-machanism-KEM">Key-encapsulation machanism(KEM)</h2><p>KEMå®šä¹‰ä¸º$Gen,Encaps,Decaps$</p><p>$Gen(1^n)\rightarrow (pk,sk)$<br>$Encaps(1^n,pk)\rightarrow (c,k),k\in\{0,1\}^{p(n)}$<br>$Decaps(sk,c)\rightarrow k$</p><p>åŒæ ·ä¹Ÿè¦æ±‚å­˜åœ¨å¯å¿½ç•¥çš„æ¦‚ç‡ä¸æˆåŠŸï¼ˆå…¬é’¥å•Šå—¯ï¼‰</p><hr><p>KEM experiment</p><ol><li>äº‹å…ˆç»™å®šnã€‚</li><li>é¢„è¨€æœº$Gen(1^n)\rightarrow (pk,sk),Encaps_{pk}(1^n)\rightarrow (câ€™,k)$,éšæœºé€‰æ‹©$b\leftarrow\{0,1\}$ï¼Œè‹¥b=0ï¼Œkâ€™=kï¼Œå¦åˆ™kä»$\{0,1\}^n$éšæœºè·å–ï¼Œè¿”å›æ•Œæ‰‹$(pk,(câ€™,kâ€™))$</li><li>æ•Œæ‰‹è¿”å›bâ€™ï¼Œå‰©ä½™å’Œå…¶ä»–é¢„è¨€æœºå®šä¹‰ç›¸åŒã€‚</li></ol><hr><div class="admonition warning"><p class="admonition-title">warning</p><p>å¯¹ä»»æ„PPTæ•Œæ‰‹$\mathcal{A}$,è‹¥æ»¡è¶³ä»¥ä¸‹æ€§è´¨åˆ™æœ‰CPA-secureï¼š$$Pr[KEM_{\mathcal{A},\prod}^{\mathbf{pa}}=1]\leq 1/2+negl(n)$$</p></div><p>ç”¨å…ˆå‰æ„é€ çš„å…¬é’¥å¯†ç æ–¹æ¡ˆï¼ˆIND-CPA/IND-CCAï¼‰å¯ä»¥å¾ˆå®¹æ˜“æ„é€ KEM(IND-CPA/IND-CCA)ï¼Œæ„é€ æ–¹æ³•ç•¥ï¼ˆæ‡’ï¼‰ï¼ŒæŠŠåŠ å¯†çš„æ¶ˆæ¯æ¢æˆkå°±è¡Œäº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºkæœ¬èº«éœ€è¦â€œéšæœºâ€é€‰æ‹©ï¼Œå› æ­¤æ¶ˆæ¯ç©ºé—´éœ€è¦å…·æœ‰åˆé€‚çš„â€œmin-entropyâ€ã€‚</p><p>å½“ç„¶ï¼Œä¸“é—¨çš„KEMç®—æ³•æ•ˆç‡è‚¯å®šæ¯”è¿™ç§æ„é€ çš„æ•ˆç‡è¦é«˜ã€‚</p><h3 id="Hybrid-Encryption">Hybrid Encryption</h3><p>æœ‰äº†KEMï¼Œå°±å¯ä»¥æ„é€ æ›´é«˜æ•ˆçš„ï¼ˆæ··åˆï¼‰å…¬é’¥åŠ å¯†ã€‚</p><p>è®¾$\prod=(Gen,Encaps,Decaps),\prodâ€™=(Genâ€™,Encâ€™,Decâ€™)$,æ„é€ $\prod^{hy}=(Gen^{hy},Enc^{hy},Dec^{hy})$</p><p>$Gen^{hy}:(pk,sk)\leftarrow Gen(1^n)$<br>$Enc^{hy}:câ€™ \leftarrow Enc_kâ€™(m)$<br>output:$(c,câ€™)$<br>$Dec^{hy}:k=Decaps_{sk}Â©,m=Dec_kâ€™(câ€™)$</p><div class="admonition info"><p class="admonition-title">info</p><p>è‹¥$\prod$ æ˜¯CPA-secure KEMï¼Œ$\prod'$ç§é’¥å¯†ç æ˜¯EAVä¸‹å®‰å…¨ï¼Œåˆ™$\prod^{hy}$æ˜¯CPA-secureçš„ã€‚</p></div><div class="admonition info"><p class="admonition-title">info</p><p>è‹¥$\prod$ æ˜¯CCA-secure KEMï¼Œ$\prod'$ç§é’¥å¯†ç æ˜¯CCA-secureï¼Œåˆ™$\prod^{hy}$æ˜¯CCA-secureçš„ã€‚</p></div><h2 id="EIGamal-Encryption">EIGamal Encryption</h2><p>åŸºæœ¬æ€è·¯ï¼š<br>åˆ©ç”¨DH problemï¼Œæ¥æ”¶è€…é€‰æ‹©$a\leftarrow \mathbb{Z}_q$ä½œä¸ºç§é’¥ï¼Œè€ŒæŠŠç¾¤$(G,q,g)$å’Œ$g^a$ä½œä¸ºå…¬é’¥å…¬å¼€ï¼Œé‚£ä¹ˆä»»ä½•äººå¯ä»¥æŒ‡å®šbï¼Œä¼ è¾“$g^bï¼ŒK\cdot M$ç»™æ¥æ”¶è€…ï¼Œåˆ™æ¥æ”¶è€…è¿è¡Œ$K\leftarrow(g^b)^a$,ä»è€Œè§£å¯†ï¼Œå¹¶å…±äº«å¯†é’¥ã€‚</p><h3 id="scheme">scheme</h3><p>$Gen(1^n):Run(G,q,g)\leftarrow\mathbb{G}(1^n)$éšæœºé€‰æ‹©$x\leftarrow\mathbb{Z}_q$,è®¡ç®—$y=g^x$<br>$$(sk,pk)=((G,q,g,x)(G,q,g,y))$$<br>$Enc(m,pk):$å¯¹äºè¾“å…¥mï¼Œéšæœºé€‰æ‹©$r\leftarrow\mathbb{Z}_q,$<br>$$C=(g^r,m\cdot y^r)$$<br>$Dec(C,sk):C=(C_1,C_2),$<br>$$m=C_2\cdot(C_1^x)^{-1}$$</p><p>åœ¨è¿™é‡Œå¯ä»¥è®¤ä¸º$(G,q,g)$ä¸ºå®‰å…¨å‚æ•°ã€‚</p><h3 id="Security">Security</h3><div class="admonition warning"><p class="admonition-title">lemma EIGamal</p><p>è®¾$G$ä¸ºæœ‰é™ç¾¤ï¼Œ$m\in G$ä»»æ„ï¼Œéšæœºé€‰æ‹©çš„$k\in G$å’Œè®¾ç½®çš„$k'=k\cdot m$å…·æœ‰ç›¸åŒçš„åˆ†å¸ƒï¼Œå³å¯¹ä»»æ„çš„$g'\in G$$$Pr[k\cdot m=g']=1/G$$</p></div><p>ä¸Šæ–¹çš„lemmaä¸­ï¼Œå¯ä»¥çœ‹åˆ°ç±»ä¼¼äºç§é’¥å¯†ç ä¸­çš„ä¸€æ¬¡ä¸€å¯†å®šä¹‰ï¼Œé‚£ä¹ˆç”±æ­¤ï¼Œå¯ä»¥è®¾æƒ³å‡ºå¦å¤–ä¸€ç§"EIGamal"çš„åŠ å¯†æ–¹å¼ï¼š</p><p>éšæœºé€‰æ‹©$g^z$,è®©å¯†æ–‡$C=(g^r,m\cdot g^z)$</p><p>å› æ­¤ï¼Œ $g^z$ å¯¹æ•Œæ‰‹æ˜¯æœªçŸ¥çš„ï¼Œåˆ™å…¶èƒ½å¤Ÿæ»¡è¶³ä¿¡æ¯è®ºå®‰å…¨ï¼ˆå³å®Œç¾åŠ å¯†ï¼‰</p><p>EIGamalçš„å®‰å…¨æ€§è¯æ˜ä¾¿åŸºäºæ­¤ç±»çš„ä¸å¯åŒºåˆ†æ€§å°äº$1/2+negl(n)$,è€Œå…¶è¯æ˜åˆä¾èµ–äºDDH assumptionã€‚</p><p>å®‰å…¨è¯æ˜å°±ç•¥äº†ã€‚ï¼ˆğŸ˜‹ï¼‰</p><h2 id="RSA-attacks">RSA attacks</h2><p>å›é¡¾ä¸€ä¸‹â€œè¯¾æœ¬â€ä¸Šçš„RSAï¼š</p><p>$Gen()$:é€‰æ‹©ä¸¤ä¸ªå¤§ç´ æ•°pï¼Œqï¼ŒN=pqï¼Œå‡åŒ€é€‰æ‹©eï¼Œ$1&lt;e&lt;\phi(N)$ä¸”$gcd(e,\phi(N))=1$.è®¡ç®—$d,ed=1\quad \phi(N)$<br>$Enc(pk,m): c=m^e\quad mod N$<br>$Dec(sk,c): m=c^d \quad mod N$</p><div class="admonition missing"><p class="admonition-title">RSA in our class</p><p>è¯¾æœ¬ä¸Šçš„RSAæ˜¯ä¸èƒ½å¤Ÿç›´æ¥ä½¿ç”¨çš„ã€‚</p></div><p>RSAå‡è®¾ä¸­ï¼Œmæ˜¯éšæœºå‡åŒ€é€‰æ‹©çš„ï¼Œä½†å…¶æœ¬è´¨ä¸Šè€Œè¨€ï¼Œæ¶ˆæ¯å¹¶ä¸æ»¡è¶³è¿™ä¸€æ¡ä»¶ã€‚åŒæ—¶ï¼ŒRSAåŠ å¯†è¿‡ç¨‹æ˜¯ç¡®å®šæ€§çš„ï¼Œå› æ­¤å¿…å®šä¸æ˜¯å®‰å…¨çš„ã€‚</p><p>å…·ä½“æ”»å‡»æ–¹æ³•ç•¥ã€‚åæ­£å¾ˆå®¹æ˜“æ„é€ æã€‚</p><hr><p>ç”±ä¸Šï¼ŒRSAåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦è¿›è¡Œé¢„å¤„ç†ç­‰è¿‡ç¨‹ï¼Œæ‰èƒ½å¤ŸçœŸæ­£ä½œä¸ºåŠ å¯†ç®—æ³•è¿›è¡Œå…¬é’¥åŠ å¯†ã€‚</p><p>RSA-OAEPä¾¿ç”¨äº†å“ˆå¸Œå‡½æ•°ï¼Œä½¿å¾—RSA-OAEPæ˜¯CCA Secureçš„ï¼ˆè¯æ˜è¿‡ç¨‹ä¸­ç”¨åˆ°äº†éšæœºå‡½æ•°ï¼Œå…¶ç”¨SHA-256è¿›è¡Œå®ä¾‹åŒ–ã€‚ï¼‰</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> Public key </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…© Key management and public key revolution</title>
      <link href="/2023/02/16/modern-cryptox-key-management-and-public-key-revolution/"/>
      <url>/2023/02/16/modern-cryptox-key-management-and-public-key-revolution/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç§é’¥å¯†ç å­¦çš„å®‰å…¨æ€§ï¼Œä½†æ²¡æœ‰è§£å†³ä¸€ç‚¹ï¼šå¦‚ä½•åˆ†å‘å¯†é’¥ï¼Ÿ</p><p>Perfect Secretä¸­çš„OTPå¯ä»¥é‡‡ç”¨çº¿ä¸‹çš„äº¤æ¢å¯†é’¥ï¼Œä½†å¦‚ä»Šçš„ç½‘ç»œæ— æ³•è¿™æ ·åšã€‚åŒæ—¶ï¼Œç§é’¥å¯†ç è¿˜éœ€è¦ä¿è¯å¯†é’¥ç®¡ç†çš„å®‰å…¨æ€§ï¼Œå¹¶ä¸”ä¹Ÿä¸é€‚ç”¨äºå¼€æ”¾çš„ç³»ç»Ÿä¸­å®‰å…¨é€šä¿¡çš„éœ€æ±‚ã€‚</p><h2 id="Partial-Solutionï¼šKey-Distribution-Centers-KDC">Partial Solutionï¼šKey-Distribution Centers(KDC)</h2><p>åœ¨å°é—­ç³»ç»Ÿä¸­ï¼Œèƒ½å¤Ÿæ„é€ å‡ºè¿™æ ·ä¸€ç§å¯†é’¥ç®¡ç†æ–¹æ¡ˆï¼Œç³»ç»Ÿä¸­KDCæœåŠ¡å™¨æ¥åˆ†é…å¯†é’¥ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·éƒ½ä¿å­˜å’ŒKDCå®‰å…¨é€šä¿¡çš„é•¿æœŸå¯†é’¥ï¼Œè€ŒKDCæŒ‰éœ€è¿”å›ç”¨æˆ·çŸ­æœŸå¯†é’¥ã€‚</p><div class="admonition info"><p class="admonition-title">ç¬¦å·è¯´æ˜</p><p>$S$:KDC Server$A,B$,ç”¨æˆ·ã€‚$K_{AS},K_{BS}$ï¼Œ$A,B$ä¿å­˜çš„é•¿æœŸå¯†é’¥ã€‚$\{M\}_K$è¢«KåŠ å¯†ä¸”è®¤è¯çš„æ¶ˆæ¯Mï¼Œå¯ä»¥é‡‡ç”¨ä»»ä½•çš„AE schemeï¼Œ$K=(K_0,K_1)$,å¹¶é‡‡ç”¨Encrypt-then-MACã€‚</p><hr><p>P.S. ç”¨æˆ·Aï¼ŒBåœ¨å¯†ç å­¦è®ºæ–‡ä¸­åˆå¯ä»¥å«åšAliceï¼ŒBobï¼Œæ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œåªæ˜¯çº¦å®šä¿—ç§°çš„å«æ³•:-)ï¼Œæœ¬æ–‡åœ¨ä¹‹åä¹Ÿä¼šå‡ºç°$A$,Aliceç­‰æ··ç”¨çš„æƒ…å†µã€‚</p></div><h3 id="toy-protocol-First">toy protocol(First)</h3><p>å¾ˆå®¹æ˜“çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡ºè¿™æ ·ä¸€ä¸ªæ–¹æ¡ˆï¼š</p><ol><li>$A$è¯•å›¾ä¸Bå»ºç«‹è”ç³»ï¼Œå‘$S$å‘é€$(A,B)$</li><li>$S$éšæœºé€‰æ‹©å¯†é’¥$K$,å¹¶å‘é€$\{K\}_{K_{ AS} }\{K\}_{ K_{ BS} }$<br>$\{K\}_{K_{ BS} }$å¯ä»¥è®¤ä¸ºæ˜¯Så‘é€çš„ticketã€‚</li><li>$A$å‘$B$å‘é€$\{K\}_{K_{BS} },A$ï¼Œå»ºç«‹è”ç³»ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶æ»¡è¶³CPA-Secureã€‚ç„¶è€Œï¼Œå…¶æ— æ³•æŠµå¾¡ä¸­é—´äººæ”»å‡»ï¼šè¿›è¡Œç¬¬ä¸‰æ­¥æ—¶ï¼Œä¸­é—´äººæ•Œæ‰‹æˆªè·Aå‘é€çš„ä¿¡æ¯ï¼Œå¹¶å‘Bå‘é€$\{K\}_{K_{BS} },Eve$ã€‚</p><h3 id="Secondï¼šsuffer-from-replay-attack">Secondï¼šsuffer from replay attack</h3><p>å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œè‹¥ä¸­é—´äººå¯ä»¥æˆªè·èº«ä»½å¹¶é¡¶æ›¿ï¼Œé‚£ä¹ˆå°†èº«ä»½ä¿¡æ¯ä¹Ÿéšä¹‹åŠ å¯†å‘é€å³å¯ã€‚äºæ˜¯å°†ä¸Šè¿°æ–¹æ¡ˆä¸­$\{K\}_{K_{?S} }$è½¬ä¸º$\{K,?\}_{K_{otherS} }$</p><p>ç„¶è€Œï¼Œè¯¥æ–¹æ³•åŒæ ·ä¹Ÿå¯ä»¥é­å—é‡æ”¾æ”»å‡»ã€‚æ•Œæ‰‹å¯ä»¥å­˜å‚¨KDCå‘é€çš„å€¼å¹¶é‡æ”¾ï¼Œè¿™æ ·ä¾¿å¯ä»¥ä½¿å…¶å¤ç”¨å¯†é’¥ï¼Œå¯¼è‡´ä¸å®‰å…¨æ€§ã€‚</p><h3 id="Third-Needham-Schreoder-1972">Third: Needham Schreoder 1972</h3><p>å› æ­¤ï¼Œä¾¿æœ‰äº†$Nonce$æ¦‚å¿µã€‚<br>$Nonce$çš„å­—é¢æ„ä¹‰æ˜¯â€œnumber used onceâ€,ä¸€æ¬¡æ€§æœ‰æ•ˆã€‚ä¸€èˆ¬è€Œè¨€ï¼Œ$Nonce$æ˜¯éšæœºé€‰æ‹©çš„æ•°ï¼Œå…¶åœ¨é€šä¿¡ä¸­ç”¨äºè¯æ˜è¯¥ä¿¡æ¯æ˜¯å…¨æ–°ç”Ÿæˆè€Œä¸æ˜¯é‡æ”¾çš„ã€‚</p><p>äºæ˜¯ï¼Œåœ¨ä¸Šè¿°è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ä¸­Aå°†å‘é€$N_A$,ç¬¬äºŒæ­¥ä¸­$\{K,B\}_{K_{AS} }$æ”¹ä¸º$\{K,B,N_A\}_{K_{AS} }$</p><hr><p>ç„¶è€Œï¼Œè¯¥åè®®ä»ç„¶å­˜åœ¨ç¼ºé™·ã€‚å€˜è‹¥æ•Œæ‰‹å‘é€$\{K_{old},A\}_{K_{BS} }$ ,Bæ— æ³•åˆ¤æ–­è¯¥å¯†é’¥æ˜¯å¦é‡æ”¾ã€‚</p><h3 id="Kerboros">Kerboros</h3><p>ï¼ˆçœŸå®çš„Kerborosæ˜¯å¾ˆå¤æ‚çš„ï¼Œè¿™é‡Œéšä¾¿å†™ç‚¹äº†ï¼‰</p><ol><li>$A$ å‘$S$å‘é€$(A,B,N_A,N_B)$</li><li>$S$é€‰æ‹©éšæœºå¯†é’¥$K$ï¼Œå‘é€$\{K,B,N_A\}<em>{K</em>{AS} },\{K,A,N_B\}<em>{K</em>{BS} }$</li><li>$A$å‘é€$\{K,A,N_B\}<em>{K</em>{BS} }$ï¼Œ$B$å‘é€$(B,N_B)$ã€‚</li></ol><p>åŒæ—¶ï¼ŒKerborosé€šè¿‡timestampsæ¥ä¿è¯keyçš„freshnessã€‚</p><h3 id="conclusion">conclusion</h3><p>KDCèƒ½å¤Ÿä¿è¯å°é—­ç³»ç»Ÿå†…çš„å¯æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿæ¥çº³æ›´å¤šçš„æˆå‘˜ï¼Œç”¨æˆ·åªéœ€è¦å­˜å‚¨KDC keysï¼Œåœ¨é€šä¿¡çš„æ—¶å€™åªéœ€è¦KDCç”Ÿæˆsession keys å³å¯ã€‚</p><p>ç„¶è€Œï¼Œå…¶æ— æ³•åœ¨å¼€æ”¾ç³»ç»Ÿå¦‚Internetä¸­å…·æœ‰æ‰©å±•æ€§ï¼Œå¹¶ä¸”å…¶ä¾èµ–äºKDCçš„honestyã€availableã€‚æ²¡æœ‰å…¶ä»–æªæ–½ä¿è¯KDCçš„å¯ä¿¡ï¼ŒKDCä¸€æ—¦æ•…éšœä¹Ÿå¯èƒ½å¯¼è‡´äº‹æ•…ã€‚</p><h2 id="Public-Key-Cryptography">Public-Key Cryptography</h2><p>ç°æ„é€ ä¸€ä¸ªå®éªŒï¼š</p><p>Aliceã€Bobæƒ³è¦æ„å»ºEAVä¸‹å®‰å…¨çš„é€šä¿¡ã€‚ï¼ˆç°åœ¨å…ˆè®¨è®ºæ²¡æœ‰ç¯¡æ”¹ä¸‹çš„çº¯EAVæ”»å‡»ï¼‰</p><p>é€‰å®šä¸€ä¸ªç´ æ•°qï¼Œç”Ÿæˆqé˜¶ç¾¤ï¼Œç”Ÿæˆå…ƒä¸º$g$ã€‚</p><p>æœ‰ä»¥ä¸‹å¯†é’¥ç”Ÿæˆï¼š</p><ol><li>Aliceç”Ÿæˆ$g^a$,$a\leftarrow \mathbb{Z}_q$ï¼ŒåŒç†Bocç”Ÿæˆ$g^b$</li><li>ä¸¤è€…ç›´æ¥äº’ç›¸å‘é€$g^?$ï¼Œå¹¶æ ¹æ®å„è‡ªçš„ç”Ÿæˆæ•°ï¼Œç”Ÿæˆå¯†é’¥$(g^b)^a\quad (g^a)^b$</li></ol><hr><p>å®šä¹‰$\mathbf{KE}_{\mathcal{A},\prod}^{\mathbf{eav}}$å®éªŒï¼š</p><p>åœ¨è¿™é‡Œï¼Œå®‰å…¨å‚æ•°ä¸º$\mathcal{G}$ç”Ÿæˆçš„$(G,q,g)$</p><ol><li>é¢„è¨€æœºç”Ÿæˆ(k,trans)ï¼Œéšæœºé€‰æ‹©$b\leftarrow\{0,1\}$ï¼Œè‹¥$b=0$ï¼Œ$kâ€™=k$ï¼Œå¦åˆ™$kâ€™$ä»$G$ä¸­å‡åŒ€é€‰æ‹©,è¿”å›æ•Œæ‰‹$(kâ€™,trans)$</li><li>æ•Œæ‰‹è¿”å›$bâ€™$.</li></ol><hr><div class="admonition warning"><p class="admonition-title">key-exchange protocal $\prod$</p><p>it's secure in the EAV if for every PPT $\mathcal{A}$$$Pr[b=b']\leq 1/2+negl(n)$$</p></div><p>å…¶å®‰å…¨æ€§åŸºäºDDHé—®é¢˜ã€‚</p><div class="admonition info"><p class="admonition-title">DDH and Diffie-Hellman key-exchange protocol</p><p>è‹¥DDHæ˜¯å›°éš¾çš„ï¼Œé‚£ä¹ˆDH å¯†é’¥äº¤æ¢åè®®åœ¨EAVä¸‹æ˜¯å®‰å…¨çš„ã€‚</p></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œé€‰å–å¾—æ˜¯æœ‰é™ç¾¤é‡Œçš„å…ƒç´ ï¼Œå› æ­¤å¯ä»¥ç”¨é”®æ§å‡½æ•°è½¬åŒ–ä¸ºnbits stringä»¥ä¿è¯å®‰å…¨æ€§ã€‚å…·ä½“è½¬æ¢ç•¥ã€‚</p><hr><p>DHå¯†é’¥äº¤æ¢åè®®ä¿è¯äº†EAVä¸‹çš„å¯†é’¥äº¤æ¢æ˜¯å®‰å…¨çš„ï¼Œä½†å…¶æ— æ³•æŠµå¾¡ä¸­é—´äººæ”»å‡»ã€‚ç„¶è€Œï¼Œå…¶ç¬¬ä¸€æ¬¡è¯æ˜äº†éå¯¹ç§°æŠ€æœ¯ï¼Œä»¥åŠæ•°è®ºç›¸å…³çŸ¥è¯†å¯ä»¥ç”¨äºå¯†ç å­¦çš„å¯†é’¥åˆ†å‘é—®é¢˜ã€‚å…¶ä»ç„¶ä¸ºæ ‡å‡†å¯†é’¥äº¤æ¢åè®®çš„æ ¸å¿ƒã€‚</p><h2 id="Public-Key-revolution">Public-Key revolution</h2><p>PPTæ— ï¼Œä¸ä½œä¸ºè€ƒçº²ï¼Œä½†è§‰å¾—æœ‰è¶£å°±æ¬æ¥äº†ã€‚</p><p>åœ¨Diffie-Hellmanå‘å¸ƒä»–ä»¬çš„å¯†é’¥äº¤æ¢åè®®æ—¶ï¼Œä»–ä»¬ä¹Ÿæå‡ºäº†éå¯¹ç§°çš„å¯†ç å­¦ã€‚</p><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå‡ºç°äº†RSAç­‰å…¬é’¥åŠ å¯†æ–¹æ¡ˆï¼Œä¹Ÿå‡ºç°äº†æ•°å­—ç­¾åè¿™ä¸€å…¬é’¥å¯†ç å­¦ä¸‹çš„è®¤è¯æ‰‹æ®µã€‚</p><p>å…¬é’¥åŠ å¯†æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p><ol><li>å…¬é’¥å¯†ç å­¦å…è®¸é€šè¿‡å…¬å¼€(ä½†ç»è¿‡èº«ä»½éªŒè¯)çš„é€šé“è¿›è¡Œå¯†é’¥åˆ†å‘ï¼Œå…¶å¯ä»¥ç®€åŒ–å…±äº«å¯†é’¥çš„åˆ†å‘ä¸æ›´æ–°ã€‚</li><li>å…¬é’¥å¯†ç èƒ½å¤Ÿå‡å°‘ç”¨æˆ·å­˜å‚¨å¯†é’¥çš„æ•°é‡ï¼Œä¾‹å¦‚åœ¨å…¬å¸æƒ…å¢ƒä¸‹ï¼Œæ¯ä¸ªå‘˜å·¥åªéœ€è¦å­˜å‚¨è‡ªå·±çš„ç§é’¥å’Œç›¸å¯¹äºå…¶ä»–æ‰€æœ‰å‘˜å·¥å…¬é’¥å³å¯ï¼Œå…¬é’¥ç”šè‡³ä¸éœ€è¦ä¿å¯†ï¼Œå¯ä»¥å­˜å‚¨åœ¨ä¸­å¤®å­˜å‚¨åº“ä¸­ã€‚</li><li>å…¬é’¥å¯†ç æ›´é€‚ç”¨äºå¼€æ”¾ç¯å¢ƒï¼Œé€šä¿¡åŒæ–¹å³ä½¿æ²¡æœ‰é€šä¿¡è¿‡ä¹Ÿèƒ½å¤Ÿå»ºç«‹å®‰å…¨é€šä¿¡ä¿¡é“ã€‚</li></ol><p>å¯ä»¥è¯´ï¼Œå…¬é’¥åŠ å¯†æ˜¯å¯¹å¯†ç å­¦çš„ä¸€æ¬¡é©å‘½ã€‚åœ¨å…¬é’¥å¯†ç å­¦å‡ºç°å‰ï¼Œå¯†ç å­¦ä¸€èˆ¬å±äºæƒ…æŠ¥ç­‰é¢†åŸŸï¼Œè€Œå…¬é’¥æŠ€æœ¯å‡ºç°åï¼Œä¾¿æœ‰äº†TLSã€SSLè¿™äº›ä½¿ç”¨ã€‚</p><hr><p>ä¸¥æ ¼è¯´æ¥ï¼Œå…¬é’¥å¯†ç æ¯”ç§é’¥å¯†ç è¦æ›´å¼ºï¼Œæ¯ä¸ªå…¬é’¥å¯†ç æ–¹æ¡ˆéƒ½å¯ä»¥ç”¨ä½œç§é’¥å¯†ç åŠ å¯†æ–¹æ¡ˆï¼ˆæ—¢ç„¶EAVæ— æ³•åœ¨å…¬é’¥å…¬å¼€çš„æƒ…å†µä¸‹ç ´è§£ï¼Œå…¬é’¥è‹¥ä¿å¯†æ›´æ— æ³•ç ´è§£ï¼‰ï¼Œä½†ç§é’¥å¯†ç å­¦çš„æ•ˆç‡æ›´é«˜ï¼Œå¯ä»¥å’Œå…¬é’¥å¯†ç å­¦è¿›è¡Œé€‚å½“ç»„åˆä½¿ç”¨ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> Public key </tag>
            
            <tag> Key management </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…¨ Public key and Pre knowledge</title>
      <link href="/2023/02/13/modern-cryptoix-public-key-and-pre-knowledge/"/>
      <url>/2023/02/13/modern-cryptoix-public-key-and-pre-knowledge/</url>
      
        <content type="html"><![CDATA[<p>ä¿¡å®‰æ•°å­¦çˆ·ä»¬å¯ä»¥è·³è¿‡è¿™ç« ï¼ˆ</p><p>åŒæ—¶ï¼Œè¿™ç« åªæ˜¯ä¸ºäº†ç¨å¾®æœ‰ç‚¹æ•°è®ºåŸºç¡€çš„äººæ¶è¡¥ä¸€ä¸‹æ‰€éœ€çŸ¥è¯†ï¼Œæ²¡æœ‰æ¥è§¦è¿‡æ•°è®ºçš„è¿˜æ˜¯ç¨å¾®å­¦å­¦å†æ¥ï¼ˆ</p><h2 id="math">math</h2><h3 id="Integers-mod-N">Integers mod N</h3><p>gcdï¼Œä»¥åŠ$\xi(N)$(æ¬§æ‹‰å‡½æ•°)ã€‚</p><p>å…³äºæ¬§æ‹‰å‡½æ•°ï¼Œå¯ä»¥çœ‹ <a href="https://oi-wiki.org/math/number-theory/euler/">OI-WIKI</a></p><p>éœ€è¦äº†è§£å…¶ç§¯æ€§å‡½æ•°çš„æ€§è´¨ã€‚</p><h3 id="Division-Remainder-Modulo">Division Remainder Modulo</h3><p>æ•°è®ºåŸºç¡€çš„modè¡¨ç¤ºï¼š$a \equiv b\quad mod\quad N$<br>å…¶æ€§è´¨è¾ƒä¸ºç®€å•ã€‚</p><h3 id="Groups">Groups</h3><p>è¿‘ä¸–ä»£æ•°,å…¶ç ”ç©¶çš„æ˜¯æŠ½è±¡æ„ä¹‰ä¸Šçš„ä»£æ•°è¿ç®—ï¼Œå› æ­¤å…¶è¿ç®—è§„åˆ™éœ€è¦é‡æ–°å®šä¹‰ã€‚ç¾¤è¿™ç§ä»£æ•°ç»“æ„æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š</p><ol><li>é—­åŒ…ï¼š$\forall g,h\in G,g\cdot h\in G$.</li><li>å•ä½å…ƒï¼š$\exists e\in G\quad s.t. \forall g\in G,e\cdot g=g=g\cdot e$.</li><li>é€†å…ƒï¼š$\forall g\in G,\exists h\in G,g\cdot h=e=h\cdot g$</li><li>ç»“åˆå¾‹ï¼š$\forall g,h,f\in G,(g\cdot h)\cdot f=g\cdot (h\cdot f)$</li></ol><p>ç¾¤æ»¡è¶³ä»¥ä¸‹æ€§è´¨è¢«ç§°ä¸ºäº¤æ¢ç¾¤ï¼š</p><p>$\forall g,h\in G,g\cdot h=h\cdot g$<br>åœ¨å¯†ç å­¦ä¸­ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šåªè®¨è®ºäº¤æ¢ç¾¤ã€‚</p><p>Example:<br>è‹¥N&gt;0ï¼Œé‚£ä¹ˆ$G=\{a\cdot b mod N\}$æ˜¯ä¸€ä¸ªç¾¤ã€‚</p><h3 id="å¹‚">å¹‚</h3><p>ç®€å†™$g^m=g\cdot g\cdot gâ€¦g$,åŠ æ³•ç¾¤ä¹Ÿæ˜¯ç±»ä¼¼å®šä¹‰ï¼Œäºæ˜¯æœ‰ï¼š</p><ol><li>$g^{i+j}=g^i\cdot g^j$</li><li>$g^{ij}=(g^i)^j=(g^j)^i$</li><li>$g^{-i}=(g^i)^{-1}=(g^{-1})^i$</li></ol><h3 id="order-of-a-Group">order of a Group</h3><p>è‹¥Gæ˜¯æœ‰é™ç¾¤ï¼Œé‚£ä¹ˆ$m=|G|$ä¸ºå…¶é˜¶ã€‚<br>åˆ™æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š$\forall g\in G,g^m=1$ï¼ˆå•ä½å…ƒï¼‰<br>æ¨è®ºï¼š$G$ä¸ºæœ‰é™ç¾¤ï¼Œé‚£ä¹ˆ$g^x=g^{x\quad mod\quad m}$</p><h3 id="æ±‚å¹‚æ–¹å¼">æ±‚å¹‚æ–¹å¼</h3><p>å¯¹äºæ±‚$a^n$ä¸­nååˆ†åºå¤§çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡å¿«é€Ÿå¹‚çš„æ€æƒ³å¿«é€Ÿæ±‚è§£ã€‚å…³äºå¿«é€Ÿå¹‚ï¼Œæ„Ÿè§‰æ˜¯ç®—æ³•ç«èµ›åŸºæœ¬åŠŸäº†ï¼Œæœæœå°±æœ‰ï¼ˆ</p><h3 id="Cyclic-Groups">Cyclic Groups</h3><p>ç°å®šä¹‰$G=\{g_0,g_1,â€¦\}$ä¸ºæœ‰é™ç¾¤ï¼Œå…¶é˜¶ä¸ºmã€‚</p><p>è®¾$i\leq m$æ˜¯èƒ½å¤Ÿæ»¡è¶³ä»¥ä¸‹æ€§è´¨çš„æœ€å°æ­£æ•´æ•°ï¼š$g^i=1$,å…¶å¯ä»¥æ„å»ºè¿™æ ·ä¸€ä¸ªç¾¤ï¼š$g^i=g^0,g^{i+1}=g^i,&lt; g &gt;=\{g^0,g^1,â€¦g^{i-1}\}$</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å«iä¸ºå…ƒç´ $g$çš„é˜¶ï¼Œè€Œ$&lt; g &gt;$æ˜¯Gçš„å­ç¾¤ï¼Œç”±gç”Ÿæˆã€‚</p><p>è‹¥ç”±ä¸€ä¸ªå…ƒç´ $g\in G$,å…¶é˜¶ä¸º$m=|G|$ï¼Œé‚£ä¹ˆGè¢«ç§°ä¸ºå¾ªç¯ç¾¤ã€‚</p><div class="admonition info"><p class="admonition-title">info</p><p>è‹¥Gä¸ºmé˜¶ç¾¤ï¼Œ$g\in G$æœ‰é˜¶$i$ ï¼Œåˆ™$i|m$</p></div><p>è‹¥pæ˜¯ç´ æ•°ï¼Œåˆ™$Z^*_{p}=\{1,2,3,4,â€¦p-1\}$æ˜¯é˜¶ä¸ºp-1çš„å¾ªç¯ç¾¤ã€‚</p><h3 id="Generating-random-primes">Generating random primes</h3><div class="admonition info"><p class="admonition-title">Bertrandâ€™s postulate</p><p>$\forall n&gt;1$,the fraction of n-bit integers that are prime is at least $1/3n$.</p></div><p>æœ‰ç®—æ³•èƒ½å¤Ÿç”Ÿæˆéšæœºçš„ç´ æ•°ï¼Œä½†å®ç°å…¶ç®—æ³•çš„è¦ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°ä¸ºç´ æ•°ã€‚äºæ˜¯æœ‰ç´ æ€§æµ‹è¯•ã€‚</p><h3 id="Probabilistic-primality-testï¼ˆç´ æ€§æµ‹è¯•ï¼‰">Probabilistic primality testï¼ˆç´ æ€§æµ‹è¯•ï¼‰</h3><p>ç¡®å®šæ€§çš„æµ‹è¯•ä¸€ä¸ªç´ æ•°æ€è·¯å¾ˆç®€å•ï¼Œä½†ç”¨æ¦‚ç‡æµ‹è¯•èƒ½å¤Ÿæ›´æœ‰æ•ˆç‡çš„è§£å†³ã€‚å…¶å¯¹äºæ‰€æœ‰çš„ç´ æ•°ï¼Œéƒ½ä¼šè¾“å‡ºæ­£ç¡®çš„ç»“æœï¼Œä½†å¯èƒ½ä¼šè¯¯åˆ¤åˆæ•°ä¸ºç´ æ•°ã€‚</p><p>ç´ æ€§æµ‹è¯•é‡‡ç”¨ <a href="https://oi-wiki.org/math/number-theory/fermat/">è´¹é©¬å°å®šç†</a>ï¼Œè€Œç´ æ€§æµ‹è¯•å¯ä»¥è§ <a href="https://oi-wiki.org/math/number-theory/prime/#%E7%B4%A0%E6%80%A7%E6%B5%8B%E8%AF%95">è¿™é‡Œ</a></p><h3 id="å› æ•°">å› æ•°</h3><p>å¯¹äºä¸€ä¸ªæ•°è€Œè¨€ï¼Œè‹¥å…¶åªæœ‰å¤§çš„è´¨å› æ•°ï¼Œé‚£ä¹ˆåˆ†è§£å®ƒæ˜¯å¾ˆéš¾çš„ï¼›ä½†æ‰¾åˆ°ä»»æ„ç»™å®šçš„Nçš„è¾ƒå°å› æ•°æ˜¯è¾ƒä¸ºç®€å•çš„ï¼š$Pollard~rho$ç®—æ³•ã€‚å…³äºPollard rhoç®—æ³•ï¼Œå¯ä»¥åœ¨OI WIKIä¸­æ‰¾åˆ°ã€‚</p><p>å®šä¹‰GenModuleå®éªŒï¼š</p><hr><p>äº‹å…ˆç»™å®šå®‰å…¨å‚æ•°n</p><ol><li>é¢„è¨€æœºç”Ÿæˆï¼ˆ$N,p,q$ï¼‰ï¼Œè¿”å›æ•Œæ‰‹$N$ï¼Œå…¶ä¸­$N=pq$ï¼Œ$pq$ä¸ºnbits ç´ æ•°.</li><li>æ•Œæ‰‹å‘é€$pâ€™,qâ€™$ï¼Œè‹¥$N=pâ€™qâ€™$ï¼Œè¿”å›1ï¼Œå¦åˆ™è¿”å›0.</li></ol><hr><div class="admonition warning"><p class="admonition-title">Definition Factoring hard</p><p>Factoring is hard è¿™ä¸€ç»“è®ºåŸºäºä»¥ä¸‹æ€§è´¨ï¼šå¯¹ä»»æ„PPT æ•Œæ‰‹$Pr[Factoring_{\mathcal{A,\mathbf{GenModulus}}}=1]\leq negl(n)$</p></div><h2 id="RSA-assumption">RSA assumption</h2><p>å®šä¹‰GenRSAå®éªŒï¼š</p><hr><p>äº‹å…ˆç»™å®šå®‰å…¨å‚æ•°nã€‚</p><ol><li>é¢„è¨€æœºç”Ÿæˆï¼ˆ$N,e,d$ï¼‰è¿”å›æ•Œæ‰‹$N,e,y$ï¼Œå…¶ä¸­$N=pq,gcd(e,\phi(N))=1,ed=1\quad mod \phi(N)$,yä¸ºå‡åŒ€é€‰æ‹©ã€‚</li><li>æ•Œæ‰‹è¿”å›xï¼Œè‹¥$x^e=y\quad mod N$ è¿”å›1ï¼Œå¦åˆ™è¿”å›0.</li></ol><hr><p>å®šä¹‰RSAæ˜¯å›°éš¾çš„ï¼Œç±»ä¼¼ä¸Šæ–¹Factoring å®šä¹‰æ–¹å¼ã€‚</p><p>RSAçš„ç»å…¸æ„é€ æ–¹å¼ï¼Œå°±ä¸ç”¨ç»†è®²äº†ç½¢ï¼‰ç½‘ä¸Šä¸€æœéƒ½æœ‰çš„ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒRSAç®—æ³•åŸºäºçš„å‡è®¾å¹¶ä¸æ˜¯â€œå¤§æ•´æ•°å› å¼åˆ†è§£æ˜¯å›°éš¾çš„â€ï¼Œå…¶åŸºäºçš„æ˜¯ä¸Šæ–¹çš„RSAé—®é¢˜ã€‚å³ä½¿ç°åŸºäºRSAçš„æ”»å‡»åŸºæœ¬ä¸Šéƒ½æ˜¯åŸºäºå¤§æ•´æ•°å› å¼åˆ†è§£ã€‚</p><p>å®é™…ä¸Šï¼ŒRSAçš„éš¾åº¦ä¸å¯èƒ½æ¯”Factoringæ›´éš¾ï¼Œä½†RSAé—®é¢˜çš„éš¾æ˜“ç¨‹åº¦æ˜¯å¦ç”±Factoringæ‰€å†³å®šï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒRSAé—®é¢˜å¯èƒ½å¯ä»¥åœ¨PPTå†…å®Œæˆï¼Œä½†Factoringåˆ™ä¸èƒ½ã€‚</p><hr><p>åŒæ—¶ï¼Œæ™®é€šæ•™æä¸Šçš„RSAå®é™…ä¸Šä¸å¤ªå¯èƒ½åœ¨å®é™…æ–¹æ¡ˆä¸­å‡ºç°ï¼Œå®é™…æ–¹æ¡ˆçš„RSAå·²ç»ç»è¿‡ä¿®æ”¹ï¼Œä½†ä»åŸºäºæœ€åŸºæœ¬çš„RSAç®—æ³•ã€‚</p><h2 id="Generators">Generators</h2><div class="admonition info"><p class="admonition-title">info</p><p>è‹¥Gä¸ºqé˜¶å¾ªç¯ç¾¤ï¼Œq&gt;1,å…¶ç”Ÿæˆå…ƒä¸ºgï¼Œé‚£ä¹ˆGä¸€å…±æœ‰$\phi(q)$ä¸ªç”Ÿæˆå…ƒã€‚</p></div><p>æ¨è®ºï¼šè‹¥Gä¸ºqé˜¶ç¾¤ï¼Œqä¸ºç´ æ•°ï¼Œé‚£ä¹ˆGä¸ºå¾ªç¯ç¾¤ï¼›åŒæ—¶ï¼Œé™¤äº†å•ä½å…ƒï¼Œä»»ä½•Gçš„å…ƒç´ éƒ½æ˜¯ç”Ÿæˆå…ƒã€‚</p><hr><p>è‹¥Gä¸ºqé˜¶ç¾¤ï¼Œqå¯ä»¥è¡¨ç¤ºä¸º $\prod p_i^{e_i}$ï¼Œåˆ™é€‰æ‹©$q_i=q/p_i$ï¼Œå½“ä¸”ä»…å½“$h\in G,h^{q_i}\neq 1$æ—¶hä¸ºGçš„ç”Ÿæˆå…ƒã€‚</p><h2 id="Discrete-logarithms">Discrete logarithms</h2><p>ç°é€‰æ‹©qé˜¶å¾ªç¯ç¾¤ï¼Œé‚£ä¹ˆå¯ä»¥å®šä¹‰DL problemï¼š</p><hr><p>DL problemï¼šç»™å®š$h=g^x$å»å¯»æ‰¾xã€‚</p><p>è®©$\mathcal{G}$ä¸ºç¾¤ç”Ÿæˆå™¨ï¼Œå…¶è¾“å…¥ä¸º$1^n$,è¾“å‡ºä¸€ä¸ªå¾ªç¯ç¾¤ $(G,q,g)$,å…¶ä¸­$|q|=n$ã€‚</p><p>åˆ™æœ‰ï¼š$DLOG_{\mathcal{A},\mathcal{G}}$:</p><ol><li>è¿è¡Œ $\mathcal{G}(1^n)$.</li><li>å‡åŒ€é€‰æ‹©å…ƒç´ $h\in G$</li><li>æ•Œæ‰‹è¢«ç»™å®šï¼š$G,q,g,h$å¹¶è¿”å›é¢„è¨€æœº$x\in \mathbb{Z}_q$</li><li>è‹¥$g^x=h$è¾“å‡º1ï¼Œå¦åˆ™è¿”å›0ã€‚</li></ol><hr><div class="admonition warning"><p class="admonition-title">Discrete-logarithm</p><p>å®šä¹‰ç¦»æ•£å¯¹æ•°é—®é¢˜æ˜¯éš¾çš„ï¼Œå…¶ä¾èµ–äºä¸Šè¿°å®éªŒå¯¹ä»»æ„PPTæ•Œæ‰‹ï¼š$$Pr[DLOG_{\mathcal{A},\mathcal{G}}=1]\leq negl(n)$$</p></div><p>åŸºäºDL problemï¼Œç°è®¨è®ºä»¥ä¸‹è¾ƒä¸ºå¼±çš„é—®é¢˜</p><h3 id="computational-Diffie-Hellman-CDH">computational Diffie-Hellman(CDH)</h3><p>è®©$DH_g(h_1,h_2)=g^{log_g(h_1)\cdot log_g(h_2)}$<br>è‹¥$h_1=g^{x_1},h_2=g^{x_2}$,é‚£ä¹ˆ$DH_g(h_1,h_2)=g^{x_1x_2}=h_1^{x_2}=h_2^{x_1}$</p><p>CDH problem: Given $G,q,g,h_1,h_2$ï¼Œè®¡ç®—  $DH_g(h_1,h_2)$</p><p>å…¶æ¦‚ç‡å®šä¹‰ç±»ä¼¼ä¸ŠèŠ‚ã€‚</p><h3 id="Decision-Diffie-Hellman-DDH">Decision Diffie-Hellman(DDH)</h3><p>ç»™å®š$(G,q,g)$å¹¶å‡åŒ€éšæœºé€‰æ‹©$h_1,h_2\in G$åŒºåˆ†$DH_g(h_1,h_2)$çš„ç»“æœå’Œéšæœºé€‰æ‹©çš„å…ƒç´ $hâ€™\in G$ã€</p><p>å…¶ç±»ä¼¼çš„å®šä¹‰ä¹Ÿæ˜¯ä¸Šæ–¹çš„æ¦‚ç‡å®šä¹‰ã€‚</p><hr><h3 id="conclusion">conclusion</h3><p>è‹¥èƒ½è§£å†³DHé—®é¢˜ï¼Œè‡ªç„¶ä¹Ÿèƒ½è§£å†³DDHå’ŒCDHé—®é¢˜ï¼ŒDDHæ˜¯æ¯”CDHæ›´å¼ºçš„å‡è®¾ï¼›ä½†ä¹Ÿæœ‰groupsæ»¡è¶³CDHæ›´éš¾ï¼ŒDDHæ˜¯ç®€å•çš„æ€§è´¨ã€‚</p><p>åœ¨å®é™…é—®é¢˜ä¸­ï¼Œç”±äºç´ æ•°é˜¶çš„ç¾¤ç”Ÿæˆå…ƒæ›´å®¹æ˜“æ‰¾åˆ°ï¼Œä¸”DL Problemçš„å¼ºåº¦æ˜¯æœ€é«˜çš„ï¼ŒåŒæ—¶è¿˜æœ‰å…¶ä»–çš„æ€§è´¨ï¼ˆè¿™é‡Œä¸è®¨è®ºï¼‰ï¼Œä¸€èˆ¬è€Œè¨€é€‰æ‹©ç´ æ•°é˜¶çš„ç¾¤ã€‚</p><h2 id="Elliptic-curves-æ¤­åœ†æ›²çº¿">Elliptic curves(æ¤­åœ†æ›²çº¿)</h2><p>è¿™é‡Œè¦å¼•å…¥åŸŸçš„æ¦‚å¿µã€‚å…³äºåŸŸï¼Œä¸€èˆ¬è€Œè¨€æ˜¯æ»¡è¶³ä¸¤ç±»è¿ç®—çš„ä»£æ•°ç»“æ„ï¼Œå…·ä½“å¯è§OI WIKIã€‚</p><p>åœ¨å¯†ç å­¦ä¸­ï¼Œä¸ºäº†è®©DLPæ›´éš¾ï¼Œéœ€è¦é€‰æ‹©å¤§ç´ æ•°é˜¶çš„ç¾¤ï¼ˆå­ç¾¤ï¼‰ã€‚è€Œå¯¹äºæ¤­åœ†æ›²çº¿ç¾¤çš„é˜¶ï¼Œåˆ™æœ‰ä»¥ä¸‹è®¨è®ºï¼š</p><p>å®šä¹‰äºŒæ¬¡å‰©ä½™(quadratic residue,QR),é€‰æ‹©$y\in \mathbb{Z}_p$ï¼Œå…¶ä¸ºæ¨¡pçš„äºŒæ¬¡å‰©ä½™æ—¶ï¼Œæ»¡è¶³ï¼š$\exists x\in \mathbb{Z}_p,x^2=y\quad mod p$.</p><p>å¯¹äºå¤§äº2çš„ç´ æ•°pã€‚æœ‰ä¸€åŠçš„$\mathbb{Z}_p$,ä¸”æ¯ä¸ªQRéƒ½æœ‰ä¸¤ä¸ªsquare rootsã€‚</p><p>emmmï¼Œå‰©ä¸‹çš„çœŸçœ‹ä¸æ‡‚äº†ï¼Œä¼¼ä¹æ˜¯æ„é€ äº†ä¸€ä¸ªç´ æ•°ç­‰å¼ï¼Œè‹¥æ»¡è¶³æœ‰è¯¥ç´ æ•°è¡¨è¾¾å¼çš„ç‚¹ï¼Œåˆ™æœ‰p+1ä¸ª point of infiniteï¼Ÿè€Œè¿™ä¸ªç­‰å¼ä¼¼ä¹å’Œæ„é€ äºŒæ¬¡å‰©ä½™çš„äº¤ç‚¹ä¸ªæ•°æœ‰å…³ï¼Ÿ</p><p>ç›´æ¥ä¸Šç»“è®ºäº†ã€‚</p><div class="admonition info"><p class="admonition-title">Hasse bound</p><p>pä¸ºç´ æ•°ï¼ŒEä¸º$\mathbb{Z}_p$çš„æ¤­åœ†æ›²çº¿ï¼Œåˆ™æœ‰ï¼š$$p+1-2\sqrt{p}\leq |E(\mathbb{Z}_p)|\leq p+1+2\sqrt{p}$$</p></div><p>é€‰æ‹©æ¤­åœ†æ›²çº¿æ˜¯ï¼Œä¸€èˆ¬è€Œè¨€æ˜¯éšæœºé€‰æ‹©ï¼Œå…¶ä¾¿å¯ä»¥æå…¶æ¥è¿‘â€œå‡åŒ€â€åˆ†å¸ƒåœ¨Hasse boundæ‰€ç¡®å®šçš„åŒºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¦æ’é™¤å¼±æ¤­åœ†æ›²çº¿ã€‚</p><p>é€šè¿‡æ¤­åœ†æ›²çº¿ï¼Œè¿˜å¯ä»¥å®šä¹‰æ¤­åœ†æ›²çº¿ä¸Šçš„DLP(ECDLP)ï¼Œç›¸å¯¹åº”çš„ä¹Ÿå¯ä»¥å®šä¹‰CDH,DDHã€‚</p><h3 id="Application">Application</h3><p>æˆ‘è§‰å¾—å¾ˆé‡è¦ï¼Œè¯´æ˜äº†ä¸€äº›æœ‰å…³æ¤­åœ†æ›²çº¿çš„æ”»å‡»ã€åé—¨ï¼Œä»¥åŠæ–°å‹åº”ç”¨ï¼Œä½†ä¸æƒ³ç¿»è¯‘ï¼Œç›´æ¥è´´åŸæ–‡äº†ã€‚</p><p>Although curves standardized decades ago are still widely used, there happened a lot in the last decades.<br>Starting with Kocherâ€™99, side-channel attacks and their couter-measures have become extremely sophisticated.<br>Decades of new research yielding faster, simpler and safer ways to do ECC.<br>Suspicion surrounding previous standards: snowden leaks, dual EC-DRBG backdoor, etc., lead to conjectured.weaknesses in the NIST curves.<br>Other specific classes of curves enable secure cryptographic pairings.<br>And thus interesting applications such as practical identity-and attribute-based cryptography.</p><hr><p>åŸºäºæ¤­åœ†æ›²çº¿çš„åŒçº¿æ€§æ˜ å°„ï¼Œè¿™é‡Œç•¥ã€‚</p><h2 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h2><p>ç¬‘æ­»ï¼ŒåŸPPTè¿™é‡Œæ˜¯æçŸ­çš„ï¼Œè€å¸ˆä¼¼ä¹ä¸¤èŠ‚è¯¾å°±ç»“æŸäº†ï¼Œä½†è¦ç†è§£è¿™äº›æ¦‚å¿µå¯¹äºåˆå­¦è€…è€Œè¨€è¿˜æ˜¯ä¸å¤ªå¤Ÿã€‚åªèƒ½çœ‹ä¹‹åè‡ªå·±èƒ½ä¸èƒ½è¡¥ä¸Šäº†ã€‚</p><p>ä¸‰åˆ·å¯†ç å­¦ï¼</p><p><img src="/images/paimon.png" alt="ä¸‰åˆ·å¯†ç å­¦ï¼"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> Number theory </tag>
            
            <tag> Public key </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…§ Practical Construction of symmetric key primitives</title>
      <link href="/2023/02/13/modern-cryptoviii-practical-construction-of-symmetric-key-primitives/"/>
      <url>/2023/02/13/modern-cryptoviii-practical-construction-of-symmetric-key-primitives/</url>
      
        <content type="html"><![CDATA[<p>æœ¬èŠ‚æ‰€æ¢è®¨çš„ä¸€ç³»åˆ—é—®é¢˜è®¸å¤šéƒ½æ˜¯åŸºäºå¯å‘å¼çš„ï¼Œä¹Ÿå°±æ˜¯æ— æ³•åŸºäºä»»ä½•è¾ƒå¼±çš„å‡è®¾è¯æ˜å®‰å…¨æ€§ã€‚ä½†è‹¥å‡è®¾æˆç«‹ï¼Œä¾‹å¦‚å¤§æ•´æ•°å› å¼åˆ†è§£ã€AESæ˜¯ä¼ªéšæœºæ’åˆ—ç­‰ï¼Œå¯ä»¥é€šè¿‡ç†è®ºè¯æ˜å’Œå®è·µè¯æ˜æ¥è¡¨æ˜å…¶å®‰å…¨æ€§ã€‚</p><p>å¦å¤–ï¼Œæœ¬èŠ‚ä¸è¿›è¡Œè¿‡å¤šçš„å¯¹åŠ å¯†æ–¹æ¡ˆç»†èŠ‚çš„æè¿°ã€‚</p><h2 id="Stream-cipher">Stream cipher</h2><h3 id="RC4">RC4</h3><p>è™½ç„¶åœ¨æ™®é€šçš„å¯†ç å­¦æ•™æä¸­ï¼Œæµå¯†ç ä¸€èˆ¬å…·æœ‰ä»£ç çŸ­ã€é€Ÿåº¦å¿«çš„ç‰¹ç‚¹ï¼Œå®é™…ä¸ŠRC4ä¹Ÿæ»¡è¶³è¿™ä¸ªæ€§è´¨ï¼›ä½†è¿‘å¹´æ¥å·²ç»è¯æ˜RC4æœ‰ç€å¯†ç å­¦æ„ä¹‰ä¸Šçš„ç¼ºé™·ï¼Œå®é™…ä¸­ä¸åº”è¯¥ç»§ç»­ä½¿ç”¨ã€‚</p><h3 id="Trivium">Trivium</h3><p>ï¼ˆç•¥ï¼‰</p><h3 id="ChaCha20">ChaCha20</h3><p>ChaCha20ä½œä¸ºæµå¯†ç ï¼Œå¯ä»¥å’ŒPoly1305è¿™ç§æ¶ˆæ¯è®¤è¯ç»„åˆæˆ AE schemeï¼Œå¹¶è¢«å¹¿æ³›ç”¨äºTLSã€‚</p><h2 id="Block-ciphers">Block ciphers</h2><p>å…¸ï¼Œåœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­å·²æœ‰éƒ¨åˆ†ä»‹ç»ã€‚è¿™é‡Œæ”¾ä¸€äº›ç›¸å…³æ•°æ®ç½¢ã€‚</p><p>n(åˆ†ç»„é•¿åº¦)ï¼Œk(å¯†é’¥é•¿åº¦)<br>$DES:n=64\quad bits,k=56\quad bits$<br>$AES:n=128\quad bits,k=128,192,256\quad bits$</p><h3 id="Iteration">Iteration</h3><p>è½®å‡½æ•°åœ¨DESä¸­ç”¨äºè¿­ä»£ç”Ÿæˆå¯†æ–‡ã€‚</p><table><thead><tr><th>åˆ†ç»„å¯†ç </th><th>è½®å‡½æ•°è¿­ä»£æ¬¡æ•°</th></tr></thead><tbody><tr><td>DES</td><td>16</td></tr><tr><td>AES-128</td><td>10</td></tr><tr><td>AES-192</td><td>12</td></tr><tr><td>AES-256</td><td>14</td></tr></tbody></table><h3 id="Designed-goals">Designed goals</h3><p>åˆ†ç»„å¯†ç åº”è¯¥è¡¨ç°ä¸ºä¼ªéšæœºæ’åˆ—ï¼Œå› æ­¤æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><ol><li>The number of permutation for n bits is $(2^n)!\approx n2^n$</li><li>Construct set of permutations with concise description(short key)</li><li>Similar to security property of PRP.</li></ol><p>(æ‡’ï¼Œéšä¾¿æŠ„äº†)</p><p>åˆ†ç»„å¯†ç çš„å®‰å…¨æ€§æ˜¯æœ€é‡è¦çš„ï¼Œè€Œåˆ¤æ–­å…¶çš„ä¾æ®æ˜¯ï¼šå…¶è¾“å‡ºæ— æ³•å’Œéšæœºæ’åˆ—è¾“å‡ºåŒºåˆ†å¼€ã€‚</p><p>å¦å¤–ï¼Œåˆ†ç»„å¯†ç è¿˜æœ‰ä¸€ä¸ªé‡è¦æ€§è´¨ï¼š<strong>æ”¹å˜è¾“å…¥çš„1bit ä¹Ÿèƒ½å½±å“æ‰€æœ‰è¾“å‡ºä½</strong>ã€‚ç¡®åˆ‡è€Œè¨€ï¼Œ1bitçš„å½±å“ä¸æ˜¯æ”¹å˜æ‰€æœ‰ä½ï¼Œè€Œæ˜¯å¤§è‡´ä¸Šè®©æ¯ä¸€ä½æœ‰ä¸€èˆ¬çš„æ¦‚ç‡è¢«æ”¹å˜ã€‚</p><p>é¦™å†œæå‡ºäº†æ··æ·†æ‰©æ•£èŒƒå¼ï¼ˆconfusion-diffusion paradigmï¼‰ï¼Œé€šè¿‡å¯†é’¥æ„å»ºæ’åˆ—ï¼Œå†é€šè¿‡è½®å‡½æ•°æ¥æ„å»ºç®€æ´ã€ä¼ªéšæœºçš„æ’åˆ—ã€‚</p><p>äºæ˜¯ï¼Œæœ‰ä¸¤ç§æ‰‹æ®µå»æ„é€ åˆ†ç»„å¯†ç ï¼šSubstitution Permutation Network å’ŒFeistel Network</p><h2 id="Substitution-Permutation-Network">Substitution Permutation Network</h2><p>ä¸ºäº†é˜æ˜å…·ä½“ç»†èŠ‚ï¼Œç°å‡è®¾block length=nï¼Œä»£æ¢å—é•¿åº¦ä¸ºLï¼Œäºæ˜¯ä¾¿æœ‰ä¸ªn/Lä»£æ¢å—ã€‚å…·ä½“å¦‚ä½•æ“ä½œè§ä¸‹ï¼š</p><hr><ol><li>key mixingï¼šè¾“å…¥$x=x\oplus k$ï¼Œå…¶ä¸­kæ˜¯è¯¥è½®æ¬¡çš„å­å¯†é’¥ã€‚</li><li>Substitutionï¼š $x=S_1(x_1)||â€¦||S_8(x_{n/L})$ï¼Œä½¿ç”¨S-boxè¿™ç§æ’åˆ—ç½®æ¢æ–¹å¼ã€‚</li><li>Permutation æ’åˆ—xçš„ä½æ¥è·å¾—è½®å‡½æ•°çš„è¾“å‡ºã€‚</li></ol><hr><p>æ¯ä¸€è½®çš„è¾“å‡ºéƒ½ä½œä¸ºä¸‹ä¸€è½®çš„è¾“å…¥ï¼Œæœ€åé€šè¿‡å¯†é’¥æ··åˆæ¥å¾—åˆ°æœ€åçš„è¾“å‡º.<br>S-boxå’Œmixing permutationæ˜¯å…¬å¼€çš„,å› æ­¤ï¼Œè‹¥æ²¡æœ‰key mixingï¼Œå‰©ä½™æ­¥éª¤éƒ½æ˜¯ç¡®å®šæ€§çš„ï¼Œæ— å¯†é’¥å‚ä¸ï¼Œä¹Ÿå› æ­¤ä¸æä¾›é¢å¤–çš„å®‰å…¨æ€§ã€‚</p><p>æ¯ä¸€è½®çš„å­å¯†é’¥éƒ½æ˜¯é€šè¿‡å®é™…å¯†é’¥(master key)key scheduleæ¥æ´¾ç”Ÿçš„ã€‚</p><p>å› æ­¤ï¼Œä¸€ä¸ªrè½®SPNæœ‰ rè½®key mixingç­‰æ­¥éª¤ï¼Œä½†æœ€åçš„å¯†é’¥æ··åˆå¯¼è‡´éœ€è¦(r+1)ä¸ªå­å¯†é’¥ã€‚</p><h3 id="avalanche-effect">avalanche effect</h3><p>æ”¹å˜è¾“å…¥çš„ä¸€ä½ä¼šå¯¼è‡´S boxä¸­è‡³å°‘ä¸¤ä½è¾“å‡ºçš„æ”¹å˜ã€‚</p><p>mixing permutationä¹Ÿä¿è¯ä»»ä½•ä¸€ä¸ªS boxçš„è¾“å‡ºéƒ½ä¼šä½œä¸ºä¸‹ä¸€è½®å¤šä¸ªS boxçš„è¾“å…¥ã€‚</p><p>ç”±æ­¤çš„å½±å“è¢«ç§°ä¸ºâ€œé›ªå´©æ•ˆåº”â€ã€‚</p><h2 id="Feistel-Network">Feistel Network</h2><p>å…·ä½“ç»†èŠ‚çš„å°±ã€‚ã€‚ä¸è®²äº†ï¼Œç½‘ä¸Šä¸€æœä¸€å¤§å †ã€‚è®²ç‚¹åˆ«çš„ã€‚</p><p>ä½†è¿˜æ˜¯è¦æœ‰åŸºæœ¬å½¢å¼ä¸æ˜¯ï¼Ÿ</p><p>åˆ†ç»„blockåˆ†ä¸ºå·¦å³ä¸¤å—ï¼šL,Rã€‚</p><p>$$L_i=R_{i-1}$$</p><p>$$R_i=L_{i-1}\oplus f_i(R_{i-1})$$</p><p>åœ¨è¯¥ç±»æ„é€ æ–¹å¼ä¸­ï¼Œå¤„ç†çš„å­å‡½æ•°$f_i$æ˜¯å…¬å¼€çš„ï¼Œä¸”æ¯ä¸€è½®çš„å­å¯†é’¥ä¹Ÿæ˜¯ä»ä¸»å¯†é’¥ä¸­æ´¾ç”Ÿè€Œæ¥ï¼Œä¸”æ˜¯ç§˜å¯†çš„ã€‚å› æ­¤ï¼Œä¸åƒFeistel Networkçš„ç»“æœæ˜¯å¯é€†çš„ï¼Œ$f_i$æ˜¯ä¸å¯é€†çš„ã€‚</p><div class="admonition info"><p class="admonition-title">Luby-Rackoff'85</p><p>è‹¥$f$ï¼ˆè¾“å…¥å¯†é’¥çš„å‡½æ•°ï¼‰æ˜¯å®‰å…¨çš„PRFï¼Œé‚£ä¹ˆ3è½®çš„Feistel Fä¾¿å¯ä¸ºä¸€ä¸ªå®‰å…¨çš„PRPã€‚</p></div><h2 id="DES">DES</h2><p>DESé‡‡ç”¨16è½®çš„Feistel Networkæ„é€ ï¼Œä½†å…¶å­å‡½æ•°$f_i(x)=F(k_i,x)$ï¼Œæ„é€ æ–¹å¼æ˜¯ç±»ä¼¼ Substitution permutation Networkçš„.</p><h3 id="S-boxes-and-P-boxes">S-boxes and P-boxes</h3><p>DESçš„æ„é€ æ–¹å¼å…·æœ‰S-boxeså’ŒP-boxesï¼ŒS-boxesçš„è¾“å‡ºæ˜¯â€œP-boxæ›¿æ¢â€çš„è¾“å…¥ã€‚P-boxeså°†æ¯ä¸€è¾“å…¥ä½éƒ½æ˜ å°„åˆ°ä¸€ä¸ªè¾“å‡ºä½ã€‚</p><p>è‹¥éšæœºé€‰å–S/P-boxï¼Œä¼šå¯¼è‡´åˆ†ç»„å¯†ç ä¸å®‰å…¨ã€‚å…¶åº”è¯¥å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><ol><li>ä»»ä½•è¾“å‡ºä½è¾“å‡ºåˆ†å¸ƒéƒ½ä¸åº”è¯¥æ¥è¿‘è¾“å…¥ä½çš„çº¿æ€§ç»„åˆï¼ˆå‡½æ•°ï¼‰</li><li>S boxesçš„æ¯4ä½è¾“å…¥éƒ½åº”è¯¥æ˜ å°„ä¸º1ä½è¾“å‡ºä½ã€‚</li><li>è‹¥ä½ æŸ¥è¿‡S-boxesçš„è¡¨æ ¼ï¼Œå¯ä»¥çœ‹åˆ°å…¶è¾“å‡ºæ˜¯æŒ‰ç…§2-4ä½çš„è¡¨æ ¼æ¥æ˜ å°„åˆ°4ä½è¾“å‡ºçš„ã€‚DESçš„S-boxè¦æ±‚è¡¨æ ¼ä¸­æ¯ä¸€è¡Œï¼ˆ2ä½å¯¹åº”çš„ä¸€è¡Œæˆ–ä¸€åˆ—ï¼‰çš„4 bits output stringéƒ½åº”è¯¥åªå‡ºç°ä¸€æ¬¡ã€‚</li><li>æ”¹å˜S boxè¾“å…¥çš„ä¸€ä½éƒ½ä¼šæ”¹å˜è¾“å‡ºçš„2ä½ã€‚</li></ol><h3 id="double-DES">double DES</h3><p>DESçš„56ä½å¯†é’¥è¿‡çŸ­ï¼Œä»è€Œå¯¼è‡´å¯ä»¥é€šè¿‡æš´åŠ›æœç´¢æ¥ç ´è§£ï¼Œäººä»¬è¯•å›¾é€šè¿‡åŠ é•¿å¯†é’¥é•¿åº¦ã€é‡å¤ä½¿ç”¨DESæ¥ä¿®å¤ï¼Œäºæ˜¯å°±æœ‰äº†ç†ŸçŸ¥çš„3 DESã€‚</p><p>double DES:$2E(k_1,E(k_2,m))$é‡‡ç”¨112 ä½å¯†é’¥ï¼Œçœ‹èµ·æ¥åº”è¯¥å®‰å…¨æ€§ç¿»å€ã€‚ä½†å®é™…ä¸Šï¼Œå…¶å¹¶æ²¡æœ‰åŠ å¼ºå¤šå°‘å®‰å…¨æ€§ã€‚</p><h4 id="meet-in-the-middle-attack">meet in the middle attack</h4><ol><li>å»ºè¡¨ï¼Œå¯¹ç¬¬ä¸€å±‚çš„åŠ å¯†å¯èƒ½ç»“æœ$E(k_i,M)$è¿›è¡Œç©·ä¸¾ï¼Œå¹¶é€šè¿‡å¯†é’¥æ¥æ’åºï¼Œæ—¶é—´å¤æ‚åº¦$O(2^{56}log(2^{56}))$</li><li>ç©·ä¸¾æœç´¢å¯†é’¥ç©ºé—´$k\in \{0,1\}^{56}$ï¼Œæ£€ç´¢$D(k,C)$æ˜¯å¦åœ¨è¡¨ä¸­ï¼Œæ£€ç´¢å¯ç”¨äºŒåˆ†ã€‚è‹¥æ‰¾åˆ°ï¼Œæœ‰ï¼š$D(k_i,M)=D(k,C)-&gt;(k_i,k)=(k_2,k_1)$</li></ol><p>æ€»æ—¶é—´å¤æ‚åº¦ä¸º$O(2^{56}log^{56})+O(2^{56}log^{56})=O(2^{63})&lt;&lt;2^{112}$ï¼Œè¿œè¿œè¾¾ä¸åˆ°é¢„æœŸå®‰å…¨æ€§ã€‚</p><h3 id="Triple-DES-3-DES">Triple DES(3 DES)</h3><p>æ„é€ æ–¹å¼ç±»ä¼¼ double DESï¼Œå…¶ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸Šç±»ä¼¼æ–¹æ³•æ¥æ”»ç ´ï¼Œè™½ç„¶ä¹Ÿè¾¾ä¸åˆ°é¢„æœŸçš„å®‰å…¨æ€§ï¼Œä½†å¤§è‡´éœ€è¦$O(2^{118})$æ‰èƒ½æ”»ç ´ï¼Œå› æ­¤ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚</p><p>ç„¶è€Œï¼Œå…¶3å€äºæ™®é€šDESçš„æ—¶é—´ï¼Œä»¥åŠè¢«æ—¥åçš„æœºå™¨æ”»ç ´çš„å¯èƒ½æ€§ï¼Œä¿ƒä½¿AESçš„è¯ç”Ÿã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…¦ Cryptographic Hash Functions</title>
      <link href="/2023/02/09/modern-cryptovii-cryptographic-hash-functions/"/>
      <url>/2023/02/09/modern-cryptovii-cryptographic-hash-functions/</url>
      
        <content type="html"><![CDATA[<p>è®¡ç®—æœºç§‘å­¦ä¸Šåˆ°å¤„éƒ½æ˜¯å“ˆå¸Œå‡½æ•°ï¼Œå¾—ç›Šäºå“ˆå¸Œå‡½æ•°å¯ä»¥ä½œä¸ºä¸€ç§â€œå‹ç¼©â€çš„æ–¹å¼ï¼Œè¿›è¡Œè¯¸å¦‚å“ˆå¸Œè¡¨çš„æ„å»ºã€‚å¯†ç å­¦ä¸Šçš„å“ˆå¸Œå‡½æ•°åˆ™è¦æ»¡è¶³æ›´å¤šçš„æ€§è´¨ã€‚</p><h2 id="Collision-resistance">Collision resistance</h2><p>å½¢å¼åŒ–ï¼š<br>å¯¹äº$H:\{0,1\}^m\rightarrow \{0,1\}^n,m\geq n$å¯¹ä»»ä½•çš„PPTç®—æ³•ï¼Œæ— æ³•æ‰¾åˆ°ä¸€ä¸ªç¢°æ’ï¼Œæˆ–è€…è¯´å¯¹ $x\neq xâ€™,H(x)\neq H(xâ€™)$,é‚£ä¹ˆè¯¥å‡½æ•°æŠ—ç¢°æ’ã€‚</p><p>$m&gt;n$ï¼Œåˆ™å“ˆå¸Œå‡½æ•°å¿…å®šä¼šäº§ç”Ÿç¢°æ’ã€‚åªæ˜¯å¯¹PPTæ•Œæ‰‹è€Œè¨€ï¼Œåªæœ‰æå°æ¦‚ç‡èƒ½å¤Ÿæ‰¾åˆ°ç¢°æ’ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå®šä¹‰çš„å“ˆå¸Œå‡½æ•°æ˜¯<strong>unkeyed</strong>çš„ï¼Œä¹Ÿå› æ­¤æ˜¯ç¡®å®šæ€§çš„ã€‚ç„¶è€Œï¼Œå®é™…è¿ç”¨ä¸­ï¼Œè‹¥è¦æ”»ç ´è¿™ä¸€å“ˆå¸Œå‡½æ•°ï¼Œä¾¿éœ€è¦å»æ‰¾åˆ°ä¸€å¯¹ç¢°æ’ï¼Œè€Œç¢°æ’çš„å¯»æ‰¾æ˜¯ååˆ†å›°éš¾çš„ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œçš„unkeyedåªæ˜¯æŒ‡$H(k,x)$ä¸­çš„kä¸ºå…¬å¼€å¸¸é‡ï¼Œè€Œééšæœºé€‰å®šçš„æ„æ€ã€‚</p><p>åœ¨å¯†ç å­¦ä¸­çš„è¯æ˜é‡Œï¼Œè‹¥ç»“æœä¾èµ–æŠ—ç¢°æ’æ€§ï¼Œå½¢å¼ä¸Šæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨keyedå“ˆå¸Œå‡½æ•°ï¼Œå®é™…ä¸Šé€šå¸¸ä½¿ç”¨unkeyedå“ˆå¸Œå‡½æ•°ï¼Œå¹¶ä¸”åŒæ ·èƒ½å¤Ÿæ»¡è¶³æŠ—ç¢°æ’ã€‚</p><h3 id="Definition">Definition</h3><div class="admonition warning"><p class="admonition-title">Definition: Hash Functions</p><p>A hash Function with output length $l$ is a pair of PPT algorithm (Gen,H) satisfying</p><ol><li>$s\leftarrow Gen(1^n),|s|\geq n$,ä½œä¸ºk,å¹¶ä¸ºæ‰€æœ‰äººå¯çŸ¥ã€‚</li><li>For a key s and $x\in\{0,1\}^*,H(s,x)$output a string in $\{0,1\}^{l(n)}$if the input x  is restricted to $|x|= l'(n),l'(n)\geq l(n)$ï¼ŒGenï¼ŒH)is a fixed-length hash Function.</li></ol></div><hr><p>collision-finding experiment</p><ol><li>ç”Ÿæˆå¯†é’¥sã€‚</li><li>æ•Œæ‰‹è¢«ç»™å®šå¯†é’¥$s$ï¼Œè¾“å‡ºä¿¡æ¯$x$ï¼Œ$xâ€™$ä¿è¯ä¸¤è€…é•¿åº¦ç›¸åŒå¹¶ç¬¦åˆä¸Šè¿°å®šä¹‰ã€‚</li><li>è‹¥$H(x)=H(xâ€™)$ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0.</li></ol><div class="admonition warning"><p class="admonition-title">Definition:collision resistant in orcacle</p><p>(Gen,H) is a collision resistant if for every PPT $\mathcal{A}$$$Pr_{s\leftarrow Gen(1^n)}[\mathcal{A}(s)\rightarrow(x\neq x')\land H(s,x)=H(s,x')]\leq negl(n)$$</p></div><hr><h3 id="weaker-notions-of-security">weaker notions of security</h3><ol><li>ç¬¬äºŒåŸè±¡æ€§(Second-preimage or target-collision resistance)ï¼šå¯¹äºç»™å®šçš„så’Œéšæœºçš„xï¼Œæ‰¾åˆ°$xâ€™\neq x,H(s,x)=H(s,xâ€™)$æ˜¯æå…¶å›°éš¾çš„ï¼Œ</li><li>å•å‘æ€§(Preimage resistance or one-wayness) ç»™å®šså’Œyï¼Œyæ˜¯$H(s,x)$çš„ç»“æœï¼Œæ‰¾åˆ°$xâ€™$ï¼ˆä¸ä¸€å®šéè¦$x\neq xâ€™$ï¼‰ï¼Œ$H(s,xâ€™)=y$</li></ol><p>è¿™æ˜¯åœ¨æ›´å¼±æ„ä¹‰ä¸Šçš„å®‰å…¨æ€§ã€‚æœ‰äº†collision-resistanceï¼Œè¿™ä¸¤ä¸ªæ€§è´¨ä¾¿éƒ½æœ‰äº†ã€‚è‹¥æ»¡è¶³è¿™ä¸¤ä¸ªå°æ€§è´¨ï¼Œä¾¿å¯ä»¥æ„é€ å‡ºå•å‘å‡½æ•°ã€‚</p><h2 id="Domain-extension-for-CRHFs">Domain extension for CRHFs</h2><p>å¦‚åŒå…ˆå‰ä¸€èˆ¬ï¼Œè¿™é‡Œä»‹ç»é€šè¿‡æ“ä½œæ¨¡å¼è¿›è¡Œæ‰©å±•ã€‚</p><div class="admonition warning"><p class="admonition-title">The Merkle Damgard transform</p><p>Chop input x with length $L=|x|$ into $B=\lceil \frac{L}{n}\rceil$,å¹¶åœ¨æœ€åä¸€å—æ·»åŠ 0ä»¥å¡«å……ã€‚$x_{B+1}=L$æœ‰ä»¥ä¸‹å½¢å¼åŒ–ï¼š$z_0=IV,z_i=h(z_{i-1},x_i)$$h_{B+1}=H(x)$</p></div><p>åœ¨è¿™é‡Œï¼Œç”±äºåŸæ¶ˆæ¯å¡«å……åæœ‰è¢«ç¢°æ’çš„å¯èƒ½ï¼Œä¾‹å¦‚111||000å’Œ1110||00å¡«å……åç›¸åŒï¼Œå› æ­¤æœ€åä¸€å—è®¾ä¸ºLç”¨äºé˜²ç¢°æ’ã€‚<br>è¿™ç§æ„é€ æ–¹å¼æ˜¯ååˆ†æ™®éçš„ã€‚åœ¨å®é™…çš„å“ˆå¸Œæ„é€ æ–¹æ¡ˆä¸­åŸºæœ¬éƒ½ç”¨åˆ°äº†è¯¥æ„é€ æ–¹å¼ï¼šMD5,SHA-1,SHA-2ã€‚</p><div class="admonition info"><p class="admonition-title">MD transform collision resistant</p><p>if $h$ is collision resistant, so is $H$.</p></div><p>å¯¹ä¸Šè¿°æ€§è´¨çš„è¯æ˜è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡åè¯æ³•ï¼Œè‹¥Hä¸æ»¡è¶³è¯¥æ€§è´¨ï¼Œåˆ™hä¹Ÿä¸æ»¡è¶³æŠ—ç¢°æ’ã€‚</p><p>é¡ºå¸¦ä¸€æï¼Œç‹å°äº‘é™¢å£«çš„ä¸€å¤§å·¥ä½œä¾¿æ˜¯æ‰¾åˆ°æ‚å‡‘(hash)å‡½æ•°çš„ç¢°æ’ï¼Œä¹Ÿå› å¥¹çš„å·¥ä½œï¼Œé‡‡ç”¨MD transformçš„MD5,SHA-1è¢«è¯æ˜æ˜¯ä¸å®‰å…¨çš„ã€‚å®é™…è¿ç”¨ä¸­ï¼Œæœ€å¥½é‡‡ç”¨SHA-2,æˆ–è€…ä¸æ˜¯MD transformå½¢å¼çš„SHA-3ç®—æ³•ã€‚</p><h2 id="Hash-and-MAC">Hash-and-MAC</h2><p>æœ‰äº†hashå‡½æ•°åï¼Œå¯¹<strong>ä»»æ„é•¿åº¦</strong>çš„æ˜æ–‡mè¿›è¡Œè®¤è¯ï¼Œå¯ä»¥é‡‡ç”¨â€œå…ˆå¯¹mè¿›è¡Œhashï¼Œå†å¯¹hashå€¼è¿›è¡Œmacè®¡ç®—â€ã€‚MACä¿è¯äº†æ”»å‡»è€…æ— æ³•å¯¹ä»»ä½•æ–°çš„å“ˆå¸Œå€¼è¿›è¡Œè®¤è¯ï¼Œè€ŒæŠ—ç¢°æ’ä½¿æ”»å‡»è€…æ— æ³•æ‰¾åˆ°å¯¹åº”çš„æ˜æ–‡ã€‚</p><hr><p>æ„é€ è®¤è¯æ–¹æ¡ˆï¼š<br>$\prodâ€™=(Genâ€™,Macâ€™,Vrfyâ€™)$<br>$Genâ€™(1^n)\rightarrow &lt;s(Gen_H(1^n)),k(Gen)&gt;$<br>$Mac_{&lt;s,k&gt;}'(m)=Mac_k(H^s(m))$<br>$Vrfy$æ»¡è¶³canonicalæ¡ä»¶ã€‚</p><hr><div class="admonition info"><p class="admonition-title">New Construct</p><p>è‹¥åŸ$\prod$æ˜¯å®‰å…¨çš„MACï¼Œä¸”$H$æ˜¯æŠ—ç¢°æ’çš„ï¼Œåˆ™$\prod'$å¯¹ä»»æ„é•¿åº¦çš„æ˜æ–‡éƒ½æ˜¯å®‰å…¨çš„MACæ–¹æ¡ˆã€‚</p></div><p>è¯æ˜è¿‡ç¨‹éœ€è¦ç”¨åˆ°å½’çº¦æ€§è¯æ˜ï¼Œè¯æ˜è‹¥æ•Œæ‰‹è¦æ”»ç ´æ„é€ çš„æ–¹æ¡ˆï¼Œè¦ä¹ˆæ”»ç ´MACè¦ä¹ˆæ‰¾åˆ°ç¢°æ’ã€‚</p><h3 id="using-Hash-functions-as-MACs">using Hash functions as MACs</h3><p>åœ¨è®¸å¤šåœºåˆä¸­ï¼Œäººä»¬ä¼šé”™è¯¯çš„ç›´æ¥æŠŠå¯†ç å­¦æ„ä¹‰ä¸Šçš„hashå‡½æ•°ç”¨äºè®¤è¯<s>è°ä¼šå»å­¦å¯†ç å­¦å•Š</s>,è¿™å®é™…ä¸Šæ˜¯ååˆ†å±é™©çš„ã€‚</p><p>$Naive$<s>y**ng</s> MACï¼š$Mac_k(m)=H(k||m)$</p><p>ä½†ç”¨hashå‡½æ•°æ„é€ MACæ˜¯å¯è¡Œçš„ï¼š</p><p>$Nested$ MACï¼ˆä¸¤å¯†é’¥ï¼‰ï¼Œè‹¥é‡‡ç”¨çš„å“ˆå¸Œå‡½æ•°æ˜¯PRFï¼Œåˆ™NMACä¹Ÿæ˜¯PRFï¼Œä»è€Œå°±æ˜¯MACã€‚</p><p>é¡ºå¸¦ä¸€æï¼ŒNMACåŸè®ºæ–‡çš„hå“ˆå¸Œå‡½æ•°é»˜è®¤ç›´æ¥å¸¦æœ‰PRFå±æ€§ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨äº†ï¼›ä½†ä¸€èˆ¬è€Œè¨€ï¼Œhåªæ˜¯å…·æœ‰æŠ—ç¢°æ’æ€§è´¨çš„å“ˆå¸Œå‡½æ•°ã€‚<br>ç„¶è€Œï¼Œç°ä»£çš„å“ˆå¸Œå‡½æ•°åŸºæœ¬éƒ½æ˜ç¡®è¦æ±‚å…·æœ‰PRFå±æ€§ï¼Œæ‰€ä»¥æ­ªæ‰“æ­£ç€ï¼ŒNMACä¹Ÿèƒ½å¤Ÿä¿è¯å®‰å…¨æ€§ã€‚</p><p>HMACåˆ™æ˜¯è¾ƒä¸ºè‘—åçš„ä¸€ä¸ªæ–¹æ¡ˆäº†ã€‚å®ƒå¯ä»¥ç”¨äºä»»æ„é•¿åº¦çš„æ¶ˆæ¯ï¼Œå¹¶ç”¨ä»»æ„çš„å“ˆå¸Œå‡½æ•°æ„é€ ï¼Œè¾ƒNMACæ›´åŠ å®ç”¨ã€‚</p><p>åœ¨HMACä¹‹å‰ï¼Œè®¸å¤šäººä¸å–œæ¬¢ç”¨CBC-MACï¼ˆå¤ªæ…¢ï¼‰è€Œè‡ªå·±æ„é€ MACï¼Œä¸èƒ½ä¸è¯´æ˜¯ä¸€ç§å®‰å…¨æ€§ç¼ºå¤±ã€‚HMACå¡«è¡¥äº†è¿™ä¸€æ¼æ´ã€‚</p><h2 id="Generic-attacks-on-hash-Functions">Generic attacks on hash Functions</h2><h3 id="Birthday-bound">Birthday bound</h3><p>çœ‹ä¸Šå»ï¼Œå¯¹äºå“ˆå¸Œå‡½æ•°çš„æ”»å‡»æ˜¯ååˆ†å›°éš¾çš„,æœ€åæƒ…å†µä¸‹è¦å¯¹æ‰€æœ‰çš„å¯èƒ½è¿›è¡Œè›®åŠ›éå†æ‰èƒ½å¾—åˆ°ä¸€å¯¹ç¢°æ’ã€‚ç„¶è€Œï¼Œ<strong>ç”Ÿæ—¥æ‚–è®º</strong>ä½¿æ”»å‡»å¯èƒ½å¤§å¤§å¢å¼ºï¼š</p><div class="admonition info"><p class="admonition-title">Birthday bound</p><p>è‹¥æœ‰qä¸ªç‹¬ç«‹å‡åŒ€éšæœºé€‰å–çš„å…ƒç´ ä»é›†åˆSä¸­é€‰å–ï¼Œ$|S|=N$ï¼Œåˆ™æœ‰ï¼š$$\frac{q(q-1)}{4N}\leq Pr[\exists i\neq j,y_i=y_j]\leq\frac{q^2}{2N}$$å¯¹äºä¸å‡åŒ€çš„é€‰å–ï¼Œç¬¬ä¸€ä¸ªä¸ç­‰å¼æˆç«‹ã€‚</p></div><p>å› æ­¤ï¼Œè¦ä¿è¯å¯¹äºq(n)é—®è¯¢çš„æ•Œæ‰‹ï¼Œ$q(n)^2/2^\ell&lt;&lt;1$ï¼Œå³$\ell&gt;2log(q(n))$</p><h3 id="meaningful-collisions">meaningful collisions</h3><p>ç”±äºæœ‰æ„ä¹‰çš„å¥å­é‡Œæœ‰è®¸å¤šå›ºå®šæ ¼å¼ï¼Œç†è®ºä¸Šè€Œè¨€ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´è¾ƒå°‘æ•°é‡çš„è¯æ¥è¾¾åˆ°ç¼©å°æœç´¢ç©ºé—´ï¼Œä»è€Œä½¿æ”»å‡»æ›´åŠ å®¹æ˜“æˆç«‹ã€‚</p><h3 id="Small-space-birthday-attacks">Small space birthday attacks</h3><p>ç›¸æ¯”æ™®é€šç”Ÿæ—¥æ”»å‡»ï¼Œè¯¥æ–¹æ³•é€šè¿‡ä¸¤å€çš„æŸ¥è¯¢æ¥æ¢å–å­˜å‚¨ç©ºé—´çš„$O(1)$å¤æ‚åº¦ã€‚</p><h2 id="Applications">Applications</h2><h3 id="random-oracle-model-éšæœºé¢„è¨€æœº">random oracle model(éšæœºé¢„è¨€æœº)</h3><p>æœ‰å‡ ç§åŸºäºå¯†ç å­¦ä¸Šçš„å“ˆå¸Œå‡½æ•°çš„æ„é€ æ–¹æ¡ˆï¼Œå•å‡­å“ˆå¸Œå‡½æ•°çš„æŠ—ç¢°æ’ã€å•å‘æ€§æ˜¯æ— æ³•å®Œæˆå®‰å…¨çš„ã€‚<br>å¯¹æ­¤ï¼Œå¦‚æœæƒ³è¦é‡æ–°å¯»æ‰¾åŸºäºåº•å±‚å“ˆå¸Œå‡½æ•°çš„å¯è¯æ˜å®‰å…¨æ–¹æ¡ˆï¼Œé‚£ä¹ˆæ‰¾åˆ°è¿™ç±»æ–¹æ¡ˆå‰ä¾¿æ— æ³•ä½¿ç”¨ï¼›è€Œå¦‚æœä½¿ç”¨ç°æœ‰çš„å¯†ç ç³»ç»Ÿï¼Œé™¤äº†è®¾è®¡è€…è¯•å›¾æ”»å‡»æœªæœè¿™ä¸€äº‹å®å¤–æ²¡æœ‰ä»»ä½•ç†ç”±è¯æ˜å…¶å®‰å…¨æ€§ï¼Œè¿™æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p>äºæ˜¯ï¼Œä¾¿æœ‰ä¸€ç§çœ‹èµ·æ¥â€œå–å·§â€çš„æ–¹æ¡ˆï¼Œåœ¨ä¸¥æ ¼çš„å¯è¯æ˜å®‰å…¨å’Œæ²¡æœ‰ä»»ä½•è¯æ˜ä¸­çš„ä¸€ç§æ–¹æ³•ï¼šå¼•å…¥ä¸€ä¸ªç†æƒ³åŒ–çš„æ¨¡å‹æ¥è¯æ˜å¯†ç çš„å®‰å…¨æ€§ï¼Œè€Œè¿™å°±æ˜¯<strong>éšæœºé¢„è¨€æœº</strong>ã€‚</p><p><s>æœ‰è¯æ˜æ€»æ¯”æ²¡æœ‰å¥½å¯¹å§</s></p><p>éšæœºé¢„è¨€æœºçš„å®šä¹‰ï¼šå‡è®¾ä¸€ä¸ªéšæœºå‡½æ•°$H:\{0,1\}^*\rightarrow\{0,1\}^n$ï¼Œå…¶åªèƒ½å¤Ÿè¢«ä»»ä½•äºº<strong>æŸ¥è¯¢</strong>è®¡ç®—ï¼Œå³è¾“å…¥$x$è¿”å›$H(x)$ã€‚</p><p>ç”¨å¦ä¸€ç§æ›´åŠ ç„ä¹çš„è¯æ¥è¯´ï¼Œåœ¨ä½ ç»™å®šè¾“å…¥å‰ï¼Œéšæœºé¢„è¨€æœºçœ‹èµ·æ¥åƒæ˜¯å®Œå…¨å‡åŒ€éšæœºçš„å‡½æ•°(é»‘ç›’å•Šå—¯)ï¼ŒåŸæ–‡ç”šè‡³å°†éšæœºé¢„è¨€æœºæ¯”ä½œâ€œin the skyâ€,ä½†ä½ æœå¤©ç©ºå–Šä¸€å¥$x$ï¼Œå®ƒå°±ä¼šç»™ä½ ç¡®å®šçš„å›åº”$H(x)$,å¹¶ä¸”$H(x)$ç¡®å®šä¸‹æ¥ï¼Œæ— è®ºä½ åé¢æ€ä¹ˆè¾“å…¥ç»™å®šçš„$x$ï¼Œ$H(x)$éƒ½æ˜¯å”¯ä¸€çš„å›åº”ã€‚</p><p><s>ä»€ä¹ˆbæ¯”å–»</s></p><p>åœ¨æ„é€ æ–¹æ¡ˆæ—¶ï¼Œè¯æ˜ä½¿ç”¨<strong>RO</strong>(éšæœºé¢„è¨€æœº),è€Œå®é™…æ„å»ºæ–¹æ¡ˆæ—¶ï¼ŒROç”¨å¯†ç å­¦æ„ä¹‰ä¸Šçš„å“ˆå¸Œå‡½æ•°å®ä¾‹åŒ–ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ç§å¯å‘å¼çš„è¯æ˜ï¼Œä½†åœ¨å®é™…å‡ºä¹æ„æ–™çš„å¥½ç”¨ã€‚</p><p>å¦å¤–ï¼Œéšæœºé¢„è¨€æœºæ»¡è¶³â€œå¯ç¼–ç¨‹æ€§â€ï¼Œåœ¨å½’çº¦æ€§è¯æ˜ä¸­å¯ä»¥é€‰å®šå‡åŒ€çš„è¾“å‡ºå€¼ã€‚</p><h4 id="pseudorandom-generator">pseudorandom generator</h4><p>è®¾éšæœºé¢„è¨€æœº$H=\{0,1\}^{n/2}\rightarrow \{0,1\}^n$<br>åˆ™æœ‰$Pr_{y\leftarrow \{0,1\}^n}[\mathcal{A}^{H(\cdot)}(y)=1]-Pr_{x\leftarrow \{0,1\}^{n/2} }[\mathcal{A}^{H(\cdot) }(H(x))=1]=negl(n)$</p><p>åˆ™Hä¾¿æ˜¯PRGã€‚</p><h4 id="pseudorandom-Function">pseudorandom Function</h4><p>$H=\{0,1\}^{2n}\rightarrow\{0,1\}^n$<br>$F_k(x)=H(k||x)$</p><p>åˆ™Fä¾¿æ˜¯PRFã€‚</p><h4 id="Collision-resistant-Hash-Function">Collision resistant Hash Function</h4><p>$H=\{0,1\}^*\rightarrow\{0,1\}^n$</p><p>å…¶æœ¬èº«ä¾¿å¯ä½œä¸ºæŠ—ç¢°æ’çš„å“ˆå¸Œå‡½æ•°å®ä¾‹åŒ–ã€‚</p><p>ä»¥ä¸Šæ‰€æœ‰çš„æ„é€ éƒ½ç”¨åˆ°äº†H(x)æ˜¯uniformçš„æ€§è´¨ï¼Œä½†æ²¡æœ‰å¯ç¼–ç¨‹æ€§ã€‚</p><div class="admonition missing"><p class="admonition-title">RO</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒROçš„ä½¿ç”¨ç›´è‡³ç°åœ¨éƒ½å­˜åœ¨ç€äº‰è®®ï¼Œæœ‰äººè®¤ä¸ºå®ƒå¹¶ä¸èƒ½ä»£è¡¨å®Œå…¨çš„å®‰å…¨ï¼Œä¹Ÿæœ‰äººè®¤ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰å®Œå…¨äº†è§£ROçš„æ€§è´¨ï¼Œå¯èƒ½ä¼šæœ‰éšè—çš„é—®é¢˜ã€‚</p></div><h3 id="Fingerprinting-and-deduplication">Fingerprinting and deduplication</h3><p>å“ˆå¸Œå‡½æ•°å¯ç”¨äºç—…æ¯’æ£€æµ‹ï¼Œå¦å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº‘å­˜å‚¨ç­‰ã€‚</p><h4 id="Merkle-tree">Merkle tree</h4><p>ä¸Šæ–‡æåˆ°å“ˆå¸Œå¯ä»¥ç”¨äºäº‘å­˜å‚¨ã€‚ç”¨æˆ·åªè¦ä¿å­˜äº†å“ˆå¸Œå€¼ï¼Œä¾¿å¯ä»¥é€šè¿‡å“ˆå¸Œå€¼æ¥æŸ¥è¯¢å¾—åˆ°å¯¹åº”çš„äº‘æ–‡ä»¶ï¼Œä»è€Œå¯¹æ–‡ä»¶è¿›è¡Œä¸‹è½½éªŒè¯ç­‰æ“ä½œã€‚è‹¥è¦é«˜æ•ˆè¿›è¡Œï¼Œå¯ä»¥é‡‡ç”¨Merkle treeè¿™ç§æ•°æ®ç»“æ„ã€‚</p><p>å…¶æ„é€ æ–¹æ³•é€šä¿—è€Œè¨€ï¼ŒMerkle treeé™¤äº†å¶å­èŠ‚ç‚¹çš„tagæ˜¯å¯¹æ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œå…¶ä½™èŠ‚ç‚¹çš„tagéƒ½æ˜¯å¯¹å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ã€‚</p><div class="admonition info"><p class="admonition-title">Merkle tree</p><p>è‹¥å…¶åº•å±‚çš„å“ˆå¸Œå‡½æ•°æ˜¯æŠ—ç¢°æ’çš„ï¼Œé‚£ä¹ˆå…·æœ‰å›ºå®šæ–‡ä»¶æ•°é‡çš„Merkle Treeä¹Ÿæ˜¯æŠ—ç¢°æ’çš„ã€‚</p></div><p>å®¢æˆ·ç«¯å­˜å‚¨æ ¹èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼Œè€ŒæœåŠ¡å™¨ç»´æŠ¤Merkle Treeä»¥åŠæ–‡ä»¶ã€‚è‹¥å®¢æˆ·ç«¯éœ€è¦å¯¹åº”çš„æ–‡ä»¶ï¼ŒæœåŠ¡å™¨å¯ä»¥å°†æ–‡ä»¶å’Œå…¶Merkle Treeè·¯å¾„å¤–çš„å…¶ä»–å­èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å“ˆå¸Œå€¼(ç©ºé—´å¤æ‚åº¦$O(log(n))$å‘å‘å®¢æˆ·ç«¯ï¼Œä»¥è®©å®¢æˆ·ç«¯éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ã€‚</p><h3 id="MAC-and-Hash-for-message-authentication">MAC and Hash for message authentication</h3><p>MACå’ŒHashéƒ½å¯ä»¥ç”¨äºè®¤è¯ï¼ŒåŒºåˆ«ä¸ºï¼š</p><p>MACè¦æ±‚é€šä¿¡åŒæ–¹åœ¨é€šä¿¡å‰å…±äº«å¯†é’¥ï¼Œè€Œå“ˆå¸Œå‡½æ•°è™½ç„¶ä¸ç”¨å¯†é’¥çš„å­˜å‚¨ï¼Œä½†è¦æ±‚èƒ½å¤Ÿå®‰å…¨å­˜å‚¨å“ˆå¸Œå€¼ã€‚</p><h3 id="basic-password-protocol">basic password protocol</h3><p><s>è°çš„å¯†ç æ˜æ–‡å­˜å‚¨å•Šï¼Ÿ</s></p><p><s>å“¦ï¼ŒCSDNå•Šï¼Œæ²¡äº‹äº†</s></p><p>æ„Ÿè§‰ç°å®ä¸­å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œæ“ä½œå·²ç»æ˜¯ç¨€æ¾å¹³å¸¸äº†ã€‚å…·æœ‰æŠ—ç¢°æ’æ€§çš„å“ˆå¸Œå°±æ˜¯å¥½ç”¨ã€‚</p><p>ç„¶è€Œï¼Œç”±äºè®¸å¤šäººé‡‡ç”¨å¼±å¯†ç ï¼Œå¯ä»¥ç”¨åœ¨çº¿å­—å…¸æ”»å‡»(æ”»å‡»è€…å¯¹ç”¨æˆ·æ¸…å•ç»Ÿä¸€å°è¯•è¾ƒå°‘å¯†ç )ï¼Œä¹Ÿå¯ä»¥ç¦»çº¿å­—å…¸æ”»å‡»(æš´åŠ›æŸ¥æ‰¾H(w)=storaged password).<br>è€Œbatchç¦»çº¿å­—å…¸æ”»å‡»åˆ™å‡è®¾æ•Œæ‰‹è·å–ä¸€æ•´ä¸ªå­˜å‚¨å¯†ç çš„æ–‡ä»¶$F$ï¼Œç”¨äº‹å…ˆå‡†å¤‡çš„å­—å…¸é›†åˆ$Dict$å¯¹å…¶è¿›è¡Œç¦»çº¿å­—å…¸æ”»å‡»ï¼Œè¿™ç§æ–¹å¼æ›´å®¹æ˜“æ”»ç ´å…¶å¯†ç ,æ—¶é—´å¤æ‚åº¦ä¸º$|Dict|+|F|$</p><p>äºæ˜¯å°±æœ‰äº†public saltï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„<strong>åŠ ç›</strong>ï¼Œå³ä½¿åœ¨å¯†ç æ–‡ä»¶ä¸­å…¬å¼€å­˜å‚¨ç›å€¼ï¼Œä¹Ÿå¯ä»¥ä¿è¯å…¶æ—¶é—´å¤æ‚åº¦å¤§å¹…ä¸Šå‡ï¼Œæ”»å‡»è€…å¿…é¡»éå†å¯†ç æ–‡ä»¶æ‰èƒ½å®Œæˆä¸€æ¬¡æ”»å‡»å°è¯•ï¼Œäºæ˜¯æ—¶é—´å¤æ‚åº¦ä¸º$O(|Dict|\times|F|)$</p><hr><p>å›åˆ°å¯¹äºå¯†ç çš„å“ˆå¸Œï¼šå¦‚æœå“ˆå¸Œå‡½æ•°ï¼Œä¾‹å¦‚SHA1æ‰§è¡Œè¿‡å¿«ï¼Œä¹Ÿå°±æ˜¯å•æ­¥æ‰§è¡Œè¿‡å¿«ï¼Œè®¡ç®—æœºä¹Ÿèƒ½åœ¨å¯æ¥å—çš„æ—¶é—´å†…å®Œæˆè®¡ç®—ã€‚</p><p>äºæ˜¯å°±æœ‰â€œæ…¢â€å“ˆå¸Œå‡½æ•°ï¼Œæˆ–è€…å¤šæ¬¡åº”ç”¨å“ˆå¸Œå‡½æ•°æ¥å‡æ…¢é€Ÿåº¦ï¼›æˆ–è€…å¦‚ä¹‹å‰å·²ç»å™è¿°è¿‡çš„â€œåŠ ç›â€ï¼ŒæŠ‘æˆ–æ˜¯æœåŠ¡å™¨è¾…åŠ©çš„æ–¹æ³•ï¼ˆå¯†ç å­¦è€å¸ˆä¼¼ä¹å°±æ˜¯æè¿™æ–¹å‘çš„ï¼Œè¿˜æäº†ä¸¤ç¯‡è‡ªå·±çš„è®ºæ–‡æ”¾åœ¨PPTï¼Œä¹ï¼‰ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> hash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…¥ CCA-Securityï¼†Authenticated Encryption</title>
      <link href="/2023/02/05/modern-cryptovi-cca-security-authenticated-encryption/"/>
      <url>/2023/02/05/modern-cryptovi-cca-security-authenticated-encryption/</url>
      
        <content type="html"><![CDATA[<h2 id="Chosen-ciphertext-attacks-CCA">Chosen ciphertext attacks(CCA)</h2><p>æœ¬ç« ä¹‹å‰æ‰€è®¨è®ºçš„éƒ½æ˜¯CPAã€EAVç­‰æ•Œæ‰‹ã€‚è€ŒCCAç›¸æ¯”CPAè€Œè¨€ï¼Œä¸ä»…èƒ½å¤Ÿè®¿é—®$Enc_korcale$,ä¹Ÿå¯ä»¥è®¿é—®$Dec_korcale$.</p><h3 id="Padding-orcale-attacks">Padding-orcale attacks</h3><p>æ¯”å¦‚ï¼ŒCBCæ¨¡å¼ä¸‹ï¼Œæ˜æ–‡é•¿åº¦å¿…ä¸ºåˆ†ç»„é•¿åº¦çš„å€æ•°ã€‚å› æ­¤ï¼Œä¾¿éœ€è¦æ‰©å……ã€‚å‡è®¾åˆ†ç»„é•¿åº¦16bytesã€‚<br>$b=16-(|m|mod 16)$<br>åˆ™åœ¨æ˜æ–‡åå¡«å……bä¸ªå€¼ï¼šbã€‚æ¯”å¦‚HelloWorld666666.è‹¥b=0ï¼Œå¡«å……16ä¸ª0.</p><p>$Dec_k(\cdot)$çš„è®¿é—®å¯¼è‡´äº†å¯ä»¥é€šè¿‡å¯¹CBCæ¨¡å¼çš„å¯†æ–‡æ›¿æ¢å­¦ä¹ åˆ°bçš„å€¼æ˜¯ä»€ä¹ˆï¼Œä»è€Œå¾—å‡ºæ›´å¤šçš„ä¿¡æ¯ã€‚</p><h3 id="CCA-Definition">CCA Definition</h3><p>è¿˜æ˜¯é‡‡å–é¢„è¨€æœºå®šä¹‰ã€‚äº‹å‰æ•Œæ‰‹å’Œé¢„è¨€æœºç»™å®šå®‰å…¨å‚æ•°$n\in N$</p><ol><li>é¢„è¨€æœºç”Ÿæˆå¯†é’¥$k\leftarrow Gen(1^n)$å’Œéšæœºé€‰å–çš„$b\leftarrow\{0,1\}$</li><li>æ•Œæ‰‹æ—¢å¯ä»¥å‘é€æ˜æ–‡$m\in\{0,1\}â€™$ï¼Œé¢„è¨€æœºè¿”å›$Enc_k( m)$ï¼›ä¹Ÿå¯ä»¥å‘é€å¯†æ–‡$c\in\{0,1\}â€™$,é¢„è¨€æœºè¿”å›$Dec_k( c)$.å¯ä¸æ–­è¿›è¡Œã€‚</li><li>æœ€åï¼Œå‘é€æ˜æ–‡$m_0,m_1\in \{0,1\}â€™,|m_0|=|m_1|$ï¼Œé¢„è¨€æœºè¿”å›$câ€™=Enc_k(m_b)$ï¼Œå…¶ä¸å¯ä»¥è¢«è§£å¯†é¢„è¨€æœºè§£å¯†ã€‚</li></ol><p>å…¶å…·ä½“çš„CCAä¸‹ä¸å¯åŒºåˆ†æ€§ï¼Œæˆ–è€…è¯´CCA-Secureçš„æ¦‚ç‡æ€§å®šä¹‰å’Œä¹‹å‰ä¸€æ ·ã€‚</p><div class="admonition info"><p class="admonition-title">Is CCA-secure unnecessarily strong?</p><p>Since we donâ€™t know what information an attacker might be able to learn when a ciphertext it sends is decrypted by a receiver, in reality we make the worst-case assumption that the attacker learns everything, where the adversary is stronger than whom in padding-oracle attack.</p></div><h2 id="CCA-schemes">CCA schemes</h2><p>åˆ°å¦‚ä»Šï¼Œæˆ‘ä»¬æ²¡æœ‰æ„é€ å‡ºä»»ä½•ä¸€ä¸ªCCA secureçš„åŠ å¯†æ–¹æ¡ˆã€‚</p><p>æ®ä¸ªä¾‹å­ã€‚æœ€ç®€å•çš„ä¸€ä¸ªschemeï¼š$Enc_k(m)=&lt;r,F_k( r)\oplus m&gt;$<br>é‚£ä¹ˆï¼Œåœ¨ä¸Šé¢çš„CCAå®šä¹‰ä¸­æœ€åä¸€æ¡ä¸­ï¼Œæ•Œæ‰‹ä¼šæ”¶åˆ°é¢„è¨€æœºçš„å›åº”ï¼š$&lt;r,s=F_k( r)\oplus m_b&gt;$ï¼Œåˆ™ä»–å¯ä»¥éšæœºé€‰å–ä¸€ä¸ªxï¼Œè®¿é—®Decé¢„è¨€æœºï¼š$s\oplus x\oplus F_k( r)=Dec_k(&lt;r,s\oplus x&gt;)$<br>ä»è€Œå­¦ä¹ åˆ°$m_b\oplus x$.</p><p>CCA Security éœ€è¦ä¸å¯å»¶å±•æ€§:$ non-malleability$.è¿™ç§æ€§è´¨å¯¼è‡´ï¼Œè‹¥æ•Œæ‰‹å¯¹ç»™å®šçš„å¯†æ–‡è¿›è¡Œä»»ä½•ä¿®é¥°ã€‚å®ƒè§£å¯†å‡ºæ¥çš„æ˜æ–‡ä¸åº”è¯¥å’ŒåŸæ˜æ–‡æœ‰ä»»ä½•è”ç³»ã€‚</p><h3 id="unforgeable-encryption">unforgeable encryption</h3><p>é¦–å…ˆå…ˆè¯•å›¾æŠŠSecrecyå’Œauthenticatedåˆèµ·æ¥ã€‚</p><hr><p>é¢„è¨€æœºå®šä¹‰unforgeableï¼š<br>ï¼ˆç®€ç•¥å†™äº†ï¼‰</p><p>äº‹å…ˆç»™å®šå®‰å…¨å‚æ•°nã€‚</p><ol><li>é¢„è¨€æœºç”Ÿæˆkã€‚</li><li>æ•Œæ‰‹å‘é€$m\in\{0,1\}^*$,é¢„è¨€æœºç»´æŠ¤$G\cup=m$,è¿”å›$Enc_k(m)$</li><li>ä¸æ–­è¿›è¡Œç¬¬äºŒæ­¥ï¼Œæœ€åæ•Œæ‰‹å‘é€$c\in \{0,1\}^*$,é¢„è¨€æœºè§£å¯†$mâ€™=Dec_k( c)$ï¼Œè‹¥$(mâ€™\neq \bot)\land(mâ€™\notin G)$è¿”å›1ï¼Œå¦åˆ™è¿”å›0.</li></ol><p>å…¶ä¸­çš„å‚ç›´ç¬¦å·è¡¨ç¤ºinvalidã€‚</p><hr><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…³äºunforgeability for encryptionï¼Œä»å¼±åˆ°å¼ºå…±ä¸‰é˜¶ï¼š</p><ol><li>Random Plaintext Unforgeability</li><li>Chosen Plaintext Unforgeability.</li><li>Existential Unforgeability.</li></ol><p>è¿™é‡Œé‡‡ç”¨æœ€å¼ºçš„ç¬¬ä¸‰ç§ã€‚</p><div class="admonition warning"><p class="admonition-title">Definition</p><p>è¯¥æ–¹æ¡ˆè‹¥æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼Œå¯¹ä»»ä½•çš„PPTæ•Œæ‰‹$\mathcal{A}$ï¼Œéƒ½æ˜¯unforgeableçš„ï¼š$$Pr[Enc-Forge_{\mathcal{A},\prod}(n)=1]\leq negl(n)$$</p></div><div class="admonition warning"><p class="admonition-title">Definition AE(1)</p><p>A private-key encryption schemes is an Authenticated Encryption scheme if it is CCA-secure and unforgeable.</p></div><h2 id="Authenticated-Encryption-AE-Definition">Authenticated Encryption(AE) Definition</h2><p>é¢„è¨€æœºå®šä¹‰AEï¼š</p><p>äº‹å…ˆç»™å®šnã€‚</p><ol><li>é¢„è¨€æœºç”Ÿæˆkï¼Œbã€‚</li><li>æ•Œæ‰‹å¯è®¿é—®ä¸¤ç§é¢„è¨€æœºï¼š<br>(1) å¦‚æœb=0ï¼Œè®¿é—®$Enc_k(m),Dec_k(m)$.<br>(2) å¦‚æœb=1,è®¿é—®$Enc_k^0(m)=Enc_k(0^{|m|})$å’Œ$Dec_\bot( c)$,Decæ°¸è¿œè¿”å›erroræ ‡å¿—ã€‚</li><li>æ•Œæ‰‹çŒœæµ‹bâ€™ï¼Œè‹¥b=bâ€™ï¼Œè¿”å›1ï¼Œå¦åˆ™è¿”å›0.</li></ol><div class="admonition warning"><p class="admonition-title">Definition AE(2)</p><p>A private-key encryption scheme is an authenticated encryption (AE) scheme if for all PPT adversaries $\mathcal{A}$ there is a negligible function negl such that:$$Pr[Priv_{\mathcal{A},\prod}^{ae}=1]\leq \frac{1}{2}+negl(n)$$</p></div><p>ä»¥ä¸Šä¸¤ä¸ªAEå®šä¹‰ç­‰ä»·ã€‚</p><p>å¦å¤–ï¼Œè‹¥AE schemesèƒ½å¤Ÿæ¥å—é¢å¤–çš„æ•°æ®ï¼Œè¢«ç§°ä¸ºauthenticated encryption with associated data (AEAD).</p><h3 id="CCA-and-AE">CCA and AE</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä»»ä½•AE schemeéƒ½æ»¡è¶³CCA-secureï¼Œåè¿‡æ¥åˆ™ä¸æ»¡è¶³ã€‚</strong></p><p>å¯†é’¥äº¤æ¢åè®®å°±æ— éœ€AEä½†éœ€è¦CCAã€‚</p><p>AEéœ€è¦æ»¡è¶³Secrecyå’Œintegrityï¼Œä½†CCA-securityåªéœ€è¦æ»¡è¶³åœ¨CCAæ•Œæ‰‹ä¸‹çš„å®‰å…¨æ€§ã€‚</p><h2 id="AE-schemes">AE schemes</h2><p>ç”±ä¸Šè®¨è®ºï¼Œæˆ‘ä»¬æƒ³è¦æ„å»ºä¸€ä¸ªå…¼å…·secrecyå’Œintegrityçš„æ–¹æ¡ˆã€‚ä½†ä¸¤è€…çš„ç»“åˆæ–¹å¼ä¼šé€ æˆä¸ä¸€æ ·çš„ç»“æœã€‚å³ä½¿æ¯ä¸ªåŸè¯­éƒ½æ˜¯å®‰å…¨çš„ï¼Œç»“åˆèµ·æ¥ä¹Ÿå¯ä»¥æ˜¯ä¸å®‰å…¨çš„ã€‚</p><p>å¦å¤–ï¼Œå®‰å…¨æ€§ä¾é å…¶åº•éƒ¨æ„å»ºçš„ç»†èŠ‚æ˜¯å±é™©çš„ã€‚æˆ‘ä»¬ä¸€èˆ¬è€Œè¨€è®¨è®ºå®‰å…¨æ€§çš„æ—¶å€™ï¼Œéƒ½æ˜¯ç€é‡äºé€šå¸¸çš„å®‰å…¨æ€§ã€‚</p><h3 id="Generic-Constructions">Generic Constructions</h3><h4 id="Encrypt-and-authenticate">Encrypt-and-authenticate</h4><p>é€‰å®šä¸¤ä¸ªç‹¬ç«‹çš„å¯†é’¥ï¼Œåˆ†åˆ«ç”Ÿæˆ$Enc_{k_E}(m)$å’Œ$Mac_{k_M}(m)$<br>è¿™ç§æ–¹å¼ä¸èƒ½ä¿è¯ä»»ä½•çš„secrecyï¼Œå› ä¸ºtagä¾¿å¯ä»¥æš´éœ²mã€‚æ— æ³•ä¿è¯CPA securityï¼Œè‹¥MACæ˜¯ç¡®å®šæ€§çš„ï¼Œæ¯”å¦‚CBC-MACï¼Œåˆ™ç›¸åŒçš„mä¾¿ä¼šç”Ÿæˆç›¸åŒçš„tagã€‚</p><h4 id="Authenticate-then-Encrypt">Authenticate-then-Encrypt</h4><p>é€‰å®šä¸¤ä¸ªç‹¬ç«‹çš„å¯†é’¥ï¼Œåºåˆ—ç”Ÿæˆï¼š<br>$t\leftarrow Mac_{k_M}(m),câ€™=Enc_{k_E}(m,t)$</p><p>å›æƒ³ä¸€ä¸‹å…ˆå‰çš„padding attackï¼Œå‡è®¾Encæ˜¯CBC-modeï¼Œåˆ™å…ˆéªŒè¯å†åŠ å¯†å­˜åœ¨ç€ä¸¤ä¸ªé”™è¯¯æ¥æºï¼šå¡«å……ä¸æ­£ç¡®ï¼Œæˆ–tagæ— æ³•Vrfyã€‚</p><p>å› æ­¤æ„é€ å‡º$Decâ€™_{k_E,k_M}( c)$ï¼š</p><ol><li>è®¡ç®—$mâ€™=Dec_{k_E}$,è‹¥padding errorå‘ç”Ÿï¼Œåˆ™è¿”å›â€œbad paddingâ€ã€‚</li><li>å°†mâ€™è§£æä¸º$m||t$ï¼Œè‹¥$Vrfy_{k_M}(m,t)=1$ï¼Œè¿”å›mï¼Œå¦åˆ™è¿”å›â€œauthentication failureâ€</li></ol><p>è‹¥æ•Œæ‰‹å¯ä»¥åŒºåˆ†ä¸¤ç§é”™è¯¯ä¿¡æ¯è¿”å›ï¼Œåˆ™ä¾¿å¯ä»¥é€šè¿‡Padding attackä¸­çš„æ–¹å¼è·å–æ•´ä¸ªæ˜æ–‡ã€‚</p><p>å®é™…è¿ç”¨ä¸­ï¼ŒSSLè¯•å›¾ä¿®å¤è¿™ä¸€ç‚¹ï¼Œå®ƒåªè¿”å›ä¸€ç§é”™è¯¯æ¶ˆæ¯ï¼Œä½†è¦ä¿è¯æ— æ³•åŒºåˆ†ä¸åŒçš„é”™è¯¯è¿˜æ˜¯ååˆ†å›°éš¾çš„ã€‚å› æ­¤ï¼Œå¾®å°çš„æ—¶é—´å·®åˆ«ä½¿è¯¥ç‰ˆæœ¬çš„SSLè¢«æˆåŠŸæ”»ç ´ã€‚</p><h4 id="Encrypt-then-Authenticate">Encrypt-then-Authenticate</h4><p>é€‰å®šä¸¤ä¸ªç‹¬ç«‹çš„å¯†é’¥ï¼Œåºåˆ—ç”Ÿæˆï¼š</p><p>$c\leftarrow Enc_{k_E}(m),t\leftarrow Mac_{k_M}( c)$</p><p>è‹¥MACæ˜¯strong MACï¼Œé‚£ä¹ˆè¯¥AEæ»¡è¶³strongly unforgeableã€‚</p><p>è‹¥é‡‡ç”¨çš„æ¨¡å—åˆ†åˆ«èƒ½æ»¡è¶³strong MACå’ŒCPA-secureï¼Œé‚£ä¹ˆè¯¥åŠ å¯†æ–¹æ¡ˆæ»¡è¶³AEã€‚<br>ï¼ˆè¯æ˜æ€è·¯ï¼Œå¤§çº¦æ˜¯è¯æ˜Decæ˜¯æ— ç”¨çš„ã€‚ï¼‰</p><h3 id="Independent-keys">Independent keys</h3><div class="admonition warning"><p class="admonition-title">å¯†é’¥çš„ç‹¬ç«‹æ€§</p><p>æ‰€æœ‰çš„å¯†ç å­¦åŸè¯­éƒ½åº”è¯¥é‡‡ç”¨ç‹¬ç«‹çš„å¯†é’¥ï¼</p></div><p>å‡è®¾ï¼š$Enc_k(m)=F_k(m||r)$ï¼ŒFæ˜¯strong PRPï¼Œåˆ™è¯¥åŠ å¯†æ–¹æ¡ˆæ»¡è¶³CPA-secureã€‚</p><p>$Mac_k( c)=F_k^{-1}( c)$è¿™ä¹Ÿèƒ½æ»¡è¶³strong secureã€‚</p><p>ä½†ï¼Œè‹¥ç”¨Enc-then-Authenï¼Œåˆ™æœ‰ï¼š</p><p>$Enc_k(m),Mac_k(Enc_k(m))=F_k(m||r),F_k^{-1}(F_k(m||r))=F_k(m||r),m||r$<br>è¿™ä¸å°±æš´éœ²åŠ›ï¼Ÿ</p><h3 id="standard-schemes">standard schemes</h3><ol><li>GCM<br>the encrypt-then-authenticate paradigm with CTR mode and GMAC</li><li>CCM<br>the authenticate-then-encrypt approach with CTR mode and CBC-MAC</li><li>ChaCha20-Poly1305<br>the encrypt-then-authenticate approach with ChaCha20 and Poly1305</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> CCA </tag>
            
            <tag> AE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…¤ Secret-Key Authentication:Message Authentication Codes</title>
      <link href="/2023/02/02/modern-cryptov-secret-key-authentication-message-authentication-codes/"/>
      <url>/2023/02/02/modern-cryptov-secret-key-authentication-message-authentication-codes/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¶ˆæ¯è®¤è¯">æ¶ˆæ¯è®¤è¯</h2><p>è‡³ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€è®¨è®ºçš„å®‰å…¨éƒ½æ˜¯secrecyï¼Œå³ä¿è¯EAVã€CPAä¸‹ä¸æ³„éœ²ä»»ä½•é™¤æ˜æ–‡é•¿åº¦å¤–çš„æ˜æ–‡ä¿¡æ¯ã€‚æœ¬ç« è¦è®¨è®ºçš„ä¾¿æ˜¯å¦ä¸€æ–¹é¢çš„å®‰å…¨ï¼šæ¶ˆæ¯è®¤è¯ã€‚å³ï¼šä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œæˆ–ä¿è¯æ¶ˆæ¯æ¥æºèº«ä»½çš„å¯é æ€§ã€‚</p><p>ä¹‹å‰åœ¨ç¾¤é‡Œå’Œç¾¤å‹è®¨è®ºè¿‡è¿™ç±»è¯é¢˜ï¼Œç¾¤å‹ä¼¼ä¹è®¤ä¸ºMACï¼ˆæ¶ˆæ¯è®¤è¯ç ï¼‰èƒ½å¤ŸåŠ å¯†ä¿¡æ¯ï¼‰æ‰€ä»¥è¯´åŠ å¯†å’Œè®¤è¯æ˜¯ååˆ†å®¹æ˜“ææ··çš„ã€‚</p><div class="admonition warning"><p class="admonition-title">Encryption and Message Authentication</p><p>Secrecyä¿è¯ç§˜å¯†æ€§ï¼Œå’Œauthenticityè®¤è¯æ€§æ˜¯ä¸¤ä¸ª<strong>å®Œå…¨ä¸åŒ</strong>çš„æ€§è´¨ã€‚Encryptionä¸èƒ½ä¿è¯ä»»ä½•çš„authenticityï¼Œè€Œmessage authenticationä¹Ÿä¸èƒ½ä¿è¯ä»»ä½•çš„secrecyã€‚</p></div><p>ä¸¾ä¸ªä¾‹å­ï¼Œå³ä½¿ä½ åŠ å¯†äº†ä¿¡æ¯ä¼ ç»™å¦ä¸€æ–¹ï¼Œæ•Œæ‰‹æˆªè·äº†ä½ çš„ä¿¡æ¯ï¼Œæ”¹äº†ä¸‹ä½ çš„å¯†æ–‡è½¬å‘ç»™ç›®æ ‡ï¼Œè§£å¯†å‡ºæ¥çš„å¯èƒ½æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚å¦‚æœä½ å¯¹OFBï¼ŒCTRè¿™ç±»æ¨¡å¼åŠ å¯†çš„å¯†æ–‡è¿›è¡Œå¼‚æˆ–æŸäº›ä½çš„æ“ä½œï¼Œå¯ä»¥ç›´æ¥æ”¹å˜æ˜æ–‡ç‰¹å®šä½çš„ä¿¡æ¯ã€‚</p><h2 id="Message-Authentication-Codes-MAC">Message Authentication Codes(MAC)</h2><p>è¿™ä¸ªMACå’Œè®¾å¤‡çš„ç‰©ç†åœ°å€ï¼ˆMedia Access Control Addressï¼‰ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼‰</p><h3 id="Definition">Definition</h3><div class="admonition warning"><p class="admonition-title">Definition</p><p>MAC is a tuple($Gen,Mac,Vrfy$) of PPT algorithm:</p><ol><li>$Gen(1^n)\rightarrow k,|k|\geq n$,å…¸å‹çš„kä¿è¯uniformã€‚</li><li>$Mac_k( m)\rightarrow t$,è®¡ç®—è®¤è¯æ ‡ç­¾tagã€‚</li><li>$Vrfy_k(m,t)\rightarrow b$ b=1è¡¨ç¤ºæœ‰æ•ˆï¼Œå¦åˆ™è®¤è¯å¤±è´¥ã€‚</li></ol><hr><p>$Gen$ and possibly $Mac$ are <strong>probabilistic</strong>ï¼Œand if $|m|$ is restricted to $l(n)$:fixed-length MAC</p></div><p>Correctness:<br>è™½ç„¶Genå’ŒMacæœ‰æ¦‚ç‡æ€§ï¼Œä½†æœ‰ï¼š<br>$$Pr[Vrfy_k(m,Mac_k( m))=1|k\leftarrow Gen(1^n)]=1$$</p><p>Canonical verificationï¼šä¸€èˆ¬è€Œè¨€ï¼ŒMacæ˜¯ç¡®å®šæ€§çš„ï¼Œåˆ™Vrfyå¯è¢«é¡ºç†æˆç« çš„å®šä¹‰ä¸ºï¼š<br>$$Vrfy_k(m,t)=1&lt;=&gt; Mac_k(m)=t$$</p><h3 id="Security-of-MACs">Security of MACs</h3><p>å‡è®¾æƒ…æ™¯ï¼šä¸¤æ–¹äº’ç›¸é€šä¿¡ï¼ˆä½¿ç”¨æ˜æ–‡Må’Œæ ‡ç­¾Tï¼‰ï¼Œæ•Œæ‰‹åœ¨é€šä¿¡ä¿¡é“ä¸­æˆªå–ä¿¡æ¯ï¼Œä»–çš„ç›®æ ‡æ˜¯ä¼ªé€ å‡ºä¸€ç»„$Mâ€™,Tâ€™$ï¼Œä½¿å¾—$Vrfy_k ( Mâ€™,Tâ€™)=1$</p><p>æ¬å‡ºé¢„è¨€æœºæ¥å½¢å¼åŒ–å®šä¹‰ç½¢ï¼</p><hr><p>Message authentication experiment $Mac-forge_{\mathcal{a},\prod(n)}$</p><p>äº‹å‰ï¼Œæ•Œæ‰‹å’Œé¢„è¨€æœºéƒ½å·²çŸ¥å®‰å…¨å‚æ•°nï¼Œkä¹Ÿç”±é¢„è¨€æœºçš„Genç”Ÿæˆã€‚</p><ol><li>æ•Œæ‰‹å‘é¢„è¨€æœºå‘é€ä¿¡æ¯$m\in \{0,1\}'$.</li><li>é¢„è¨€æœºç»´æŠ¤ä¸€ä¸ªé›†åˆ$\mathcal{Q}=Q\cup m$,å¹¶è¿”å›$Mac_k( m)$.</li><li>ä¸æ–­é‡å¤1.2.ï¼ˆPPTæ•Œæ‰‹å˜›ï¼‰,æœ€åï¼Œæ•Œæ‰‹å‘é€$(mâ€™,tâ€™),\mathcal{A}$wins if $Vrfy(mâ€™,tâ€™)=1,mâ€™ \notin \mathcal{Q}$</li></ol><hr><div class="admonition warning"><p class="admonition-title">Definition</p><p>A MAC $\prod=(Gen,Mac,Vrfy)$ is existentically unforgeable under an adaptive Chosen-message attack if for all PPT adversaries $\mathcal{A}$:$$Pr[\mathcal{A}~win]=Pr[Mac-forge_{\mathcal{A},\prod}(n)=1]\leq negl(n)$$</p></div><p>existentically unforgeable(å­˜åœ¨ä¸å¯ä¼ªé€ æ€§)ï¼šA wins if he manages to find any messageã€‚<br>Chosen-messageï¼šå…è®¸ Aé€‰æ‹©ä»»ä½•çš„æ¶ˆæ¯è¿›è¡Œç›¸å…³ä¿¡æ¯å­¦ä¹ ã€‚</p><p>ä»¥ä¸Šå®šä¹‰ç®—æ˜¯è¾ƒå¼ºçš„ä¸€ä¸ªMACå®šä¹‰äº†ï¼Œä½†å…¶ä»ç„¶æ— æ³•é˜»æŒ¡é‡æ”¾æ”»å‡»ï¼šæ•Œæ‰‹è‹¥é€‰å–äº†$m \in \mathcal{Q}$è¿›è¡Œæ”»å‡»ï¼Œåˆ™ç›´æ¥è·èƒœ,å› ä¸ºè¿™é‡Œçš„MACæ˜¯æ— çŠ¶æ€çš„ã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æ— æ³•é˜»æŒ¡è°ƒæ•´æ¬¡åºï¼Œç”šè‡³åˆ é™¤messageä¸€éƒ¨åˆ†ã€‚è¿™äº›åˆ™å¯ä»¥é€šè¿‡åºåˆ—å·ï¼Œä»¥åŠtime-stampsç­‰è°ƒæ•´è§£å†³ã€‚</p><h2 id="Strong-MACs">Strong MACs</h2><p>ä¸Šè¿°é¢„è¨€æœºä¸­ï¼Œ$Mac$å¹¶ä¸ä¸€å®šæ˜¯ç¡®å®šæ€§ç®—æ³•ï¼Œå› æ­¤ä¸€ä¸ª $m$ å¯ä»¥å¯¹åº”å¤šä¸ª $t$ ,è¿™è®©æ•Œæ‰‹æœ‰äº†å¦ä¸€ç§æ”»å‡»æ–¹å¼ï¼šä¼ªé€ å‡ºä¸åŒäº$Mac_k(m)$çš„tag $tâ€™$ï¼Œæ»¡è¶³$Vrfy_k(m,tâ€™)=1$.å› æ­¤ï¼ŒåŠ ä¸Šå‰é¢æ‰€æåˆ°çš„canonical Macæ€§è´¨ï¼Œä¾¿å¯ä»¥å®šä¹‰å‡ºStrong MACã€‚</p><h3 id="verification-queries">verification queries</h3><p>ç†è®ºä¸Šè€Œè¨€å¯ä»¥å®šä¹‰æ›´å¼ºæ€§è´¨çš„MACï¼Œå¯ä»¥è®©æ•Œæ‰‹é™¤äº†è®¿é—®ä¸Šè¿°çš„é¢„è¨€æœºå¤–ï¼Œè¿˜å¯ä»¥è®©æ•Œæ‰‹é€‚åº”æ€§åœ°è®¿é—®$Vrfy$é¢„è¨€æœºï¼šå‘é€$(mâ€™,t)$,é¢„è¨€æœºè¿”å›$Vrfy_k(mâ€™,t)$ã€‚<br>ä½†å®é™…ä¸Šï¼Œè‹¥é‡‡ç”¨canonical MACï¼Œè¿™å¹¶ä¸èƒ½ä½¿å®šä¹‰æ›´å¼ºã€‚æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¹Ÿåªè®¨è®ºcanonical Macã€‚</p><h2 id="A-potential-timing-attack">A potential timing attack</h2><p>æ¢ä¸ªæ€è·¯ï¼š<br>è‹¥æ”»å‡»è€…èƒ½å¤Ÿåœ¨ä¸Šè¿°çš„æ–¹æ¡ˆä¸­è·å¾—é™¤äº†æœ€åå‘é€çš„æ¶ˆæ¯æ˜¯å¦VrfyæˆåŠŸå¤–ï¼Œè¿˜èƒ½å¾—åˆ°<strong>æ—¶é—´ä¿¡æ¯</strong>ï¼šè¿™é‡Œçš„æ—¶é—´ä¿¡æ¯æ˜¯æŒ‡Vrfyè¿™ä¸ªå†³ç­–è¿‡ç¨‹ä¸­æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚<br>æ¯”æ–¹è¯´ï¼ŒCanonical Macï¼ˆä¹‹åç›´æ¥ç”¨Macä»£æŒ‡äº†ï¼‰çš„Vrfyè¿‡ç¨‹æ˜¯é€ä½æ¯”è¾ƒtagæ˜¯å¦ç›¸åŒï¼Œè‹¥é‡åˆ°ä¸åŒä½ç›´æ¥æå‰è¿”å›ç»“æœã€‚é‚£ä¹ˆï¼Œè¿™å’ŒVrfyè¿‡ç¨‹æˆåŠŸï¼Œæ¯”è¾ƒå®Œæ‰€æœ‰ä½çš„æ—¶é—´èŠ±è´¹ç›¸æ¯”ï¼Œå¿…å®šçŸ­äº†ä¸€äº›ã€‚</p><p>äºæ˜¯ï¼šæ¯”å¦‚ï¼Œå¯¹äºä¸€ä¸ª16-byteé•¿åº¦çš„tagï¼Œæ•Œæ‰‹å¯¹äºç¬¬ä¸€ä¸ªbyteçš„åˆ¤æ–­ï¼Œå‘é¢„è¨€æœºå‘é€$(m,t_0),(m,t_1),â€¦(m,t_{255})$ï¼Œéå†æ‰€æœ‰å¯èƒ½æ€§ï¼Œåé¢å…¨éƒ¨ç½®0.è¿™æ ·ä¾¿å¯ä»¥é€šè¿‡æ—¶é—´æ¯”è¾ƒæ¥æ£€æµ‹$t_j$å«æœ‰æ­£ç¡®çš„ä¸€å—ï¼Œè¿™æ ·ä¸æ–­å¾ªç¯ä¸‹ä¸€æ­¥ï¼Œä¾¿å¯ä»¥é€šè¿‡$256\times 16$æ¥å¯»æ‰¾åˆ°è¯¥tagçš„æ­£ç¡®ä¿¡æ¯ã€‚</p><p>å®é™…ä¸Šï¼Œè¿™ç§æ”»å‡»æ–¹å¼å·²ç»è·å¾—æˆåŠŸè¿‡ã€‚</p><h2 id="Constructionsï¼šMAC">Constructionsï¼šMAC</h2><h3 id="Fixed-length-MAC">Fixed-length MAC</h3><p>å¯ä»¥ç”¨PRFæ¥æ„é€ å‡ºä¸€ä¸ªMACæ–¹æ¡ˆï¼š</p><div class="admonition info"><p class="admonition-title">PRF-&gt;MAC</p><p>Every PRF $F:\{0,1\}^{l_{key}^n}\times \{0,1\}^{l_{in}^n}\rightarrow \{0,1\}^{l_{out}^n}$ å¯ä»¥ç”¨æ¥æ„é€ ä¸€ä¸ªæ¶ˆæ¯ç©ºé—´ä¸º$\{0,1\}^{l_{in}^n}$çš„MACï¼ˆ$\{0,1\}^{l_{out}^n}\in \omega(log(n))$ï¼‰</p></div><p>Constructions:</p><p>$Gen(1^n)\rightarrow k$ï¼šlike PRF Fï¼šgenerate k.<br>$Mac_k( m)=F_k( m),|m|=\{0,1\}^{l_{in}^n}$<br>$Vrfy_k(m,t)&lt;=&gt;Mac_k( m)=t$</p><p>è¯æ˜å®‰å…¨æ€§å¯ä»¥ç”¨PRFçš„å®‰å…¨æ€§+åè¯æ³•ã€‚</p><h3 id="Arbitrary-length-MAC">Arbitrary length MAC</h3><p>å¾ˆå®¹æ˜“å¾€<strong>å¤ç”¨fix-length MAC</strong><br>æ–¹å‘å»æ„é€ ä»»æ„é•¿åº¦çš„MACï¼Œä½†è¿™é‡Œä»ç„¶ä¼šå‡ºç°é—®é¢˜ï¼š</p><p>å‡è®¾$Mac_k( m)=&lt;t_1,â€¦t_d&gt;,t_i=Macâ€™_k(m_i)$</p><ol><li>é‡æ’æ¬¡åºï¼šæ¯”å¦‚$&lt;t_1,t_2&gt;,&lt;m_1,m_2&gt;$ï¼Œè°ƒæ¢1ï¼Œ2ä½ç½®ç…§æ ·é€šè¿‡$Vrfy$ã€‚<br>æ–¹æ³•ï¼šåŠ ä¸Šåºåˆ—å·ï¼Œ$t_i=Macâ€™_i(i,m_i)$</li><li>æˆªæ–­ï¼Œæˆªå–ä¸€éƒ¨åˆ†tï¼Œmè¿›è¡Œvrfyã€‚<br>æ–¹æ³•ï¼š$t_i=Macâ€™_i(l,i,m_i),l=|m|$</li><li>æ··åˆè°ƒæ¢ã€‚å‡è®¾ä¸¤æ¡ç›¸åŒé•¿åº¦çš„æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶å„å–ä¸€éƒ¨åˆ†è¿›è¡Œæ··åˆï¼Œå¯ä»¥é€šè¿‡Vrfy<br>æ–¹æ³•ï¼šåŠ ä¸Šä¸€ä¸ªmessage identifier $r$ï¼Œä¸€èˆ¬è€Œè¨€æ˜¯éšæœºæ•°ï¼š$t_i=Macâ€™_k(r,l,i,m_i)$.</li></ol><p>åŸºæœ¬æ»¡è¶³éœ€è¦äº†ã€‚å…·ä½“æ„é€ ç•¥ï¼ˆ</p><h3 id="CBC-MAC">CBC-MAC</h3><p>å›å¿†ä¸€ä¸‹ä¸Šä¸€ç« CBCæ¨¡å¼ï¼š</p><p>$c_0=IV$,<br>$c_i=F_k(m_i\oplus c_{i-1})$</p><p>CBC-MACçœå»é€‰å–IVå¹¶å¼‚æˆ–çš„ä¸€æ­¥ï¼Œå¹¶ä¸”åªç”Ÿæˆtag tã€‚<br>å½¢å¼åŒ–è€Œè¨€ï¼š</p><hr><p>$t_1=F_k(m_1)$<br>$t_i=F_k(m_i\oplus t_{i-1})$<br>$t_{output}=t_{last}$</p><hr><div class="admonition info"><p class="admonition-title">CBC-MAC</p><p>for any polynomial $l$,if F is a PRF,then the CBC-MAC for message of length $l(n)\cdot n$ is secure.</p></div><p>è‹¥ä¸æ˜¯é€‰å®šçš„é•¿åº¦ï¼ŒCBC-MACæ˜¯ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…éƒ½éœ€è¦äº‹å…ˆçº¦å®šå¥½å‘é€æ¶ˆæ¯çš„é•¿åº¦ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> MAC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…£ Private key Encryption</title>
      <link href="/2023/01/31/modern-cryptoiv-private-key-encryption/"/>
      <url>/2023/01/31/modern-cryptoiv-private-key-encryption/</url>
      
        <content type="html"><![CDATA[<h2 id="å¯¹ä¸ŠèŠ‚çš„è¡¥å……è¯´æ˜">å¯¹ä¸ŠèŠ‚çš„è¡¥å……è¯´æ˜</h2><p>ä¸Šæ¥ <a href="https://zzzremake.github.io/2023/01/03/modern-cryptoiii-computational-security/#Stronger-security-notions-CPA-Security">â…¢</a>ã€‚</p><p>æˆ‘ä»¬ç›®å‰å·²ç»æ‹¥æœ‰çš„åŠ å¯†æ–¹æ¡ˆï¼Œåªæœ‰one-time padä»¥åŠå…¶â…¢é‡Œå¤´çš„æ”¹è¿›å‹ã€‚æ”¹è¿›å‹çš„åŠ å¯†æ–¹æ¡ˆæ˜¯åœ¨å•æ¶ˆæ¯æ„ä¹‰ä¸‹çš„EAVä¸å¯åŒºåˆ†æ€§ã€‚<br>åœ¨å¤šæ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œç”±äºone-time padæœ¬è´¨æ˜¯<strong>ç¡®å®šæ€§</strong>çš„ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®‰å…¨æ€§ã€‚ç”±æ­¤å¯ä»¥å¯¼å‡ºï¼š</p><p>!!!<br>è‹¥ä¸€ä¸ªåŠ å¯†æ–¹æ¡ˆä¸­Encä¸ºç¡®å®šæ€§çš„ï¼Œåˆ™åœ¨EAVä¸‹æ— æ³•ä¿è¯å¤šæ¶ˆæ¯åŠ å¯†çš„ä¸å¯åŒºåˆ†æ€§ã€‚</p><p>å› æ­¤ï¼Œéœ€è¦æ¦‚ç‡æ„ä¹‰ä¸Šçš„Encï¼Œä¹Ÿå› æ­¤å¯ä»¥å¯¼å‡ºCPA-Securityã€‚</p><p>å¦å¤–ï¼Œå¤šæ¶ˆæ¯åŠ å¯†çš„ã€å›ºå®šæ˜æ–‡é•¿åº¦çš„åŠ å¯†æ–¹æ¡ˆï¼Œç†è®ºä¸Šè¿›è¡Œé‡å¤ä¾¿å¯ä»¥åŠ å¯†ä»»æ„é•¿çš„æ¶ˆæ¯ï¼Œä½†åœ¨è¿™ç« çš„åç»­éƒ¨åˆ†ä¸­ï¼Œå°†ä»‹ç»æ›´ä¸ºæœ‰æ•ˆç‡çš„åŠ å¯†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯æ–¹å¼ã€‚</p><hr><p>åœ¨å¼€å§‹æœ¬èŠ‚æ„é€ CPAåŠ å¯†æ–¹æ¡ˆå‰ï¼Œæœ‰å¿…è¦å¯¹ä¼ªéšæœºæ€§è¿›è¡Œæ·±å…¥è®¨è®ºã€‚</p><h2 id="Pseudorandom-functions">Pseudorandom functions</h2><p>æ³¨æ„ä¸PRGï¼ˆPseudorandom generatorï¼‰åŒºåˆ†ã€‚<br>PRGæ˜¯å°†ä½œä¸ºç§å­çš„éšæœºåºåˆ—è¿›è¡Œæ‰©å±•é•¿åº¦ï¼Œä½¿å…¶æ— æ³•ä¸ç›¸åŒé•¿åº¦çš„uniformlyéšæœºåºåˆ—åŒºåˆ†ï¼›PRFåˆ™æ˜¯ä¸€ç±»ä»¥å¯†é’¥keyä½œä¸ºè¾“å…¥çš„å¤šé¡¹å¼å¯è®¡ç®—å‡½æ•°ï¼Œå…¶æ— æ³•ä¸éšæœºå‡½æ•°è¿›è¡ŒåŒºåˆ†ã€‚</p><div class="admonition warning"><p class="admonition-title">Definition:PRF</p><p>$$F:\{0,1\}^{l_{key}} \times \{0,1\}^{l_{in}} \rightarrow \{0,1\}^{l_{out}}$$</p><ol><li>Efficient:$$l_{key}(n)=l_{in}(n)=l_{out}(n)^a$$å®é™…ä¸Šçš„PRFå¯ä»¥ä¸ç­‰é•¿ï¼Œä½†åœ¨æ¥ä¸‹æ¥çš„è®¨è®ºä¸­ï¼Œå¯ä»¥</li><li>Secure: $F(k,\cdot)$with a random key $\mathcal{k} \in \{0,1\}^{n}$ å’Œéšæœºå‡½æ•°$\{0,1\}^{n}\rightarrow\{0,1\}^{n} $æ— æ³•åŒºåˆ†ã€‚</li></ol></div><p>å®é™…ä¸Šçš„PRFå¯ä»¥ä¸ç­‰é•¿ï¼Œä½†åœ¨æ¥ä¸‹æ¥çš„è®¨è®ºä¸­ï¼Œå¯ä»¥è®¤ä¸ºä¸Šé¢çš„$l_?(n)=n$.</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°æœ¬è´¨æ˜¯ä¸€ç§ä¸€ä¸€æ˜ å°„ï¼Œå› æ­¤å¯ä»¥å°†æ‰€æœ‰å¯èƒ½çš„å‡½æ•°çœ‹ä½œä¸€ä¸ªå‡½æ•°é›†åˆ$Func_n$,åˆ™æœ‰ï¼š$|Func_n|=2^{2^n\cdot n}$ã€‚<br>æè¿°éšå³å‡åŒ€é€‰å–çš„$f\in Func_n$åˆ™éœ€è¦$2^n\cdot n$bits çš„ç©ºé—´å»å»ºç«‹æ˜ å°„ã€‚äºæ˜¯åœ¨å¤šé¡¹å¼çš„ç®—æ³•ä¸‹æ— æ³•æœ‰æ•ˆçš„è¯»å–fçš„æ‰€æœ‰å¯èƒ½çš„å–å€¼ï¼Œä¹Ÿå› æ­¤æ— æ³•ä½¿ç”¨å¤šé¡¹å¼ç®—æ³•ç›´æ¥å®šä¹‰ä¸éšæœºå‡½æ•°çš„ä¸å¯åŒºåˆ†æ€§ã€‚<br>äºæ˜¯ï¼Œå¯ä»¥é€šè¿‡è¯•å›¾åŒºåˆ† $f$ å’Œéšæœºå‡½æ•°çš„åŒºåˆ†è€…$\mathcal{D}$è®¿é—®<strong>é¢„è¨€æœº</strong>æ¥å½¢å¼åŒ–PRFçš„å®‰å…¨å®šä¹‰ã€‚</p><h3 id="PRF-Definition-oracle">PRF Definition(oracle)</h3><p>Definitionï¼š</p><ol><li>æ•Œæ‰‹ï¼ˆ$\mathcal{D}$ï¼‰å‘oracleå‘é€<strong>å•ä¸ª</strong>ä¿¡æ¯xã€‚</li><li>é¢„è¨€æœºè¡Œä¸ºä¸ä¹‹å‰ç›¸ä¼¼ï¼Œéšæœºç”Ÿæˆå¯†é’¥kå’Œbã€‚<strong>ä¸ä¸€æ ·çš„</strong>ï¼šå¦‚æœ$b=0$ï¼Œåˆ™ç”¨$F_k(x)$è¿”å›ï¼Œå¦åˆ™åˆ™ç”¨$f\leftarrow Func_n $ç”Ÿæˆ$f(x)$è¿”å›ã€‚fä¸ºå‡åŒ€éšæœºé€‰æ‹©çš„å‡½æ•°ã€‚</li><li>æ•Œæ‰‹è¿”å›bâ€™ï¼Œoracleè¡Œä¸ºä¸ä¹‹å‰çš„é¢„è¨€æœºè¡Œä¸ºç›¸åŒã€‚</li></ol><p>äºæ˜¯ï¼Œä¸Šæ–¹çš„Definitionä¸­secureå¯ä»¥æ”¹ä¸ºï¼š</p><div class="admonition warning"><p class="admonition-title">Definition:PRF(2)</p><p>Secureï¼šfor every PPT $\mathcal{D}$:$$|Pr[b'=1|b=0]-Pr[b'=1|b=1]|= \\|Pr_{k\leftarrow \{0,1\}^{n}}[D^{F(k,\cdot)}=1]-Pr_{f\leftarrow Func_n}[D^{f(\cdot)}]|\leq negl(n)$$</p></div><h2 id="Pseudorandom-permutationsï¼ˆPRPï¼‰">Pseudorandom permutationsï¼ˆPRPï¼‰</h2><p>ç°å®šä¹‰$Perm_n\subset Func_n$,è¡¨ç¤ºæ‰€æœ‰åœ¨$\{0,1\}^n$ä¸Šçš„æ’åˆ—é›†åˆã€‚äºæ˜¯ï¼š<br>$$|Perm_n|=2^n!$$<br>æˆ‘ä»¬å¯ä»¥ç”¨å‡ ä¹å’ŒPRFsç›¸åŒçš„å®šä¹‰æ–¹å¼å®šä¹‰ä¼ªéšæœºæ€§æ’åˆ—PRPsï¼š</p><div class="admonition warning"><p class="admonition-title">Definition:Pseudorandom permutations</p><p>$$F:\{0,1\}^{l_{key}} \times \{0,1\}^{l_{in}} \rightarrow \{0,1\}^{l_{out}}$$æ˜¯PRPï¼Œåˆ™æœ‰ï¼š</p><ol><li>Efficient: åŒPRF</li><li>$F_k(\cdot)$æ˜¯æ’åˆ—ã€‚</li><li>Secureï¼šfor every PPT $\mathcal{D}$:$$|Pr_{k\leftarrow \{0,1\}^{l_{key}(n)}}[D^{F(k,\cdot)}=1]-Pr_{f\leftarrow Perm_{l_{in}(n)}}[D^{f(\cdot)}]|\leq negl(n)$$</li></ol></div><p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œç”±äºæ˜¯PRPï¼Œè¦æ±‚å¤šé¡¹å¼æ—¶é—´å†…è®¡ç®—å‡½æ•°ä¸é€†å‡½æ•°ï¼Œæ‰€ä»¥è¦æ±‚$l_{in}(n)=l_{key}(n)$.</p><div class="admonition info"><p class="admonition-title">PRP and PRF</p><p>å¦‚æœFæ˜¯PRPä¸”$l_{in}(n)\geq n$,é‚£ä¹ˆFåŒæ ·ä¹Ÿæ˜¯PRFã€‚</p></div><p>ä¸Šè¿°æƒ…å†µåœ¨æ¸è¿›æ„ä¹‰ä¸Šæˆç«‹ï¼Œä½†å…·ä½“å®‰å…¨æ€§ä»ç„¶å¯èƒ½å—åˆ°å½±å“ã€‚</p><h3 id="Strong-PRPs">Strong PRPs</h3><p>PRPåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé€†å‡½æ•°åŒæ ·ä¹Ÿè¢«honest parties æ‰€éœ€ã€‚å› æ­¤ï¼Œéœ€è¦è€ƒè™‘æ›´é«˜çš„å®‰å…¨æ€§ã€‚</p><div class="admonition warning"><p class="admonition-title">Definition Strong PRP</p><p>Fä¸ºæœ‰æ•ˆçš„ã€å…·æœ‰keyè¾“å…¥çš„ã€é•¿åº¦å›ºå®šçš„ï¼ˆnçš„å¤šé¡¹å¼ï¼‰æ’åˆ—ã€‚è‹¥ä¸ºStrong PRPsï¼Œåˆ™æœ‰ï¼š$$Pr[\mathcal{D}^{F(k,\cdot),F^{-1}(k,\cdot)}=1]-Pr[\mathcal{D}^{f(\cdot),f^{-1}(\cdot)}=1]\leq negl(n)$$</p></div><div class="admonition missing"><p class="admonition-title">block-ciphers(åˆ†ç»„å¯†ç )</p><p>å®é™…ä¸Šï¼ŒåƒDES,AESè¿™ç±»æˆ‘ä»¬ç†Ÿæ‚‰çš„<strong>åˆ†ç»„å¯†ç </strong>ï¼Œå…¶æœ€åˆå§‹çš„ç›®çš„å°±æ˜¯ä½œä¸ºstrong PRPsè¿›è¡Œä½¿ç”¨ã€‚å…¶åŒºåˆ«ä»…ä»…åœ¨äºåˆ†ç»„ä»¥åŠå¯†é’¥çš„é•¿åº¦å›ºå®šï¼ˆè€Œéæ¸è¿›æ„ä¹‰ä¸Šï¼‰ï¼Œä»¥åŠè®¤ä¸ºæš´åŠ›ç ´è§£æ‰æ˜¯æœ€ä½³çš„ç ´è§£æ–¹å¼ã€‚å› æ­¤ï¼Œ<strong>åˆ†ç»„å¯†ç ä¸æ˜¯åŠ å¯†æ–¹æ¡ˆ</strong>ã€‚</p></div><h3 id="CPA-Secure">CPA-Secure</h3><p>é€šè¿‡PRFs/PRPsï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¾ˆå¥½çš„å®šä¹‰CPA-secureçš„åŠ å¯†æ–¹æ¡ˆã€‚</p><p>$F:\{0,1\}^n\times \{0,1\}^n\rightarrow \{0,1\}^n$<br>$Enc(k,m\in \{0,1\}^n )$ é€‰å–$r\leftarrow\{0,1\}^n$<br>$$c\leftarrow &lt;r,m\oplus F_k( r)&gt;$$<br>$Dec(c=&lt;r,s&gt;):m\leftarrow F_k( r)\oplus s$</p><div class="admonition info"><p class="admonition-title">info</p><p>å¦‚æœFæ˜¯PRF,ä¸Šè¿°æ„é€ ä¸º CPA-secure çš„å›ºå®šæ˜æ–‡é•¿åº¦çš„ç§é’¥åŠ å¯†æ–¹æ¡ˆã€‚</p></div><h2 id="Modes-of-Operation-æ“ä½œæ¨¡å¼">Modes of Operation(æ“ä½œæ¨¡å¼)</h2><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒPRGsæ›´å¤šç”¨äºåˆå§‹åŒ–æµå¯†ç ï¼Œè€ŒPRPsåˆ™ç”¨äºåˆ†ç»„å¯†ç ã€‚å®é™…ä¸Šï¼Œåˆ†ç»„å¯†ç çš„å¦ä¸€ä¸ªåå­—å°±æ˜¯PRPã€‚</p><h3 id="Stream-ciphers-æµå¯†ç ">Stream ciphers(æµå¯†ç )</h3><h4 id="basic-definition">basic definition</h4><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å®šä¹‰çš„åŠ å¯†æ–¹æ¡ˆéƒ½å¯¹æ˜æ–‡æœ‰æ˜ç¡®çš„é•¿åº¦é™åˆ¶ï¼Œä¸å¤Ÿæœ‰æ‰©å±•æ€§ã€‚æµå¯†ç åˆ™æä¾›äº†æ›´é«˜çš„å»¶å±•æ€§ã€‚</p><p>æµå¯†ç åœ¨å½¢å¼ä¸Šï¼Œæä¾›äº†ä»¥ä¸‹ç¡®å®šæ€§çš„ç®—æ³•ä½œä¸ºåŸºæœ¬éƒ¨ä»¶ï¼š</p><ol><li>$Init$: è¾“å…¥ç§å­$s$å’Œé€‰å®šçš„åˆå§‹å‘é‡$IV$,è¾“å‡ºåˆå§‹çŠ¶æ€$st$.</li><li>$Next$ï¼šä»¥çŠ¶æ€ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºa bit $y$ å¹¶ä¸”æ›´æ–°çŠ¶æ€ $stâ€™$.</li></ol><p>åˆ™å¯ä»¥å®šä¹‰å¸¦æœ‰å¯†é’¥è¾“å…¥çš„å‡½æ•°ï¼š<br>$$F_s^l(IV)=GetBits_1(Init(s,IV),1^l)$$<br>è‹¥$F^l$ä¸ºä¸ºéšæœºå‡½æ•°ï¼Œåˆ™è¯¥æµå¯†ç æ˜¯å®‰å…¨çš„ã€‚</p><h4 id="æµå¯†ç ã®æ“ä½œæ¨¡å¼">æµå¯†ç ã®æ“ä½œæ¨¡å¼</h4><p>ç•¥ã€‚åˆ†åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ã€‚</p><h3 id="Block-cipher-modes-of-operation">Block-cipher modes of operation</h3><p>å…·ä½“çš„æ“ä½œæ¨¡å¼å½¢å¼å°±ä¸åœ¨æœ¬èŠ‚ä»‹ç»äº†ï¼Œä¸€æœéƒ½æœ‰ã€‚</p><p>æ“ä½œæ¨¡å¼å¯ä»¥çœ‹ä½œä¸€ç§æ„é€ ï¼Œè¿™ç§æ„é€ å°†ä¸€ä¸ªå¯†ç å­¦ä¸Šçš„æ¨¡å—ï¼ˆæˆ–è€…ï¼ŒåŸè¯­ï¼Ÿï¼‰ï¼ˆPRF,PRP/åˆ†ç»„å¯†ç æŠ‘æˆ–æ˜¯æ—¥åè¦ä»‹ç»çš„hash functionï¼‰è½¬å˜ä¸ºä¸€ç§usefulçš„å¯†ç å­¦æ–¹æ¡ˆï¼ˆåŠ å¯†æ–¹æ¡ˆï¼Œæˆ–æ˜¯æ—¥åä»‹ç»çš„è®¤è¯æ–¹æ¡ˆï¼‰ã€‚</p><h4 id="ECB">ECB</h4><p>æœ€æœ€åŸºæœ¬çš„æ¨¡å¼ï¼Œä½†è¿™ç§æ¨¡å¼<strong>ç»å¯¹</strong>ä¸èƒ½ç»§ç»­ä½¿ç”¨äº†ã€‚ECBçš„æ¨¡å¼æ˜¯ç¡®å®šæ€§çš„ï¼Œå› æ­¤å¹¶ä¸æ˜¯CPA-secureçš„ã€‚</p><p><s>è€å¸ˆç”šè‡³åœ¨è¯¾å ‚è®²å¦‚æœæœ‰äººæ¯•è®¾åœ¨å®‰å…¨éƒ¨ä»½ç”¨ECBè¢«ä»–é€®åˆ°ç›´æ¥æ¯™äº†</s></p><h4 id="CBC">CBC</h4><p>è‹¥CBCç”¨åˆ°çš„å¸¦æœ‰å¯†é’¥è¾“å…¥çš„å‡½æ•°Fä¸ºPRPï¼Œåˆ™CBCæ˜¯CPA-Secureçš„ã€‚</p><p>CBCçš„ä¸»ä½“éƒ¨åˆ†æ˜¯ä½œä¸ºä¸€ä¸ªé“¾æ¡è¿›è¡Œçš„ï¼Œæ‰€ä»¥åªèƒ½åºåˆ—æ€§çš„è¿›è¡ŒåŠ å¯†ï¼Œæ— æ³•æœ‰æ•ˆçš„å¹¶è¡ŒåŒ–å¤„ç†ä»è€ŒåŠ é€ŸåŠ å¯†è¿‡ç¨‹ã€‚</p><h5 id="Chain-CBC-mode">Chain CBC mode</h5><p>è¿™ç§æ¨¡å¼åœ¨SSL 3.0å’ŒTLS 1.0ä¸­ä½¿ç”¨ï¼Œå°†å…¶ä¸Šä¸€æ¬¡åŠ å¯†çš„æœ€åä¸€ä¸ªåˆ†ç»„è¿”å›çš„å¯†æ–‡å—ä½œä¸ºä¸‹ä¸€æ¡æ˜æ–‡åŠ å¯†çš„$IV$ã€‚çœ‹ä¸Šå»ï¼Œè¿™ç§æ–¹å¼èƒ½å¤ŸåŠ å¯†æ›´å¤šçš„æ¶ˆæ¯è€Œä¸ç”¨é‡æ–°ç”Ÿæˆæ–°çš„$IV$.ç„¶è€Œï¼Œè¿™ç§æ–¹å¼ä¸æ˜¯CPA secureçš„ã€‚</p><p>æ„Ÿè§‰ä»‹ç»è¿™ä¸ªæ¡ˆä¾‹çš„æ›´å¤šåŸå› æ˜¯è­¦é†’åˆ«äººä¸è¦éšæ„æ”¹åŠ¨åŸæ¥å·²è¢«è¯æ˜å®‰å…¨çš„æ–¹æ¡ˆã€‚å³ä½¿åªæ˜¯å¾ˆå°çš„æ”¹åŠ¨ä¹Ÿæ— æ³•ä¿è¯èƒ½ä¿æŒå®‰å…¨æ€§ã€‚</p><h4 id="OFB">OFB</h4><p>ç›¸æ¯”äºCBCï¼š</p><ol><li>OFBçš„$F_k$ä¸éœ€è¦é€†å‡½æ•°æ¥ä½œä¸ºDecè§£å¯†ï¼Œå› æ­¤$F_k$å¯ä»¥æ˜¯PRFï¼Œè€Œä¸æ˜¯CBCå› éœ€è¦é€†å‡½æ•°è€Œé€‰æ‹©çš„PRPã€‚</li><li>OFBè‹¥é‡‡å–ä¸ŠèŠ‚çš„Chain CBCçš„å½¢å¼é€‰å–$IV$ï¼Œèƒ½å¤Ÿä¿è¯å®‰å…¨æ€§ã€‚</li><li>è™½ç„¶è®¡ç®—ä¸Šã€‚OFBä»ç„¶éœ€è¦åºåˆ—åŒ–çš„è®¡ç®—ï¼Œä½†å¯ä»¥åœ¨åŠ å¯†å‰æŠŠåºåˆ—åŒ–çš„éƒ¨åˆ†å®Œæˆï¼Œè€ŒåŠ å¯†ä¾¿å¯ä»¥ä½¿ç”¨å¹¶è¡ŒåŒ–è¿›è¡ŒåŠ é€Ÿã€‚</li><li>æ˜æ–‡é•¿åº¦æ— éœ€æ˜¯nçš„å€æ•°ã€‚</li></ol><h4 id="CTR">CTR</h4><p>CTRå¯¹æ˜æ–‡é•¿åº¦å…·æœ‰é™åˆ¶ã€‚è¿™é‡Œè¯¦ç»†ä»‹ç»CTRã€‚</p><p>$Enc_k(m_1,â€¦,m_l)$,å…¶ä¸­$m_i$è¡¨ç¤ºæ˜æ–‡å—:</p><ol><li>random $IV\leftarrow\{0,1\}^{3n/4}$</li><li>$y_i=F_k(IV||i)$</li><li>$c_i=y_i\oplus m_i$</li><li>$c=&lt;IV,c_1,â€¦c_l&gt;$</li></ol><p>$DecÂ©:m_i=c_i\oplus F_k(IV||i)$</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶é™åˆ¶äº†$l&lt;2^{n/4}$ï¼Œåˆå§‹å‘é‡é•¿åº¦ä¹Ÿæœ‰å˜åŒ–ï¼Œè¿™é‡Œæ˜¯å› ä¸ºCTRé‡‡ç”¨è®¡æ•°å™¨æ¨¡å¼ï¼Œè€Œè®¡æ•°å™¨èƒ½å¤Ÿè®¡æ•°çš„éƒ¨åˆ†åªæœ‰3n/4bitsç©ºå‡ºæ¥çš„n/4ã€‚</p><p>CTRçš„åŠ å¯†è¿‡ç¨‹æ˜¯å®Œå…¨çš„å¹¶è¡ŒåŒ–çš„ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥æŸ¥çœ‹å¯†æ–‡çš„æŸä¸€å—è§£å¯†ç»“æœï¼Œè€Œæ— éœ€è§£å¯†æ•´æ¡ä¿¡æ¯ã€‚</p><h4 id="Concrete-Security">Concrete Security</h4><p>CTR,CBC,OFBåŸºæœ¬ä¸Šèƒ½å¤Ÿä¿è¯$q(n)$ æ¬¡æŸ¥è¯¢ä¸‹çš„$q(n)^2/2^n$ä¼˜åŠ¿ï¼Œåœ¨å…·ä½“å®‰å…¨ä¸­éœ€è¦ä½¿ç”¨è¾ƒå¤§çš„blocks sizeï¼Œå› æ­¤nè¦å¤§ã€‚<br>CTRé™åˆ¶äº†é•¿åº¦ï¼Œå› æ­¤åœ¨n=64ï¼Œæ¯”å¦‚é‡‡ç”¨DESæ—¶èƒ½å¤ŸåŠ å¯†34GBçš„æ˜æ–‡ï¼Œæ¢ç”¨n=128æ¯”å¦‚AESå°±åŸºæœ¬å·®ä¸å¤šèƒ½æ»¡è¶³å„ç§éœ€è¦äº†ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> æ“ä½œæ¨¡å¼ </tag>
            
            <tag> éšæœºæ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern-Cryptoâ…¢  Computational Security</title>
      <link href="/2023/01/03/modern-cryptoiii-computational-security/"/>
      <url>/2023/01/03/modern-cryptoiii-computational-security/</url>
      
        <content type="html"><![CDATA[<h2 id="Computational-Security">Computational Security</h2><p>Perfect Securityåœ¨æ‹¥æœ‰æ— é™ç®—åŠ›çš„eavçªƒå¬è€…æƒ…å†µä¸‹æ˜¯å¯è¯æ˜å®‰å…¨çš„ï¼Œä¸ä¼šæ³„éœ²ä»»ä½•æœ‰å…³æ˜æ–‡çš„ä¿¡æ¯ï¼Œå› æ­¤è¢«ç§°ä¸º<strong>ä¿¡æ¯è®ºå®‰å…¨</strong>ã€‚ç„¶è€Œï¼Œè¯¥æ–¹æ³•å…·æœ‰å¯†é’¥é•¿åº¦å¿…é¡»å’Œæ˜æ–‡é•¿åº¦ç­‰é•¿ã€å¯†é’¥ä¸èƒ½å¤ç”¨ï¼Œä¸”åŠ å¯†æ–¹æ¡ˆæœ‰ç€ä¸å¿…è¦çš„å¼ºå®‰å…¨æ€§ã€‚å› æ­¤ï¼Œä¾¿æœ‰äº†æ›´å¼±å®‰å…¨æ„ä¹‰ä¸Šçš„è®¡ç®—å®‰å…¨æ€§ã€‚</p><p>è®¡ç®—å®‰å…¨æ€§ï¼ˆComputational Securityï¼‰ï¼Œè¿™ç§å®‰å…¨æ€§æœ‰ç€ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>å®ƒå¯ä»¥æŠµå¾¡ä»»ä½•æ‹¥æœ‰æœ‰é™ä½†åºå¤§ç®—åŠ›çš„æ•Œæ‰‹ã€‚</li><li>æœ‰ç€æå…¶å¾®å°çš„å¯èƒ½æ€§è¢«æ”»ç ´ã€‚</li></ol><p>å› æ­¤ï¼Œç†æƒ³çŠ¶å†µä¸‹ï¼Œè¿™ç§å®‰å…¨æ€§çš„æ”»ç ´æ–¹æ³•åªæœ‰æš´åŠ›ç©·ä¸¾æ‰€æœ‰çš„å¯†é’¥ã€‚</p><p>æœ‰ä¸¤ç§æè¿°è®¡ç®—å®‰å…¨æ€§çš„æ–¹æ³•ï¼šå…·ä½“/æ¸è¿›æ–¹æ³•ã€‚</p><h3 id="Concrete-Approach">Concrete Approach</h3><p>é€šè¿‡ç²¾ç¡®ç¡®å®šæœ€å¤§çš„è¢«æˆåŠŸæ”»ç ´çš„æ¦‚ç‡ç•Œé™æ¥æè¿°è®¡ç®—å®‰å…¨æ€§ã€‚æ•Œæ‰‹è¢«è®¤ä¸ºæ˜¯æ¦‚ç‡æ€§çš„ï¼ˆrandomizedï¼‰ã€‚<br>å½¢å¼åŒ–è€Œè¨€ï¼Œæœ‰ï¼š</p><div class="admonition warning"><p class="admonition-title">$(t,\xi)-secure$</p><p>A scheme is $(t,\xi)-secure$ if any adversary running for time at most $t$ succeeds in breaking the scheme with probability at most $\xi$.</p></div><p>å…·ä½“çš„å®‰å…¨æ€§åœ¨å®é™…é—®é¢˜ååˆ†é‡è¦ï¼Œä½†åœ¨æŠ½è±¡è®¨è®ºä¸Šçš„æ„ä¹‰è€Œè¨€ï¼Œç²¾ç¡®çš„å…·ä½“å®‰å…¨æ€§å¾ˆéš¾è¿›è¡Œè®¨è®ºã€‚<br>åœ¨ç›´è§‰ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¤ä¸ºï¼š$t$åº”å½“è¶³å¤Ÿçš„å¤§ï¼Œä¸”è¯¥æ–¹æ³•æ˜¯æœ‰æ•ˆçš„ï¼ˆå¤šé¡¹å¼è€ŒéæŒ‡æ•°ï¼‰ç®—æ³•ï¼›$\xi$æ˜¯ä¸€ä¸ªæ¸è¿›ç­‰äº0çš„å€¼ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°†é‡ç‚¹æŠ•å‘æ¸è¿›å®‰å…¨æ€§ã€‚</p><h3 id="Asymptotic-Approach">Asymptotic Approach</h3><p>æ¶‰åŠçŸ¥è¯†ï¼šå›¾çµæœºï¼Œä»¥åŠè®¡ç®—å¤æ‚æ€§ã€‚</p><p>ç”±ä¹‹å‰â… é‡Œå¤´çš„ä»‹ç»ï¼Œéœ€è¦å°½å¯èƒ½åœ°æ„é€ å‡ºæ¥å›¾çµæœºï¼ˆå‡†ç¡®æ¥è®²æ˜¯ç¡®å®šæ€§å›¾çµæœºï¼‰æ„ä¹‰ä¸Šçš„éš¾è§£é—®é¢˜ï¼Œä»è€Œæ„é€ å‡ºæ¸è¿›æ„ä¹‰ä¸Šçš„è®¡ç®—å®‰å…¨æ€§ã€‚</p><h4 id="Assumption-and-PPTï¼ˆæ¦‚ç‡æ„ä¹‰ä¸Šå¤šé¡¹å¼èƒ½åŠ›ï¼‰">Assumption and PPTï¼ˆæ¦‚ç‡æ„ä¹‰ä¸Šå¤šé¡¹å¼èƒ½åŠ›ï¼‰</h4><p>åœ¨è®¡ç®—å¤æ‚æ€§ä¸Šè®¨è®ºæ¸è¿›å®‰å…¨ï¼Œéœ€è¦æœ‰ä»¥ä¸‹å‡è®¾ï¼š</p><ol><li>å®‰å…¨å‚æ•° $n\in N$å¿…é¡»è¢«ä»»ä½•äººæ‰€çŸ¥ã€‚å®‰å…¨å‚æ•°å°±æ˜¯å…·ä½“å¯†é’¥çš„é•¿åº¦ã€‚</li><li>Honest partiesï¼ˆéæ•Œæ‰‹ï¼‰æ‹¥æœ‰å¯ä»¥è¿›è¡Œæ¦‚ç‡æ„ä¹‰ä¸Šçš„å¤šé¡¹å¼ç®—æ³•èƒ½åŠ›ï¼ˆPPTï¼‰ï¼Œæ¦‚ç‡æ„ä¹‰æ˜¯æŒ‡æ‰€æœ‰çš„PPTç®—æ³•éƒ½å¯ä»¥æ— æ¡ä»¶è·å–æ— åçš„ã€ç‹¬ç«‹çš„åºåˆ—ï¼Œå¤šé¡¹å¼åˆ™æ˜¯ï¼š<br>$\exists ~ polunomial~p(n)$,æ‰€æœ‰çš„honest partieséƒ½å¯ä»¥run in time $p(n)$</li><li>efficient adversaryä¹Ÿè¢«å®šä¹‰ä¸ºæ‹¥æœ‰PPTèƒ½åŠ›ï¼Œè¢«ç§°ä¸ºPPT adversaryã€‚</li></ol><div class="admonition info"><p class="admonition-title">Why PPT?</p><ol><li>è·å–æ— åç‹¬ç«‹çš„åºåˆ—æ•°æ®æ˜¯å¯†ç å­¦æ‰€å¿…éœ€çš„ï¼ˆä¾‹å¦‚ç”Ÿæˆéšæœºæ•°ï¼‰ï¼Œéæ•Œæ‰‹ç”¨æ­¤ç”Ÿæˆéšæœºå¯†é’¥ï¼Œåˆ™æ•Œæ‰‹ä¹Ÿåº”å½“å…·æœ‰è¯¥èƒ½åŠ›ã€‚</li><li>PPTæ•Œæ‰‹å¯èƒ½è¿˜æœ‰è¯æ˜ä¸äº†çš„ã€ç›¸è¾ƒçœŸå®ä¸–ç•Œçš„æ•Œæ‰‹çš„é™„åŠ èƒ½åŠ›ã€‚ä¸ºäº†è¯æ˜èƒ½å¤Ÿæ›´åŠ ä¸¥è°¨å®Œå–„ï¼Œå‡å®šæ•Œæ‰‹å…·æœ‰PPTèƒ½åŠ›ã€‚</li></ol></div><h4 id="Strong-Church-Turing-Thesis">Strong Church-Turing Thesis</h4><p>ç”¨ç±»ä¼¼è®¨è®ºè®¡ç®—å¤æ‚æ€§çš„æ–¹æ³•è®¨è®ºæ¸è¿›å®‰å…¨æ€§çš„å¦ä¸€ä¸ªåŸå› ä¾¿æ˜¯â… ä¸­è®¨è®ºçš„å¦‚å°æ ‡é¢˜æ‰€ç¤ºçš„ç†è®ºã€‚ä»»ä½•ç›®å‰å®é™…ä¸Šçš„æ¨¡å‹éƒ½å¯ä»¥åˆ’å½’åˆ°å¤šé¡¹å¼çš„ç®—æ³•ä¸Šï¼Œä¹Ÿå› æ­¤æˆ‘ä»¬å¯ä»¥è®¨è®ºå¸ƒå°”è¡¨è¾¾å¼ã€å›¾çµæœºã€éšæœºé¢„è¨€æœºç­‰å¯ä»¥å½’çº¦åˆ°å¤šé¡¹å¼ä¸Šçš„æ¨¡å‹ã€‚</p><h4 id="Definition">Definition</h4><div class="admonition warning"><p class="admonition-title">Definition:negligible function</p><p>$\forall~polynomial~p(.),\exists N~s.t. \forall n&gt;N:$$$f(n)&lt;\frac{1}{p(n)}$$</p></div><p>å³ï¼Œéšç€nå¢åŠ ï¼Œf(n)ä¸‹é™çš„çš„è¾ƒä»»æ„çš„1/p(n)æ›´å¿«ã€‚<br>æ¥ä¸‹é‡Œç»™å‡ºå½¢å¼åŒ–çš„æ¸è¿›å®‰å…¨å®šä¹‰ï¼š</p><div class="admonition warning"><p class="admonition-title">Definition: Asymptotic Approach</p><p>A scheme is secure if any PPT adversary succeeds in breaking scheme with at most <strong>negligible</strong> probability.</p></div><p>å½¢å¼åŒ–ä¸€ç‚¹ï¼Ÿ</p><div class="admonition warning"><p class="admonition-title">Definition: abstract</p><p>A scheme is secure that for every PPT adversary $\mathcal{A}$ï¼Œå…¶è¿›è¡Œç‰¹å®šçš„æ”»å‡»ï¼›for every positive polynomial $p$,there exists an integer $N$ such that when $n$ï¼ˆè¢«é€‰å®šçš„ä¸€ä¸ªå¸¸æ•°ï¼‰&gt;$N$,the probability that $\mathcal{A}$ succeeds in the attack is less than $1/p(n)$ã€‚</p></div><p>å› æ­¤ï¼Œå®‰å…¨å‚æ•°nçš„å¤§å°å’Œæ¸è¿›å®‰å…¨æ€§æ¯æ¯ç›¸å…³ã€‚å…¶ä¸­ï¼Œhonest partiesä¸€èˆ¬è€Œè¨€è¿è¡Œçš„æ˜¯å›ºå®šçš„å¤šé¡¹å¼ç®—æ³•ï¼Œå¦‚$O(n^2)$ï¼Œè€Œé˜²å¾¡çš„æ•Œæ‰‹éœ€è¦é’ˆå¯¹æ‰€æœ‰å¤šé¡¹å¼ï¼Œä¹Ÿå°±æ˜¯â€œæœ‰æ•ˆçš„â€ç®—æ³•ã€‚</p><h2 id="Computationally-secure-encryption">Computationally secure encryption</h2><h3 id="Definition-2">Definition</h3><p>$Gen(1^n)\rightarrow k,assume~~~~|k|\geq n$<br>$Enc_k(m)\rightarrow c(maybe~~probabilistic)$<br>$Dec_k( c)=m(deterministic)$</p><p>å…¶ä¸­ï¼ŒGenè¿è¡Œå¤šé¡¹å¼æ—¶é—´ï¼Œä¸”è‹¥æ¶ˆæ¯ç©ºé—´æ˜¯å›ºå®šçš„ï¼Œå¯è¢«ç§°ä¸ºfixed-length private-key encryptionï¼Œä¸ä¹‹åçš„æ“ä½œæ¨¡å¼ç›¸å¯¹åº”ã€‚<br>è¯¥å®šä¹‰æ˜¯æ— çŠ¶æ€çš„ï¼ˆæ— ä¸Šä¸‹æ–‡çš„çŠ¶æ€æ¶ˆæ¯ï¼‰<br>æœ€åï¼Œè¯¥å®šä¹‰ä¹Ÿæ»¡è¶³ä¹‹å‰ç±»ä¼¼çš„å®šä¹‰ä¸­çš„Correctnessã€‚</p><h3 id="EAV-security-experiment-oracle">EAV security experiment(oracle)</h3><p>è®¨è®ºè®¡ç®—å®‰å…¨æ€§æ—¶ï¼Œæœ‰ä»¥ä¸‹æ€§è´¨ï¼š<br>è¦æ±‚æ•Œæ‰‹å…·æœ‰æœ‰é™ç®—åŠ›ï¼Œå…è®¸æ•Œæ‰‹æœ‰å°æ¦‚ç‡è·èƒœçš„æœºä¼šï¼Œä»¥åŠåŠ å¯†çš„æ¶ˆæ¯é•¿åº¦å¯ä»¥ä»»æ„é•¿ï¼ˆä¸å…ˆå‰çš„perfect encryptionåŒºåˆ«ï¼‰ã€‚<br>å¯†é’¥ä»ç„¶ä¸å¯å¤ç”¨ã€‚</p><p>ä¹Ÿå› æ­¤ï¼Œè®¡ç®—å®‰å…¨æ€§ç›¸æ¯”äºä¿¡æ¯è®ºå®‰å…¨æ€§ï¼Œå…·æœ‰ä»¥ä¸Šçš„â€œæ¾å¼›â€ã€‚</p><p>oracleï¼š</p><ol><li>æ•Œæ‰‹å‘é¢„è¨€æœºå‘é€ä¸¤æ¡æ¶ˆæ¯$m_0,m_1$.</li><li>é¢„è¨€æœºæŒ‰å®šä¹‰ç”Ÿæˆkï¼Œéšæœºé€‰æ‹©$b\leftarrow \{0,1\}$å¹¶ç”Ÿæˆå¯†æ–‡cè¿”å›æ•Œæ‰‹ã€‚</li><li>æ•Œæ‰‹é‡‡å–ç­–ç•¥ï¼Œè¿”å›bâ€™ï¼Œè‹¥$b=bâ€™,output~~1$ï¼Œå¦åˆ™ä¸º0.</li></ol><p>å…¶å®é¢„è¨€æœºè¿‡ç¨‹å’Œå®Œç¾åŠ å¯†å¾ˆåƒï¼Œä½†å…¶å…·ä½“å®šä¹‰ä¸åŒã€‚</p><p>ä¹Ÿå› æ­¤ï¼Œæœ‰ä»¥ä¸‹å®šä¹‰ï¼š</p><div class="admonition warning"><p class="admonition-title">Definition: $PrivK_{\mathcal{A},\prod}^{eav}$</p><p>$\prod=(Gen,Enc,Dec)$åœ¨ä»¥ä¸Šå®éªŒè‹¥å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼Œåˆ™åœ¨EAVï¼ˆçªƒå¬è€…ï¼‰å­˜åœ¨çš„æƒ…å†µä¸‹å…·æœ‰ä¸å¯åŒºåˆ†æ€§ï¼š$$Pr[PrivK_{\mathcal{A},\prod}^{eav}(n)=1]\leq1/2+negl(n)$$æ¢å¥è¯è€Œè¨€ï¼šfor every PPT æ•Œæ‰‹$\mathcal{A}$:$$|Pr[out\mathcal{A}(PrivK_{\mathcal{A},\prod}^{eav}(n,0))=1]-Pr[out_\mathcal{A}(PrivK_{\mathcal{A},\prod}^{eav}(n,1))=1]|\leq negl(n)$$</p></div><p>ç¬¬ä¸€å’Œç¬¬äºŒçš„å®šä¹‰è™½ç„¶ç­‰ä»·ï¼Œä½†æ•Œæ‰‹è·èƒœçš„æ¦‚ç‡ä¸å¯èƒ½å°äº1/2ï¼ˆä¹±çŒœä¹Ÿèƒ½1/2å¯¹å§ï¼‰ï¼Œè€Œç¬¬äºŒç§å®šä¹‰æ˜¯ç»å¯¹å€¼å¼çš„å®šä¹‰ï¼Œå› æ­¤ç‰¹åœ°ç‚¹æ˜ã€‚</p><p>åœ¨ä¸Šé¢çš„å®šä¹‰è¿‡ç¨‹ä¸­ï¼Œoracleå®éªŒåªè¿›è¡Œäº†å•ä¸ªå¯†æ–‡çš„è¿‡ç¨‹ï¼Œæ•Œæ‰‹é™¤äº†å•ä¸ªå¯†æ–‡å¤–æ²¡æœ‰å¾—åˆ°ä»»ä½•çš„ä¿¡æ¯ã€‚</p><h3 id="Plaintext-length">Plaintext length</h3><p>å‘é€å¯†æ–‡çš„è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬è‚¯å®šä¼šæ³„éœ²çš„ä¿¡æ¯é™¤äº†å¯†æ–‡è¢«å‘é€è¿™ä¸ªè¡Œä¸ºæœ¬èº«å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªçœ‹ä¸Šå»ä¸å¤ªæ•æ„Ÿçš„åœ°æ–¹ï¼š<strong>æ˜æ–‡é•¿åº¦</strong>ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ˜æ–‡é•¿åº¦çš„æ³„éœ²ä¸ä¼šé€ æˆä»€ä¹ˆå½±å“ï¼Œä½†ä»ç„¶å­˜åœ¨ç€æ”»å‡»æ‰‹æ®µã€‚ä¾‹å¦‚ï¼š</p><p>Crime attackï¼šå¾ˆå¤šæ˜æ–‡åœ¨åŠ å¯†å‰ä¼šè¿›è¡Œå‹ç¼©ï¼Œå‡è®¾æœ‰ä¸¤æ¡ä¿¡æ¯X,Yï¼Œæ‹¼æ¥åçš„å­—ç¬¦ä¸²ä¸ºX||Y,è‹¥Xä¸Yç›¸åƒï¼Œå‹ç¼©ç®—æ³•ä¼šå°†å…¶å‹ç¼©ï¼Œé•¿åº¦ç¼©å°ä»è€Œæš´éœ²X,Yçš„ç›¸å…³ä¿¡æ¯ã€‚</p><p>é‡åˆ°è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬è€Œè¨€éœ€è¦å¯¹æ¶ˆæ¯å¡«å……è‡³å›ºå®šé•¿åº¦ï¼Œä½†æ— æ³•å®Œå…¨é¿å…é•¿åº¦æ¶ˆæ¯çš„æ³„éœ²ã€‚</p><h3 id="Semantic-Securityï¼ˆè¯­ä¹‰å®‰å…¨ï¼‰">Semantic Securityï¼ˆè¯­ä¹‰å®‰å…¨ï¼‰</h3><p>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬è®¨è®ºçš„computational security notionå»ºç«‹åœ¨ä¸å¯åŒºåˆ†æ€§ï¼ˆindistinguishabilityï¼‰ä¸Šã€‚åœ¨ä¸Šä¸€èŠ‚çš„è®¨è®ºä¸­ï¼Œæ˜æ–‡é•¿åº¦çš„æ³„éœ²ä¸å¯é¿å…ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›é™¤æ­¤ä¹‹å¤–ä¸å†æ³„éœ²ä»»ä½•æ¶ˆæ¯ã€‚</p><p>ä¹Ÿå› æ­¤æœ‰äº† <strong>Semantic Securityï¼ˆè¯­ä¹‰å®‰å…¨ï¼‰</strong> ä»¥åŠå…¶<s>ååˆ†è¯¡å¼‚çš„</s>å®šä¹‰ï¼š<br><s>å·æ‡’è´´PPT</s></p><div class="admonition warning"><p class="admonition-title">Definition Semantic Security</p><p>A private-key encryption scheme $Enc,Dec$ is semantical secure in the presence of an eavesdropper if for every PPT algorithm $\mathcal{A}$ there exists a PPT algorithm $\mathcal{A'}$ such that for any PPT algorithm $Samp$ and poly-time computable functions $f$ and $h$, the following is negligible:$$|Pr[\mathcal{A}(1^n,Enc_k(m),h(m))=f(m)]-Pr[\mathcal{A'}(1^n,|m|,h(m))=f(m)]|$$</p></div><p>å…¶ä¸­çš„h(m)å¯ä»¥çœ‹ä½œé™„åŠ çš„ä¿¡æ¯ä»¥å‡½æ•°çš„æ–¹å¼å±•ç°ï¼›è€Œf(m)å¯ä»¥çœ‹ä½œè¿›è¡ŒéªŒè¯æ‰€éœ€çš„è°“è¯ï¼ˆæˆ–è€…è¯´è¡Œä¸ºï¼‰ã€‚<br>å¤ªç»•äº†ï¼Ÿæ‰€å¹¸çš„æ˜¯ï¼Œæœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><div class="admonition info"><p class="admonition-title">info</p><p><strong>private-key encryption scheme çš„ä¸å¯åŒºåˆ†æ€§å’Œè¯­ä¹‰å®‰å…¨æ˜¯ç­‰ä»·çš„</strong>ï¼Œè¯¥æ€§è´¨å¯¹äºä»»æ„çš„å¨èƒæ¨¡å‹éƒ½æˆç«‹ã€‚</p></div><h2 id="Pseudorandomnessï¼ˆä¼ªéšæœºæ€§ï¼‰">Pseudorandomnessï¼ˆä¼ªéšæœºæ€§ï¼‰</h2><p>çœŸéšæœºæ•°çš„ç”Ÿæˆå¼€é”€å·¨å¤§ï¼ˆè™½ç„¶æ˜¯å¯ä»¥ç”Ÿæˆçš„ï¼‰ï¼Œå¯†ç å­¦çš„ä¼ªéšæœºæ€§æ„å‘³ç€ï¼šè¯¥ç”Ÿæˆåˆ†å¸ƒæ— æ³•æœ‰æ•ˆçš„ï¼ˆä¹Ÿå°±æ˜¯æœ‰é™ç®—åŠ›ï¼‰å’ŒçœŸéšæœºåˆ†å¸ƒç›¸åŒºåˆ†ã€‚</p><div class="admonition warning"><p class="admonition-title">Definition: a Sequence of Pseudorandom Distributions</p><p>A sequence of distributions $\{Dist_n\}_{n\in N}$ where$\{Dist_n\}=l(n)$ for some  polynomial $l$ is pseudorandom, if for every PPT distinguisher $\mathcal{D}$:</p><p>$$|Pr[\mathcal{D}(U_{l(n)})=1]-Pr[\mathcal{D}(Dist_n)=1]|\leq negl(n)$$</p></div><p>ä¹Ÿå› æ­¤ï¼Œå¯ä»¥å°†å…¶ä½œä¸ºä¸Šè¿°åŠ å¯†æ–¹æ¡ˆä¸­çš„Genï¼Œç”¨äºç”Ÿæˆå¯†é’¥ï¼š</p><div class="admonition warning"><p class="admonition-title">Definition Pseudorandomness Generator(PRGs)</p><p>A (deterministic) poly-time algorithm$$G:\{0,1\}^n\rightarrow \{0,1\}^{l(n)}$$is a pseudorandom generator if:</p><ol><li>(<strong>Expansion</strong>)$\forall n,l(n)&gt;n$.</li><li>(<strong>Pseudorandomness</strong>)$\{G(U_N)\}_{n \in N} $ is a sequence of pseudorandom distributions.</li></ol></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š PRG çš„æš´åŠ›ç ´è§£æ–¹æ³•å…·æœ‰ä»¥ä¸‹è¢«ç ´è§£çš„ä¼˜åŠ¿ï¼š<br>$$|Pr[\mathcal{D}(U_{l(b)})=1]-Pr[\mathcal{D}(G(U_n))=1]|\geq 1-2^{n-l(n)}$$<br>è™½ç„¶è¯´PRGæ— æ³•è¢«æœ‰æ•ˆçš„åŒºåˆ†ï¼Œä½†PRGçš„è¾“å‡ºå¹¶ä¸æ˜¯uniformçš„ã€‚æœ¬è´¨ä¸Šï¼ŒPRGå¯ä»¥çœ‹ä½œä»é•¿åº¦è¾ƒå°çš„uniformæ•°æ®æ˜ å°„åˆ°é•¿åº¦è¾ƒé•¿çš„ä¼ªéšæœºæ€§å¯†é’¥ã€‚</p><p>ä¸åšè¯æ˜çš„ï¼šPRGå­˜åœ¨å½“ä¸”ä»…å½“å•å‘å‡½æ•°ï¼ˆæš‚æ—¶ä¸åšè¯´æ˜ï¼‰å­˜åœ¨ã€‚</p><h3 id="Encryption-where-mathcal-M-mathcal-K">Encryption where |$|\mathcal{M}|&gt;&gt;|\mathcal{K}|$|</h3><p>åŸºäº One-time padï¼Œè¿™é‡Œæå‡ºä¸€ä¸ªåŠ å¯†æ–¹æ¡ˆã€‚<br>using PRG $G:\{0,1\}^n\rightarrow \{0,1\}^{l(n)}$<br>é€‰æ‹©å®‰å…¨å‚æ•° $n\in N,\mathcal{K}=\{0,1\}^n,\mathcal{M}=\mathcal{C}=\{0,1\}^{l(n)}$<br>Gen(é$G$) ç”Ÿæˆéšæœºæ€§å¯†é’¥kï¼š<br>$$Enc_k(m)=m\oplus G(k)$$<br>$$Dec_k( c )=c\oplus G(k)$$<br>äºæ˜¯æœ‰ï¼š</p><div class="admonition info"><p class="admonition-title">info</p><p>åœ¨ä¸Šè¿°çš„åŠ å¯†æ–¹æ¡ˆä¸­ï¼Œè‹¥Genæ˜¯æœ¬èŠ‚å®šä¹‰çš„PRGï¼Œåˆ™è¯¥fixed-length private-key encryption scheme åœ¨EAVä¸‹å…·æœ‰ä¸å¯åŒºåˆ†æ€§ã€‚</p></div><h2 id="Reductionï¼ˆå½’çº¦æ€§è¯æ˜ï¼‰">Reductionï¼ˆå½’çº¦æ€§è¯æ˜ï¼‰</h2><p><strong>å½’çº¦</strong>çš„æ¦‚å¿µåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ååˆ†é‡è¦ã€‚</p><p>å…¶æœ¬è´¨æ˜¯å¯¹ä¸Šè¿°æ„é€ çš„åŠ å¯†æ–¹æ¡ˆè¿›è¡Œè¯æ˜ï¼Œè‹¥è¦æ”»ç ´å…¶æ–¹æ¡ˆï¼Œå¿…é¡»è¦æ”»ç ´å…¶å†…ç½®çš„å·²è¢«è¯æ˜å®‰å…¨æ€§çš„æ¨¡å—ã€‚é€šè¿‡åè¯æ³•å³å¯è¯æ˜æ„é€ çš„åŠ å¯†æ–¹æ¡ˆå®‰å…¨æ€§ã€‚</p><p>è€Œå¦‚ä½•æ„å»ºè¿™ç§åè¯ï¼Ÿæ—¢ç„¶æˆ‘ä»¬å°†åŠ å¯†æ–¹æ¡ˆçš„å®‰å…¨æ€§å½’çº¦åˆ°äº†å…¶<strong>åº•å±‚æ„ä»¶çš„å®‰å…¨æ€§</strong>ï¼Œè€Œå¦‚ä»Šæˆ‘ä»¬æ‰€è®¨è®ºè¿‡çš„è¯æ˜å®‰å…¨æ€§çš„æ–¹æ³•åªæœ‰<strong>é¢„è¨€æœº</strong>ï¼Œé‚£ä¹ˆç­”æ¡ˆå‘¼ä¹‹æ¬²å‡ºï¼š</p><p>æ„é€ ä¸€ä¸ªæ•Œæ‰‹$\mathcal{A}$å»æ”»ç ´æ„å»ºçš„åŠ å¯†æ–¹æ¡ˆã€‚è€Œæ”»ç ´è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°†é€šè¿‡ä¸€ç³»åˆ—è¿‡ç¨‹ï¼Œå°†æ•Œæ‰‹è¾“å…¥è½¬åŒ–ä¸ºæŠ½è±¡çš„æ•Œæ‰‹$\mathcal{Aâ€™}$ï¼Œå…¶å¯¹åº•å±‚çš„æ„ä»¶è¿›è¡Œé¢„è¨€æœºå®éªŒï¼Œå†å°†é¢„è¨€æœºè¾“å‡ºè½¬åŒ–åè¿”å›ç»™$\mathcal{A}$.ç”±äºåº•å±‚çš„æ„å»ºå·²è¢«è¯æ˜å®‰å…¨æ€§,é‚£ä¹ˆä¾¿å¯ä»¥è¯æ˜åŠ å¯†æ–¹æ¡ˆå®‰å…¨æ€§ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯æ¨¡æ‹ŸæŠ½è±¡æ•Œæ‰‹çš„è¿‡ç¨‹ã€‚å¯¹äºè¯¥å½’çº¦è¿‡ç¨‹è€Œè¨€ï¼Œå¯¹æ•Œæ‰‹$\mathcal{A}$çš„å”¯ä¸€äº†è§£å°±æ˜¯ä»–æœŸæœ›ä¸é¢„è¨€æœºè¿›è¡ŒæŒ‘æˆ˜ï¼Œé‚£ä¹ˆå½’çº¦è¿‡ç¨‹å¿…é¡»æ¨¡æ‹Ÿåœ°å’Œé¢„è¨€æœºè¡Œä¸ºä¸€è‡´ã€‚</p><p>å…·ä½“è€Œè¨€è¿˜æœ‰è®¸å¤šç®—å¼ï¼Œä½†è¿™é‡Œç•¥äº†ã€‚æ‡’ã€‚</p><hr><p>æœ¬èŠ‚å®é™…ä¸Šæ˜¯å¯¹ä¸ŠèŠ‚çš„warningè¿›è¡Œè¯æ˜ï¼Œä½†ç”±äºå…¶é‡è¦æ€§å•å¼€ä¸€èŠ‚ï¼Œåˆå› ä¸ºæ‡’äº†æ‰€ä»¥ç­‰ä¹‹åæœ‰ç©ºäº†å†™åšå®¢é‡Œå¤´ã€‚<br>æœ¬è´¨ä¸Šè¿™ä»½åšå®¢è¿˜æ˜¯ä¸€ä»½å¤ä¹ çš„ï¼Œä½†å†™åšå®¢è€—è´¹çš„æ—¶é—´è¶…å‡ºäº†æˆ‘çš„é¢„æœŸã€‚ä¹‹åè¦å°½å¯èƒ½ç®€ç•¥å†™äº†ã€‚</p><h2 id="Stronger-security-notions-CPA-Security">Stronger security notions(CPA Security)</h2><p>ä¹‹å‰è®¨è®ºçš„éƒ½ä¸ºå•æ¶ˆæ¯çš„åŠ å¯†è¿‡ç¨‹ï¼Œè¿™é‡Œå¼€å§‹è®¨è®ºé€‰æ‹©æ˜æ–‡æ”»å‡»ï¼Œå³å¯ä»¥é€‰æ‹©å¤šä¸ªæ˜æ–‡ï¼Œå¾—åˆ°å¯¹åº”çš„å¯†æ–‡ï¼ˆ<strong>éƒ½æ˜¯ç”¨å•ä¸ªå¯†é’¥åŠ å¯†</strong>ï¼‰æ¥è¯•å›¾è·å¾—ç›¸å…³ä¿¡æ¯ï¼Œè€Œé€‰æ‹©æ˜æ–‡æ”»å‡»åˆå¯ä»¥åˆ†ä¸ºé€‚åº”æ€§å’Œéé€‚åº”æ€§æ”»å‡»ã€‚</p><p><strong>éé€‚åº”æ€§CPA</strong>ï¼šåœ¨ä¸Šè¿°çš„é¢„è¨€æœºå®éªŒä¸­ï¼Œæ•Œæ‰‹ç¬¬ä¸€æ­¥é€‰æ‹©äº†ä¸€å¯¹æ˜æ–‡è¿›è¡Œå®éªŒï¼›è€Œè¿™é‡Œçš„CPAåˆ™æ˜¯åœ¨ç¬¬ä¸€æ­¥å°†é€‰æ‹©å¤šä¸ªæ˜æ–‡ï¼Œå’Œè¿™ä¸€å¯¹æ˜æ–‡åŒæ—¶å‘å‡ºï¼Œå¹¶è·å¾—ç”¨ç›¸åŒå¯†é’¥åŠ å¯†çš„å¯†æ–‡å›åº”ã€‚æ•Œæ‰‹è·å¾—äº†å¤šä½™çš„ä¿¡æ¯ï¼Œå¹¶ä»ç„¶å¯¹é€‰å®šçš„ä¸€å¯¹æ˜æ–‡è¿›è¡Œç”„åˆ«ã€‚</p><p><strong>é€‚åº”æ€§CPA</strong>ï¼šæ— éœ€åœ¨æ„å¤šä¸ªæ˜æ–‡çš„é€‰æ‹©æ˜¯å¦éœ€è¦åœ¨ç¬¬ä¸€æ­¥å°±å…¨éƒ¨å®Œæˆã€‚æ•Œæ‰‹å¯ä»¥æ ¹æ®ä¸Šä¸€æ¬¡çš„å›åº”è€Œæ”¹å˜ä¸‹ä¸€æ¬¡å‘é€çš„æ˜æ–‡ï¼Œä»è€Œè·å¾—æ›´å¤šçš„ä¿¡æ¯ï¼Œæ•Œæ‰‹çš„èƒ½åŠ›ä¹Ÿå› æ­¤è¾ƒéé€‚åº”æ€§CPAå¢å¼ºã€‚é€‚åº”æ€§æ”»å‡»å¯ä»¥åœ¨å‘é€é€‰å®šçš„ä¸€å¯¹æ˜æ–‡å‰è¿›è¡Œå‘é€/æ”¶åˆ°å›åº”ï¼Œä¹Ÿå¯ä»¥åœ¨ä¹‹åè¿›è¡Œå‘é€/æ”¶åˆ°å›åº”ï¼Œä¸”ä»ç„¶éœ€è¦å¯¹è¯¥é€‰å®šçš„æ˜æ–‡è¿›è¡Œç”„åˆ«ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ç§CPAå‘é€çš„å¤šä½™æ˜æ–‡ï¼Œå…¶é•¿åº¦éƒ½å¿…é¡»å’Œé€‰å®šçš„ä¸€å¯¹æ˜æ–‡é•¿åº¦ä¸€è‡´ã€‚</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªLeft-or-right Securityï¼Œä¸åšå¤šä½™ä»‹ç»ã€‚</p><div class="admonition warning"><p class="admonition-title">Definition</p><p>Private-key encryption scheme Î  has indistinguishable multiple encryptions under a chosen-plaintext attack, or is CPA-secure for multiple encryptions, if for all probabilistic polynomial-time adversary A there is a negligible function negl such that$$Pr[PrivK_{\mathcal{A},\prod}^{LR-cpa}(n)=1]\leq 1/2+negl(n)$$where the probability is taken over the randomness used by A and the randomness used in the experiment.</p></div><div class="admonition info"><p class="admonition-title">info</p><p>Any private-key encryption scheme that is CPA-secure is also a CPA-secure for multiple encryptions.</p></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DevOpsåˆæ¢--ä¸€æ¬¡ä¸æˆåŠŸçš„æ‹›æ–°ç»å†</title>
      <link href="/2022/12/25/devops-chu-tan-yi-ci-bu-cheng-gong-de-zhao-xin-jing-li/"/>
      <url>/2022/12/25/devops-chu-tan-yi-ci-bu-cheng-gong-de-zhao-xin-jing-li/</url>
      
        <content type="html"><![CDATA[<p>æ— é¡¹ç›®ç»å†è€…ä¸å¾—å…¥æ˜Ÿè¾°DevOpsã€‚<br>åŠå¼€ç©ç¬‘ï¼Œè™½ç„¶ç¬”è¯•å®Œæˆçš„è‡ªè®¤ä¸ºè¿˜è¡Œï¼Œä½†å¯èƒ½è¿˜æœ‰ç¼ºé™·ï¼Œè¿™é‡Œå°±æ”¾ä¸‹ç­‰ä¹‹åæœ‰é¡¹ç›®ç»å†äº†æ¥å“é‰´ä¸€ä¸‹è¿™å¨ç­”è¾©å§ã€‚DevOpsçœ‹é‡é¡¹ç›®ç»å†å½“ç„¶æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œä½†æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯é¢è¯•åŸºæœ¬ä¸Šåªé—®è¿™ä¸€ç‚¹ã€‚è¯„åˆ¤æ ‡å‡†æ˜ç¡®äº†é‚£è¢«è–„çº±ä¹Ÿæ˜¯åˆæƒ…åˆç†ã€‚</p><p>å¿«è¿›åˆ°ç»å…¸ç¬‘è¯ï¼š<br>â€œä½ æ¥æ˜Ÿè¾°æœ‰é¡¹ç›®ç»å†å—â€<br>â€œæ²¡æœ‰ï¼Œä½†æˆ‘å¾—è¿›äº†æ˜Ÿè¾°æ‰èƒ½æœ‰é¡¹ç›®ç»å†â€<br>è¿™å°±æ˜¯å¤§ä¸€æ‘†æ²¡æœ‰æé¡¹ç›®çš„ä¸‹åœº.jpg</p><p>è¿‡ç¨‹æˆªå›¾å°±ä¸æ”¾äº†ï¼Œè¿™é‡ŒæŠŠéƒ¨åˆ†é¢˜ç›®æ”¾å‡ºæ¥ã€‚</p><p>ç›¸å…³é“¾æ¥ï¼š</p><p><a href="https://docs.docker.com/">dockerå®˜æ–¹æ–‡æ¡£</a><br><a href="https://docs.gitlab.com">gitlabå®˜æ–¹æ–‡æ¡£</a><br><a href="https://gitlab.com/">gitlabå®˜ç½‘</a><br><a href="https://gitlab.com/ZzzRemake">æˆ‘çš„gitlabä¸»é¡µ</a></p><h2 id="å‘½ä»¤è¡Œå…¥é—¨">å‘½ä»¤è¡Œå…¥é—¨</h2><h3 id="æ€è€ƒé¢˜-ä¸å›¾å½¢ç•Œé¢ç›¸æ¯”ï¼Œå‘½ä»¤è¡Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ">æ€è€ƒé¢˜ ä¸å›¾å½¢ç•Œé¢ç›¸æ¯”ï¼Œå‘½ä»¤è¡Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</h3><p>å‘½ä»¤è¡Œç›¸æ¯”å›¾å½¢ç•Œé¢æ¶ˆè€—çš„èµ„æºæ›´å°‘ï¼Œèƒ½å¤Ÿè®©ç”¨æˆ¶é¿å¼€å›¾å½¢ç•Œé¢çš„æ‚ä¹±ï¼ˆå¤„ç†å¤§é‡æ•°æ®ç­‰åœºæ™¯ï¼‰æ›´ä¸“æ³¨æ“ä½œå‘½ä»¤ã€ä¿¡æ¯ç­‰æœ¬è´¨éœ€æ±‚ï¼Œæ“ä½œæ›´åŠ çµæ´»ï¼›ä¸”åœ¨æŸäº›æ— æ³•ä½¿ç”¨å›¾å½¢ç•Œé¢ç¨‹åºæˆ–ç›¸å…³è®¾æ–½çš„æƒ…å†µä¸‹ï¼Œå‘½ä»¤è¡Œå¿…ä¸å¯å°‘ã€‚</p><p>é¡ºå¸¦ä¸€æï¼Œè¿™é‡Œå¯ä»¥å»äº†è§£ä¸€ä¸‹å„å¤§Shellã€‚<br>æ¥ä¸ªçŸ¥ä¹è¿æ¥ï¼š<a href="https://www.zhihu.com/question/21418449/answer/2292448029">DavidZçš„å›ç­”</a></p><p>ä¹‹åæä¸€ä¸ªä¸“é—¨çš„å‘½ä»¤è¡Œåˆ†ç±»å­¦å­¦ç½¢ã€‚</p><h2 id="Linuxå®‰è£…è½¯ä»¶">Linuxå®‰è£…è½¯ä»¶</h2><h3 id="docker">docker</h3><p>dockerå®˜æ–¹æ–‡æ¡£æä¾›äº†Docker desktopå’ŒDocker Engineçš„ä¸¤ç§ä¸‹è½½æ–¹å¼ï¼Œæˆ‘æ˜¯å®‰è£…äº†Docker Engineï¼Œå¹¶ä¸”åŸºæœ¬æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤è¿›è¡Œçš„ã€‚<br>æ‰€æœ‰æ­¥éª¤é™„åœ¨ä»¥ä¸‹ä»£ç å—ä¸­ï¼Œå¹¶ä»¥æ³¨é‡Šæ³¨æ˜è¿‡ç¨‹ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash"># ç¬¬ä¸€æ­¥ï¼Œå¸è½½æ—§ç‰ˆæœ¬ï¼ˆç„¶è€Œæˆ‘çš„Ubuntuæ ¹æœ¬æ²¡æœ‰ï¼‰sudo apt-get remove docker docker-engine docker.io containerd runc# ç¬¬äºŒéƒ¨ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡è£…ï¼Œéœ€è¦å»ºç«‹æ–°çš„Docker ä»“åº“# 1.ä¾èµ–é¡¹sudo apt-get updatesudo apt-get install ca-certificates curl gnupg lsb-release# 2.curl add GPGkeysudo mkdir -p /etc/apt/keyringscurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg# 3. å»ºç«‹ä»“åº“echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; / dev/null# ç¬¬ä¸‰æ­¥ï¼Œæ­£å¸¸çš„ç”¨apt-getå®‰è£…sudo apt-get updatesudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin# æµ‹è¯•ä¸€ä¸‹ï¼Ÿsudo docker run hello-world</code></pre><h3 id="æ€è€ƒé¢˜-Linuxä¸‹å®‰è£…è½¯ä»¶ä¸Windows-macOSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">æ€è€ƒé¢˜ Linuxä¸‹å®‰è£…è½¯ä»¶ä¸Windows/macOSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>Linuxå¯ä»¥é€šè¿‡åŒ…ç®¡ç†å·¥å…·æ–¹ä¾¿çš„è·å–æœ€æ–°çš„è½¯ä»¶å¹¶æ›´æ–°ï¼Œaptç­‰åŒ…ç®¡ç†å·¥å…·åœ¨å®‰è£…è½¯ä»¶çš„æ—¶å€™å¯ä»¥å®‰è£…ä¾èµ–é¡¹ï¼Œå¤§å¤§ç®€åŒ–äº†å®‰è£…è½¯ä»¶çš„è¿‡ç¨‹ã€‚Windowsåˆ™æ˜¯é€šè¿‡ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶(exe)ç­‰æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œæ— æ³•è§£å†³ä¾èµ–é—®é¢˜ï¼ŒLinuxå½“ç„¶ä¹Ÿæœ‰ç±»ä¼¼çš„å®‰è£…åŒ…ç›´æ¥å®‰è£…ï¼Œä¸è§£å†³ä¾èµ–çš„æ–¹å¼ï¼Œaptç­‰åŒ…ç®¡ç†ä¾¿æ”¹å–„äº†è¿™ä¸€ç‚¹ã€‚</p><p><strong>åæ¥ä¿®è®¢éƒ¨åˆ†</strong><br>å½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥æ‰©å±•å¼€è®²ã€‚dpkgï¼Œdebä¹‹ç±»çš„ã€‚ã€‚emmmï¼Œå½’linuxæ¡£ï¼Ÿå’Œå…ˆå‰é‚£ä¸ªå‘½ä»¤è¡Œä¸€èµ·ã€‚</p><h2 id="ç½‘ç»œç›¸å…³">ç½‘ç»œç›¸å…³</h2><h3 id="æ€è€ƒé¢˜-OSIä¸ƒå±‚æ¨¡å‹çš„æ•°æ®å¤„ç†è¿‡ç¨‹">æ€è€ƒé¢˜ OSIä¸ƒå±‚æ¨¡å‹çš„æ•°æ®å¤„ç†è¿‡ç¨‹</h3><p>åº”ç”¨å±‚ï¼šå°†æ•°æ®å‘ˆç°ç»™ç”¨æˆ¶ï¼›è¡¨ç¤ºå±‚ï¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®ç¼–ç è§£ç æˆåº”ç”¨å±‚èƒ½è¯»å–çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥å¯¹æ•°æ®åŠ å¯†è§£å¯†ï¼›ä¼šè¯å±‚ï¼šå†ä¸¤å°ä¸»æœºé—´å»ºç«‹ä¼šè¯ä»¥ä¼ è¾“æ•°æ®ã€‚<br>ä»¥ä¸Šå±‚çš„PDUéƒ½ä¸ºæ•°æ®ï¼ˆdataï¼‰ï¼Œéƒ½æ˜¯å’Œåº”ç”¨æœ¬èº«ç›¸å…³çš„æ•°æ®ã€æ¶ˆæ¯æŠ¥æ–‡ç­‰ã€‚<br>è€Œä¼ è¾“å±‚å°†PDUåˆ†æ®µä¸ºsegmentï¼ˆTCPï¼‰æˆ–è€…æ•°æ®æŠ¥datagramï¼ˆUDPï¼‰ï¼Œä¸¤è€…å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚åˆ†æ®µå‰è¿›è¡Œæ•°æ®å°è£…ï¼ŒåŠ ä¸ŠTCPæˆ–UDPç­‰æœ‰å…³ä¿¡æ¯ã€‚<br>ç½‘ç»œå±‚å°†æ•°æ®å¤´åŠ ä¸ŠIPä¿¡æ¯ï¼ŒåŒ…å«äº†é€»è¾‘å¯»å€çš„ä¿¡æ¯ï¼Œä¹‹åå°†å¤„ç†åçš„PDUï¼šåŒ…ï¼ˆPacketï¼‰ä¼ è¾“ç»™æ•°æ®é“¾è·¯å±‚ã€‚<br>æ•°æ®é“¾è·¯å±‚çš„PDUå½¢å¼ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œå…¶ä¸­åŠ ä¸Šäº†LLCå¤´ï¼ˆä¸ç¡¬ä»¶æ— å…³ï¼‰å’ŒMACå¤´ï¼ˆå¯»å€ç­‰ç¡¬ä»¶ç›¸å…³ï¼‰ï¼›ç‰©ç†å±‚åˆ™å°†æ•°æ®å¤„ç†ä¸ºäºŒè¿›åˆ¶æµæ•°æ®ä½ï¼ˆbitï¼‰</p><h3 id="å®è·µé¢˜-Linuxé…ç½®è·¯ç”±è®¿é—®å¤–ç½‘">å®è·µé¢˜ Linuxé…ç½®è·¯ç”±è®¿é—®å¤–ç½‘</h3><p>NATæ¨¡å¼ä¸‹çš„linuxè™šæ‹Ÿæœºæ— æ³•å®Œæˆä»»åŠ¡ï¼Œå› æ­¤å°†è™šæ‹Ÿæœºåˆ‡æ¢æˆæ¡¥æ¥æ¨¡å¼ã€‚<br>ç„¶è€Œï¼Œæ¡¥æ¥æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é»˜è®¤è·¯ç”±æ˜¯æ²¡æœ‰ä»»ä½•å¤šä½™è®¾ç½®çš„ï¼Œå› æ­¤ï¼Œåœ¨å–æ¶ˆNATçš„è®¾ç½®åï¼Œç½‘å¡çš„è·¯ç”±æ— æ³•æ”¹å˜ï¼Œåœ¨å®¿ä¸»æœºåˆ‡æ¢WIFIçš„æ—¶å€™ä¾¿å› ä¸ºæ²¡æœ‰åˆæ³•IPåœ°å€è€Œæ— æ³•è”ç½‘ã€‚ï¼ˆå¤§æ¦‚ã€‚ã€‚ç¬¦åˆé¢˜ç›®è¦<br>æ±‚ï¼Ÿï¼‰<br>äºæ˜¯åœ¨<code>/etc/netplan</code>æ–‡ä»¶å¤¹ï¼ˆæ–°ç‰ˆçš„Ubuntuç½‘ç»œé…ç½®æ–‡ä»¶ä¸å…¶ä»–ç³»ç»Ÿä¸åŒï¼‰æ‰¾åˆ°yamlå¹¶ä¿®æ”¹ï¼š</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml">network:     version: 2    renderer: NetworkManager    ethernets:        ens33:            dhcp4: true            dhcp6: true</code></pre><p>è¿™é‡Œç”¨dhcpåŠ¨æ€é…ç½®ipï¼Œens33è¡¨ç¤ºç½‘å¡ã€‚emmmï¼Œå…¶ä»–çš„è¿˜æ˜¯éœ€è¦æŸ¥ä¸€ä¸‹çš„ã€‚</p><p>ä¹‹åè™šæ‹Ÿæœºå’Œä¸»æœºèƒ½å¤Ÿpingé€šï¼Œä¹Ÿèƒ½å¤Ÿè®¿é—®å¤–ç½‘ã€‚</p><h3 id="é€‰åšé¢˜-è¯·ç®€è¿°äºŒå±‚äº¤æ¢æœºã€ä¸‰å±‚äº¤æ¢æœºã€è·¯ç”±å™¨ä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠå®ƒä»¬ä¸€èˆ¬è¢«éƒ¨ç½²åœ¨ç½‘ç»œçš„å“ªäº›ä½ç½®ä¸Š">é€‰åšé¢˜ è¯·ç®€è¿°äºŒå±‚äº¤æ¢æœºã€ä¸‰å±‚äº¤æ¢æœºã€è·¯ç”±å™¨ä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠå®ƒä»¬ä¸€èˆ¬è¢«éƒ¨ç½²åœ¨ç½‘ç»œçš„å“ªäº›ä½ç½®ä¸Š</h3><p>äºŒå±‚äº¤æ¢æœºä½äºOSIç¬¬äºŒå±‚ï¼Œå¯ä»¥ç”¨MACåœ°å€è½¬å‘æ•°æ®ï¼ˆå¯ä¼ è¾“åˆ°å•ä¸€ä¸»æœºï¼Œä¸é›†çº¿å™¨çš„å¹¿æ’­åŒºåˆ†ï¼‰ï¼Œå¯ä»¥ç”¨äºVLANç­‰æ–¹å¼åˆ’åˆ†å¹¿æ’­åŸŸï¼›ä¸‰å±‚äº¤æ¢æœºåœ¨åŠ ä¸Šäº†è·¯ç”±æ¨¡å—ï¼Œä»è€ŒåŠ é€Ÿè½¬å‘æ•°æ®åŒ…çš„è¿‡ç¨‹ï¼ˆä¸€æ¬¡è·¯ç”±ï¼Œå¤šæ¬¡è½¬å‘ï¼‰ã€‚<br>ç„¶è€Œï¼Œä¸‰å±‚äº¤æ¢æœºåªèƒ½éƒ¨åˆ†å®ç°è·¯ç”±å™¨çš„åŠŸèƒ½ã€‚è¿æ¥WANçš„è·¯ç”±å™¨æ‰€éœ€ç»´æŠ¤çš„è¡¨é¡¹ååˆ†åºå¤§ä¸”å­˜åœ¨åˆ·æ–°çš„å¯èƒ½ï¼Œè¿™å¯¹ä¸‰å±‚äº¤æ¢æœºæ¥è¯´ä»»åŠ¡è¿‡äºç¹é‡ï¼Œä¸”å¤§é‡çš„æ•°æ®ä¹Ÿå¯¹å…¶åŠ é€Ÿè½¬å‘çš„æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ï¼Œå› è€Œè¿™éƒ¨åˆ†ç”±è·¯ç”±å™¨æ‰¿æ‹…ã€‚åŒæ—¶ï¼Œè·¯ç”±å™¨å¯ä»¥æä¾›ç½‘ç»œå®‰å…¨ã€é™¤TCP/IPå¤–çš„ç½‘ç»œåè®®ç­‰åŠŸèƒ½ï¼Œè¿™äº›éƒ½æ˜¯ä¸‰å±‚äº¤æ¢æœºæ‰€æ— æ³•åšåˆ°çš„ã€‚</p><p><strong>äºŒæ¬¡ä¿®è®¢</strong>:<br>å®é™…ä¸Šï¼Œè¿™é‡Œçš„äºŒå±‚ã€ä¸‰å±‚äº¤æ¢æœºå¯ä»¥å’Œå¾ˆå¤šæ¦‚å¿µæŒ‚é’©ã€‚å…³äºäº¤æ¢æœºçš„åŒºåˆ«ï¼Œå¯ä»¥çœ‹è¿™ä¸ªåšå®¢ï¼š<br><a href="https://blog.csdn.net/dog250/article/details/8219141">Vlan/Trunkä»¥åŠä¸‰å±‚äº¤æ¢</a><br>å…³äºvlanï¼Œå¯ä»¥çœ‹è¿™ä¸ª<a href="https://blog.csdn.net/phunxm/article/details/9498829">åŸç†è¯¦è§£</a>.</p><div class="admonition info"><p class="admonition-title">æ¨èä¹¦ç±</p><p>å°±æ˜¯ä½ ç”µè¯¾æœ¬ï¼Œå¤§é»‘çš®æ˜¯çœŸä¸é”™ã€‚<strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹</strong></p></div><h3 id="é™„åŠ é¢˜">é™„åŠ é¢˜</h3><p>å®é™…ä¸Šè¿™ä¸ªé™„åŠ é¢˜ä¸æ˜¯DevOpsé‡Œå¤´çš„ï¼Œæˆ‘ä»ç½‘ç®¡ä¼šé‚£é‡Œæ¬ä¸€ä¸ªæ”¾åœ¨è¿™ï¼Œæ„Ÿè§‰æ˜¯å¾ˆå¥½ç©çš„ã€‚</p><p><strong>DH42ç½‘ç»œé…ç½®</strong><br><a href="https://lantian.pub/article/modify-website/dn42-experimental-network-2020.lantian/">lantianâ€™s blog</a><br>å’•å’•å’•ï¼Œç­‰æœ‰æ—¶é—´æã€‚</p><h2 id="dockerå®¹å™¨">dockerå®¹å™¨</h2><h3 id="å®è·µé¢˜-åœ¨dockerä¸­è¿è¡Œphpmyadminå®¹å™¨">å®è·µé¢˜ åœ¨dockerä¸­è¿è¡Œphpmyadminå®¹å™¨</h3><div class="admonition info"><p class="admonition-title">æç¤º</p><p>phpmyadminæ˜¯ä¸€ä¸ªWebç«¯çš„æ•°æ®åº“å¯è§†åŒ–ç•Œé¢ï¼Œå®ƒéœ€è¦æŒ‡å®šMySQLæœåŠ¡å™¨çš„IPåœ°å€ï¼Œé€šè¿‡è®¾ç½®å®¹å™¨çš„ç¯å¢ƒå˜é‡<code>PMA_HOST</code>æ¥æŒ‡å®šã€‚å¦‚æœä½ æ˜¯åœ¨Linuxç¯å¢ƒï¼Œé‚£ä¹ˆdockerä¼šæœ‰ä¸€ä¸ªå­ç½‘ï¼Œä¸€èˆ¬æ˜¯<code>172.16.0.0/16</code>ç½‘æ®µï¼Œåˆšæ‰è¿è¡Œçš„mariaDBå®¹å™¨ä¼šå¾—åˆ°ä¸€ä¸ªIPåœ°å€ï¼Œä½ å¯ä»¥é€šè¿‡<code>docker ps</code>å‘½ä»¤æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨ä¿¡æ¯ï¼Œç„¶åé€šè¿‡<code>docker inspect</code> å®¹å™¨IDæŸ¥çœ‹å®¹å™¨çš„IPåœ°å€ã€‚å¦‚æœä½ æ˜¯åœ¨macOSä¸Šè¿è¡Œdockerï¼Œéœ€è¦æ³¨æ„ç”±äºmacOSä¸å…·å¤‡dockeræ‰€éœ€è¦çš„namespaceå’Œcgroupï¼Œæ‰€ä»¥macOSä¸Šçš„dockerå®é™…æ˜¯è¿è¡Œåœ¨VirtualBoxè™šæ‹Ÿæœºä¸­çš„ï¼Œè€Œä¸”å®ƒçš„ç½‘ç»œä¸å®¿ä¸»æœºç½‘ç»œå¹¶ä¸ç›´æ¥è¿é€šï¼Œå¥½åœ¨å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ˜¯è¿é€šçš„ï¼Œä½†æ˜¯å¯¹äºphpmyadminï¼Œä½ å¯èƒ½éœ€è¦å°†å®ƒçš„Webç«¯å£ï¼ˆ80ï¼‰æ˜ å°„åˆ°æœ¬æœºçš„å…¶ä»–ç«¯å£ä¸Šï¼Œå¯ä»¥ç”¨å‚æ•° <code>-p</code> å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ æŒ‡å®šã€‚</p></div><pre class="language-bash" data-language="bash"><code class="language-bash"># docker åˆ›å»ºç½‘ç»œsudo docker network create my-mariadb# åˆ›å»ºmariadbï¼ŒæŒ‡å®šç¯å¢ƒå˜é‡MYSQL_ROOT_PASSWORDã€ç«¯å£æ˜ å°„ã€å‘½åå·å’Œç½‘ç»œåˆ«åsudo docker run -d \--restart always \--network my-mariadb --network-alias mariadb \-e MYSQL_ROOT_PASSWORD=123456 \-p 3306:3306 \-v mariadb-data:/var/lib/mysql \mariadb# åˆ›å»ºphpmyadminï¼ŒæŒ‡å®šç¯å¢ƒå˜é‡PMA_HOSTã€ç«¯å£æ˜ å°„å’Œç½‘ç»œåˆ«åsudo docker run -d \--restart always \--network my-mariadb --network-alias phpmyadmin \-p 8081:80 \-e PMA_HOST=mariadb \phpmyadmin</code></pre><h3 id="æ€è€ƒé¢˜-dockerå’Œè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ">æ€è€ƒé¢˜ dockerå’Œè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3><p>dockeré€šè¿‡dockerå®ˆæŠ¤è¿›ç¨‹æ¥ç®¡ç†dockerå®¹å™¨ï¼Œé€šè¿‡linuxçš„namespaceç»„åˆå’Œcgroupsæ¥éš”ç¦»dockerå†…å¤–å’Œç®¡ç†æ‰€ç”¨èµ„æºã€‚dockerå¯ä»¥å°†åº”ç”¨ç¨‹åºæ‰€è¿è¡Œå­˜å‚¨çš„æ•°æ®é€šè¿‡åˆ†å±‚æ¥éš”ç¦»ï¼Œpushå’Œpullé•œåƒçš„æ—¶å€™ä¸ä¼šå½±å“ï¼Œé€šè¿‡æ•°æ®å·æŒ‚è½½æ¥æŒä¹…åŒ–æ•°æ®ã€‚ç„¶è€Œå…¶éš”ç¦»æ€§æ— æ³•æ¯”æ‹Ÿè™šæ‹Ÿæœºã€‚<br>è€Œè™šæ‹Ÿæœºæ˜¯é€šè¿‡Hypervisorç®¡ç†è™šæ‹Ÿæœºç³»ç»Ÿï¼Œç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºï¼Œå¹¶è¾ƒdockeréœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ç­‰ç¡¬ä»¶èµ„æºã€‚è™šæ‹Ÿæœºåœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦è¿è¡Œå„ç§ä¾èµ–ï¼Œç›¸è¾ƒdockerå¯ä»¥ä¸“æ³¨å•ä¸ªåº”ç”¨è€Œè¨€æ›´å¯èƒ½å‘ç”Ÿå†²çªï¼Œå¯åŠ¨æ—¶é—´ä¹Ÿæ¯”æ‹Ÿä¸äº†dockerçš„å¿«æ·ã€‚</p><p><strong>äºŒæ¬¡ä¿®è®¢</strong>:<br>å…³äºdockerç›¸å…³ï¼Œé™¤äº†æœ€ä¸Šæ–¹çš„å®˜æ–¹æ–‡æ¡£æ•™ç¨‹ï¼ˆæ–°äººå‹å¥½ï¼‰ï¼Œè¿˜æœ‰ç›¸å…³çš„<a href="https://www.lixl.cn/books/Docker/1-Overview/#docker_7">ä»‹ç»</a></p><h2 id="GitLab-CI-CD">GitLab CI/CD</h2><p>gitæ“ä½œè¿™é‡Œå°±ä¸æ”¾äº†ï¼ˆ</p><h3 id="å®è·µé¢˜-ä½¿ç”¨GitLab-CI-CDåŠŸèƒ½ï¼Œå®ç°Dockeré•œåƒè‡ªåŠ¨å‘å¸ƒ">å®è·µé¢˜ ä½¿ç”¨GitLab CI/CDåŠŸèƒ½ï¼Œå®ç°Dockeré•œåƒè‡ªåŠ¨å‘å¸ƒ</h3><p><a href="https://gitlab.com/ZzzRemake/hello_devops">çœ‹çœ‹é¡¹ç›®</a><br>å…·ä½“å·²ç»å†™readmeé‡Œå¤´äº†ã€‚</p><h3 id="æ€è€ƒé¢˜-å¦‚ä½•å°†Dockeré•œåƒå®é™…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Ÿ">æ€è€ƒé¢˜ å¦‚ä½•å°†Dockeré•œåƒå®é™…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Ÿ</h3><p>ä¼¼ä¹æ˜¯ä¸€ä¸ªè›®æ·±å¥¥çš„é—®é¢˜ï¼Œä½†æˆ‘æ²¡æœ‰é¡¹ç›®å¼€å‘ç»éªŒï¼ˆè¿™å°±æ˜¯å¤§ä¸€æ‘†æ²¡æœ‰æé¡¹ç›®çš„ä¸‹åœº.jpgx2ï¼‰ï¼Œè¿™é‡Œåªèƒ½æ”¾ç½‘ä¸ŠæŸ¥åˆ°çš„ç©æ„å„¿äº†ã€‚</p><p>åˆ›å»ºé•œåƒåå·²ç»å‘å¸ƒåˆ°äº†docker hubï¼Œå› æ­¤å¯ä»¥è®©æœåŠ¡å™¨åˆ é™¤åŸæœ‰çš„å¯èƒ½å†²çªçš„é•œåƒï¼Œç„¶åä»docker hubæ‹‰å–æ‰€éœ€é•œåƒè¿è¡Œå®¹å™¨ã€‚</p><h3 id="å®è·µé¢˜-æ­å»ºåšå®¢ç½¢">å®è·µé¢˜ æ­å»ºåšå®¢ç½¢</h3><p><a href="https://zzzremake.gitlab.io/">åšå®¢é“¾æ¥</a></p><p><a href="https://gitlab.com/ZzzRemake/zzzremake.gitlab.io">ä»“åº“é“¾æ¥</a></p><p>ä¹‹å‰å·²ç»åœ¨windowsç¯å¢ƒä¸‹å†™è¿‡ä¸€æ¬¡github pageéƒ¨ç½²hexoåšå®¢ï¼ˆå°±æ˜¯ä½ ç°åœ¨çœ‹åˆ°çš„åšå®¢ï¼‰äº†ï¼Œä½†<code>node_modules/</code>ä»¥åŠç›¸å…³çš„åŒ…ç”±äºéƒ½æ˜¯jsç­‰æ–‡ä»¶ï¼Œç†è®ºä¸Šæ˜¯å¯ä»¥è·¨å¹³å°çš„ï¼Œå› æ­¤æˆ‘ç›´æ¥è¯•äº†ä¸‹copyï¼Œè¿˜çœŸè¡Œï¼Œä¹ï¼ˆ<br>äºæ˜¯ä¾¿æŠŠç›¸å…³æ–‡ä»¶copyåˆ°äº†è™šæ‹Ÿæœºä¸­ï¼Œä¸”åœ¨gitlabç½‘â»šé‡Œæ–°å»ºäº†åˆ›å»ºpageçš„projectã€‚æ¥ä¸‹æ¥çš„æ­¥éª¤å’Œä¹‹å‰ç”¨<code>gitlab CI/CD</code> åŠŸèƒ½éƒ¨ç½²dockeré•œåƒç›¸ä¼¼ã€‚ç¼–å†™<code>.gitlab-ci.yml</code>æ—¶ï¼Œå‘ç°gitlabæœ‰æä¾›hexoçš„æ¨¡æ¿<br>ymlï¼Œcopyåç”±äºnodeç‰ˆæœ¬ä¸åŒä¿®æ”¹äº†æ¨¡æ¿çš„imageä¿¡æ¯ï¼Œæäº¤åä¾¿å¯é€šè¿‡pipelineç”Ÿæˆåšå®¢ã€‚</p><p><strong>problems</strong>:<br>åœ¨æ³¨å†Œgitlab-runnerçš„æ—¶å€™ï¼Œæˆ‘åŸæœ¬ä»¥ä¸ºéœ€è¦å†åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªgitlab-runnerçš„dockeræ¥æ­é…åšå®¢ä»“åº“çš„æµæ°´çº¿ï¼Œä½†æ³¨å†ŒåæŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œå‘ç°æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æ–°æ·»åŠ äº†å…³äºåšå®¢ä»“åº“é…ç½®runnerçš„ä¿¡æ¯.</p><p>å¦å¤–ï¼Œcopyåå‘ç°ä½¿ç”¨çš„ä¸»é¢˜æ–‡ä»¶å¤¹<code>theme/hexo-theme-matery</code>é‡Œé¢æ˜¯æœ‰<code>git</code>å­ä»“åº“çš„ï¼Œå¦‚æœä¸åˆ é™¤å…¶ä¸­çš„<code>.git</code>æ–‡ä»¶å¤¹ï¼Œpushåˆ°gitlabä¸Šä¼šæ— æ³•æ‰“å¼€å…¶ä¸­çš„æ–‡ä»¶ï¼ˆæ— urlï¼‰ï¼Œæµæ°´çº¿åˆ›å»ºçš„è¿‡ç¨‹ä¹Ÿä¼šå¤±è´¥ã€‚ç”±äºåšå®¢é¡¹ç›®æœ¬èº«ä¸æ˜¯ä¸€ä¸ªå¤æ‚é¡¹ç›®ï¼ˆï¼Ÿï¼Œå› æ­¤åˆ å»è¿™é‡Œçš„å­ä»“åº“ï¼Œç”¨ä¸»ä»“åº“ç›´æ¥ç®¡ç†ã€‚</p><p><strong>äºŒæ¬¡ä¿®è®¢</strong>:<br>æ²¡é”™ï¼Œè¿™å°±æ˜¯ä¸ªç®€å•çš„å¤åˆ¶ç²˜è´´ï¼Œå«é‡‘é‡å…¶å®å°±åªæœ‰<code>.gitlab-ci.yml</code>ç¼–å†™ï¼Œç„¶è€Œè¿™ä¸ªæˆ‘ä¹Ÿæ˜¯æŠ„æ¨¡æ¿çš„ï¼ˆè¿™å°±æ˜¯å¤§ä¸€æ‘†æ²¡æœ‰æé¡¹ç›®çš„ä¸‹åœº.jpgx3ï¼‰</p><h2 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h2><p>å—¯ï¼Œåœ¨è¿™é‡ŒäºŒæ¬¡ä¿®è®¢çš„æ„ä¹‰æ˜¯ä¸ºäº†ä¹‹åçš„å­¦ä¹ è®¡åˆ’ã€‚æˆ‘ç›®å‰åªæ˜¯åˆæ­¥äº†è§£dockerï¼Œgitï¼Œgitlabï¼Œlinuxè¿™äº›çš„è¿ç”¨ï¼Œè·ç¦»ç”¨å¥½è¿˜æœ‰å¾ˆå¤§çš„å·®è·ã€‚è¿™é‡Œçš„å­¦ä¹ è®¡åˆ’ä¹Ÿæ˜¯ç£ä¿ƒç½¢ã€‚<br>åˆ—å‡ºæ¥çš„å°±å·²ç»è›®å¤šäº†ã€‚</p><ol><li>å‘½ä»¤è¡Œæ“ä½œå­¦ä¹ </li><li>Linuxï¼ˆä¹Ÿè®¸ä¹‹åä¸“é—¨æä¸ªåŒç³»ç»Ÿï¼Ÿï¼‰</li><li>è®¡ç®—æœºç½‘ç»œç›¸å…³</li><li>DH42</li><li>Docker</li><li>gitlab CI/CD</li><li>ç¬¬äºŒä¸ªåšå®¢</li></ol><p>æğŸï¼Œè¿™ä¹ˆå¤šã€‚æ…¢æ…¢æ¶ˆåŒ–ç½¢ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DevOps </tag>
            
            <tag> docker </tag>
            
            <tag> CI/CD </tag>
            
            <tag> GitLab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern Cryptoâ…¡ Perfect Encryption</title>
      <link href="/2022/12/02/modern-cryptoii-perfect-encryption/"/>
      <url>/2022/12/02/modern-cryptoii-perfect-encryption/</url>
      
        <content type="html"><![CDATA[<h2 id="Something-ahead">Something ahead</h2><p>æ¦‚ç‡è®ºå•Šå—¯ï¼Œä½†ç¡®å®ä¸ç”¨å¤šå°‘ç›¸å…³çŸ¥è¯†ï¼Œæ¦‚ç‡è®ºä¸€äºŒä¸¤ç« å­¦å­¦å°±è¡Œã€‚</p><p>æ¡ä»¶æ¦‚ç‡å…¬å¼ï¼š$Pr[B|A]=Pr[A\land B]/Pr[AB]$ã€‚<br>è´å¶æ–¯å…¬å¼ï¼š$Pr[B|A]=\frac{Pr[A|B]\cdot Pr[B]}{Pr[A]}$<br>å…¨æ¦‚ç‡å…¬å¼$Pr[A]=\sum_i^nPr[A|B_i]\cdot Pr[B_i]$</p><p>æ€ä¹ˆæ ·ï¼Œéƒ½ä¼šå§ï¼ˆ</p><h2 id="random-number">random-number</h2><p>å¯†ç å­¦ä¸­ï¼Œéšæœºæ•°çš„ç”Ÿæˆæ˜¯å¾ˆé‡è¦çš„ï¼Œä¾‹å¦‚åŠ å¯†æ–¹æ¡ˆä¸­ç”Ÿæˆå¯†é’¥çš„$Gen$ä¾¿éœ€è¦ä»¥æ­¤ä¿è¯éšæœºæ€§ã€‚ç„¶è€Œï¼Œè¿™é‡Œä¸è®¨è®ºå¦‚ä½•ç”Ÿæˆï¼Œä»¥åŠæ€ä¹ˆåˆ¤å®šéšæœºæ•°ï¼Œç•™åœ¨ç¬¬å››ç« è¿›è¡Œ<s>å’•å’•å’•</s></p><p>ç°åœ¨è¿™é‡Œæ‰€è¿›è¡Œçš„æ˜¯ä¸€äº›æ¦‚å¿µçš„è®¨è®ºï¼š<br>éšæœºæ•°ç”Ÿæˆå¤§çº¦éœ€è¦ï¼š</p><ol><li>æ”¶é›†é«˜ç†µæ•°æ®ï¼Œè¿™é‡Œçš„é«˜ç†µæ˜¯æŒ‡é«˜ä¸ç¡®å®šæ€§ï¼Œä½†å¹¶ä¸æ˜¯å¯†ç å­¦ä¸­æˆ‘ä»¬æ‰€éœ€è¦çš„éšæœºã€‚</li><li>ä»¥æ•°æ®ä¸ºä¾æ®ï¼Œç”Ÿæˆä¸€ç³»åˆ—å‡ ä¹ç‹¬ç«‹çš„(independent),æ— åçš„(unbiased)ä½åºåˆ—ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®ä»ç„¶æ˜¯æœ‰è¦æ±‚çš„ï¼šuniformã€‚è€Œå…³äºéšæœºæ€§ï¼Œéšæœºçš„æ¦‚ç‡æ€§ç­‰ç­‰ï¼Œä¸åœ¨è¿™é‡Œè®¨è®ºã€‚è¿™é‡Œåªæ˜¯è¯´æ˜ï¼Œéšæœºæ•°æˆ–è€…ä¼ªéšæœºæ•°æ˜¯å¯ä»¥ç”Ÿæˆçš„ã€‚</p><p>P.S.è¿™é‡Œè¿˜æäº†ä¸€å¥Cé‡Œå¤´é‚£ä¸ª<code>rand()</code>å‡½æ•°æ— æ³•è¾¾åˆ°å¯†ç å­¦æ„ä¹‰ä¸Šçš„éšæœºæ€§ï¼Œä¹ã€‚</p><h2 id="å›é¡¾çŸ¥è¯†ä»¥åŠä¿®è®¢">å›é¡¾çŸ¥è¯†ä»¥åŠä¿®è®¢</h2><p>æˆ‘ä»¬ç°åœ¨æ˜ç™½äº†ï¼š<br>$$<br>\begin{split}<br>\mathcal{K}:&amp; keyspace  \\<br>\mathcal{M}:&amp; plaintext\quad space \\<br>\mathcal{C}:&amp; ciphertext\quad space \\<br>Gen:&amp; \rightarrow \mathcal{K} \\<br>Enc:&amp; \mathcal{K}\times \mathcal{M}\rightarrow C \\<br>Dec:&amp; \mathcal{K}\times \mathcal{C}\rightarrow M<br>\end{split}<br>$$<br>å…¶ä¸­ï¼Œ$Genï¼ŒEnc$æ˜¯æ¦‚ç‡æ€§çš„ã€‚Genéœ€è¦éšæœºç”Ÿæˆå¯†é’¥æ¥ä¿è¯å®‰å…¨æ€§ï¼ŒEncæˆ‘ä»¬å…è®¸éšæœºï¼Œä½†Decéœ€è¦æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š<br>$$Correctness:\forall k \in \mathcal{K},m\in\mathcal{M}:Dec_k(Enc_k(m))=m$$<br>å³è§£å¯†æ­£ç¡®æ€§ã€‚<br>åœ¨è¿™é‡Œï¼Œå¯ä»¥ç”¨<strong>æ¦‚ç‡</strong>çš„æ–¹å¼æ¥çœ‹å¾…$K,M,C$,ä½œä¸ºå…¶å–å€¼ç©ºé—´çš„éšæœºå˜é‡ã€‚$K$è‚¯å®šæ˜¯éšæœºç”Ÿæˆäº†ï¼Œè€Œåœ¨æ”»å‡»è€…çœ‹æ¥ï¼Œ$M$(éšæœºå˜é‡)æ˜¯åœ¨æ¶ˆæ¯ç©ºé—´ä¸­çš„æ¦‚ç‡åˆ†å¸ƒï¼Œè€Œé‡‡é›†åˆ°çš„$m$ä¿¡æ¯æ˜¯å…¶çš„é‡‡æ ·ã€‚ä¹Ÿå› æ­¤ï¼Œ$C$ä¹Ÿæ˜¯æ¦‚ç‡åˆ†å¸ƒã€‚è¿™å’Œæˆ‘ä»¬å¹³å¸¸è®¤ä¸ºä¸¤è€…æ˜¯ç¡®å®šçš„ä¸åŒã€‚</p><p>ç†è®ºä¸Šè€Œè¨€ï¼Œæ˜æ–‡åº”è¯¥å’ŒåŠ å¯†ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯Kæ— å…³ï¼Œä¸¤è€…ç›¸äº’ç‹¬ç«‹ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ä¹‹å‰å¯¹å®‰å…¨ç›®æ ‡çš„å®šä¹‰ï¼Œå‡è®¾ç°åœ¨é€šä¿¡åŒæ–¹æ­£åœ¨é€šè¿‡å¯¹ç§°å¯†é’¥çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œæ•Œæ‰‹èƒ½å¤Ÿè§‚å¯Ÿåˆ°çš„å°±æ˜¯é€šä¿¡çš„å¯†æ–‡å†…å®¹ã€‚å¹¶ä¸”ï¼Œæ•Œæ‰‹è¿˜å¯ä»¥åšåˆ°ï¼š</p><ol><li>å¯ä»¥çŸ¥é“æ‰€æœ‰å¯èƒ½çš„å‘é€çš„æ¶ˆæ¯ï¼Œä»¥åŠæ¶ˆæ¯ç©ºé—´çš„æ¦‚ç‡åˆ†å¸ƒ</li><li>åŒæ—¶æ”»å‡»è€…ä¹ŸçŸ¥é“åŠ å¯†æ–¹æ¡ˆæœ¬èº«ï¼Œä½†æ•Œæ‰‹ä¸çŸ¥é“å¯†é’¥ $k$ã€‚<br>é‚£ä¹ˆï¼ŒPerfect Secrecyä¾¿æœ‰ä¸¤ç§è¡¨è¿°æ–¹å¼ï¼š</li></ol><div class="admonition info"><p class="admonition-title">æ”»å‡»è€…æ— æ³•é€šè¿‡è§‚å¯Ÿå¯†æ–‡æ¥è·å¾—ä»»ä½•å’Œæ˜æ–‡ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p>$$\forall m\in\mathcal{M},c\in\mathcal{C},Pr[M=m|C=c]=Pr[M=m]\qquad(Pr[C=c]&gt;0)$$å¯†æ–‡å’Œæ˜æ–‡çš„éšæœºå˜é‡æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚</p></div><div class="admonition info"><p class="admonition-title">å¯†æ–‡çš„åˆ†å¸ƒå’ŒåŠ å¯†çš„æ˜æ–‡ä¿¡æ¯ç›¸äº’ç‹¬ç«‹ã€‚</p><p>$$\forall m.m'\in\mathcal{M},c\in\mathcal{C},Pr[Enc_K(m)=c]=Pr[Enc_K(m')=c]$$</p></div><p>è¿™ä¸¤ç§è¡¨è¾¾æ˜¯ç›¸äº’ç­‰ä»·çš„ï¼Œè¿™é‡Œä¸ç»™å‡ºè¯æ˜è¿‡ç¨‹ï¼ˆä½†ç¡®å®å¯ä»¥è¯ï¼Œåªæ˜¯æˆ‘æ‡’ä¸æƒ³å†™ï¼Œè¯æ˜è¿‡ç¨‹éœ€è¦ç”¨åˆ°ä¸Šé¢æ‰€ç»™çš„æ¦‚ç‡è®ºåŸºç¡€ï¼‰<br>ç„¶è€Œè¯æ˜è¿‡ç¨‹è¿˜æ˜¯å¾ˆå¥½ç©çš„ï¼Œä¹Ÿè®¸ç­‰ä¹‹åè¡¥ä¸Šï¼Ÿ<s>å†æ¬¡å’•å’•å’•</s></p><h2 id="indistinguishability">indistinguishability</h2><p><strong>å¯’å‡æ›´æ–°å’¯ï¼</strong></p><p>å¯ä»¥å¯¹ä¸Šè¿°çš„è¿‡ç¨‹è¿›è¡Œå¦ä¸€ç§è¡¨è¿°ï¼Œè¿™ç§è¡¨è¿°æ˜¯é€šè¿‡experimentå®ç°çš„ã€‚æ”»å‡»è€…è¯•å›¾è¢«åŠ¨çš„è§‚å¯Ÿå¯†æ–‡ï¼Œå¹¶ç»™å®šä¸¤æ¡æ˜æ–‡ï¼Œåˆ¤æ–­è¯¥å¯†æ–‡æ˜¯å“ªä¸€æ¡æ˜æ–‡åŠ å¯†çš„ã€‚</p><p>äºæ˜¯ä¾¿å¼•å…¥äº†ä¸€ä¸ªå¯†ç å­¦ä¸Šååˆ†é‡è¦çš„æ¨¡å‹ï¼š<strong>é¢„è¨€æœºï¼ˆoracleï¼‰</strong>ï¼Œç›®å‰å¯ä»¥æŠŠå…¶ç†è§£ä¸ºä¸€ä¸ªæ‰§è¡ŒæŒ‡å®šæ“ä½œçš„é»‘ç®±ã€‚å®ƒæ€»æ˜¯èƒ½æ­£ç¡®çš„ç»™ä½ æ‰€è®¾å®šå¥½çš„ç›®æ ‡ç­”æ¡ˆã€‚</p><p>ä¸Šè¿°è§‚å¯Ÿè¿‡ç¨‹ï¼Œå¯ä»¥è¡¨ç¤ºä¸º$Priv_{\mathcal{A}\prod}^{eav}$ï¼Œè¡¨ç¤ºåœ¨çªƒå¬è€…$eav$ä¸‹çš„ä¸å¯åŒºåˆ†æ€§experimentï¼Œæ•Œæ‰‹ä¸ºAï¼Œè¯¥ä¸å¯åŒºåˆ†æ€§experimentä¸ºblockç¬¦å·,ç±»ä¼¼åŠ å¯†æ–¹æ¡ˆã€‚</p><ol><li>$eav\quad generate\quad m_0,m_1\in \mathcal{M}$<br>æ•Œæ‰‹ç”Ÿæˆä¸¤æ¡æ˜æ–‡ï¼Œä¼ é€’ç»™Oracleã€‚</li><li>$Oracleï¼šk\leftarrow Gen \\<br>b\leftarrow {0,1}(random) \\<br>c:=Enc_k(m_b)<br>$<br>oracleç”Ÿæˆå¯†é’¥ï¼Œéšæœºé€‰æ‹©æ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°å¯†æ–‡cã€‚</li><li>$c-&gt;eav$,eavåˆ¤æ–­$b$ä¸º0è¿˜æ˜¯1ï¼Œä¹Ÿå°±æ˜¯çŒœæµ‹æ˜¯è‡ªå·±ç”Ÿæˆçš„å“ªä¸€æ¡æ˜æ–‡ï¼Œå¹¶å°†çŒœæµ‹ç»“æœ$bâ€™$è¿”å›oracleã€‚<br>$Priv_{\mathcal{A}\prod}^{eav}=1\quad if b=bâ€™,else\quad Priv_{\mathcal{A}\prod}^{eav}=0$ã€‚</li></ol><div class="admonition warning"><p class="admonition-title">Definition</p><p>$(Gen,Enc,Dec)$ is Perfectly indistinguishable if for every $\mathcal{A}$ it holds that$$Pr[Priv_{\mathcal{A}\prod}^{eav}=1]=\frac{1}{2}$$</p></div><p>æ”»å‡»è€…æ— æ³•åŒºåˆ†ä¸¤è€…æ¶ˆæ¯ã€‚è¿™ç§perfectly indistinguishableçš„è¡¨è¿°å’Œå‰ä¸¤ä¸ªé€šè¿‡æ¦‚ç‡çš„æè¿°æ˜¯ç›¸åŒçš„ã€‚</p><h2 id="The-One-Time-pad">The One-Time pad</h2><p>å¯†ç å­¦æ˜¯èºçº¿ä¸Šå‡çš„ï¼Œå¾ˆå¤šåˆšå¼€å§‹çš„åŠ å¯†æ–¹æ¡ˆå¹¶æ²¡æœ‰å®Œå–„çš„ç†è®ºåŸºç¡€ï¼Œä¾‹å¦‚è¿™é‡Œè¦è®²çš„<strong>OTP</strong>åœ¨1917å¹´æå‡ºï¼Œè€Œé‚£æ—¶è¿˜æ²¡æœ‰å¯è¯æ˜å®‰å…¨çš„æ¦‚å¿µã€‚</p><p>åŠ å¯†è¿‡ç¨‹ï¼š<br>è®¾é•¿åº¦ä¸º$l\in N,\mathcal{M}=\mathcal{K}=\mathcal{C}={0,1}^l$.<br>$Gen\rightarrow k\in\mathcal{K}$,uniformly at random<br>$Enc_k(m)=m\oplus k,Dec_k ( c ) =c\oplus k$<br>å…¶ä¸ºPerfect secretã€‚è¯æ˜è¿‡ç¨‹ï¼š</p><p>$Pr[Enc_k(m)=c]=Pr[m\oplus k=c]=Pr[k=c\oplus m]=|\mathcal{K}|^{-1}=2^{-l}$</p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ç¾¤çš„æ–¹å¼å†™å†™ã€‚</p><p>éœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™é‡Œçš„å¯†é’¥ã€æ˜æ–‡ã€å¯†æ–‡çš„é•¿åº¦éƒ½æ˜¯ç­‰é•¿çš„ï¼Œå› æ­¤ç”Ÿæˆå¯†é’¥ã€åŠ å¯†è¿‡ç¨‹ä»¥åŠæ³„éœ²æ¶ˆæ¯ç­‰éƒ½æœ‰ä¸€äº›ç¼ºç‚¹ã€‚OTPå¹¶ä¸æ˜¯å¥½ç”¨çš„åŠ å¯†æ–¹æ¡ˆã€‚<br>å¹¶ä¸”ï¼ŒOTPä¸èƒ½å¤Ÿå¤ç”¨å¯†é’¥ã€‚ä¸€æ—¦å¤ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡</p><p>$$Enc_k(m)\oplus Enc_k(mâ€™)=m\oplus mâ€™$$</p><p>å»é™¤å¯†é’¥ï¼Œä½¿å¯†é’¥ä¸§å¤±ä½œç”¨è€Œæš´éœ²æ˜æ–‡çš„ç›¸å…³ä¿¡æ¯ï¼ŒOTPä¾¿å¤±å»ä½œç”¨ã€‚</p><h2 id="Limitations">Limitations</h2><div class="admonition info"><p class="admonition-title">Theorem</p><p>è‹¥åŠ å¯†æ–¹æ¡ˆä¸ºå®Œç¾åŠ å¯†ï¼Œé‚£ä¹ˆå¯†é’¥ç©ºé—´å¤§å°å¿…é¡»å¤§äºæ˜æ–‡ç©ºé—´å¤§å°ã€‚</p></div><p>åè¯æ³•ç¨å¾®è¯ä¸€ä¸‹å°±è¡Œäº†ã€‚</p><h3 id="Shannonâ€™s-Theorm">Shannonâ€™s Theorm*</h3><p>PPTæ— ï¼Œè¿™é‡Œè¡¥å……ä¸‹ã€‚</p><div class="admonition info"><p class="admonition-title">Shannon's Theorm</p><p>è‹¥$(Gen,Enc,Dec)ï¼Œand|\mathcal{M}|=|\mathcal{K}|=|\mathcal{C}|$</p><ol><li>$\forall k\in\mathcal{K},Pr(k~is~~chosen)=\frac{1}{|\mathcal{K}|}$</li><li>$\forall m\in\mathcal{M},c\in\mathcal{C}ï¼Œ\exists k(unique)\in \mathcal{K},Enc_k(m)=c$</li></ol><p>é‚£ä¹ˆè¿™ä¸ªåŠ å¯†æ–¹æ¡ˆä¸ºPerfect secretã€‚è¿™æ˜¯å……è¦æ¡ä»¶ã€‚</p></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Modern Cryptoâ…  Introduction</title>
      <link href="/2022/11/26/modern-cryptoi-introduction/"/>
      <url>/2022/11/26/modern-cryptoi-introduction/</url>
      
        <content type="html"><![CDATA[<p>è¯¥åšå®¢ã€‚ã€‚å¤§çº¦æ˜¯å­¦æ ¡è¯¾ç¨‹çš„ä¸€ä¸ªå°å°çš„å¤ä¹ ã€‚</p><p>å¦æœ‰æœ¬åšå®¢é™„åŠ è¯´æ˜ï¼š</p><div class="admonition info"><p class="admonition-title">è¯´æ˜æ¡†</p><p>è¿™ç§æ ¼å¼ä¸€èˆ¬è€Œè¨€æ˜¯å¯¹æ€§è´¨ã€æ„é€ ç­‰çš„è¯´æ˜ã€‚</p></div><div class="admonition warning"><p class="admonition-title">å®šä¹‰æ¡†</p><p>è¿™ç§æ ¼å¼ä¸€èˆ¬æ˜¯å¯¹åŠ å¯†æ–¹æ¡ˆç­‰å®šä¹‰çš„è¯´æ˜ã€‚</p></div><div class="admonition missing"><p class="admonition-title">æ³¨æ„æ¡†</p><p>è¿™ç§æ ¼å¼æ˜¯å¯¹å°¤å…¶éœ€è¦æ³¨æ„çš„åœ°æ–¹çš„è¯´æ˜ã€‚</p></div><p>è¯ä¸å¤šè¯´ï¼Œæ‘†ä¸ªğŸ“•å…ˆã€‚</p><div class="admonition info"><p class="admonition-title">book</p><p>nameï¼šIntroduction To Modern Cryptography</p><p>authorï¼šJonathan Katz, Yehuda Lindell</p></div><h2 id="ä¸€äº›å…ˆå¯¼æ¦‚å¿µ">ä¸€äº›å…ˆå¯¼æ¦‚å¿µ</h2><p>ä¼ ç»Ÿçš„å¯†ç å­¦è¢«ç§°ä¸º <abbr title="ç¼–ç ">Codes</abbr> æˆ–æ˜¯ <abbr title="åŠ å¯†">Ciphers</abbr>ï¼Œå¦‚å‡¯æ’’å¯†ç ç­‰è¿™äº›æ„é€ æ–¹å¼ï¼›è€Œç°ä»£å¯†ç å­¦æä¾›çš„ä¸ä¹‹å¯¹åº”çš„æ¦‚å¿µè¢«ç§°ä¸º <abbr title="åŠ å¯†æ–¹æ¡ˆ">Encryption Scheme</abbr>ï¼Œå¹¶æœ‰ä¸¥æ ¼çš„å®‰å…¨è¯æ˜ã€‚ä¸¤è€…çš„å…·ä½“å·®åˆ«åé¢å°±ä¼šæåˆ°ã€‚</p><h3 id="å¯†é’¥ç›¸å…³">å¯†é’¥ç›¸å…³</h3><p>åœ¨åˆšå­¦å¯†ç å­¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¤ä¸ºå¯†é’¥èƒ½å¤Ÿå®‰å…¨å…±äº«ï¼Œé¿å¼€å¯¹å®‰å…¨ä¼ é€’å¯†é’¥è¿‡ç¨‹çš„è®¨è®ºï¼ˆå› ä¸ºç›®å‰çš„çŸ¥è¯†æ— æ³•å¯¹å…¶è¿›è¡Œè®¨è®ºï¼‰ï¼Œå¹¶ä¸”å‡è®¾ç”¨æˆ·èƒ½å¤Ÿå¦¥å–„ä¿æŠ¤å¯†é’¥ã€‚</p><h3 id="åŸºæœ¬è®°å·">åŸºæœ¬è®°å·</h3><p>$$<br>\begin{split}<br>K:&amp; key\quad space\\<br>M:&amp; plaintext\quad space\\<br>C:&amp; ciphertext\quad space<br>\end{split}<br>$$</p><p>ç±»ä¼¼äºå–å€¼ç©ºé—´çš„æ¦‚å¿µã€‚<br>Måœ¨ä¼ ç»Ÿå¯†ç å­¦ä¸­å¯èƒ½æ˜¯ä¸€äº›å­—æ¯ï¼ˆç¼–ç ï¼‰è¡¨ï¼Œä½†ç°ä»£å¯†ç å­¦å°†å…¶è®¾å®šä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯¹åº”ç°å®ä¸­ä¼ é€’çš„ä¿¡æ¯ã€‚<br>åŠ å¯†æ–¹æ¡ˆï¼ˆEncryption schemeï¼‰ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š<br>$Gen-&gt;K(probabilisticï¼Œæ¦‚ç‡æ€§)$ å¯†é’¥ç”Ÿæˆç®—æ³•<br>$Enc:K\times M\rightarrow C$ åŠ å¯†ç®—æ³•<br>$Dec:K\times C\rightarrow M$ è§£å¯†ç®—æ³•<br>æ­£ç¡®æ€§ï¼š$\forall k \in K,m \in M:Dec_k(Enc_k(m))=m $</p><p>ç°ä»£å¯†ç å­¦å’Œä¼ ç»Ÿå¯†ç å­¦çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯Kerckhoffs principleï¼š</p><div class="admonition info"><p class="admonition-title">Kerckhoffs principle</p><p>The cipher method must not be required to be secret, and it must be able to fall into the hands of the enemy without inconvenience.åŠ å¯†çš„æ–¹æ³•å¿…ä¸èƒ½è¢«è¦æ±‚æ˜¯ç§˜å¯†çš„ï¼Œå¹¶ä¸”è¿™ç§åŠ å¯†çš„æ–¹æ³•å¿…å®šèƒ½å¤Ÿè¢«æ•Œæ‰‹è·å–ã€‚</p></div><p>ç°ä»£å¯†ç å­¦æ”¾å¼ƒäº†å¯¹åŠ å¯†æ–¹æ¡ˆçš„ä¿å¯†æ€§ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ç½‘ç»œä¸Šæ‰¾åˆ°åŠ å¯†åº“ï¼Œä¾‹å¦‚OpenSSLçš„åŠ å¯†æ–¹æ¡ˆå…·ä½“å¦‚ä½•æ“ä½œã€‚å¯†ç å­¦è®¤ä¸ºï¼Œå”¯ä¸€åº”è¯¥ä¿å¯†çš„æ˜¯å¯†é’¥æœ¬èº«ï¼Œè€ŒåŠ å¯†æ–¹æ¡ˆåº”å½“å…¬å¼€ã€‚(åŒæ—¶ï¼Œè¿™ä¸ªåŸåˆ™ä¹Ÿéšå«äº†ä¸€ç‚¹ï¼šä¸è¦ç”¨è‡ªå·±å®ç°çš„åŠ å¯†æ–¹æ¡ˆ)</p><p>ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆç¬¬ä¸€çœ¼çœ‹çš„è›®å¥‡æ€ªçš„è¦æ±‚æï¼Ÿ</p><div class="admonition warning"><p class="admonition-title">warning</p><p>1.å¯¹<strong>åŠ å¯†æ–¹æ¡ˆä¿å¯†</strong>æ˜¯<strong>ä¸åˆ‡å®é™…</strong>çš„ï¼Œè¯¸å¦‚é€†å‘å·¥ç¨‹ã€æ¸—é€æ”»ç ´ç­‰æ–¹å¼ä¾¿å¯ä»¥å¾—åˆ°åŠ å¯†æ–¹æ¡ˆã€‚å³ï¼Œä½ æ— æ³•é¢„è®¡æ•Œæ‰‹ä¼šé‡‡å–ä»€ä¹ˆæ–¹å¼è·å–åˆ°ä½ çš„åŠ å¯†æ–¹æ¡ˆï¼›ä¹Ÿå› æ­¤ï¼Œä¸èƒ½å¤Ÿè®¤ä¸ºå¯¹åŠ å¯†æ–¹æ¡ˆè¿›è¡Œä¿å¯†æªæ–½ä¾¿èƒ½å¤Ÿç¡®ä¿æ›´å¥½çš„å®‰å…¨æ€§ã€‚</p><p>2.ç›¸æ¯”è€Œè¨€ï¼Œç›¸è¾ƒåŠ å¯†æ–¹æ¡ˆè€Œè¨€ï¼Œ<strong>æ›´å°çš„</strong>å¯†é’¥æ›´æ˜“ä¿å­˜ï¼Œæ›´æ”¹å¯†é’¥ä¹Ÿæ¯”æ›´æ”¹æ–¹æ¡ˆæ›´åŠ å®¹æ˜“</p><p>3.èƒ½å¤Ÿæ›´å¥½çš„åœ¨å…¬å¼€åœºåˆä¸‹è®¨è®ºåŠ å¯†æ–¹æ¡ˆçš„å®‰å…¨æ€§ï¼Œä»è€Œä¿ƒè¿›åŠ å¯†æ–¹æ¡ˆçš„æ ‡å‡†åŒ–ã€‚</p></div><h2 id="ä¼ ç»ŸåŠ å¯†ï¼ˆéå¤å…¸å¯†ç å­¦ï¼‰">ä¼ ç»ŸåŠ å¯†ï¼ˆéå¤å…¸å¯†ç å­¦ï¼‰</h2><p>è¿™é‡Œå°±ç®€ç•¥äº†ã€‚</p><p>ä¼ ç»Ÿå¯†ç å­¦æ›´å¤šæ„ä¹‰ä¸Šå¯ä»¥çœ‹ä½œä¸€ç§â€œè‰ºæœ¯â€ï¼Œæ˜¯ä¸€ç§æ™ºåŠ›ä¸Šçš„æ¯”æ‹¼ï¼›ä½†å…¶ä¹Ÿå¯ä»¥é€šè¿‡è¯¸å¦‚æš´åŠ›ç ´è§£ã€é¢‘æ¬¡åˆ†æã€è¯æ³•åˆ†æç­‰æ–¹å¼ç ´è§£ï¼Œæš´åŠ›ç ´è§£çš„åŸå› å°±æ˜¯å› ä¸ºå¯†é’¥ç©ºé—´ä¸å¤Ÿå¤§ã€‚å› æ­¤ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä»Šçš„åŠ å¯†æ–¹æ¡ˆå¯†é’¥ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼ŒDESä¸º$2^{56}$ï¼Œæ¯”ç‰¹å¸é‡‡ç”¨$2^{90}$å¤§å°çš„å¯†é’¥ç©ºé—´åŠ å¯†æ–¹æ¡ˆï¼ŒAESçš„å¯†é’¥ç©ºé—´å·²ç»æ‰©å±•åˆ°äº†$2^{128},2^{256}$.</p><p>ç„¶è€ŒDESç°åœ¨æ—©å°±ä¸å®‰å…¨äº†ï¼Œä»¤äººæ„Ÿå¹ã€‚ä¸æ˜¯å› ä¸ºç®—æ³•æœ¬èº«æœ‰é—®é¢˜ï¼Œè€Œæ˜¯å¯†é’¥ç©ºé—´å¤ªå°äº†ã€‚æ®è¯´ä¸Šä¸ªä¸–çºªçš„è®¡ç®—æœºå°±èƒ½æ”»ç ´æã€‚</p><h2 id="ç°ä»£å¯†ç å­¦">ç°ä»£å¯†ç å­¦</h2><p>ç°ä»£å¯†ç å­¦çš„å®‰å…¨å®šä¹‰ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<br><strong>å®‰å…¨ç›®æ ‡</strong>å’Œ<strong>å¨èƒæ¨¡å‹</strong>ã€‚</p><p>å¯è¯æ˜æ€§å®‰å…¨ï¼ˆå½’çº¦å®‰å…¨ï¼‰ï¼š</p><ol><li>æä¾›å½¢å¼åŒ–çš„å®‰å…¨å®šä¹‰ã€‚</li><li>ç²¾ç¡®çš„ç»™å®šå‡è®¾ã€‚</li><li>åœ¨å‡è®¾çš„åŸºç¡€ä¸Šï¼Œæä¾›ä¸€ä¸ªä½ æ„é€ çš„åŠ å¯†æ–¹æ¡ˆçš„å®‰å…¨æ€§è¯æ˜ï¼Œå®‰å…¨æ€§åŸºäºå®‰å…¨å®šä¹‰ã€‚</li></ol><h3 id="å®‰å…¨ç›®æ ‡">å®‰å…¨ç›®æ ‡</h3><p>å¯¹æ­¤ï¼Œæœ‰ä¸€ä¸ªå¯¹å®‰å…¨åŠ å¯†çš„å¼ºå®šä¹‰ï¼š</p><div class="admonition info"><p class="admonition-title">info</p><p><strong>ä¸ç®¡æ”»å‡»è€…æœ‰äº†å¤šå°‘ä¿¡æ¯ã€‚å¯†æ–‡éƒ½ä¸èƒ½æ³„éœ²ç»™æ•Œæ‰‹ä»»ä½•é¢å¤–çš„å…³äºæ˜æ–‡çš„ä¿¡æ¯ã€‚</strong></p></div><p>å®é™…ä¸Šï¼Œè¿™ç§å®šä¹‰æ¯”æƒ³è±¡ä¸­çš„è¦å¼ºã€‚è¯¥åŠ å¯†æ–¹æ¡ˆä¸ä¼šæ³„éœ²å¯†é’¥ã€ä¸ä¼šæ³„éœ²æ˜æ–‡ä¿¡æ¯ï¼ŒåŠ å¯†è€…ä¹Ÿæ— æ³•è·å–é™¤äº†æ˜æ–‡å¤–çš„åˆ«çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œç†è®ºä¸Šï¼Œè¿™ç§å¼ºå®šä¹‰ä¾¿å¯é˜»ç»ä¸€åˆ‡å¯èƒ½çš„æ”»å‡»ã€‚</p><h3 id="å¨èƒæ¨¡å‹">å¨èƒæ¨¡å‹</h3><p>å¯ä»¥çœ‹çœ‹<a href="https://www.cnblogs.com/xdyixia/p/11610091.html">è¿™é‡Œ</a>çš„å¨èƒæ¨¡å‹ã€‚</p><p>å¯†ç å­¦ä¸­ï¼Œè®¤ä¸ºç”±å››ç§å¨èƒæ¨¡å‹ï¼Œè¿™äº›å¨èƒæ¨¡å‹ä»£è¡¨äº†æ•Œæ‰‹çš„èƒ½åŠ›ï¼ˆä½†ä½ æ— ä»å¾—çŸ¥æ•Œæ‰‹ä¼šåšä»€ä¹ˆï¼Œè¿™åœ¨å®é™…åº”ç”¨ä¸­æ˜¯åˆç†çš„ï¼‰</p><ol><li><strong>Ciphertext-only attack</strong>,è·å–å¯†æ–‡æ”»å‡»ï¼Œæ•Œæ‰‹ä»…èƒ½è·å–åˆ°ä¼ é€’çš„å¯†æ–‡ã€‚</li><li><strong>Known-plaintext attack</strong>,è·å–æ˜æ–‡æ”»å‡»ï¼Œæ•Œæ‰‹å¯ä»¥å¾—åˆ°æ˜æ–‡ã€å¯†æ–‡å¯¹ï¼Œä»–çš„æ”»å‡»ç›®æ ‡æ˜¯æ”»ç ´ç”¨ç›¸åŒå¯†é’¥åŠ å¯†çš„å¯†æ–‡ã€‚</li><li><strong>Chosen-plaintext attack</strong>(CPA)ï¼Œé€‰æ‹©æ˜æ–‡æ”»å‡»ï¼Œæ•Œæ‰‹ä»»æ„é€‰æ‹©æ˜æ–‡ï¼Œèƒ½å¤Ÿå¾—åˆ°æ˜æ–‡/å¯†æ–‡å¯¹ã€‚CPAå®‰å…¨æ€§æ˜¯å¾ˆé‡è¦çš„ï¼ˆåé¢çš„ç« èŠ‚æœ‰è®¨è®ºï¼‰</li><li><strong>Chosen-ciphertext attack</strong>(CCA)ï¼Œé€‰æ‹©å¯†æ–‡æ”»å‡»ï¼Œæ•Œæ‰‹èƒ½å¤Ÿå¾—åˆ°ä»»ä½•å¯†æ–‡çš„è§£å¯†ç»“æœã€‚</li></ol><p>å¯ä»¥å‘ç°ï¼Œç”±ä¸Šåˆ°ä¸‹çš„å¨èƒæ¨¡å‹ï¼Œæ•Œæ‰‹è¶Šæ¥è¶Šå¼ºã€‚<br>å½“ç„¶ï¼Œé€‰æ‹©å¨èƒæ¨¡å‹æ—¶å¹¶ä¸æ˜¯è¶Šå¼ºè¶Šå¥½ï¼Œåœ¨å®é™…æ–¹æ¡ˆä¸­è‡ªå·±é€‰æ‹©ç½¢ï¼</p><p>å¦å¤–ï¼Œéœ€è¦ç‚¹æ˜çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™é‡Œçš„attackä¾¿å·²ç»ä¸ºä¹‹åçš„é¢„è¨€æœºæ¨¡å‹æ‰“ä¸‹æŸäº›åŸºç¡€ã€‚é¢„è¨€æœºçš„æ¦‚å¿µæš‚ä¸”ä¸è¡¨ã€‚</p><h3 id="ç›¸å…³å‡è®¾">ç›¸å…³å‡è®¾</h3><h4 id="Turing-Machine">Turing Machine</h4><p>å›¾çµæœºæ¨¡å‹åœ¨è®¡ç®—æœºç§‘å­¦ä¸­å æœ‰æä¸ºé‡è¦çš„åœ°ä½ï¼Œä»¥å…¶ä¸ºåŸºç¡€å»ºç«‹çš„å›¾çµæœºæ¨¡å‹æˆä¸ºå¯è®¡ç®—æ€§ç†è®ºã€è®¡ç®—å¤æ‚åº¦ç†è®ºä¸­é‡è¦çš„ä¸€ç¯ã€‚<br>åœ¨ä¹‹åçš„å­¦ä¹ ä¸­ï¼Œå°†ä¼šå­¦ä¹ åˆ°ä»¥ä¸‹å®šç†ï¼š</p><div class="admonition info"><p class="admonition-title">Strong Church-Turing Thesis</p><p>Every physically realisable computation can be simulated on a Turing Machine with at most polynomial slowdown. Probably only true if we exclude quantum computers.</p></div><p><s>ç›¸ä¿¡å¤§å®¶éƒ½æ‡‚è®¡ç®—å¤æ‚åº¦ç›¸å…³å§</s><br>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•å¤šé¡¹å¼ç®—æ³•ï¼Œæ— è®ºåœ¨ç°å®ä¸­é‡‡ç”¨ä»€ä¹ˆç‰©ç†æ¨¡å‹ï¼Œéƒ½å¯ä»¥å½’çº¦åˆ°å›¾çµæœºæ¨¡å‹ï¼Œå¹¶ä¸”æ—¶é—´å¤æ‚åº¦ä¹ŸåŒæ ·æ˜¯å¤šé¡¹å¼ã€‚ï¼ˆå½“ç„¶è¿˜æ²¡æœ‰å‡ºæ¥çš„é‡å­è®¡ç®—æœºä¸åœ¨è®¨è®ºèŒƒå›´å†…ï¼‰</p><p>æˆ‘è§‰å¾—è¿™å—è›®é‡è¦çš„ï¼Œå°±ç§»åˆ°è¿™é‡Œäº†,<s>ç„¶è€Œè¿™æ˜¯ç¬¬ä¸‰ç« çš„å†…å®¹</s>.</p><h4 id="NP">NP</h4><p><s>ä½ ä¸€å®šå·²ç»çŸ¥é“$P$å’Œ$NP$é—®é¢˜å§</s></p><p>æœ‰äº†å›¾çµæœºæ¨¡å‹ï¼Œæ‰èƒ½å¤Ÿè®¨è®º$NP$é—®é¢˜ã€‚å®é™…ä¸Šï¼Œå¯†ç å­¦å¤§éƒ¨åˆ†çš„åŸè¯­(å¤§çº¦æ˜¯åŸºæœ¬ç»„æˆéƒ¨åˆ†çš„æ„æ€)éƒ½å»ºç«‹åœ¨$NP\neq P$çš„åŸºç¡€ä¸Šï¼Œè¿™æ ·æ‰èƒ½è®¨è®ºè®¡ç®—å¤æ‚æ€§å®‰å…¨ï¼ˆåé¢çš„åšå®¢æ¥è®²ï¼‰</p><p>å…¬é’¥å¯†ç å­¦ä¸­çš„å¾ˆå¤šç»“æ„ï¼Œä¾‹å¦‚å› å¼åˆ†è§£çš„éš¾è§£æ€§å°±åŸºäº$NP$é—®é¢˜æã€‚</p><p>ğŸ§è¯¾ä»¶ä¸­ç‰¹åœ°å¼ºè°ƒäº†è¿™é‡Œä»‹ç»çš„precise assumptionçš„é‡è¦æ€§ï¼Œä¾‹å¦‚æ•°å­¦è¯æ˜çš„å®‰å…¨æ€§éœ€è¦è¿™ä¸ªï¼Œæˆ–è€…åŠ å¯†æ–¹æ¡ˆçš„æ¯”è¾ƒ(ç”¨å¼±å‡è®¾é™åˆ¶çš„åŠ å¯†æ–¹æ¡ˆè‚¯å®šæ›´å¥½å˜›),ä»¥åŠæ„å»ºåŠ å¯†æ–¹æ¡ˆçš„å®‰å…¨æ€§ã€‚</p><p>ğŸ˜‡è¿™é‡Œä»‹ç»ä¸€ä¸‹æ¨¡å—åŒ–çš„åŠ å¯†æ–¹æ¡ˆå§</p><p>å®é™…ä¸Šï¼Œå¯†ç å­¦ä¹Ÿæ˜¯ä¸€ä¸ªè‡ªåº•è€Œä¸Šçš„ä¸æ–­æ„å»ºçš„è¿‡ç¨‹ï¼Œæ„å»ºå¤æ‚åŠ å¯†æ–¹æ¡ˆçš„æ—¶å€™éœ€è¦ä¹‹å‰éªŒè¯è¿‡çš„ç®€å•çš„å¯†ç å­¦éƒ¨åˆ†ã€‚è¿™æ ·ï¼Œå³ä½¿éƒ¨åˆ†å‡ºç°é—®é¢˜ï¼Œæ¢ä¸€ä¸ªcomponentå°±è¡Œäº†ï¼›è‹¥åŠ å¯†æ–¹æ¡ˆå‡ºç°é—®é¢˜ï¼Œåˆ™è®¤ä¸ºæ˜¯åŠ å¯†æ–¹æ¡ˆç»„ç»‡çš„é—®é¢˜ï¼Œä¸æ˜¯componentçš„é—®é¢˜ã€‚ä¸¤å…¨å…¶ç¾å•Šå—¯ã€‚</p><h4 id="å®‰å…¨æ€§">å®‰å…¨æ€§</h4><p>ä¹‹å‰è®¨è®ºçš„æ˜¯å¯è¯æ˜å®‰å…¨æ€§ï¼ŒåŠ å¯†æ–¹æ¡ˆå»ºç«‹åœ¨å®‰å…¨ç›®æ ‡å’Œå¨èƒæ¨¡å‹çš„å‡è®¾åŸºç¡€ä¸Šè¯æ˜å…¶å®‰å…¨æ€§ã€‚è‡ªç„¶æ˜¯å’Œå®é™…ä¸­çš„å®‰å…¨æ€§æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>å¯è¯æ˜å®‰å…¨æ€§å»ºç«‹åœ¨å®‰å…¨ç›®æ ‡ã€å¨èƒæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œç°å®ä¸–ç•Œä¸ä¼šæä¾›è¿™ä¹ˆç†æƒ³çš„æ¨¡å‹çš„ã€‚åŒæ—¶ï¼Œå³ä½¿ç°å®ä¸–ç•Œæ»¡è¶³äº†å¯è¯æ˜å®‰å…¨æ€§çš„æ¡ä»¶ï¼Œä¹Ÿä¸èƒ½ä¸€å®šç¡®ä¿å®‰å…¨æ€§ï¼Œä½†è¿™ç§æ–¹å¼è‡ªç„¶æ˜¯æéš¾æ‰¾åˆ°çš„ã€‚åœ¨å¯†ç å­¦ä¸­ä¸è¿›è¡Œè®¨è®ºã€‚</p><h2 id="äºŒæ¬¡ä¿®è®¢éƒ¨åˆ†">----äºŒæ¬¡ä¿®è®¢éƒ¨åˆ†----</h2><p>æœ‰ä¹¦å°±æ˜¯ä¸ä¸€æ ·å•ŠğŸ˜‹</p><h2 id="Principles">Principles</h2><h3 id="1-Formal-Definitions">1.Formal Definitions</h3><p>å½¢å¼åŒ–å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯å½¢å¼åŒ–ä»¥ä¸Šçš„å®‰å…¨åŠ å¯†æ–¹æ¡ˆã€‚</p><p>ä½œç”¨ï¼š</p><ol><li>é¿å…ç³Šé‡Œç³Šæ¶‚çš„æ–¹æ¡ˆå®šä¹‰ï¼Œèƒ½å¤Ÿæä¾›ä¸€ç§æ–¹æ³•å»è¯„ä¼°ã€è¯æ˜å®‰å…¨æ€§ä¸å¦ã€‚</li><li>æä¾›äº†æ–¹æ¡ˆæ¯”è¾ƒçš„æœ‰æ•ˆæ€§ã€‚æ–¹æ¡ˆçš„å®‰å…¨æ€§å–å†³äºå…·ä½“çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¼±å®šä¹‰çš„å®‰å…¨æ–¹æ¡ˆå¯èƒ½æ¯”å¼ºå®šä¹‰æ›´åŠ æœ‰æ•ˆã€‚-&gt;æ¨¡å—åŒ–çš„å¯è¡Œæ€§ã€‚</li></ol><p>è¿™é‡Œç»™äº†å½¢å¼åŒ–å®šä¹‰çš„ä¸€ä¸ªä¾‹å­ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„å¯¹äºå®‰å…¨ç›®æ ‡çš„å®šä¹‰ã€‚è¿™é‡Œè¿›è¡Œè¡¥å……ã€‚<br>å›é¡¾ä¸€ä¸‹å®šä¹‰ï¼š</p><div class="admonition info"><p class="admonition-title">info</p><p><strong>ä¸ç®¡æ”»å‡»è€…æœ‰äº†å¤šå°‘ä¿¡æ¯ã€‚å¯†æ–‡éƒ½ä¸èƒ½æ³„éœ²ç»™æ•Œæ‰‹ä»»ä½•é¢å¤–çš„å…³äºæ˜æ–‡çš„ä¿¡æ¯ã€‚</strong></p></div><p>è¿™é‡Œå¹¶æ²¡æœ‰å®šä¹‰ä¿¡æ¯çš„â€œmeaningfulâ€ï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰æ²¡æœ‰ä»»ä½•ä¿¡æ¯è¢«æ³„éœ²ï¼Œå› æ­¤è¯¥å®šä¹‰å¯ä»¥æ»¡è¶³å…¶ä»–æ½œåœ¨çš„éœ€è¦ã€‚å…³äºâ€œä¸æ³„éœ²ä»»ä½•å…³äºæ˜æ–‡çš„ä¿¡æ¯â€ï¼Œä»¥åŠæœ‰å…³æ”»å‡»æ‰‹å¯èƒ½æœ‰çš„å…ˆéªŒçŸ¥è¯†ç›¸å…³ï¼Œåœ¨ä¹‹åçš„ç¬¬äºŒã€ä¸‰ç« ä¸­ä¾¿æœ‰æ¶‰åŠã€‚</p><h3 id="2-Precise-Assumptions">2. Precise Assumptions</h3><p>é™¤äº†å®‰å…¨æ€§è¯æ˜éœ€è¦ç²¾ç¡®çš„å‡è®¾ï¼Œå…¶è¿˜å¯ä»¥è®©æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œæ–¹æ¡ˆé—´çš„æ¯”è¾ƒã€‚åŸºäºæ›´å¼±çš„å®‰å…¨æ€§å‡è®¾ï¼Œèƒ½å¤Ÿæœ‰æ›´é«˜çš„è‡ªç”±åº¦å»æ„å»ºåŠ å¯†æ–¹æ¡ˆï¼Œå› æ­¤ç›¸è¾ƒè€Œè¨€ï¼Œå¼±å®‰å…¨æ€§å‡è®¾ä¸‹çš„å®‰å…¨æ€§è¯æ˜æ›´å—åˆ°äººä»¬çš„é’çã€‚</p><p>åŒæ—¶ï¼Œç²¾ç¡®å‡è®¾ä¹Ÿæä¾›äº†ï¼šè‹¥ç»„æˆåŠ å¯†æ–¹æ¡ˆçš„blockè¢«æ”»ç ´åï¼Œå‡è®¾ä»ç„¶æˆç«‹ä¸‹çš„è¡¡é‡åŸåŠ å¯†æ–¹æ¡ˆå®‰å…¨æ€§çš„æ–¹å¼ã€‚</p><p>è¿™é‡Œè§£é‡Šäº†ä¸€å †ä¸ºä»€ä¹ˆé‡‡ç”¨å»ºç«‹åœ¨å‡è®¾ä¸Šçš„å®‰å…¨æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯ç›´æ¥è®¤ä¸ºå®‰å…¨æ–¹æ¡ˆæ˜¯å®‰å…¨çš„åŸå› ï¼Œè¿™é‡Œç•¥äº†ï¼ˆä¹¦P19ï¼‰ã€‚</p><h3 id="3-Proofs-of-Security">3. Proofs of Security</h3><p>è‹¥è¦æ„å»ºåŠ å¯†æ–¹æ¡ˆï¼Œå¿…é¡»è¦å»ºç«‹åœ¨ç²¾ç¡®å‡è®¾ä¸Šçš„å®‰å…¨æ€§è¯æ˜ä¸Šï¼Œè¿™æ¯”å¯å‘å¼ï¼Œæˆ–è€…æ²¡æœ‰å‡è®¾çš„è¯æ˜å¥½ã€‚</p><p>å…³äºå¯å‘å¼çš„è¯æ˜ï¼šå³ä½¿è¯æ˜äº†å¯¹äºä¸€å¤§æ‰¹æ”»å‡»ä¸‹ä½ çš„æ–¹æ¡ˆçš„å®‰å…¨æ€§ï¼Œä¹Ÿä¸èƒ½ä¿è¯ä½ çš„æ–¹æ¡ˆä¸€å®šå®‰å…¨ã€‚</p><h3 id="4-Provable-Security-and-Real-world-Security">4. Provable Security and Real-world Security</h3><p>ç°å®æƒ…å†µçš„ä¸åŒï¼Œå¯¼è‡´å¯èƒ½çš„å®‰å…¨ç›®æ ‡ã€å¨èƒæ¨¡å‹ã€å‡è®¾ç­‰ä¸æ»¡è¶³å¯è¯æ˜å®‰å…¨æ‰€éœ€ï¼Œå¦å¤–ä¹Ÿæœ‰å„ç§æ„æƒ³ä¸åˆ°çš„æ–¹å¼æ”»ç ´å¯è¯æ˜å®‰å…¨ä¸‹çš„åŠ å¯†æ–¹æ¡ˆã€‚</p><hr><p><strong>ç¢ç¢å¿µ</strong>ï¼šå“¦å®Œè›‹ï¼ŒåŸºç¡€ç†è®ºæˆ‘ä¹Ÿä¸å¤ªä¼šï¼Œå¯†ç å­¦è¦å¯„äº†ğŸ˜­</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker_first:åŸºæœ¬æŒ‡ä»¤</title>
      <link href="/2022/11/04/docker-first-ji-ben-zhi-ling/"/>
      <url>/2022/11/04/docker-first-ji-ben-zhi-ling/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•æŒ‡ä»¤ä¿¡æ¯ä¾›ä¹‹åæŸ¥è¯¢ã€‚</p><h2 id="begin">begin</h2><p>link:<a href="https://docs.docker.com/">docker-docs</a></p><h3 id="docker-build">docker build</h3><pre class="language-bash" data-language="bash"><code class="language-bash">docker build -t tag-name .</code></pre><p><code>build</code>: ç”¨<code>dockerfile</code>æ¥å»ºç«‹æ˜ åƒã€‚<br><code>-t</code> flag your image,åé¢è·Ÿç€åå­—ã€‚<br><code>.</code> current directory to find <code>Dockerfile</code></p><h3 id="docker-run">docker run</h3><pre class="language-bash" data-language="bash"><code class="language-bash">docker run -dp 3000:3000 tag-name</code></pre><p><code>run</code> è¿è¡Œdocker<br><code>-d</code> åˆ†ç¦»â€œdetachedâ€modeè¿è¡Œã€‚<br><code>-p</code> map from hostâ€™s port to containerâ€™s port</p><h3 id="update-code">update code</h3><pre class="language-bash" data-language="bash"><code class="language-bash">docker ps# swap out container-id with ID from docker psdocker stop container-iddocker rm container-id# or stop&amp;rm:docker rm -f container-id</code></pre><p><code>ps</code>ï¼šè¿è¡Œä¸­å®¹å™¨list<br><code>stop</code> stop è¿è¡Œ<br><code>rm</code>ï¼šremove containerï¼ˆé»˜è®¤éœ€è¦stopåï¼‰<br><code>-f</code>ï¼šå¼ºåˆ¶ã€‚</p><p>ä»¥ä¸Šä»ç„¶éœ€è¦éº»çƒ¦çš„æŒç»­æ€§é‡å¤´å†æ¥ã€‚</p><h3 id="push-docker-hub">push docker-hub</h3><p><code>docker-hub</code>:å…ˆåˆ›ä¸ªä»“åº“ã€‚åé¢ä¼šç›´æ¥ç»™ä½ ä¸ªä»£ç ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker push namespace/tagname</code></pre><p>ç„¶è€Œåªæœ‰è¿™ä¸ªæ˜¯ä¸å¤Ÿçš„ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker login -u USER-NAMEdocker tag image-name USER-NAME/NEW-NAMEdocker push USER-NAME/NEW-NAME</code></pre><p>tagä¸€ä¸‹ï¼Œæ‰èƒ½æ‰¾åˆ°æ­£ç¡®çš„imageæã€‚</p><h3 id="DB">DB</h3><p>ä¸€ä¸ªå®¹å™¨è¿è¡Œçš„æ—¶å€™ï¼Œä»–æ˜¯ç”¨æ˜ åƒé‡Œå¤´çš„å¤šä¸ªå±‚ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæ¯ä¸ªå®¹å™¨è¿˜æœ‰è‡ªå·±çš„æš‚å­˜ç©ºé—´æ¥åˆ›å»º/æ›´æ–°/åˆ é™¤æ–‡ä»¶ï¼Œä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šåœ¨å¦ä¸€ä¸ªå®¹å™¨çœ‹åˆ°ã€‚<br>æ¯”å¦‚ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker run -d ubuntu bash -c "shuf -i 1-10000 -n 1 -o /data.txt &amp;&amp; tail -f /dev/null"docker exec container-id cat /data.txt</code></pre><p>then, we can use volume!</p><h3 id="named-volumes">named volumes</h3><p>æ•°æ®bucketï¼ŒæŒä¹…åŒ–æŒ‡å®šä½ç½®çš„æœ€åæ”¹åŠ¨æ•°æ®ï¼Œ</p><p>ç”¨å·æŒä¹…åŒ–ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker volume create volume-namedocker run -dp 3000:3000 -v volume-name:&lt;where?&gt; &lt;container-name&gt;</code></pre><p>where is the volume?</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker volume inspect volume-name</code></pre><h3 id="bind-mounts">bind mounts</h3><p>named volumeæŒç»­åŒ–æ•°æ®è¿˜æ˜¯ä¸é”™çš„ã€‚<br>è¿™é‡Œè®²çš„bind mountsï¼Œå¯ä»¥æ§åˆ¶ç¡®åˆ‡çš„æŒ‚è½½ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å…¶æŒä¹…åŒ–æ•°æ®ï¼Œä½†å®ƒé€šå¸¸ç”¨äºæä¾›é¢å¤–çš„æ•°æ®ç»™å®¹å™¨ã€‚ç”¨å…¶å¯ä»¥ç«‹åˆ»çœ‹åˆ°æ‰€éœ€çš„æ›´æ”¹ã€‚</p><div class="admonition info"><p class="admonition-title">various volume</p><p>å½“ç„¶ï¼Œå…¶ä¸­è¿˜æ˜¯æœ‰åˆ«çš„volumeçš„ï¼Œè¿™é‡Œåªæœ‰bind mountså’Œnamed volumedã€‚</p></div><pre class="language-bash" data-language="bash"><code class="language-bash">docker run -dp 3000:3000 \     -w /app -v "$(pwd):/app" \     node:12-alpine \     sh -c "yarn install &amp;&amp; yarn run dev"</code></pre><p><code>-w app</code>ï¼šset working directory<br><code>-v "$(pwd):/app"</code>bind mount the currentï¼ˆpwdï¼Ÿï¼‰directory into the <code>/app</code> directory in the container<br><code>node:12-alpline</code> image to useï¼ˆbase imageï¼‰<br><code>sh -c....</code> alpineï¼šshell running commandã€‚</p><p>æŸ¥çœ‹dockeræ—¥å¿—ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker logs -f container-id</code></pre><h3 id="å¤šåº”ç”¨ï¼šå¤šå®¹å™¨">å¤šåº”ç”¨ï¼šå¤šå®¹å™¨</h3><h4 id="container-networking">container networking</h4><p>ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>å¼€å§‹çš„æ—¶å€™ç»™ä½ æ¥ä¸ªç½‘</li><li>è¿æ¥ç°æˆçš„container</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash">docker network create network-name# create networkï¼Œand thenï¼šdocker run -d \     --network todo-app --network-alias mysql \     -v todo-mysql-data:/var/lib/mysql \     -e MYSQL_ROOT_PASSWORD=secret \     -e MYSQL_DATABASE=todos \     mysql:5.7</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>-e</code>è®¾ç½®äº†ç¯å¢ƒå˜é‡.</p><div class="admonition info"><p class="admonition-title">new volume?</p><p>åœ¨è¿™é‡Œ,è‡ªåŠ¨åˆ›å»ºäº†ä¸ªvolumeï¼Œå› æ­¤å‡ºç°äº†ä»æœªå‡ºç°çš„å·åã€‚</p></div><pre class="language-bash" data-language="bash"><code class="language-bash">docker run -it --network todo-app nicolaka/netshoot</code></pre><p>use dig tool,we could find the mysql <code>ip</code>ï¼Œdockerå¯ä»¥å°†åå­—å’Œç½‘ç»œåœ°å€è”ç³»ï¼šuse<code>--network-alias</code>flagã€‚</p><h4 id="connect-mysql-with-app">connect mysql with app</h4><pre class="language-bash" data-language="bash"><code class="language-bash"># mysql version8.0 and higher:mysql&gt; ALTER USER 'root' IDENTIFIED WITH mysql_native_password BY 'secret';mysql&gt; flush privileges;mysql&gt; exit# docker:connectdocker run -dp 3000:3000 \   -w /app -v "$(pwd):/app" \   --network todo-app \   -e MYSQL_HOST=mysql \   -e MYSQL_USER=root \   -e MYSQL_PASSWORD=secret \   -e MYSQL_DB=todos \   node:12-alpine \   sh -c "yarn install &amp;&amp; yarn run dev"# operate, and show mysql imformationdocker exec -it &lt;mysql-container-id&gt; mysql -p todosmysql&gt; select * from todo_items; +--------------------------------------+--------------------+-----------+ | id                                   | name               | completed | +--------------------------------------+--------------------+-----------+ | c906ff08-60e6-44e6-8f49-ed56a0853e85 | Do amazing things! |         0 | | 2912a79e-8486-4bc3-a4c5-460793a575ab | Be awesome!        |         0 | +--------------------------------------+--------------------+-----------+</code></pre><h3 id="Docker-Compose">Docker Compose</h3><p><a href="https://docs.docker.com/compose/install/">install Docker Compose</a></p><p>and then: create <code>docker-compose.yml</code> in root directory.</p><div class="admonition info"><p class="admonition-title">ä¸æƒ³å†™äº†ï¼Œçœ‹è¿æ¥å§</p><p>you can see detail in <a href="https://docs.docker.com/get-started/08_using_compose/">here</a></p></div><h3 id="addition">addition</h3><h4 id="æ‰«æå®‰å…¨æ¼æ´">æ‰«æå®‰å…¨æ¼æ´</h4><pre class="language-bash" data-language="bash"><code class="language-bash">docker scan --logindocker scanf image-name</code></pre><h4 id="æŸ¥çœ‹Image-Layering">æŸ¥çœ‹Image Layering</h4><pre class="language-bash" data-language="bash"><code class="language-bash">docker image histroy image-name#  å¯ä»¥çœ‹åˆ°Image-id,create-time,create-by,size,commentdocker image history --no-trunc getting-started# å¿½ç•¥æˆªæ–­æã€‚</code></pre><div class="admonition warning"><p class="admonition-title">layer changes</p><p>Once a layer changes, all downstream layers have to be recreated as well</p></div><h4 id="dockerignore">.dockerignore</h4><p>.dockerignoreæ–‡ä»¶ä¸­ï¼š</p><pre class="language-docker" data-language="docker"><code class="language-docker">node_modules</code></pre><p>ä½¿ç”¨ç¼“å­˜speed upã€‚</p><h4 id="multi-stage-builds">multi-stage builds</h4><pre class="language-docker" data-language="docker"><code class="language-docker"># syntax=docker/dockerfile:1FROM maven AS buildWORKDIR /appCOPY . .RUN mvn packageFROM tomcatCOPY --from=build /app/target/file.war /usr/local/tomcat/webapps# react example# syntax=docker/dockerfile:1FROM node:12 AS buildWORKDIR /appCOPY package* yarn.lock ./RUN yarn installCOPY public ./publicCOPY src ./srcRUN yarn run buildFROM nginx:alpineCOPY --from=build /app/build /usr/share/nginx/html</code></pre><p>å¤šé˜¶æ®µæ„å»ºå¯ä»¥å‡å°‘æ•´ä½“image sizeã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> primary </tag>
            
            <tag> DevOpswork </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dpæŠ€å·§1ï¼šå››è¾¹å½¢ä¸ç­‰å¼</title>
      <link href="/2022/10/22/dp-ji-qiao-1-si-bian-xing-bu-deng-shi/"/>
      <url>/2022/10/22/dp-ji-qiao-1-si-bian-xing-bu-deng-shi/</url>
      
        <content type="html"><![CDATA[<p>åŒºé—´dpä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§åˆ°ä»¥ä¸‹å¼å­ï¼š</p><p>$dp(i,j)=min_{i\leq k&lt; j}(dp(i,k)+dp(k+1,j)+~<s>w(i,j)</s>~)$</p><p>é‚£ä¹ˆï¼Œå¯¹äºè¿™ä¸ª $w$ ï¼Œå¦‚æœæ»¡è¶³å•è°ƒæ€§ï¼š</p><p>$$(l\leq lâ€™\leq râ€™\leq r)~~~w(lâ€™,râ€™)\leq w(l,r)$$</p><p>æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ï¼š</p><p>$$(l\leq lâ€™\leq râ€™\leq r)~~~w(l,râ€™)+w(lâ€™,r)\leq w(l,r)+w(lâ€™,râ€™)$$</p><p>é‚£ä¹ˆæœ‰ï¼Œå¯¹äºä¸Šé¢çš„dpè€Œè¨€ï¼Œæ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ã€‚<br>è¯æ˜ï¼š<br>å¯¹äº$l=lâ€™$æˆ–è€…$r=râ€™$ï¼Œæœ‰ï¼š<br>$dp(l,râ€™)+dp(lâ€™,r), ~~~ dp(l,r)+dp(lâ€™,râ€™)$ï¼Œæˆ‘è§‰å¾—ä½ è§‚å¯Ÿä¸‹å°±èƒ½æ•´å‡ºæ¥ã€‚ã€‚</p><p>é‚£ä¹ˆï¼Œæ•°å­¦å½’çº³æ³•æ•´ä¸ªï¼šå¯¹$len=r-l+1$å½’çº³ï¼š</p><ol><li><p>$l\leq lâ€™=râ€™\leq r$ï¼Œæ­¤æ—¶$len=0$.</p><p>å¯¹äº$dp(l,râ€™)+dp(lâ€™,r)$æœ‰ï¼š</p><p>$åŸå¼=dp(l,râ€™)+dp(râ€™,r) \leq dp(l,r)+dp(lâ€™,râ€™)=dp(l,r)$</p></li></ol><p>å³è¯æ˜è¯¥å¼æˆç«‹ã€‚<br>åˆ™å¯¹$dp(l,r)$:<br>è®¾$k=max{ x|dp(l,r)=dp(l,x-1)+dp(x,r)+w(l,r)}$<br>ç”±å¯¹ç§°æ€§ï¼šä¸å¦¨è®¾$k\leq râ€™$.<br>æœ‰ï¼š<br>$$<br>\begin{aligned}<br>dp(l,râ€™)+dp(lâ€™,r) &amp;\leq w(l,râ€™)+dp(l,k-1)+dp(k,râ€™)+dp(lâ€™,r)\\<br>&amp; \leq w(l,r)+dp(l,k-1)+dp(k,râ€™)+dp(lâ€™,r)\\<br>&amp; \leq w(l,r)+dp(l,k-1)+dp(k,r)=dp(l,r)<br>\end{aligned}$$<br>2. $l&lt;lâ€™&lt; râ€™&lt; r$<br>å¯¹$dp(l,râ€™)+dp(lâ€™,r)$è€Œè¨€ï¼šè®¾<br>$y=max{x|dp(l,râ€™)=dp(l,x-1)+dp(x,râ€™)+w(l,râ€™) }$<br>$z=max{x|dp(lâ€™,r)=dp(lâ€™,x-1)+dp(x,r)+w(lâ€™,r)}$<br>åˆ™ï¼š<br>ä¸å¦¨è®¾ï¼š$y\leq z$,åˆ™æœ‰$l&lt;z\leq y \leq r$.<br>åŸå¼<br>$$\begin{aligned}<br>\leq dp(l,y-1)+dp(y,râ€™)+w(l,râ€™)+w(lâ€™,r)+dp(lâ€™,z-1)+dp(z,r)\\<br>\leq w(l,r)+w(lâ€™,râ€™)+dp(l,y-1)+dp(lâ€™,z-1)+dp(y,râ€™)+dp(z,r)\\<br>\leq w(l,r)+w(lâ€™,râ€™)+dp(l,y-1)+dp(lâ€™,z-1)+dp(y,r)+dp(z,râ€™)\\<br>= dp(l,r)+dp(lâ€™,râ€™)<br>\end{aligned}<br>$$</p><p>è¿™æ€§è´¨å’ŒåŒºé—´$dp$æœ‰å•¥å…³ç³»å‘¢ï¼Ÿ<br>è¯¥æ€§è´¨èƒ½å¤Ÿè¯æ˜å•è°ƒæ€§ï¼šå¯¹äºæ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼çš„dpçŠ¶æ€ï¼Œå®šä¹‰$s(i,j)$ä¸º$dp(i,j)$å†³ç­–è¿‡ç¨‹çš„æœ€å¤§å€¼ã€‚<br>å› æ­¤æœ‰:$s(i,j)$å•è°ƒï¼Œ$s(i,j)\leq s(i,j+1)\leq s(i+1,j+1)$.<br>å› æ­¤åœ¨dpè¿‡ç¨‹ä¸­ï¼š<br>$$dp(i,j)=\begin{cases}<br>min_{s(i,j-1)\leq k \leq s(i+1,j)}{dp(i,k-1)+dp(k,j)+w(i,j)} &amp; i&lt;j \\<br>0 &amp;i=j \\<br>+\infty &amp;i&gt;j<br>\end{cases}$$</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒºé—´dp </tag>
            
            <tag> ä¼˜åŒ– </tag>
            
            <tag> Math </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„æ¿å­</title>
      <link href="/2022/10/22/shu-ju-jie-gou-ban-zi/"/>
      <url>/2022/10/22/shu-ju-jie-gou-ban-zi/</url>
      
        <content type="html"><![CDATA[<h2 id="å¹¶æŸ¥é›†">å¹¶æŸ¥é›†</h2><p>åˆ¤æ–­é›†åˆï¼Œåˆå¹¶é›†åˆï¼Œæ¯”å¦‚å›¾è®ºä¸­çš„kruskalï¼Œè¿é€šåˆ†æ”¯ç­‰ã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">//int fa[N],siz[N];void init_set(int n){//åˆå§‹åŒ–    for(int i=1;i&lt;=n;++i){        fa[i]=i,siz[i]=1;    }}int find(int x){//è·¯å¾„å‹ç¼©    return fa[x]==x?x:(fa[x]=find(fa[x]));}void unionfa(int x,int y){//å¯å‘å¼åˆå¹¶    int parent_x=find(x),parent_y=find(y);    if(parent_x==parent_y){        return;    }    if(siz[parent_x]&gt;siz[parent_y]){        swap(parent_x,parent_y);    }//æŒ‰ç…§èŠ‚ç‚¹é›†åˆå¤§å°ï¼Œä¿è¯å°çš„å’Œåˆ°å¤§çš„é‡Œé¢ã€‚    fa[parent_x]=parent_y;    siz[parent_y]+=siz[parent_x];}</code></pre><h2 id="STè¡¨">STè¡¨</h2><p>$\Theta(nlogn)é¢„å¤„ç†ï¼Œ\Theta(1)æŸ¥è¯¢$</p><p>å¯é‡å¤è´¡çŒ®â€”â€”â€”è‹¥å¯¹æŸç§è¿ç®—$opt$ï¼Œæœ‰:$x<sub>opt</sub> x=x$ï¼Œä¾‹å¦‚$gcd(x,x)=x,max(x,x)=x$ï¼Œåˆ™ç±»ä¼¼çš„åŒºé—´æŸ¥è¯¢ï¼Œæ¯”å¦‚åŒºé—´gcdï¼ŒåŒºé—´æœ€å¤§å€¼ï¼Œä¸”$opt$æ»¡è¶³ç»“åˆå¾‹$a<sub>opt</sub>(b<sub>opt</sub>c)=(a<sub>opt</sub>b)<sub>opt</sub>c$,åˆ™å¯ä»¥ä½¿ç”¨STè¡¨è¿›è¡ŒåŒºé—´æŸ¥è¯¢ã€‚<br>ä½†æ¯”å¦‚åŒºé—´å’Œï¼Œoptè¡Œä¸ºå°±ä¼šè®¡ç®—ä¸¤æ¬¡ï¼Œè¿˜æ˜¯ä¸è¡Œæã€‚<br>DP:$f(i,j)=max[i,i+2^j-1]$<br>$f(i,0)=max[i,i]=i$<br>-&gt;<br>$f(i,j)=max(f(i,j-1),f(i+2^{j-1},j-1))$</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">//ä»¥æœ€å¤§å€¼ä¸ºä¾‹//#define N 2000001const int maxlog=21;int st[N][maxlog],logn[N];void init_st(int n){    logn[1]=0;    logn[2]=1;    for(int i=3;i&lt;N;++i){        logn[i]=logn[i&gt;&gt;1]+1;    }}void st_process(int total){    init_st();    for(int i=1;i&lt;=n;++i){        cin&gt;&gt;st[i][0];    }}</code></pre><h2 id="æ ‘çŠ¶æ•°ç»„">æ ‘çŠ¶æ•°ç»„</h2><pre class="language-cpp" data-language="cpp"><code class="language-cpp">int tree[N],diff[N];int lowbit(int x){    return x&amp;-x;}void add(int x,int k,int n){    int tem=x*k;    while(x&lt;=n){        tree[x]+=k,diff[x]+=tem;        x+=lowbit(x);       }}void add_range(int,l,int r,int k){    add(l,k),add(r+1,-v);}long long int get_sum_range(intl,int r){    return (r+1ll)*getpre(r,tree)-1ll*l*getpre(l-1,tree)-    (getpre(r,diff)-getpre(l-1,diff));}int getpre(int x,int *tree){    int cnt=0;    while(x) {        cnt+=tree[x];        x-=lowbit(x);    }    return cnt;}</code></pre><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¿å­ </tag>
            
            <tag> Data Structure </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­—ç¬¦ä¸²æ¿å­</title>
      <link href="/2022/10/22/zi-fu-chuan-ban-zi/"/>
      <url>/2022/10/22/zi-fu-chuan-ban-zi/</url>
      
        <content type="html"><![CDATA[<h2 id="å­—å…¸æ ‘">å­—å…¸æ ‘</h2><pre class="language-cpp" data-language="cpp"><code class="language-cpp">struct trie{    int nxt[N][26], cnt = 0;    bool vis[N]={0};//è¯¥èŠ‚ç‚¹ç»“å°¾çš„å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨    //int repeat[N] = {0};    //ä¸¤ç§é‡è½½ç‰ˆæœ¬    void insert(string &amp;s){        int now = 0;        for (int i = 0;i&lt;s.size();++i){            int tem = s[i] - 'a';            if(!nxt[now][tem]) nxt[now][tem] = ++cnt;            now = nxt[now][tem];        }        vis[now] = 1;    }    int find(string &amp;s){        int now = 0;        for (int i=0;i&lt;s.size();++i){            int tem = s[i] - 'a';            if(!nxt[now][tem]) return false;            now = nxt[now][tem];        }        /*if(vis[now]){            ++repeat[now];        }   return repeat[now];*/        return vis[now];    }};</code></pre><h2 id="å‰ç¼€å‡½æ•°">å‰ç¼€å‡½æ•°</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‰ç¼€å‡½æ•°æœ¬èº«å°±æ˜¯â€è·³è½¬â€œï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªè·³è½¬çš„å¤±é…å‡½æ•°æ€§è´¨ã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">int pre_len[N];void pre_len_process(string s){    //kmp:string s,string t;    //string last=s+"#"+t;    for(int i=0;i&lt;s.size();++i){        int j=pre_len[i-1];        while(j&gt;0&amp;&amp;s[i]!=s[j]){            j=pre_len[j-1];        }        if(s[i]==s[j]){            ++j;        }        pre_len[i]=j;    }}</code></pre><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¿å­ </tag>
            
            <tag> String </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾è®ºæ¿å­</title>
      <link href="/2022/10/22/tu-lun-ban-zi/"/>
      <url>/2022/10/22/tu-lun-ban-zi/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€">åŸºç¡€</h2><h3 id="å»ºå›¾">å»ºå›¾</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">struct edge{    int u,v;};vector&lt;edge&gt; e;vector&lt;bool&gt; vis;//è¾ƒä¸ºä½æ•ˆï¼Œè‹¥ç”¨æ—¶åŸºæœ¬ä¸Šæ˜¯éœ€è¦å­˜è¾¹çš„æ¶ˆæ¯ä»¥å¤šæ¬¡å»ºå›¾ï¼Œ//æˆ–è€…éœ€è¦åƒkruskalé‚£æ ·å¯¹è¾¹æƒç­‰è¿›è¡Œç›´æ¥æ“ä½œã€‚é‚»æ¥è¡¨ï¼ŒåŒå¹³å¸¸å†™æ³•ã€‚é“¾å¼å‰å‘æ˜Ÿï¼šint total=-1,head[]...;//éœ€è¦å…¨éƒ¨åˆå§‹åŒ–ä¸º-1ã€‚void add(int u,int v){    nxt[++cnt]=head[u];    head[u]=cnt;    to[cnt]=v;}//éå†æ—¶for(int i=head[u];~i;i=nxt[i]){    v=to[i];}</code></pre><h3 id="æ‹“æ‰‘æ’åº">æ‹“æ‰‘æ’åº</h3><p>Kahnç®—æ³•ï¼šä¸æ–­ç»´æŠ¤ä¸€ä¸ªå…¥åº¦ä¸º0çš„é›†åˆï¼ˆBFSï¼‰</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">//struct node{ int now, val;};//ç¬¬ä¸€ç§å†™æ³•ï¼Œé‡‡ç”¨ç»“æ„ä½“åŠ ä»¥åˆ¤æ–­vector&lt;int&gt; graph[30];int intonow[30];//set&lt;int&gt; total;//ç°æœ‰èŠ‚ç‚¹vector&lt;int&gt; output;bool toposort(int n){    queue&lt;int&gt; q;    output.clear();    for (int i = 0; i &lt; n;++i)        if(!intonow[i])            q.push(i);    while(!q.empty()){//        int now = q.front();        q.pop();        output.push_back(now);        for (int i = 0; i &lt; graph[now].size();++i){            int nxt = graph[now][i];            if(--intonow[nxt]==0){                q.push(nxt);            }        }    }    if(output.size()==n){        cout&lt;&lt;....;        return true;    } else {        return false;    }    /*åœ¨è¿™é‡Œä¿ç•™çš„åŸå› æ˜¯å› ä¸ºè¿™é‡Œçš„å®Œå…¨å»ºç«‹å…³ç³»å’Œæ‹“æ‰‘æ’åºè¿˜æ˜¯æœ‰æ‰€ä¸åŒï¼Œåœ¨è¿™é‡Œå°±å½“æ‹“å±•æ€è·¯äº†ã€‚    if(maxs==n){        cout &lt;&lt; "Sorted sequence determined after " &lt;&lt; len &lt;&lt; " relations: ";//lenä¸ºå‡½æ•°å‚æ•°ï¼Œè‡ªå·±çœ‹çœ‹è¦ä¸è¦ç½¢        for (int i = 0; i &lt; output.size();++i)            cout &lt;&lt; char('A' + output[i]);        cout &lt;&lt; ".";return true;    }     if(cnt!=total.size()){        cout &lt;&lt; "Inconsistency found after " &lt;&lt; len &lt;&lt; " relations.";        return true;    }    return false;*/}</code></pre><p>DFSï¼šéœ€è¦æ³¨æ„çš„å°±æ˜¯æœ€åçš„outputæ˜¯dfsåºï¼Œéœ€è¦reverse</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">vector&lt;int&gt; graph[N],output;int marked[N];bool dfs(int now){    marked[now]=-1;    for(int nxt:graph[now]){        if(marked[nxt]&lt;0) return false;        if(!marked[nxt]&amp;&amp;!dfs(nxt)) return false;    }    marked[now]=1;    output.push_back(now);    return true;}bool toposort(){    output.clear(),memset(marked,0,sizeof(marked));    for(int i=0;i&lt;n;++i)   if(!marked[i]&amp;&amp;!dfs(i)) return false;    reverse(output.begin(),output.end());    return true;}</code></pre><h3 id="æ ‘é“¾å‰–åˆ†">æ ‘é“¾å‰–åˆ†</h3><p>ä¸‹é¢æ˜¯é‡é“¾å‰–åˆ†ï¼ŒæŒ‰ç…§å­æ ‘å¤§å°è¿›è¡Œåˆ’åˆ†ã€‚å…¶ä»–å¦‚é•¿é“¾å‰–åˆ†ï¼Œå¯ä»¥ç›´æ¥æ”¹æ”¹å°±è¡Œã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">int fa[N],dep[N],siz[N],hson[N];//çˆ¶èŠ‚ç‚¹ï¼Œæ·±åº¦ï¼Œå­æ ‘å¤§å°ï¼Œé‡èŠ‚ç‚¹vector&lt;int&gt; a[N];int top[N],dfn[N],rnk[N],tot;//é“¾é¡¶ï¼Œdfsåºï¼Œrnkï¼šé€†å‡½æ•°ï¼Œrnk[dfn[x]]=x;int dfs1(int u){//è®°å½•æ‰€éœ€ä¿¡æ¯    hson[u]=-1;    siz[u]=1;    for(int i=0;i&lt;a[u].size();++i){        int v=a[u][i];        if(!dep[v]){            dep[v]=dep[u]+1;            siz[u]+=dfs(v,d+1);            fa[v]=u;            if(hson[u]==-1||siz[hson[u]]&lt;siz[v]){                hson[u]=v;            }        }    }    return siz[u];}void dfs2(int u,int nowtop){    top[u]=nowtop;    dfn[u]=++tot;    rnk[cnt]=u;    if(hson[u]==-1)return;    dfs2(hson[u],nowtop);    for(int i=0;i&lt;a[u].size();++i){        int v=a[u][i];        if(v!=hson[u]&amp;&amp;v!=fa[u]){            dfs2(v,v);        }    }}</code></pre><h2 id="æ ‘">æ ‘</h2><h3 id="æ ‘ç›´å¾„">æ ‘ç›´å¾„</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">int fail[N],d[N];vector&lt;int&gt; a[N];int road[N],cnt=0;void dfs(int u,int fa,int &amp;last){    fail[u]=fa;    for(int v:a[u]){        if(v!=fa){            d[v]=d[u]+1;            if(d[v]&gt;d[last])  last=v;            dfs(v,u,last);        }    }}//ä½¿ç”¨ï¼šcnt=0;int begin=0,end=0;d[1]=0,dfs(1,0,begin);d[begin]=0;dfs(begin,0,end);for(int i=end;i;i=fail[i]){    road[cnt++]=i;}</code></pre><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Graph </tag>
            
            <tag> æ¿å­ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apriori</title>
      <link href="/2022/10/22/apriori/"/>
      <url>/2022/10/22/apriori/</url>
      
        <content type="html"><![CDATA[<p>å…ˆå­˜ç€ï¼Œä¹ã€‚<br>æéº»éº»æ»´å›¾çµçš„é¡¹ç›®å’ŒæŠ¥å‘Šæœ‰ç‚¹å¤šï¼ŒAprioriç®—æ³•ä»¥åŠæ•°æ®æŒ–æ˜çš„ç›¸å…³æ¦‚å¿µå€’æ˜¯å¯ä»¥ç¨å¾®æ€»ç»“ä¸‹ï¼Œæ¯•ç«Ÿæˆ‘ä¹‹åä¸ä¼šå»çœ‹è¯¾æœ¬å’Œpptäº†ã€‚<br>è°çœ‹è¿™äº›å•Šï¼ˆæš´è®ºï¼‰</p><h2 id="æ¥ç‚¹æ¦‚å¿µ">æ¥ç‚¹æ¦‚å¿µ</h2><h3 id="basic-conception">basic conception</h3><p>é¦–å…ˆè¦æ˜ç™½çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™é‡Œçš„æ•°æ®æŒ–æ˜åŸºæœ¬ä¸Šæ˜¯å»å¯»æ‰¾æ•°æ®çš„å…³è”æ€§çš„ã€‚</p><p>é¡¹é›†ï¼šè‹¥å¹²ä¸ªé¡¹çš„é›†åˆï¼Œæ˜¯æ•°æ®æŒ–æ˜ç§æœ€åŸºæœ¬çš„æ¨¡å¼ã€‚<br>äº‹åŠ¡ï¼šæ¯ä¸ªäº‹åŠ¡éƒ½æ˜¯éç©ºé¡¹é›†ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€è¡¨ç¤ºTIDã€‚<br>æ•°æ®é›†ï¼šäº‹åŠ¡çš„é›†åˆã€‚<br>ké¡¹é›†ï¼šäº‹åŠ¡$|A|=k$</p><p>æ€»ä½“è€Œè¨€ï¼Œç»™å®šäº†æ•°æ®é›†åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åˆ†ææ¥å‘ç°é¢‘ç¹é¡¹é›†ã€‚</p><p>å‘ï¼Œæ¥ä¸‹æ¥æ•´ç‚¹æ•°å­¦ã€‚</p><h3 id="math">math</h3><p>æ”¯æŒåº¦$Support(A,B)=P(AB)=\frac{|AB|}{|\Omega|}$</p><p>å¤šä¸ªäº‹ç‰©çš„æ”¯æŒåº¦å½“ç„¶å¯ä»¥æ¨äº†å˜›ã€‚å½“ç„¶ï¼Œè¿™ç§ä¸œè¥¿ä¸ä¸€å®šèƒ½å¤Ÿæˆä¸ºé¢‘ç¹é¡¹é›†çš„è¯„åˆ¤æ ‡å‡†ï¼Œæ¥ä¸‹æ¥ä¾¿æœ‰ï¼š</p><p>ç½®ä¿¡åº¦$Confidence(A&lt;-B)=P(A|B)$</p><p>å‘ï¼Œæ¡ä»¶æ¦‚ç‡ï¼æ¡ä»¶æ¦‚ç‡å°±èƒ½ç¨å¾®æ•´ç‚¹å’Œå…³è”æ€§äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿã€‚</p><p>æå‡åº¦$Lift(A&lt;-B)=P(A|B)/P(AB)$</p><p>è¿™å°±èƒ½ä¸€çœ¼é¡¶é’ˆäº†ã€‚è‹¥ $Lift$ èƒ½å¤Ÿå¤§äº1ï¼Œåˆ™è¯¥è§„åˆ™($A&lt;-B$)ä¸ºæœ‰æ•ˆå¼ºå…³è”è§„åˆ™ï¼Œè€Œç­‰äº1å°±æ˜¯æˆ‘ä»¬æ¦‚ç‡è®ºå­¦è¿‡çš„ç›¸äº’ç‹¬ç«‹äº‹ä»¶ï¼š</p><p>$P(X|Y)=P(X)$</p><p>å°äºç­‰äº1å°±æ˜¯æ— æ•ˆçš„å¼ºå…³è”è§„åˆ™äº†ã€‚<br>å½“ç„¶ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰æ ‡å‡†ï¼Œè¿™é‡Œåªæ˜¯ä¸€äº›å¸¸ç”¨çš„å½¢å¼ã€‚å½“æˆ‘ä»¬è‡ªå®šä¹‰çš„æ ‡å‡†ç®—å‡ºçš„å€¼å¤§äºæŸä¸ªé˜ˆå€¼ï¼ˆçœ‹çœ‹ä¹‹åèƒ½ä¸èƒ½å¡«å‘è§£é‡Šä¸‹ï¼‰,ä¾¿å¯è®¤ä¸ºä»–æ˜¯é¢‘ç¹ké¡¹é›†ã€‚</p><h2 id="æ¥ç‚¹æ€§è´¨">æ¥ç‚¹æ€§è´¨</h2><p>kç»´æ•°æ®é¡¹é›†ä¸ºé¢‘ç¹é¡¹é›†çš„å¿…è¦æ¡ä»¶æ˜¯æ‰€æœ‰k-1å­é¡¹é›†ä¹Ÿä¸ºé¢‘ç¹é¡¹é›†ã€‚ï¼ˆå…ˆéªŒåŸç†ï¼‰<br>ä¼¼ä¹å¯ä»¥æ ¹æ®è¿™ä¸ªè§„åˆ™æ¥çº¿æ€§é€’æ¨ï¼Ÿ</p><p>å…·ä½“ä¼¼ä¹ä¹Ÿè¡¥å……ä¸äº†å¤ªå¤šï¼Œå…ˆæ”¾ç€ğŸ•Šã€‚</p><h2 id="æ¥ç‚¹å®ç°">æ¥ç‚¹å®ç°</h2><p>ä¸ºäº†æ‰¾å‡ºæ‰€æœ‰é¢‘ç¹ké¡¹é›†çš„é›†åˆ$L_k$ï¼Œéœ€è¦é€å±‚æœç´¢ã€‚ç°åœ¨ï¼Œå¯¹äºç”Ÿæˆ$L_k$:</p><h3 id="è¿æ¥æ­¥éª¤">è¿æ¥æ­¥éª¤</h3><p>æ ¹æ®ç»™çš„æ•°æ®é›†ï¼Œç”Ÿæˆ$C_k$ï¼ˆå€™é€‰é›†åˆï¼‰ç½¢ï¼ä¹Ÿå°±æ˜¯å¤šä¸€é¡¹çš„é—®é¢˜ï¼<br>ä½†ä¸€çœ¼TLEï¼ˆé”™ä¹±ï¼‰</p><h3 id="å‰ªææ­¥éª¤">å‰ªææ­¥éª¤</h3><p>$C_k$æ˜¯$(L_k)$çš„è¶…é›†ï¼Œæ‰€ä»¥$C_k$å¯ä»¥ç»§ç»­å‰ªæã€‚<br>å‹ç¼©$C_k $ï¼ˆåˆ©ç”¨å‰é¢è®²çš„æ€§è´¨ï¼‰,ç”¨éç©ºå­é›†æ˜¯å¦æ˜¯é¢‘ç¹é¡¹é›†ï¼ˆé˜ˆå€¼ä¹‹ç±»çš„ï¼‰åšåˆ¤æ–­æ¡ä»¶æ¥å‰ªæï¼Œç„¶åç”¨é˜ˆå€¼å†æ¬¡åˆ¤æ–­æ˜¯å¦æ˜¯é¢‘ç¹é¡¹é›†ã€‚</p><p>æœ€åï¼Œè‹¥æ‰«æké¡¹é›†ä¸ºç©ºé›†ï¼Œåˆ™k-1ä¸ºæœ€å¤§é¢‘ç¹é¡¹é›†ï¼Œç®—æ³•ç»“æŸã€‚</p><p>å½“ç„¶ï¼Œè¿˜æœ‰è¯¸å¦‚æå¤§é¢‘ç¹é¡¹é›†ï¼Œè¿™ç­‰ä¹‹åå¡«å‘äº†ã€‚ä»ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå…¶å®è¿™æ–¹æ³•è›®ä½æ•ˆçš„ï¼Œä¸¤å‰ªæåœ¨æ¯å±‚éƒ½è¦æ‰«ææ•°æ®é›†å‰é¢éƒ½æ˜¯fwï¼Œå…¶å®å’Œæš´å®å·®ä¸å¤šäº†ã€‚</p><h2 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h2><p>æ„Ÿè§‰æˆ‘å†™äº†ä¸€å †æŒ–äº†ä¸€å †å‘ï¼Œä¹ã€‚å›¾çµğŸ‘ŠğŸ˜­ã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®æŒ–æ˜ </tag>
            
            <tag> é¢‘ç¹é¡¹é›† </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
